---
title: "TÃ‰CNICAS DE ANÃLISIS MULTIVARIANTE"
subtitle: "MÃ¡ster propio (NTIC) en Â«Big Data y Business AnalyticsÂ»"
author:
  - "Profesor: Javier Ãlvarez LiÃ©bana"
institute: "Facultad de Estudios EstadÃ­sticos (UCM)"
date: "22/04/2022 - 23/04/2022 (actualizado: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    self_contained: false
    lib_dir: libs
    css: [default, style.css]
    nature:
      # beforeInit: "stylejs.js"
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---


```{r settings, include = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina = 3, out.width = "100%", cache = FALSE,
                      comment = ">", echo = TRUE, message = FALSE,
                      warning = FALSE, hiline = TRUE, dpi = 120)

# xaringan Extra
# devtools::install_github("gadenbuie/xaringanExtra")
library(xaringanExtra)
use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
use_tile_view() # panel
# xaringanExtra::use_scribble() # scribble
use_extra_styles(hover_code_line = TRUE,
                 mute_unhighlighted_code = FALSE) # Hover triangle code line
use_clipboard( # About clipboard
  button_text = "Click para copiar cÃ³digo",
  success_text = "CÃ³digo copiado",
  error_text = "Ctrl+C para copiar"
)
use_freezeframe() # restarting gifs
use_animate_all("fade") # animates
use_panelset() # panels 
```

class: inverse center middle

# ATAJOS DE LAS DIAPOSITIVAS



$$\\[2.7in]$$

.left[Pulsa <kbd-black>O</kbd-black> para ver el panel de diapositivas]
.left[Pulsa <kbd-black>H</kbd-black> para ver otros atajos]

---


# Material de las clases


.pull-left[

- **Diapositivas** del curso:
<https://dadosdelaplace.github.io/teaching/pca-clustering>

- **Scripts** del curso:
<https://github.com/dadosdelaplace/teaching/tree/main/bdba-pca-clustering-2022/scripts>

- **BibliografÃ­a**: <https://github.com/dadosdelaplace/teaching/tree/main/bdba-pca-clustering-2022/biblio>

&nbsp;

- **Manual** de R: <https://dadosdelaplace.github.io/courses-intro-R/>

- **Materiales del curso de dataviz** en R: <https://dadosdelaplace.github.io/curso-dataviz-ECI-2022>


]

.pull-right[

```{r material, echo = FALSE,  out.width = "83%", fig.align = "right"}
knitr::include_graphics("./img/portada_master.jpg")
``` 

]

---

# Me presento: la turra

.pull-left[

```{r echo = FALSE,  out.width = "80%", fig.align = "left"}
knitr::include_graphics("./img/me.jpeg")
``` 

]

.pull-right[

* **Javier Ãlvarez LiÃ©bana**, nacido en 1989 en Carabanchel Bajo (Madrid)


* No, lo siento, Manolito era de Caranbanchel Alto)


* Licenciado (UCM) en **MatemÃ¡ticas** (Erasmus en Bologna mediante)

* **MÃ¡ster (UCM) en IngenierÃ­a MatemÃ¡tica** (2013-2014)


* **Doctorado en estadÃ­stica** por la Universidad de Granada


* Encargado de la **visualizaciÃ³n y anÃ¡lisis de datos covid** de la ConsejerÃ­a de Salud del **Principado de Asturias**

]

&nbsp;

Intentando la **divulgaciÃ³n cientÃ­fica** por `Twitter (@dadosdelaplace)` e `Instagram (@javieralvarezliebana)`

---

# Objetivos


.pull-left[

El propÃ³sito de estas clases serÃ¡ el tratamiento de **datos multidimensionales**, con tres objetivos principales:

- **ReducciÃ³n de la dimensiÃ³n**: Â¿todas las variables (columnas) nos aportan informaciÃ³n? Â¿Todas son necesarias? Â¿Podemos transformar las variables para mantener la informaciÃ³n de los datos pero reducir la dimensionalidad de los mismos?

- **VisualizaciÃ³n**: Â¿cuÃ¡ntas dimensiones podemos incluir en un grÃ¡fico 2D? Â¿CÃ³mo visualizar datos multidimensionales?

- **Encontrar patrones**: Â¿cÃ³mo agrupar (clusterizar) los elementos en funciÃ³n de sus diferencias y similitudes?

]

.pull-right[

```{r material2, echo = FALSE,  out.width = "120%", fig.align = "left"}
knitr::include_graphics("./img/portada_master.jpg")
``` 

]

&nbsp;

ğŸ“š Estas **diapositivas** han sido elaboradas con el propio `R` haciendo uso del paquete `{xaringan}`
y `{xaringanExtra}`.


---


# Requisitos

Para el presente curso los Ãºnicos **requisitos** serÃ¡n:

1. **ConexiÃ³n a internet** (para la descarga de algunos datos y paquetes).

2. **Instalar R**: serÃ¡ nuestro **lenguaje**, nuestro **castellano** para poder Â«comunicarnos con el ordenador. La descarga la haremos (gratuitamente) desde <https://cran.r-project.org/>

3. **Instalar R Studio**. De la misma manera que podemos escribir castellano en un ordenador, en un Word, en un papel o en un tuit, podemos usar distintos IDE (entornos de desarrollo integrados, nuestro Office), para que el trabajo sea mÃ¡s cÃ³modo. Nuestro **Word** para nosotros serÃ¡ **RStudio**.

.left[
  <img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/cran-R.jpg" alt = "cran-R" align = "left" width = "500" style = "margin-top: 5vh">
]

.right[
  <img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/R-studio.jpg" alt = "RStudio" align = "right" width = "500" style = "margin-top: 5vh;">
]


---

# R vs excel

![](./img/meme_barco.jpg)

---

# Incel vs excel

```{r echo = FALSE, out.width = '85%', fig.align = "center"}
knitr::include_graphics("./img/incel.jpg")
```

---

# Tips de RStudio: modo oscuro

<img src = "https://dadosdelaplace.github.io/courses-ECI-2022/img/menu_1.jpg" alt = "Rstudio" align = "left" width = "300" style = "margin-top: 3vh;margin-right: 2rem;">
<img src = "https://dadosdelaplace.github.io/courses-ECI-2022/img/menu_2.jpg" alt = "Rstudio" align = "left" width = "350" style = "margin-top: 3vh;margin-right: 2rem;">

**Consejo**: cambiar en tu `RStudio` la tonalidad del fondo de tu programa, en tonos oscuros y no blancos.

---

# Datos: de la celda a la tabla

<img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/celdas.jpg" alt = "celdas" align = "center" width = "850" style = "margin-top: 1vh;">


* **Celda**: un **dato individual** de un tipo concreto.
* **Variable**: **concatenaciÃ³n de datos** del mismo tipo.
* **Matriz**: **concatenaciÃ³n de variables** del **mismo tipo** y longitud.
* **Tabla**: **concatenaciÃ³n de variables** de **distinto tipo** pero igual longitud.

---

class: inverse center middle

# BLOQUE I. SelecciÃ³n de variables: PCA

&nbsp;


### [Â¿Por quÃ© es un paso importante en el anÃ¡lisis de datos multidimensional?](#intro-PCA)

### [TeorÃ­a: anÃ¡lisis de componentes principales](#teoria-PCA)

### [PrÃ¡ctica: PCA en R (visualizaciÃ³n)](#practica-PCA)

---

name: intro-PCA
class: center, middle

# Â¿Por quÃ© es un paso importante en el anÃ¡lisis de datos multidimensional?

### **Â¿QuÃ© es el anÃ¡lisis multivariante?**

---

# Breve historia de la estadÃ­stica

* Del (neo)latÃ­n Â«statisticum collegiumÂ»: consejo de **Estado**.
* Del alemÃ¡n Â«statistikÂ» (ciencia del **Estado**, intoducido por G. Achenwall).

&nbsp;

**Origen**: una herramienta para la **administraciÃ³n** eficiente del Estado, pero **sin intenciÃ³n de comunicar ni de convertir el dato en informaciÃ³n**.

---

# Breve historia de la estadÃ­stica

.pull-left[

## Primeros usos: elaboraciÃ³n de censos

Los **primeros usos** documentados de la estadÃ­stica fueron la elaboraciÃ³n de **censos** por parte de **mesopotÃ¡micos, chinos y egipcios**, con tres fines:

* Cobrar **impuestos** (un saludo, Willyrex).
* Reparto de **tierras** y optimizaciÃ³n de su uso.
* **Reclutamiento de soldados**.

]

.pull-right[

## EstadÃ­stica en la guerra

SegÃºn TucÃ­dides, conceptos estadÃ­sticos como la **moda** datan del **siglo V a.C.**: para asaltar la muralla de la ciudad de Platea, ponÃ­an a contar a varios soldados el nÃºmero de ladrillos vistos en la muralla, quedÃ¡ndose con el **conteo mÃ¡s repetido (la moda, el mÃ¡s frecuente)**, permitiendo el cÃ¡lculo de la altura de la muralla.

```{r echo = FALSE, out.width = "70%", fig.align = "center"}
knitr::include_graphics("./img/peloponeso.jpg")
```

]

---

# Â¿QuÃ© han hecho los romanos por nosotros?

.pull-left[

Precisamente por el tamaÃ±o de su Imperio, fueron los **romanos** quienes hicieron un uso mÃ¡s intenso de la estadÃ­stica:

* **Censos** (elaborados por la censura, que elaboraba no solo el censo sino la supervisiÃ³n de la moralidad pÃºblica).
* Primeras **tablas de natalidad/mortalidad**
* Primeros **catastros** (registros oficiales de propiedades, primeros impuestos)

```{r echo = FALSE, out.width = "60%", fig.align = "center"}
knitr::include_graphics("./img/catastro.jpg")
```

]

.pull-right[

```{r echo = FALSE, out.width = "95%", fig.align = "left"}
knitr::include_graphics("https://www.publico.es/tremending/wp-content/uploads/2019/02/lifeofbrian3.jpg")
```

]

---

# Breve historia de la estadÃ­stica

.pull-left[

## **ÃRABES**

Autores de los **primeros tratados de estadÃ­stica**, como el manuscrito de **Al-Kindi (801-873)**, que usÃ³ la distribuciÃ³n de **frecuencias de palabras** para el desarrollo de mÃ©todos de cifrado y descifrado de **mensajes encriptados**.

]

.pull-right[

## **MÃ‰XICO**

Ya en el **aÃ±o 1116, el rey XÃ³lotl** implementÃ³ un **censo** que consistÃ­a en la **estimaciÃ³n de piedras**, tirando cada sÃºbdito una a un montÃ³n (Nepohualco).
]


&nbsp;

.pull-left[

## **INGLATERRA**

Desde el siglo XII se realiza la **Prueba del Pyx**, considerado uno de los **primeros controles de calidad**: se extre una de las monedas acuÃ±adas y se deposita en una caja, para un aÃ±o despuÃ©s comprobar su calidad y pureza.

]

.pull-right[

## **ITALIA**

En paralelo al **auge de los primeros Â«sistemas financierosÂ» en Italia**, Â«La Nuova CrÃ³nicaÂ» de G. Villani fue considerado durante mucho tiempo el primer tratado de estadÃ­stica (hasta el descubrimiento de los trabajos de Al-Kindi).

]

---

# NavegaciÃ³n y astronomÃ­a

Y es de aquella Ã©poca medieval, en la que la navegaciÃ³n y la astronomÃ­a empezaban a tomar relevancia cientÃ­fica, cuando aparece la que se considera la primera grÃ¡fica (aunque no propiamente estadÃ­stica) <sup>1</sup>, representando el **movimiento cÃ­clico de los planetas** (entre los siglos X y XI)

```{r echo = FALSE,  out.width = "60%", fig.align = "center", fig.cap = "GrÃ¡fica extraÃ­da de Beniger y Robyn (1978)"}
knitr::include_graphics("./img/dataviz_historico_1.png")
``` 

[1] [ğŸ“š Â«Quantitative Graphics in Statistics: A Brief HistoryÂ» de James R. Beniger y Dorothy L. Robyn. The American Statistician (1978)](https://www.jstor.org/stable/2683467)

 
---

# NavegaciÃ³n y astronomÃ­a

Con una motivaciÃ³n similar, en torno a 1360 el matemÃ¡tico **Nicole Oresme** diseÃ±Ã³ el **primer grÃ¡fico de barras**<sup>1</sup> (no estadÃ­stico), con la idea de **visualizar a la vez dos magnitudes fÃ­sicas teÃ³ricas**.


```{r echo = FALSE,  out.width = "30%", fig.align = "center", fig.cap = "GrÃ¡fica extraÃ­da de Friendly y Valero-Mora (2010), de Â«Tractatus De Latitudinibus FormarumÂ»"}
knitr::include_graphics("./img/dataviz_historico_2.jpeg")
``` 

[1] [ğŸ“š Â«The First (Known) Statistical Graph: Michael Florent van Langren and the 'Secret' of LongitudeÂ» de M. Friendly y P. M. Valero-Mora. The American Statistician (2010)](https://www.researchgate.net/publication/227369016_The_First_Known_Statistical_Graph_Michael_Florent_van_Langren_and_the_Secret_of_Longitude)

 
---

# Primer grÃ¡fico estadÃ­stico

La mayorÃ­a de expertos, como Tufte <sup>1,2</sup>, consideran **este grÃ¡fico** casi longitudinal como la **primera visualizaciÃ³n de datos** de la historia, hecha por **van Langren** en 1644, representando la **distancia (en longitud) entre Toledo y Roma** (un poco mal medida ya que la distancia real es de 16.5Âº).

```{r echo = FALSE,  out.width = "45%", fig.align = "center", fig.cap = "GrÃ¡fica original extraÃ­da de Friendly y Valero-Mora (2010)"}
knitr::include_graphics("./img/longitud_dataviz.jpg")
``` 

```{r echo = FALSE,  out.width = "45%", fig.align = "center", fig.cap = "AdaptaciÃ³n extraÃ­da de Friendly y Valero-Mora (2010)"}
knitr::include_graphics("./img/dataviz_historico_3.jpeg")
``` 

[1] [ğŸ“š Â«Visual explanations: images and quantities, evidence and narrativeÂ» de E. Tufte](https://archive.org/details/visualexplanatio00tuft)

[2] [ğŸ“š Â«PowerPoint is evilÂ» de E. Tufte](https://www.wired.com/2003/09/ppt2/)

---


# Historia de la estadÃ­stica: navegaciÃ³n y astronomÃ­a

.pull-left[

### T. Brahe

Uno de los primeros usos Â«modernosÂ» de la estadÃ­stica fue en la **navegaciÃ³n y la astronomÃ­a**, siendo Tycho Brahe de los primeros en utilizar la estadÃ­stica para **reducir los errores** observacionales.
]

.pull-right[

### E. Wright

Fue el primero en usar en 1599 lo que hoy llamamos **mediana** en su libro Â«Certaine errors in navigationÂ», aplicada a la navegaciÃ³n.

]

.pull-left[

### G. Galileo

Aunque la fama se la llevÃ³ **Gauss**, fue el primero en plantear una idea similar a la que hoy llamamos **mÃ©todo de mÃ­nimos cuadrados**: los valores mÃ¡s probables serÃ­an aquellos que minimizaran los errores.

]

.pull-right[
### C. F. Gauss y A. M. Legendre

El **mÃ©todo de los mÃ­nimos cuadrados**, en el que basan modelos actuales como la regresiÃ³n, fue desarrollado por **Legendre y Gauss** (el Ãºltimo lo aplicÃ³ a la detecciÃ³n mÃ¡s probable del planeta enano Ceres).

]

---

# Historia de la estadÃ­stica: demografÃ­a, epidemiologÃ­a y fisiologÃ­a

.pull-left[

#### J. Graunt

Autor de Â«Natural and Political Observations Made upon the Bills of MortalityÂ» (1662), uno de los primeros trabajos en los que ya se hablaba de **exceso de mortalidad** a partir de las primeras tablas de natalidad y mortalidad, **estimando la poblaciÃ³n de Londres**.
]

.pull-right[

#### G. Neumann

Las **fakes news** ya existÃ­an en el siglo XVII: Gaspar Neumann tambiÃ©n un precursor en el **anÃ¡lisis estadÃ­stico de tablas de mortalidad**, para desmentir bulos (ejemplo: desmontÃ³ la creencia de que en los aÃ±os acabados en siete morÃ­an mÃ¡s personas).
]


Son precisamente las tablas de Graunt las que usÃ³ **Christiaan Huygens** (pionero en teorÃ­a de probabilidad con su Â«De ratiociniis in ludo aleaeÂ» en 1656) para generar la **primera grÃ¡fica de densidad** de una distribuciÃ³n continua, visualizando la **esperanza de vida** (en funciÃ³n de la edad).


---

# Primer grÃ¡fico de densidad


```{r echo = FALSE,  out.width = "50%", fig.align = "center", fig.cap = "Primera funciÃ³n de densidad, extraÃ­da de https://omeka.lehigh.edu/exhibits/show/data_visualization/vital_statistics/huygen"}
knitr::include_graphics("https://omeka.lehigh.edu/files/fullsize/65fc32c11a768f1d3263a99caca28dff.jpg")
``` 

---

# El gran boom: los grÃ¡ficos de Playfair

La figura que cambiÃ³ el dataviz fue, sin lugar a dudas, el economista y polÃ­tico **William Playfair (1759-1823)**. En 1786 publicÃ³ el **Â«Atlas polÃ­tico y comercialÂ»**<sup>1,2</sup> con 44 grÃ¡ficas (43 series temporales y el **diagrama de barras mÃ¡s famoso**, aunque no el primero).

.pull-left[

```{r echo = FALSE, out.width = "85%", fig.align = "center", fig.cap = "GrÃ¡ficas de Playfair, extraÃ­das de Funkhouser y Walker (1935)"}
knitr::include_graphics("./img/playfair_1.jpg")
``` 

]

.pull-right[

```{r echo = FALSE, out.width = "35%", fig.align = "center", fig.cap = "GrÃ¡ficas de Playfair, extraÃ­das de Funkhouser y Walker (1935)"}
knitr::include_graphics("./img/playfair_2.jpg")
``` 

]

[1] [ğŸ“š Â«Atlas polÃ­tico y comercialÂ» de William Playfair (1786)](https://www.amazon.es/Playfairs-Commercial-Political-Statistical-Breviary/dp/0521855543)

[2] [ğŸ“š Â«Playfair and his chartsÂ» de H. Gray Funkhouser and  Helen M. Walker (1935)](https://www.jstor.org/stable/45366440)

---

# Primer grÃ¡fico de barras

Playfair es ademÃ¡s el **autor del grÃ¡fico de barras mÃ¡s famoso** (aunque no fue el primero, pero sÃ­ el que sentÃ³ un precedente, quien lo hizo _mainstream_).

.pull-left[

```{r echo = FALSE, out.width = "95%", fig.align = "center", fig.cap = "GrÃ¡ficas de Playfair de importaciones (barras grises) y exportaciones (negras) de Escocia en 1781, extraÃ­das de la wikipedia."}
knitr::include_graphics("./img/playfair_5.jpg")
``` 

]

.pull-right[

```{r echo = FALSE, out.width = "95%", fig.align = "center", fig.cap = "Primer diagrama de barras (Philippe Buache y Guillaume de Lâ€™Isle), visualizando los niveles del Sena desde 1732 hasta 1766, extraÃ­da de https://friendly.github.io/HistDataVis"}
knitr::include_graphics("./img/playfair_6.jpg")
``` 

]


---


# EpidemiologÃ­a y bioestadÃ­stica

.pull-left[

#### F. Galton

Primo de Charles Darwin, inventor de los **silbatos para perretes**, de los mapas de predicciÃ³n meteorolÃ³gica y la persona que acuÃ±Ã³ el concepto de **regresiÃ³n** (y el de eugenesia :/).

```{r echo = FALSE, out.width = "93%", fig.align = "center"}
knitr::include_graphics("https://www.bogleheads.org/w/images/thumb/9/95/Screen_Shot_2012-01-03_at_7.36.29_AM.png/600px-Screen_Shot_2012-01-03_at_7.36.29_AM.png")
``` 


]

.pull-right[

```{r echo = FALSE, out.width = "58%", fig.align = "center"}
knitr::include_graphics("./img/galton_1.jpg")
``` 

```{r echo = FALSE, out.width = "58%", fig.align = "center"}
knitr::include_graphics("./img/galton_2.png")
``` 

]



---

# EpidemiologÃ­a y bioestadÃ­stica

.pull-left[

#### John Snow

Se le considera uno de los pioneros de la **epidemiologÃ­a moderna** y la **estadÃ­stica espacial**: aunque los **diagramas de Voronoi** tardarÃ­an aÃ±os en ser formalizados, John Snow aplicÃ³ el mismo concepto para mitigar la **epidemia de cÃ³lera en Londres**, con su **mapa con diagrama de barras**, localizando el foco en la conocida fuente de Broad Street.

]

.pull-right[

```{r echo = FALSE, out.width = "100%", fig.align = "center"}
knitr::include_graphics("https://media.revistagq.com/photos/5cc84a91c46d3a2b7435d7cf/2:3/w_1799,h_2699,c_limit/pelo%20jon%20snow.jpg")
``` 

]

---

# El boom de la estadÃ­stica: epidemiologÃ­a y bioestadÃ­stica


.pull-left[

#### John Snow

Se le considera uno de los pioneros de la **epidemiologÃ­a moderna** y la **estadÃ­stica espacial**: aunque los **diagramas de Voronoi** tardarÃ­an aÃ±os en ser formalizados, John Snow aplicÃ³ el mismo concepto para mitigar la **epidemia de cÃ³lera en Londres**, con su **mapa con diagrama de barras**, localizando el foco en la conocida fuente de Broad Street<sup>1</sup>.


[1] [ğŸ“š Â«El mapa fantasmaÂ», Steven Johnson, sobre la historia de John Snow](https://capitanswing.com/libros/el-mapa-fantasma/)


]

.pull-right[

```{r echo = FALSE, out.width = "100%", fig.align = "center", fig.cap = "John Snow, el epidemiÃ³logo"}
knitr::include_graphics("https://s1.eestatic.com/2016/04/22/reportajes/reportajes_119248513_3987143_854x640.jpg")
``` 

]

---

# Nacimiento de la estadÃ­stica espacial

```{r echo = FALSE, out.width = "77%", fig.align = "center", fig.cap = "Mapa de Londres, mostrando los casos de cÃ³lera del 19 de agosto al 30 de septiembre de 1854, extraÃ­do de https://friendly.github.io/HistDataVis."}
knitr::include_graphics("./img/snow_mapa.jpg")
``` 

---

# CÃ³lera en Londres

Esa **epidemia de cÃ³lera** en Londres fue una catÃ¡strofe en tÃ©rminos humanos pero supuso un verdadero auge de la **bioestadÃ­stica y visualizaciÃ³n de datos**. Unos aÃ±os antes que Snow, **William Farr** ya usaba el dataviz para **monitorizar las muertes diarias**<sup>1</sup> de cÃ³lera (abajo, cÃ³lera en azul, diarre en amarillo), en funciÃ³n del tiempo meteorolÃ³gico (arriba)


```{r echo = FALSE, out.width = "48%", fig.align = "center"}
knitr::include_graphics("./img/farr_colera.png")
``` 

[1] [Â«General Register Office, Report on the Mortality of Cholera in England, 1848â€“49Â» publicado en 1852](https://wellcomecollection.org/works/pajtrpez/items?canvas=9)


---


# Florence Nigthingale: una revoluciÃ³n

.pull-left[


* El 21 de octubre de 1854 **Florence Nigthingale** fue enviada para mejorar las **condiciones sanitarias** de los **soldados britÃ¡nicos en la guerra de Crimea**. 

* A su regreso se dedicÃ³ a demostrar que los **soldados fallecÃ­an por las condiciones sanitarias**: eran **muertes evitables**. Nigthingale es la creadora del famoso **diagrama de rosa**, permitiendo pintar tres variables a la vez y su estacionalidad.

* El 8 de febrero de 1955, The Times la describiÃ³ como la **Â«Ã¡ngel guardiÃ¡nÂ» de los hospitales**, y al finalizar la contienda, fue recibida como una heroÃ­na, conocida como **Â«The Lady with the LampÂ»** tras un poema de H. W. Longfellow publicado en 1857.

* AÃ±os despuÃ©s se convirtiÃ³ en la **primera mujer en la Royal Statistical Society** y renunciÃ³ a su puesto para crear las primeras escuelas de enfermerÃ­a

]

.pull-right[

```{r echo = FALSE, out.width = "90%", fig.align = "center"}
knitr::include_graphics("https://www.researchgate.net/profile/Miguel-Guevara-4/publication/325622727/figure/fig1/AS:635977265582080@1528640204506/FIGURA-2-La-dama-con-la-lampara-1891-en-ingles-The-lady-with-the-lamp.png")
``` 

]

---

# Â¿QuÃ© es el anÃ¡lisis multidimensional?

Hasta la dÃ©cada de los 60, la mayorÃ­a de la estadÃ­stica que se realizaba era

* **estadÃ­stica unidimensional**: extraer informaciÃ³n de una sola variable (rentas, impuestos, exportaciones, etc).

* **estadÃ­stica bidimensional**: desde que Galton acuÃ±Ã³ la regresiÃ³n, los grandes estadÃ­sticos de principios de siglo se centraron en el **anÃ¡lisis bidimensional**, analizando la dependencia entre una variable $X$ y otra variable $Y$, con herramientas como los **coeficientes de correlaciÃ³n** de Pearson, Spearman o Kendall<sup>1</sup>


[1] [ğŸ“š Kendall, M. (1938). Â«A New Measure of Rank CorrelationÂ». Biometrika 30 (1â€“2): 81-89. doi:10.1093/biomet/30.1-2.81](https://doi.org/10.1093/biomet/30.1-2.81)

--

&nbsp;

## Wishart, contigo empezÃ³ todo

En 1928, Wishart publicÃ³ su famoso artÃ­culo <sup>1</sup> en el que, se demostraba y desarrollaba explÃ­citamente la funciÃ³n de distribuciÃ³n de una 
**distribuciÃ³n normal multivariante**<sup>2</sup>, trabajo mÃ¡s tarde extendido por Fisher.

[2] [ğŸ“š Wishart, J. (1928). Â«The generalised product moment distribution in samples from a normal multivariate populationÂ». Biometrika. 20A (1â€“2): 32â€“52. doi:10.1093/biomet/20A.1-2.32](https://doi.org/10.1093/biomet/20A.1-2.32)


---
 
# Â¿QuÃ© es el anÃ¡lisis multidimensional?
 

El verdadero boom no llegÃ³ hasta la **dÃ©cada de los 60**,  con la publicaciÃ³n del libro Â«An Introduction to Multivariate Statistical AnalysisÂ»<sup>1</sup> de Anderson (1958), proporcionando todo un marco teÃ³rico

[1] [ğŸ“š Anderson, T.W. (1958). Â«An Introduction to Multivariate AnalysisÂ». New York: Wiley ISBN 0471026409](http://www.ru.ac.bd/stat/wp-content/uploads/sites/25/2019/03/301_03_Anderson_An-Introduction-to-Multivariate-Statistical-Analysis-2003.pdf)

--

&nbsp;

## **DefiniciÃ³n**

> El AnÃ¡lisis Multivariante es la rama de la estadÃ­stica que estudia las relaciones (CONJUNTAMENTE) entre conjuntos de variables dependientes y los individuos para los cuales se han medido dichas variables (Kendall)

## **NotaciÃ³n**

* $n$ tamaÃ±o muestral (nÃºmero de individuos).

* $\boldsymbol{X}_i = \left(\boldsymbol{X}_{1, i}, \ldots, \boldsymbol{X}_{i, p} \right)$ conjunto de $p$ variables medidas para cada individuo $i=1,\ldots,n$.

* Nuestros datos serÃ¡n una matriz $\boldsymbol{X}$ de $n$ filas y $p$ columnas (con $p \ll n$)

---

# Ejemplo de distribuciÃ³n bidimensional: normal bivariante

.pull-left[ 

Veamos un ejemplo sencillo con algo que seguramente nos sea familiar: la **distribuciÃ³n Normal o campana de Gauss** $X \sim \mathcal{N}\left(\mu, \sigma \right)$, cuya funciÃ³n de densidad es

$$f(x) = \frac{1}{\sigma {\sqrt{2\pi}}} e^{-{\frac{(x-\mu )^{2}}{2\sigma^{2}}}}, \quad \mu \in\mathbb{R},~\sigma >0$$

&nbsp;

La normal univariante depende de **dos parÃ¡metros**:

* esperanza o media $\mu = {\rm E} [X]$ 
* varianza (unidimensional) $\sigma^2 := {\rm Var} [X] = {\rm E} [\left(X - \mu \right)^2] = {\rm E} [X^2] - \mu^2$


]


.pull-right[

```{r eval = FALSE}
# Generamos muestra normal
rnorm(n = 10000, mean = 0, sd = 1)
```

```{r echo = FALSE}
library(tidyverse)
# Generamos una muestra normal (n = 10 000)
data <- tibble("x" = rnorm(n = 10000, mean = 0, sd = 1))
```

```{r echo = FALSE, out.width = "80%"}
# Ploteamos
ggplot(data, aes(x = x)) +
  geom_density(fill = "#F29288", alpha = 0.5, size = 1.2) +
  labs(x = "x", y = "f(x) (funciÃ³n densidad)")
```
  

]

---

# Normal bivariante

### **Â¿Y si medimos para cada individuo DOS variables?**

Si tenemos $\boldsymbol{X} = \left(X_1, X_2 \right)$, Â¿quÃ© estadÃ­sticos tenemos ahora a nuestra disposiciÃ³n?

* **Medidas marginales** (cada variable por separado):
  - medias $\mu_1:= {\rm E} [X_1]$ y $\mu_2:= {\rm E} [X_2]$
  - varianzas $\sigma_{1}^{2}:=\sigma_{1, 1}^{2} = \sigma_{X_1, X_1}^2$ y $\sigma_{2}^{2}:=\sigma_{2, 2}^{2} = \sigma_{X_2, X_2}^2$.

* **Varianza**: la varianza ${\rm Var} [X] := \sigma_{X}^2 = {\rm E} [ \left( X - \mu \right)^2 ]$ se puede entender cÃ³mo una medida que nos **cuantifica** la relaciÃ³n entre la variable consigo misma. Â¿Y si en lugar de medir $X_1$ vs $X_1$ medimos $X_1$ vs $X_2$?

--

&nbsp;

### **Covarianza**

Definiremos la covarianza como una especie de varianza en la que cambiamos una de las $X$ por la otra variable


$${\rm Cov} [X_1, X_2] := \sigma_{1,2} =  {\rm E} [ \left( X_1 - \mu_1 \right) \left( X_2 - \mu_2 \right) ] = {\rm E}[X_1 * X_2] - \mu_1 * \mu_2 = \sigma_{2,1}$$

---

# Normal bivariante

### **Matriz de covarianzas**

Desde un punto de vista teÃ³rico, dada una variable aleatoria bidimensional $\boldsymbol{X} = \left(X_1, X_2 \right)^{T}$, con vector de medias $\boldsymbol{\mu} = \left(\mu_1, \mu_2 \right)^{T}$ definiremos la **matriz de varianzas y covarianzas** $\Sigma$ de la siguiente manera:

$$\boldsymbol{\Sigma} := \begin{pmatrix} \sigma_{1,1}^2 & \sigma_{1,2} \\ \sigma_{2,1} & \sigma_{2,2}^2 \end{pmatrix} = \begin{pmatrix} \sigma_{1}^2 & \sigma_{1,2} \\ \sigma_{1,2} & \sigma_{2}^2 \end{pmatrix}, \quad \left| \boldsymbol{\Sigma} \right| = \sigma_{1}^{2}  \sigma_{2}^{2} - \sigma_{1,2}^{2} > 0$$

&nbsp;

Se puede expresar **matricialmente** como

$\begin{eqnarray} \left(\boldsymbol{X} - \boldsymbol{\mu} \right)^{T}\left(\boldsymbol{X} - \boldsymbol{\mu} \right) &=& \left( X_1  - \mu_1, X_2 - \mu_2 \right)^{T} \begin{pmatrix} X_1  - \mu_1 \\ X_2 - \mu_2 \end{pmatrix} \\ &=& \begin{pmatrix} \left(X_1  - \mu_1 \right)^2 & \left(X_1  - \mu_1 \right)\left(X_2  - \mu_2 \right) \\ \left(X_2  - \mu_2 \right)\left(X_1  - \mu_1 \right) & \left(X_2  - \mu_2 \right)^2 \end{pmatrix} \end{eqnarray}$

**IMPORTANTE**: es una **matriz simÃ©trica** (nos da igual medir $X$ vs $Y$, que $Y$ vs $X$).

---

# Normal multivariante

### **Normal univariante**

$$X \sim \mathcal{N} \left(\mu, \sigma^2 \right), \quad \boldsymbol{\Sigma} = \sigma^2, \quad f(x) =  \frac{1}{\sigma {\sqrt{2\pi}}} e^{-{\frac{(x-\mu )^{2}}{2\sigma^{2}}}} = \frac{1}{\sigma {\sqrt{2\pi}}} e^{-\frac{1}{2} (x-\mu ) \boldsymbol{\Sigma}^{-1} (x-\mu )}$$


### **Normal bivariante**

$$\boldsymbol{X} = \left(X_1, X_2 \right)^{T}  \sim \mathcal{N} \left( \boldsymbol{\mu}, \boldsymbol{\Sigma} \right), \quad f(x_1, x_2) = \frac{1}{2\pi \left| \Sigma \right|^{1/2}} e^{-\frac{1}{2}{(\boldsymbol{x} - \mu )^{T} \boldsymbol{\Sigma}^{-1}(\boldsymbol{x} - \mu )}}$$

### **Normal multivariante (caso general)** 

Multivariante de $p \ll n$ variables

$$\boldsymbol{X} = \left(X_1, \ldots, X_p \right)^{T}  \sim \mathcal{N} \left( \boldsymbol{\mu}, \boldsymbol{\Sigma} \right), \quad f(x_1, \ldots, x_p) = \frac{1}{\left(2\pi \right)^{p/2} \left| \Sigma \right|^{1/2}} e^{-\frac{1}{2}{(\boldsymbol{x} - \mu )^{T} \boldsymbol{\Sigma}^{-1}(\boldsymbol{x} - \mu )}}$$

$$\boldsymbol{\Sigma} = \left(\Sigma_{i,j} \right)_{i,j=1,\ldots,p}, \quad \Sigma_{i,j}:= {\rm Cov} [X_i, X_j ] = {\rm E}[(X_i-\mu_i) (X_j - \mu_j)]$$

---

# VersiÃ³n muestral

Lo anterior nos permite conocer la **formulaciÃ³n teÃ³rica (poblacional)**: Â¿cÃ³mo calculamos la varianza y covarianza cuando tenemos una muestra $\boldsymbol{X}$ de $n$ individuos y $p$ observaciones medidas?


$$\boldsymbol{X} = \begin{pmatrix} x_{1, 1} & \ldots & x_{1, p} \\ \vdots & \ddots & \vdots \\ x_{n, 1} & \ldots & x_{n, p} \end{pmatrix} \quad \text{muestra}$$

#### **p = 2**

* **Varianzas muestrales**: $s_{x_1}^{2} := s_{1}^2 = \frac{1}{n} \sum_{i=1}^n \left(x_{i, 1} - \overline{x}_1 \right)^2$ y $s_{x_2}^{2} := s_{2}^2 = \frac{1}{n} \sum_{i=1}^n \left(x_{i, 2} - \overline{x}_2 \right)^2$, donde $\overline{x}_1$ y $\overline{x}_2$ son sus medias muestrales.

* **Covarianza muestral**: : $s_{x_1, x_2}^{2} := s_{1, 2} = s_{2, 1}^2 = \frac{1}{n} \sum_{i=1}^n \sum_{j=1}^n \left(x_{i, 1} - \overline{x}_1 \right)\left(x_{j, 2} - \overline{x}_2 \right)$

--

#### **Estimadores insesgados**

Seguramente dichos valores los hallas visto divididos por $n-1$ en lugar de $n$: los valores muestrales son estimadores de los valores poblacionales, y de aquÃ­ en adelante usaremos **estimadores insesgados**, estimadores $T$ del valor poblaciÃ³n $U$ tal que ${\rm E}[T] = U$

* Estimador insesgado de $\mu_{x}$: $\overline{x}$ tal que ${\rm E}[\overline{x}] = \mu$

* Estimador insesgado de $\sigma_{x}^2$: la **cuasivarianza** $S_{x}^2 = \frac{n}{n-1} s_{x}^{2}$ tal que ${\rm E}[\sigma_{x}^2] = S_{x}^2$

* Estimador insesgado de $\sigma_{x, y}$: la **cuasicovarianza** $S_{x, y} = \frac{n}{n-1} s_{x, y}$ tal que ${\rm E}[\sigma_{x, y}] = S_{x, y}$

---

# Matriz de covarianzas (versiÃ³n muestral)


En un **caso general**, dada una muestra $\boldsymbol{X}$ de $n$ individuos y $p$ variables

$$S_{x_{k}}^2 := S_{k}^2 = \frac{1}{n-1} \sum_{i=1}^{n} \left(x_{i, k} - \overline{x}_k \right)^2 \quad \text{(cuasi) var. muestrales (marginales)}$$


$$S_{x_{k}, x_{l}} := S_{k, l} = \frac{1}{n-1} \sum_{i=1}^{n} \sum_{j=1}^{n} \left(x_{i, k} - \overline{x}_k \right)\left(x_{j, l} - \overline{x}_l \right) \quad \text{(cuasi) covarianzas}$$

AsÃ­, la **matrÃ­z de (cuasi) covarianzas empÃ­ricas** quedarÃ¡ como

$$S := \left(S_{k, l} \right)_{k,l=1,\ldots,p} = \frac{1}{n-1} \left(\boldsymbol{X} - \boldsymbol{\mu} \right)^{T} \left(\boldsymbol{X} - \boldsymbol{\mu} \right) =_{\boldsymbol{\mu} = 0} \frac{1}{n-1} \boldsymbol{X}^{T} \boldsymbol{X}$$

&nbsp;

--

Las **covarianzas (y varianzas)** tienen un **problema**: **dependen de la magnitud** de los datos. Datos de magnitudes elevadas nos darÃ¡n valores mÃ¡s altos, proporcionando una medida que solo nos sirve para ser comparada con otra covariana, pero que **no nos proporciona una escala** para poder decir si la **relaciÃ³n lineal** entre dos variables es alta o baja.

---

# Matriz de correlaciones (versiÃ³n muestral)


Para resolverlo, tenemos la **correlaciÃ³n (de Pearson)** 

$$\rho_{k, l} := r_{k, l} = \frac{s_{k, l}}{\sqrt{s_{k}^2} \sqrt{s_{l}^2}} = \frac{S_{k, l}}{\sqrt{S_{k}^2} \sqrt{S_{l}^2}}$$

tal que siempre $-1 \leq r_{k, l} \leq 1$.

&nbsp;

De esta forma la **matriz de correlaciones** se puede expresar como

$$R := \left(r_{k, l} \right)_{k,l=1,\ldots,p} = D^{-1/2} S D^{-1/2}, \quad D = diag(S) = \begin{pmatrix} S_{1,1}^2 & \ldots & 0 \\ \vdots  & \ddots & \vdots \\  0 & \ldots & S_{p, p}^2 \end{pmatrix}$$


---


name: teoria-PCA
class: center, middle

# TeorÃ­a: anÃ¡lisis de componentes principales

---

# Objetivo: Â¿reducir dimensiÃ³n?

.pull-left[

El **objetivo Â«mainstreamÂ»** del **anÃ¡lisis de componentes principales** (PCA en inglÃ©s) suele ser el de **reducir la dimensiÃ³n** de nuestros datos: pasar de un conjunto de $n$ individuos y $p$ variables a otro de $k < p$ variables (para los mismos $n$ individuos).

&nbsp;

Esta reducciÃ³n de la dimensiÃ³n se suele hacer con **3 objetivos** principalmente:

* **Mejora computacional** de los algoritmos al tener un dataset mÃ¡s reducido.

* **Permitir la visualizaciÃ³n** en 2 o 3 dimensiones conjuntos $n$-dimensionales.

* **Reflotar patrones** subyacentes en los datos.

]

.pull-right[

```{r echo = FALSE,  out.width = "100%", fig.align = "center", fig.cap = "ExtraÃ­da de https://towardsdatascience.com/dimensionality-reduction-cheatsheet-15060fee3aa"}

knitr::include_graphics("https://miro.medium.com/max/959/1*kK4aMPHQ89ssFEus6RT4Yw.jpeg")
``` 

]

---


# Objetivo: Â¿reducir dimensiÃ³n?

.pull-left[

Â¿Entonces? Â¿No tiene sentido aplicar componentes principales o tÃ©cnicas de reducciÃ³n de la dimensiÃ³n en **datos bidimensionales**?

&nbsp;

Empecemos por un sencillo ejemplo, visualizando la **longitud y anchura de pÃ©talo** del famoso conjunto de datos `iris`

&nbsp;

**Â¿CuÃ¡les podrÃ­an ser los objetivos?** Â¿Tiene sentido en este ejemplo aplicar **tÃ©cnicas de reducciÃ³n de la dimensiÃ³n** como las componentes principales?

]

.pull-right[

```{r echo = FALSE, out.width = "100%"}
library(tidyverse)
ggplot(iris, aes(x = Petal.Width, y = Petal.Length)) +
  geom_point() +
  labs(x = "Anchura pÃ©talo", y = "Longitud pÃ©talo",
       caption = "Iris dataset extraÃ­do de Fisher (1936) y Anderson (1935).")
```

]


---


 practica-PCA
class: center, middle

# PrÃ¡ctica: PCA en R


---

class: inverse center middle

# Extra. IntroducciÃ³n al dataviz en R.

&nbsp;

### [Â¿QuÃ© es una grÃ¡fica?](#intro-historica)

### [IntroducciÃ³n a ggplot2](#intro-ggplot2)

### [La importancia de visualizar datos](#importancia-dataviz)

### [Profundizando en ggplot2](#importancia-dataviz)


---

name: intro-historica
class: center, middle


# Primer grÃ¡fico estadÃ­stico

La mayorÃ­a de expertos, como Tufte <sup>1,2</sup>, consideran **este grÃ¡fico** casi longitudinal como la **primera visualizaciÃ³n de datos** de la historia, hecha por **van Langren** en 1644, representando la **distancia (en longitud) entre Toledo y Roma** (un poco mal medida ya que la distancia real es de 16.5Âº).

```{r echo = FALSE,  out.width = "45%", fig.align = "center", fig.cap = "GrÃ¡fica original extraÃ­da de Friendly y Valero-Mora (2010)"}
knitr::include_graphics("./img/longitud_dataviz.jpg")
``` 

```{r echo = FALSE,  out.width = "45%", fig.align = "center", fig.cap = "AdaptaciÃ³n extraÃ­da de Friendly y Valero-Mora (2010)"}
knitr::include_graphics("./img/dataviz_historico_3.jpeg")
``` 

[1] [ğŸ“š Â«Visual explanations: images and quantities, evidence and narrativeÂ» de E. Tufte](https://archive.org/details/visualexplanatio00tuft)

[2] [ğŸ“š Â«PowerPoint is evilÂ» de E. Tufte](https://www.wired.com/2003/09/ppt2/)

---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?

Â¿Por quÃ© ese grÃ¡fico se considera la primera visualizaciÃ³n estadÃ­stica de la historia? Â¿QuÃ© es lo que hace que una visualizaciÃ³n sea una grÃ¡fica estadÃ­stica? **Â¿CuÃ¡l es la frontera entre una ilustraciÃ³n y una grÃ¡fica (de datos)?**

&nbsp;

Esas mismas preguntas se hizo **JoaquÃ­n Sevilla** en su manual <sup>1</sup>, argumentando que deben cumplir **3 requisitos**:

1. Que se base en el esquema de composiciÃ³n de **eje mÃ©trico** (proceso de medida): **no cualquier dibujo que incluya nÃºmeros** lo podemos denominar Â«grÃ¡fica estadÃ­sticaÂ». 

.pull-left[

```{r echo = FALSE,  out.width = "55%", fig.align = "center", fig.cap = "INFOGRAFÃA extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/mapa_sevilla.jpg")
``` 

]

.pull-right[

```{r echo = FALSE,  out.width = "53%", fig.align = "center", fig.cap = "GRÃFICA extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/grafica_dinero_sevilla.jpg")
``` 

]

ğŸ“š [1] [Â«GramÃ¡tica de las grÃ¡ficas: pistas para mejorar las representaciones de datosÂ» de JoaquÃ­n Sevilla](http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)


---

# Vizfail

.pull-left[

```{r echo = FALSE,  out.width = "99%", fig.align = "center", fig.cap = "Ejemplo de metÃ¡fora visual mal ejecutada"}
knitr::include_graphics("./img/persona_dataviz.jpg")
``` 

]

.pull-right[

* La figura elegida (una persona caminando) no guarda relaciÃ³n alguna con lo que se pretende representar.

* Los sectores seÃ±alados no tienen relaciÃ³n con el Ã­tem a representar, lo que dificulta su interpretaciÃ³n

* Los colores no dan informaciÃ³n de ningÃºn tipo.

* La forma hace imposible la comparaciÃ³n entre Ã¡reas (salvo que leas el % adjunto).

* La suma total supera el 100% Â¿?

* **Sin la fuente de los datos**.

]

---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?

Ese **proceso de medida** en el que una grÃ¡fica se debe apoyar lo ilustra muy bien Alberto Cairo <sup>1</sup> con esta **infografÃ­a**.


* Â¿SabrÃ­as decir en 5 segundos en que regiÃ³n el empleo ha crecido mÃ¡s? Â¿Y menos?
* Â¿SabrÃ­as decir en 5 segundos si la variaciÃ³n ha sido mayor en Madrid, La Rioja o Canarias?

```{r echo = FALSE,  out.width = "65%", fig.align = "center", fig.cap = "INFOGRAFÃA extraÃ­da de Alberto Cairo"}
knitr::include_graphics("./img/mapa_cairo_esp.jpg")
``` 

ğŸ“š [1] Â«The Functional Art: an introduction to information graphics and visualizationÂ» de Alberto Cairo.

---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?


```{r echo = FALSE,  out.width = "90%", fig.align = "center", fig.cap = "GRÃFICA extraÃ­da de Alberto Cairo"}
knitr::include_graphics("./img/mapa_cairo_2.jpg")
``` 

La principal diferencia entre otro tipo de comunicaciÃ³n visual y una **grÃ¡fica estadÃ­stica** radica en proporcionar **herramientas de medida**.

---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?

1. Que se base en el esquema de composiciÃ³n de **eje mÃ©trico**

2. Debe incluir **informaciÃ³n cuantitativa** (debe visualizar datos)

3. La relaciÃ³n de representatividad deberÃ­a **ser reversible**: los **datos deberÃ­an poder Â«recuperarseÂ»** a partir de la grÃ¡fica (una grÃ¡fica estadÃ­stica es un tipo particular de **aplicaciÃ³n** matemÃ¡tica).


```{r echo = FALSE,  out.width = "50%", fig.align = "center", fig.cap = "GrÃ¡fica extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/sevilla_densidad.jpg")
``` 

ğŸ“š [Â«GramÃ¡tica de las grÃ¡ficas: pistas para mejorar las representaciones de datosÂ» de JoaquÃ­n Sevilla](http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)


---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?

Hay muchas formas de hacer una grÃ¡fica estadÃ­stica, y **no suele pasar** por hacer un grÃ¡fico de tartas. Los **diagramas de tartas o sectores** tiene un problema de reversibilidad:

* Si hay **muchas variables**: salvo que conozcas el montante total y tengas un transportador de Ã¡ngulos a mano, es muy complicado que obtengas informaciÃ³n.

* Si hay **pocas variables**: Â¿aporta algo distinto (y/o mejor) que una tabla?


```{r echo = FALSE,  out.width = "40%", fig.align = "center", fig.cap = "GrÃ¡fica extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/sectores_sevilla.jpg")
``` 

---

# Â¿QuÃ© es una grÃ¡fica estadÃ­stica?

El principal problema de un **diagrama de sectores** es que la posible informaciÃ³n estÃ¡ contenido en los **Ã¡ngulos**, pero nuestra interpretaciÃ³n la realizamos a travÃ©s de la **comparaciÃ³n de Ã¡reas** (nuestros ojos no miden bien Ã¡ngulos), las cuales dependen no solo del Ã¡ngulo sino del radio.

Algo similar sucede con los mal llamados **grÃ¡ficos tridimensionales** (son bidimensionales con perspectiva en realidad): los valores mÃ¡s cercanos aparecen sobredimensionados, siendo prÃ¡cticamente imposible la reversibilidad.


```{r echo = FALSE,  out.width = "70%", fig.align = "center", fig.cap = "GrÃ¡fica extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/sectores_3D_sevilla.jpg")
``` 

---

# Vizfail

AdemÃ¡s, dado que un diagrama de sectores solo permite una **visualizaciÃ³n relativa** de los datos, no son comparables con otros diagramas de tartas.

```{r echo = FALSE,  out.width = "78%", fig.align = "center"}
knitr::include_graphics("https://pbs.twimg.com/media/BgDR4urIMAAnHmG?format=jpg&name=medium")
``` 

GrÃ¡fica extraÃ­da de <https://twitter.com/Dave_Andrade/status/432576336872624129?t=FGjLtxE8V1BJR_QdXdtZgQ&s=19>

---

# Â¿LÃ­neas rojas?

* Entender el contexto y respetar el dato

```{r echo = FALSE, out.width = "60%", fig.align = "center", fig.cap = "InfografÃ­a extraÃ­da de https://twitter.com/storywithdata"}
knitr::include_graphics("https://pbs.twimg.com/media/FIgZcF4X0AAzLnC?format=jpg&name=medium")
``` 

(en lo de los diagramas de tartas discrepamos :P)

---

# Contexto

Una **buena idea** puede estar mejor o peor ejecutada, y la forma de llevarla a cabo es importante

```{r echo = FALSE, out.width = "30%", fig.align = "center", fig.cap = "Un semÃ¡foro no es una mala idea, la forma de instalarlo sÃ­ puede serlo. Imagen extraÃ­da del manual de JoaquÃ­n Sevilla"}
knitr::include_graphics("./img/semaforo.jpg")
``` 

---

# Fundamentos de la visualizaciÃ³n de datos estadÃ­sticos

## **Recomendaciones**

[Â«The Functional Art: an introduction to information graphics and visualizationÂ» de Alberto Cairo](https://www.amazon.es/Functional-Art-Voices-That-Matter/dp/0321834739)


[Â«GramÃ¡tica de las grÃ¡ficas: pistas para mejorar las representaciones de datosÂ» de JoaquÃ­n Sevilla](https://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)


[Â«A Brief History of VisualizationÂ» de Friendly et al. (2008)](https://www.researchgate.net/publication/226400313_A_Brief_History_of_Data_Visualization)

[Â«Quantitative Graphics in Statistics: A Brief HistoryÂ» de James R. Beniger y Dorothy L. Robyn. The American Statistician (1978)](https://www.jstor.org/stable/2683467)]

[Â«Presentation GraphicsÂ» de Leland Wilkinson. International Encyclopedia of the Social & Behavioral Sciences](https://www.cs.uic.edu/~wilkinson/Publications/iesbs.pdf)

[Â«The Grammar of GraphicsÂ» de Leland Wilkinson](https://www.amazon.es/Grammar-Graphics-Statistics-Computing/dp/0387245448)


[Â«The Minard System: The Graphical Works of Charles-Joseph MinardÂ» de Sandra Rendgen](https://www.amazon.es/gp/product/1616896337/ref=sw_img_1?smid=A1AT7YVPFBWXBL&psc=1)


[Â«The Visual Display of Quantitative InformationÂ» de E. W. Tufte](https://www.amazon.es/Visual-Display-Quantitative-Information/dp/0961392142)

---

name: intro-ggplot2
class: center, middle

# Dataviz e introducciÃ³n a ggplot2

## **La gramÃ¡tica de los grÃ¡ficos**

&nbsp;

El paquete `{ggplot2}` se basa en la idea propuesta en Â«Grammar of graphicsÂ» del reciÃ©n fallecido Wilkinson.

---

## ggplot2: grammar of graphics (gg)

.pull-left[

```{r echo = FALSE,  out.width = "70%", fig.align = "center", fig.cap = "Imagen extraÃ­da de Reddit"}
knitr::include_graphics("https://dadosdelaplace.github.io/courses-ECI-2022/img/telling-dataviz")
``` 

]

.pull-right[

Una de las **principales fortalezas** de `R` no solo es el manejo de datos con `{tidyverse}`, tambiÃ©n la visualizaciÃ³n con uno de sus paquetes: el paquete `{ggplot2}`.

La **visualizaciÃ³n de datos** deberÃ­a ser una parte fundamental de todo anÃ¡lisis de datos. No es solo una cuestiÃ³n estÃ©tica. La visualizaciÃ³n de datos es fundamental para convertir el dato en informaciÃ³n.

]


---

## ggplot2: grammar of graphics (gg)

.pull-left[

La idea de la filosofÃ­a detrÃ¡s de `{ggplot2}` es entender los **grÃ¡ficos como parte integrada del flujo de datos**, dotÃ¡ndoles de una **gramÃ¡tica**, basÃ¡ndose en la idea de 
[Â«The Grammar of GraphicsÂ» de Leland Wilkinson](https://www.amazon.es/Grammar-Graphics-Statistics-Computing/dp/0387245448).

El objetivo es empezar con un lienzo en blanco e ir **aÃ±adiendo capas a tu grÃ¡fico**, como harÃ­as por ejemplo en Photoshop, con la diferencia de que nuestras capas podemos **ligarlas al conjunto de datos**.

La ventaja de `{ggplot2}` es poder **mapear atributos estÃ©ticos** (color, forma, tamaÃ±o) de **objetos geomÃ©tricos** (puntos, barras, lÃ­neas) en **funciÃ³n de los datos**, aÃ±adiendo transformaciones de los datos, resÃºmenes estadÃ­sticos y transformaciones de las coordenadas.


La **documentaciÃ³n** del paquete puedes consultarla en <https://ggplot2-book.org/introduction.html> 
]

.pull-right[

```{r echo = FALSE,  out.width = "100%", fig.align = "center", fig.cap = "Idea detrÃ¡s de la Â«Grammar of graphicsÂ» de Wilkinson"}
knitr::include_graphics("https://dadosdelaplace.github.io/courses-ECI-2022/img/grammar.jpg")
``` 
]


---

## ggplot2: grammar of graphics (gg)

.pull-left[


```{r echo = FALSE,  out.width = "100%", fig.align = "center", fig.cap = "Idea detrÃ¡s de la Â«Grammar of graphicsÂ» de Wilkinson"}
knitr::include_graphics("https://dadosdelaplace.github.io/courses-ECI-2022/img/grammar.jpg")
``` 

]

.pull-right[

Un grÃ¡fico se podrÃ¡ componer de las siguientes **capas**

* **Datos**
* **Mapeado de elementos estÃ©ticos (aesthetics)**: ejes, color, forma, tamaÃ±o, etc (en funciÃ³n de los datos)
* **Elementos geomÃ©tricos (geom)**: puntos, lÃ­neas, barras, polÃ­gonos, etc.
* **Componer grÃ¡ficas (facet)**: visualizar varias grÃ¡ficas a la vez.
* **Transformaciones estadÃ­sticas (stat)**: ordenar, resumir, agrupar, etc.
* **Sistema de coordenadas (coord)**: coordenadas, grids, etc.
* **Temas (theme)**: fuente, tamaÃ±o de letra, subtÃ­tulos, captions, leyenda, ejes, etc.

]

---



# Recursos y bibliografÃ­a

&nbsp;

### **Leyenda de los recursos**

&nbsp;

&nbsp;


#### ğŸ“š **ArtÃ­culos o libros** cientÃ­ficos que han sido sometidos a revisiÃ³n por pares.

&nbsp;

#### ğŸ”— **Recursos online** recomendados

&nbsp;

#### ğŸ’» Recursos para la **programaciÃ³n en R**

---

# BibliografÃ­a general

ğŸ’» **Tidy Data Tutor**: para visualizar la mecÃ¡nica interna de `{tidyverse}`. <https://tidydatatutor.com/>

ğŸ”— Web con recursos para la **introducciÃ³n a la estadÃ­stica y Machine Learning en R** <https://artofstat.com/>

ğŸ“š **Â«An Introduction to Multivariate Statistical AnalysisÂ»**. Anderson (1958) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/introduction_mva_anderson_2003.pdf>

ğŸ“š **Â«A New Measure of Rank CorrelationÂ»**. Kendall (1938) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/correlation_kendall_1938.pdf>

ğŸ“š **Â«The generalised product moment distribution in samples from a normal multivariate populationÂ»**. Wishart (1928) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/multivariate_normal_wishart_1928.pdf>

ğŸ“š **Â«On lines and planes of closest fit to systems of points in spaceÂ»**. Pearson (1901) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/fit_pearson_1901.pdf>


---

# Recursos dataviz

### Dataviz

ğŸ“š **Â«GramÃ¡tica de las grÃ¡ficas: pistas para mejorar las representaciones de datosÂ»**. Sevilla (2005) <http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf>

ğŸ“š **Â«Quantitative Graphics in Statistics: A Brief HistoryÂ»**. Beniger and Robyn <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/graphics_beniger_robin_1978.pdf>
 

---

# BibliografÃ­a componentes principales

ğŸ’» **Componentes principales** en `{tidymodels}`. <https://www.tmwr.org/dimensionality.html#beans>


ğŸ“š **Â«Principal Component AnalysisÂ»**. Jolliffe (2002) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/pca_jolliffe_2002.pdf>

ğŸ“š **Â«Principal Component AnalysisÂ»**. HervÃ© and Lynne (2010) <http://staff.ustc.edu.cn/~zwp/teach/MVA/abdi-awPCA2010.pdf>

ğŸ“š **Â«Principal Component Analysis: a review and recent developmentsÂ»**. Jolliffe and Cadima (2016) <https://royalsocietypublishing.org/doi/10.1098/rsta.2015.0202>

ğŸ”— **Â«The Mathematics Behind Principal Component AnalysisÂ»**. Dubey (2018).  <https://towardsdatascience.com/the-mathematics-behind-principal-component-analysis-fff2d7f4b643>


ğŸ”— **Â«A One-Stop Shop for Principal Component AnalysisÂ»**. Brems (2017). <https://towardsdatascience.com/a-one-stop-shop-for-principal-component-analysis-5582fb7e0a9c>

ğŸ“š **Â«On the number of principal components: a test of dimensionality based on measurements of similarity between matricesÂ»**. Dray (2008) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/numer_pca_dray_2008.pdf>


---

# Recursos y bibliografÃ­a

### Otras tÃ©cnicas de reducciÃ³n de la dimensiÃ³n

ğŸ”— Sobre **PCA y PLS**. Amat (2017). <https://www.cienciadedatos.net/documentos/35_principal_component_analysis#Introducci%C3%B3n>

ğŸ“š **Â«On the early history of the singular value decompositionÂ»**. Stewart (1993) <https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/svd_stewart_1993.pdf>

---

# BibliografÃ­a: clustering



---

# Tareas pendientes

- cuadros en dataviz
- Â¿ggplot2 aquÃ­?
- scripts covarianza/correlaciÃ³n
- Â¿pls? Â¿canonical analysis?
- clustering