---
title: "Entrega I"
description: |
  Primeros pasos en R
author:
  - name: C. Tangana (DNI 0000000-A)
    affiliation: Universidad Complutense de Madrid
    affiliation_url: 
date: "`r Sys.Date()`"
output:
    distill::distill_article:
        highlight: kate
        colorlinks: true
        code_folding: false
        toc: true            
        toc_depth: 3     
---

```{r setup, include = FALSE}
# Ajuste comunes de los chunk
knitr::opts_chunk$set(fig.width = 9, fig.asp = 1, out.width = "100%",
                      message = FALSE, warning = FALSE,
                      echo = TRUE, res = 400)
```

# Instrucciones (leer antes de empezar)

* Modifica dentro del documento `.Rmd` tus datos personales (nombre y DNI) ubicados en la cabecera del archivo.

* Asegúrate, **ANTES de seguir editando** el documento, que el archivo `.Rmd` se teje correctamente (botón Knit) y se genera el `.html` correspondiente.

* Los chunks (cajas de código) creados están o vacíos o incompletos, de ahí que la mayoría tengan la opción `eval = FALSE`. Una vez que edites lo que consideres debes ir cambiando cada chunck a `eval = TRUE` para que se ejecuten.

* Recuerda que puedes ejecutar chunk a chunk con el botón _play_ o ejecutar todos los chunk hasta uno dado (con el botón a la izquierda del anterior).

# Caso práctico I: datos de la OMS
## Paquetes necesarios

Necesitaremos los siguientes paquetes:

```{r paquetes}
# Borramos variables del environment
rm(list = ls())
library(glue)
library(gapminder)
library(tidyverse)
```




## Carga de datos

El archivo de datos a usar lo cargaremos del paquete`{tidyr}` dentro de `{tidyverse}`

```{r}
who
```

En él tenemos un caso bastante real de lo que nos podemos encontrar con **datos reales**. En el archivo tenemos datos relacionados con casos de tuberculosis **desagregados por año, país, edad, género y el tipo**. Los datos son del año 2014 y fueron recopilados por la OMS. Fuente: <http://www.who.int/tb/country/data/download/en/>.


* `country`, `iso2`, `iso3`: país (en nombre, en código con dos letras y en código con tres letras).

* `year`: año

* El resto de nombres de columnas siguen el siguiente patrón:
  - Las 3 primeras letras nos dicen si son casos nuevos o antiguos.
  - Las dos siguientes letras nos dicen el tipo: `rel` para casos de recaída, `ep` para casos de tuberculosis extrapulmonar, `sn` para casos de tuberculosis pulmonar que podrían no haber sido diagnosticados con un frotis positivo (smear negative), `sp` para casos de tuberculosis pulmonar diagnosticados con un frotis positivo (smear positive).

  - La sexta letra nos dice el sexo del paciente.
  - El resto de números nos dan el tramo etario (por ejemplo, `...4554` se refiere al tramo de 45 a 54 años)

Echa un vistazo a los datos.


## Ejercicio 1:

> Detalla todos los problemas que veas en los datos y que acciones habría que realizar (sin hacerlas aún) para convertir la tabla en tidydata

[Detalla aquí lo que consideres en texto normal]

## Ejercicio 2:


> Tras analizar la tabla, construye partir de ella una nueva con los mismos datos (no borres nada) pero recolocados de tal forma que sea tidydata 

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who1 <- who %>% pivot_...(...)
who1
```

## Ejercicio 3:

> Repite el ejercicio anterior pero eliminando las filas que tengan casos ausentes.

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who1 <- who %>% pivot_...(...)
who1
```

## Ejercicio 4:


> Aún no hemos visto tidyverse pero echa un vistazo a la ayuda de `count()` y aplica dicha función para contar con la tabla del ejercicio anterior cuantos registros tienes de cada tipo (agrupando todos los países y todos los años)

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who1 %>% count(...)
```

## Ejercicio 5:

> Observando la salida anterior, ¿deberíamos de cambiar algo de la variable que nos indica la tipología? ¿Hay coherencia en todas ellas?

[Detalla aquí lo que consideres]

## Ejercicio 6:

> Con la tabla del ejercicio 3 ejecuta este código (donde key es el nombre de la columna donde hayas guardado esa tipología de la enfermedad)

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who2 <- [tabla_ej3] %>% 
  mutate(key = str_replace(key, "newrel", "new_rel"))
who2
```

> ¿Qué crees que hemos hecho?

[Detalla aquí lo que consideres]

## Ejercicio 7:

> Construye nuevas columnas `"new"`, `"type"` y `"sexage"`, que nos separe el código de la tipología en cada una de sus partes (y se guarde en columnas nuevas)

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who3 <- who2 %>% ...
who3
```

## Ejercicio 8:

> Con la tabla anterior, separa correctamente el sexo de la edad creando dos variables `"sex"` y `"age"`

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE 
who4 <- who3 %>% ...
who4
```

## Extra:

> Aunque es de tidyverse que aún no sabemos, haciendo uso de `select()`, mirando la chuleta de `{dplyr}`, ¿sabrías como eliminar dos de las 3 columnas redundantes de país?

```{r eval = FALSE}
# Completa el código y cambia a eval = TRUE
who5 <- who4 %>% ...
who5
```
