<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>GESTI√ìN DE BASES DE DATOS</title>
    <meta charset="utf-8" />
    <meta name="author" content="Javier √Ålvarez Li√©bana (Fac. Estudios Estad√≠sticos - UCM)" />
    <link href="index_files/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="index_files/tile-view-0.2.6/tile-view.js"></script>
    <link href="index_files/animate.css-3.7.2/animate.xaringan.css" rel="stylesheet" />
    <link href="index_files/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link href="index_files/xaringanExtra-extra-styles-0.2.6/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="index_files/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="index_files/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Click para copiar c√≥digo","success":"C√≥digo copiado","error":"Ctrl+C para copiar"})</script>
    <link href="index_files/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset-0.2.6/panelset.js"></script>
    <script src="index_files/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="index_files/plotly-binding-4.9.4.1/plotly.js"></script>
    <script src="index_files/typedarray-0.1/typedarray.min.js"></script>
    <script src="index_files/jquery-3.5.1/jquery.min.js"></script>
    <link href="index_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="index_files/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <link href="index_files/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="index_files/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# GESTI√ìN DE BASES DE DATOS
## M√°ster en Bioestad√≠stica
### Javier √Ålvarez Li√©bana (Fac. Estudios Estad√≠sticos - UCM)
### √öltima actualizaci√≥n: 21-11-2022

---










class: inverse center middle

# ATAJOS DE LAS DIAPOSITIVAS





`$$\\[2in]$$`

.left[Pulsa &lt;kbd-black&gt;O&lt;/kbd-black&gt; para ver el **PANEL DE DIAPOSITIVAS**]
.left[Pulsa &lt;kbd-black&gt;H&lt;/kbd-black&gt; para ver **OTROS ATAJOS**]

---

# .orange[MATERIAL] de las clases


.pull-left[

- **.bg-purple_light[Diapositivas]** del curso:
&lt;https://dadosdelaplace.github.io/teaching/bioestad/slides&gt;

- **.bg-red_light[Evaluaci√≥n]** de la asignatura
&lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/eval&gt;

- **.bg-yellow[Scripts]** de la asignatura
&lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/scripts&gt;

- **.bg-orange[Bibliograf√≠a]**: &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/biblio&gt;

&amp;nbsp;

- **.bg-green_light[Manual introductorio de R]**: &lt;https://dadosdelaplace.github.io/courses-intro-R/&gt;

]

---

# Me presento: la turra

.pull-left[

&lt;img src="./img/me.jpeg" width="80%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

* **.bg-purple_light[Javier √Ålvarez Li√©bana]**, nacido en 1989 en Carabanchel Bajo (Madrid)

* Licenciado (UCM) en **Matem√°ticas** (Erasmus en Bologna mediante). **M√°ster (UCM) en Ingenier√≠a Matem√°tica** (2013-2014)


* **.bg-orange[Doctorado en estad√≠stica]** por la Universidad de Granada


* Encargado de la **visualizaci√≥n y an√°lisis de datos covid** de la Consejer√≠a de Salud del **Principado de Asturias**

]


Intentando eso de la **.bg-yellow[divulgaci√≥n]** por **Twitter** (@dadosdelaplace) e **Instagram** (@javieralvarezliebana)

---

name: objetivos

# .orange[OBJETIVOS] de la asignatura


El **.bg-purple_light[prop√≥sito]** de esta asignatura ser√° triple

- **.bg-orange[Quitarnos el miedo]** a programar: a programar se aprende programando, no hace falta ser Julian Assange para ello

--

- Aprender a **.bg-orange[abstraer ideas]** para implementarlas en un lenguaje de programaci√≥n, as√≠ como adquirir una base para el **.bg-orange[preprocesamiento, an√°lisis y visualizaci√≥n de datos]**.

--

- Am√©n de no tener miedo a hacerlo, encontrarle la **.bg-orange[utilidad]** y entender las facilidades que nos ofrece `R` frente a otras opciones como Excel o SPSS.


&amp;nbsp;

üìö Estas **diapositivas** han sido elaboradas con el propio `R` haciendo uso de los paquetes `{xaringan}`, `{xaringanExtra}` y `{xaringanthemer}`.

---

# .orange[CASOS REALES] de uso de R


.pull-left[

&lt;img src="./img/covid_isciii.jpg" width="97%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

&lt;img src="./img/momo_isciii.jpg" width="97%" style="display: block; margin: auto auto auto 0;" /&gt;


]

Las webs del Instituto de Salud Carlos III &lt;https://cnecovid.isciii.es/covid19/&gt; y &lt;https://momo.isciii.es/panel_momo/&gt; est√°n hechas con `R` (con `{shiny}` y `{plotly}` )

---

# .orange[CASOS REALES] de uso de R

.pull-left[

&lt;img src="./img/elpais_R.jpg" width="99%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

El **.bg-purple_light[equipo de datos]** (Borja Andrino, Kiko Llaneras y Daniele Grasso) trabaja con `R` para elaborar sus an√°lisis, desde los datos electorales hasta el cambio clim√°tico.

Es una de las razones por las que son capaces de realizar brillantes an√°lisis de grandes vol√∫menes de datos de forma r√°pida y √°gil: la **.bg-purple_light[automatizaci√≥n de procesos]** que nos permite programar en `R` puede ser fundamental para analizar datos que hasta entonces no pod√≠amos.

]


---

class: inverse center middle

# CLASES

&amp;nbsp;

.pull-left[

#### [CLASE 1: intro a R](#clase-1)

#### [CLASE 2: variables y vectores](#clase-2)

#### [CLASE 3: vectores y matrices](#clase-3)

#### [CLASE 4: primeros datos](#clase-4)

#### [CLASE 5: estructuras de control](#clase-5)

#### [CLASE 6: tidydata](#clase-6)



]

.pull-right[

#### [ENTREGA I (clase 6)](#entrega-I)

#### [CLASE 7: listas y funciones](#clase-7)

#### [CLASE 8: introducci√≥n a dplyr (tidyverse)](#clase-8)

#### [CLASE 9: tidyverse. res√∫menes estad√≠sticos](#clase-9)

#### [CLASE 10: repaso](#clase-10)

#### [CLASE 11: factores, importar/exportar](#clase-11)

]

---

class: inverse center middle

# CLASES

&amp;nbsp;

.pull-left[


#### [CLASE 12: cruzando tablas y m√°s funciones](#clase-12)

#### [ENTREGA II (clase 13)](#entrega-II)

#### [CLASE 14: introducci√≥n a ggplot](#clase-14)

#### [CLASE 15: profundizando en ggplot](#clase-15)

#### [CLASE 16: ggplot fet√©n](#...)

#### [ENTREGA III (clase 17)](#entrega-III)

]

.pull-right[


#### [CLASE 18: introducci√≥n a Stata](#...)

#### [CLASE 19: ...](#...)

#### [CLASE 20: ...](#...)

#### [CLASE 21: ...](#...)

]

---

class: inverse center middle
name: clase-1

# CLASE 1: introducci√≥n a R desde cero.

&amp;nbsp;

### [Instalaci√≥n](#instalacion)

### [¬øQu√© es R?](#que-es-R)

### [Primeros pasos](#primeros-pasos)

### [Ejercicios](#ejercicios1)

---

name: instalacion

# Requisitos

Para la asignatura los √∫nicos **.bg-purple_light[requisitos]** ser√°n:

--

1. **.bg-orange[Conexi√≥n a internet]** (para la descarga de algunos datos y paquetes).

--

2. **.bg-orange[Instalar R]**: ser√° nuestro lenguaje, nuestro **.bg-yellow[castellano]** para poder ¬´comunicarnos con el ordenador. La descarga la haremos (gratuitamente) desde &lt;https://cran.r-project.org/&gt;

--

3. **.bg-orange[Instalar R Studio]**. De la misma manera que podemos escribir castellano en un Word o en un tuit, podemos usar **distintos IDE** (entornos de desarrollo integrados, nuestro Office), para que el trabajo sea m√°s c√≥modo. Nuestro **.bg-yellow[Word]** para nosotros ser√° **RStudio**.

.left[
  &lt;img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/cran-R.jpg" alt = "cran-R" align = "left" width = "460" style = "margin-top: 2vh"&gt;
]

.right[
  &lt;img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/R-studio.jpg" alt = "RStudio" align = "right" width = "460" style = "margin-top: 2vh;"&gt;
]


---

# Instalaci√≥n de R

El lenguaje `R` ser√° nuestra **.bg-purple_light[gram√°tica]**, nuestra ortograf√≠a y nuestro diccionario

.pull-left[



- **Paso 1**: entra en &lt;https://cran.r-project.org/&gt; y selecciona **.bg-purple_light[sistema operativo]**.

- **Paso 2**: para **.bg-purple_light[Mac]** basta con que hacer click en el archivo .pkg, y abrirlo una vez descargado. Para sistemas **.bg-purple_light[Windows]**, debemos clickar en `install R for the first time` y en la siguiente pantalla en `Download R for Windows`. Una vez descargado, abrirlo como cualquier archivo de instalaci√≥n.

- **Paso 3**: abrir el **ejecutable**.

]

.pull-right[

&lt;img src = "https://raw.githubusercontent.com/dadosdelaplace/slides-ECI-2022/main/img/cran-R.jpg" alt = "cran-R" align = "left" width = "900" style = "margin-top: 1vh"&gt;

]

**.bg-green_light[Consejito]**: siempre que tengas que descargar algo de CRAN (ya sea el propio R o un paquete), aseg√∫rate de tener conexi√≥n a **.bg-orange[internet]**.


---

# Primera operaci√≥n

Para comprobar que se ha instalado correctamente, tras abrir `R`, deber√≠as ver una **pantalla blanca** similar a esta (en realidad se llama **.bg-purple_light[consola]**). Vamos a escribir nuestra **.bg-orange[primera operaci√≥n]** en la consola:

.pull-left[

* A una variable llamada `a` le asignaremos el valor 1 (asignamos con `&lt;-`, como una flecha)


```r
# Una variable a con valor --&gt; 1
*a &lt;- 1
```

]

--

.pull-right[

* A otra variable llamada `b` le asignaremos el valor 2 (cambia a la izquierda el nombre, cambia a la derecha el valor).


```r
# Una variable b con valor --&gt; 2
*b &lt;- 2
```

]

--

.pull-left[

* Sumamos las variables haciendo `a + b`.


```r
# Primera operaci√≥n
a &lt;- 1 # Una variable a con valor --&gt; 1
b &lt;- 2 # Una variable b con valor --&gt; 2
*a + b
```
]

--

.pull-right[

* El resultado que nos devuelve ser√° `3`.


```
&gt; [1] 3
```

]

---

# .orange[INSTALACI√ìN] de RStudio

El **.bg-purple_ligth[Word]** que usaremos para trabajar y escribir en nuestro lenguaje ser√° **.bg-purple_ligth[RStudio]** (lo que se conoce como un **IDE**, un entorno integrado de desarrollo).

.pull-left[

* **Paso 1**: entra en la [web oficial de RStudio](https://www.rstudio.com/products/rstudio/download/#download) y selecciona la **.bg-purple_light[descarga gratuita]**.

* **Paso 2**: selecciona el ejecutable que te aparezca, acorde a tu sistema operativo.

* **Paso 3**: tras descargar el ejecutable, hay que abrirlo como otro cualquier otro ejecutable y dejar que **.bg-purple_light[termine la instalaci√≥n]**.

]

.pull-right[

&lt;img src="./img/R-studio.jpg" width="80%" style="display: block; margin: auto auto auto 0;" /&gt;


]

---

# .orange[ORGANIZACI√ìN] de RStudio

.pull-left[

&lt;img src="./img/inicio_rstudio_2.jpg" width="95%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

* **.bg-purple_light[Consola]**: es el nombre para llamar a la ventana grande que te ocupa buena parte de tu pantalla. Prueba a escribir el mismo c√≥digo que antes (la suma) en ella. La consola ser√° donde **.bg-orange[ejecutaremos √≥rdenes]** y **.bg-yellow[mostraremos resultados]**.
]

---

# .orange[ORGANIZACI√ìN] de RStudio

.pull-left[

&lt;img src="./img/inicio_rstudio_3.jpg" width="75%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

* **.bg-purple_light[Environment]** (entorno de variables): la pantalla peque√±a (puedes ajustar los m√°rgenes con el rat√≥n) que tenemos en la parte superior derecha. Nos mostrar√° las **variables que tenemos definidas, el tipo y su valor**.

]

---

# .orange[ORGANIZACI√ìN] de RStudio

.pull-left[

&lt;img src="./img/inicio_rstudio_4.jpg" width="85%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

* **.bg-purple_light[Panel multiusos]**: la ventana que tenemos en la parte inferior derecha no servir√° para buscar **.bg-orange[ayuda de funciones]**, adem√°s de para **.bg-yellow[visualizar gr√°ficos]**. 

]

---

name: que-es-R

# ¬øQu√© es R?


&lt;img src = "https://logos.turbio.repl.co/rlang.svg" alt = "Rstudio" align = "left" width = "300" style = "margin-top: 1vh;margin-right: 2rem;"&gt;

`R` es un **.bg-purple_light[lenguaje estad√≠stico]**, creado por y para la estad√≠stica, con 4 ventajas fundamentales:

--

* **.bg-purple_light[Software libre]** (como C++, Python, etc). no solo es gratis, sino que permite **.bg-orange[acceder libremente a c√≥digo ajeno]**.

--

* **.bg-purple_light[Lenguaje modular]**: en la instalaci√≥n que hemos realizado solo se ha instalado el m√≠nimo para poder funcionar. Al ser software libre, existen **.bg-orange[trozos de c√≥digo]** hechos por otras personas (**.bg-yellow[paquetes]**) que podemos instalar seg√∫n necesidades.

--

* **.bg-purple_light[Gran comunidad de usuarios]**: `R` tiene una comunidad de usuarios gigante para hacer estad√≠stica (Python tiene una comunidad m√°s enfocada al Machine Learning), con m√°s de 18 000 paquetes.

--

* **.bg-purple_light[Lenguaje de alto nivel]**. Los lenguajes de alto nivel, como `R` o `Python`, facilitan la programaci√≥n al usuario (menor curva de aprendizaje, aunque m√°s lentos en ejecuci√≥n).

---

class: inverse center middle

**COMPRAR** libro --&gt; instalar un paquete (una sola vez) `install.packages()`
&lt;figure&gt;
&lt;img src = "https://cdn.cienradios.com/wp-content/uploads/sites/14/2020/09/Book-Depository-2.jpg" alt = "comprar-libros" align = "middle" width = "480" style = "margin-top: 1vh;"&gt;
&lt;/figure&gt;

**SELECCIONAR** libro (ya comprado) --&gt; acceder a un paquete instalado (en cada sesi√≥n que queramos usarlo) `library()`
&lt;figure&gt;
&lt;img src = "https://cdn.sincroguia.tv/uploads/programs/l/a/-/la-biblioteca-de-los-libros-rechazados-704306_SPA-77.jpg" alt = "comprar-libros-2" align = "middle" width = "480" style = "margin-top: 1vh;"&gt;
&lt;/figure&gt;


---

# Paquetes en R

A lo largo del curso usaremos varios de esos **.bg-purple_light[paquetes]**, como por ejemplo el paquete `{ggplot2}`, un paquete para la elaboraci√≥n de **.bg-purple_light[visualizaciones de datos]**. Vamos a instalarlo (necesitamos internet para ello) con la orden `install.packages("ggplot")`


```r
install.packages("ggplot2")
```

&amp;nbsp;


&amp;nbsp;



La **.bg-purple_light[instalaci√≥n]** de un paquete es el equivalente a **.bg-orange[comprar a un libro]**: solo lo debemos hacer **la primera vez** que lo usemos en un ordenador. Una vez que tenemos comprado nuestro libro, para poder usarlo, simplemente debemos indicar al programa que nos lo **.bg-purple_light[acerque de la estanter√≠a]** con `library(ggplot2)`.


```r
library(ggplot2)
```

---

class: center middle

# ¬øPor qu√© .orange[NO] usar Excel?

![](./img/meme_barco.jpg)

---

# ¬øPor qu√© .orange[NO] usar Excel?

Excel es una **.bg-purple_light[hoja de c√°lculo]**, ni m√°s ni menos, y el propio **Microsoft desaconseja su uso** para el an√°lisis de datos. El Excel es una herramienta maravillosa para ser usada como una sencilla hoja de c√°lculo (llevar cuentas de tu familia, declaraci√≥n de Renta, planificar viajes, etc).

&amp;nbsp;

**.bg-red_light[NO EST√Å DISE√ëADO]** para ser una base de datos, y muchos menos pensado para generar un entorno flexible para el an√°lisis estad√≠stico:

* **.bg-red_light[Software de pago]**

* **.bg-red_light[Software cerrado]**: solo podemos hacer lo que Excel ha cre√≠do que interesante que podamos hacer.

* **.bg-red_light[Alto consumo de memoria]**.

* **.bg-red_light[No es universal]**: no solo es de pago sino que adem√°s, dependiendo de la versi√≥n que tengas de Excel, tendr√° un formato distinto para datos como fechas, teniendo incluso extensiones distintas.

---

# .orange[Incel] vs excel

&lt;img src="./img/incel.jpg" width="75%" style="display: block; margin: auto;" /&gt;

---



# .red[EPIC FAILS] en Excel

Problemas de **.red[versiones]**


&lt;img src="./img/excel_genes.jpg" width="37%" style="display: block; margin: auto auto auto 0;" /&gt;


üìö Ver **.bg-green_light[bibliograf√≠a]** en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/biblio&gt;


---

# .red[EPIC FAILS] en Excel

Problemas de **.red[memoria]**

&lt;img src="./img/excel_uk.jpg" width="50%" style="display: block; margin: auto auto auto 0;" /&gt;


üìö Ver **.bg-green_light[bibliograf√≠a]** en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/biblio&gt;


---

# .red[EPIC FAILS] en Excel

Problemas de **.red[codificaci√≥n]**

&lt;img src="./img/excel_edades.jpg" width="50%" style="display: block; margin: auto auto auto 0;" /&gt;

üìö Ver **.bg-green_light[bibliograf√≠a]** en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/biblio&gt;

---

name: primeros-pasos

# Primeros pasos en R: .orange[CALCULADORA]

Empecemos por lo sencillo: **.bg-purple-light[¬øc√≥mo usar R como una calculadora?]** Si escribimos `2 + 1` en la consola y pulsamos ENTER, la consola nos mostrar√° el resultado de la suma.


```r
2 + 1
```

```
&gt; [1] 3
```

--

Si dicha suma la quisi√©ramos utilizar para un segundo c√°lculo: ¬øy si la **.bg-purple-light[almacenamos en alguna variable]**? Por ejemplo, vamos a guardar la suma en una variable `x`


```r
*x &lt;- 2 + 1
```

--

Si te fijas ahora `x` aparece definida en nuestro **.bg-yellow[environment]**, y puede ser usada de nuevo


```r
x + 3
```

```
&gt; [1] 6
```

---

# Primeros pasos en R: .orange[CALCULADORA]

### Multiplicaci√≥n


```r
*x * y
```

### Elevar al cuadrado


```r
*x^2
```

### Valor absoluto


```r
*abs(x)
```

---

# .red[Errores]

Durante tu aprendizaje va a ser **muy habitual** que las cosas no salgan a la primera, apareciendo en consola **.bg-purple_light[mensajes de error]** en un **.bg-red_light[color rojo]**. No te asustes: lo peor que puede pasar es que tengas que reiniciar `R`).

&amp;nbsp;

* Mensajes de **.bg-red_light[ERROR]**: ir√°n precedidos de la frase **.bg-yellow[¬´Error in‚Ä¶¬ª]**, y ser√°n aquellos fallos que **impidan la ejecuci√≥n del c√≥digo** 


```r
"a" + 1 # intentando sumar 1 a un texto
```

```
&gt; Error in "a" + 1: argumento no-num√©rico para operador binario
```

&amp;nbsp;

**.bg-green_light[CONSEJO]**: lee siempre los mensajes de error para aprender de ellos (ya que suelen dar pistas de c√≥mo resolverlos).

---

# .red[Errores]

Durante tu aprendizaje va a ser **muy habitual** que las cosas no salgan a la primera, apareciendo en consola **.bg-purple_light[mensajes de error]** en un **.bg-red_light[color rojo]**. No te asustes: lo peor que puede pasar es que tengas que reiniciar `R`).

&amp;nbsp;
 
* Mensajes de **.bg-orange[WARNING]**: ir√°n precedidos de la frase **.bg-yellow[¬´Warning in‚Ä¶¬ª]**, y son los fallos m√°s delicados ya que son posibles incoherencias pero sin que tu c√≥digo deje de ejecutarse.


```r
sqrt(-1) # raiz cuadrada de n√∫mero negativo
```

```
&gt; Warning in sqrt(-1): Se han producido NaNs
```

```
&gt; [1] NaN
```

&amp;nbsp;

**¬øHa ejecutado la orden?** S√≠, pero te advierte de que el resultado de la operaci√≥n es un `NaN`, **Not A Number**, un valor que no existe (al menos dentro de los n√∫meros reales).


---

# ¬øD√≥nde programamos? .orange[SCRIPTS]

Un **.bg-purple_light[script]** ser√° el documento en el que programamos, nuestro equivalente a un archivo .doc, pero aqu√≠ ser√° un archivo con extensi√≥n `.R`, donde **escribiremos las √≥rdenes**. Para **.bg-purple_light[abrir nuestro primero script]**, haz click en el men√∫ superior en `File &lt;&lt; New File &lt;&lt; R Script`.

&amp;nbsp;


.pull-left[


&lt;img src="./img/inicio_rstudio_5.jpg" width="95%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

**.bg-green_light[CONSEJO]**: intenta no abusar de la consola, ya que todo lo que no escribas en un script, cuando cierres `RStudio`, lo **habr√°s perdido** (c√≥mo si en lugar de escribir en un Word y guardarlo, nunca guardases el documento).

]

---


Ahora tenemos una **cuarta ventana**: la ventana donde **escribiremos nuestros c√≥digos**


### **¬øC√≥mo ejecutar nuestro script?**

.pull-left[

&lt;img src="./img/inicio_rstudio_6.jpg" width="95%" style="display: block; margin: auto auto auto 0;" /&gt;

]

.pull-right[

1. **.bg-purple_light[Escribimos el c√≥digo]** a ejecutar.

2. **.bg-purple_light[Guardamos]** el archivo `.R` haciendo click en `Save current document`.

3. El c√≥digo **no se ejecuta salvo que se lo indiquemos**. Tenemos tres opciones:
  - **.orange[Copiar y pegar]** en consola.
  - **.orange[Seleccionar l√≠neas]** y clickar en `Run`.
  - Activar `Source on save` a la **derecha de guardar**: no solo guarda sino que ejecuta el c√≥digo completo.

]

---

name: ejercicios1

# Primeros ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: a√±ade debajo otra l√≠nea para definir una variable `b` con el valor `5`. Tras asignarles valores, multiplica los n√∫meros en consola.


```r
a &lt;- 2
```

* üìù **Ejercicio 2**: modifica el c√≥digo inferior para definir dos variables `c` y `d`, con valores 3 y -1.


```r
c &lt;- # deber√≠as asignarle el valor 3
d &lt;- # deber√≠as asignarle el valor -1
```

* üìù **Ejercicio 3**: con las variables `a` y `b` del ej. 1, crea una nueva variable `e` guardando el resultado de su multiplicaci√≥n `a * b`. Escribe `e` en consola para ver su resultado

]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
# Para poner comentarios en el c√≥digo se usa #

# Definici√≥n de variables
a &lt;- 2
b &lt;- 5

# Multiplicaci√≥n
a * b
```

```
&gt; [1] 10
```
]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
# Definici√≥n de variables
c &lt;- 3
d &lt;- -1
```
]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
# Variables
a &lt;- 2
b &lt;- 5

# Resultado
e &lt;- a * b

# Muestro en consola
e
```

```
&gt; [1] 10
```

]
]

---

# Primeros ejercicios


.panelset[
.panel[.panel-name[Ejercicios extra]


* üìù **Ejercicio 4**: asigna un valor positivo a `x` y calcula su ra√≠z cuadrada; asigna otro negativo y calcula su valor absoluto con la funci√≥n `abs()`.


* üìù **Ejercicio 5**: usando la variable `x` ya definida, completa/modifica el c√≥digo inferior para guardar en una nueva variable `z` el resultado guardado en `x` menos 5.


```r
z &lt;- ? - ? # completa el c√≥digo
z
```

* üìù **Ejercicio 6**: usando las variables `x` e `y` ya definidas, calcula el m√°ximo de ambas (funci√≥n `max()`), y gu√°rdalo en una nueva variable `t`.

]

.panel[.panel-name[Soluci√≥n ej. 4]


```r
# Ra√≠z cuadrada
x &lt;- 73 # por ejemplo
sqrt(x)
```

```
&gt; [1] 8.544004
```

```r
# Valor absoluto
y &lt;- -19 # por ejemplo
abs(y)
```

```
&gt; [1] 19
```
]

.panel[.panel-name[Soluci√≥n ej. 5]


```r
z &lt;- x - 5
z
```

```
&gt; [1] 68
```
]

.panel[.panel-name[Soluci√≥n ej. 6]


```r
t &lt;- max(x, y)
t
```

```
&gt; [1] 73
```

]
]


---

class: inverse center middle
name: clase-2

# CLASE 2: primeros datos en R

&amp;nbsp;

### [Variables individuales: num√©ricas y caracteres](#variables)

### [Primer paquete y primera funci√≥n](#primer-paquete)

### [Vectores: num√©ricos y de caracteres](#vectores)

### [Variables l√≥gicas y de tipo fecha](#logicas)

### [Ejercicios](#ejercicios2)

---

name: variables

# De la .orange[celda] a la .green[tabla]
 

¬øDe qu√© tipo pueden ser los datos que tenemos contenidos en cada celda de una ¬´tabla¬ª?


&lt;img src="./img/celdas.jpg" width="55%" style="display: block; margin: auto;" /&gt;

* **.bg-purple_light[Celda]**: un dato **.bg-orange[individual]** de un tipo concreto.
* **.bg-purple_light[Variable]**: una **.bg-orange[concatenaci√≥n de valores]** del mismo tipo (**vectores**).
* **.bg-purple_light[Matriz]**: **.bg-orange[concatenaci√≥n de variables]** del **.bg-yellow[mismo tipo]** y longitud.
* **.bg-purple_light[Tabla]**: **.bg-orange[concatenaci√≥n de variables]** de **.bg-yellow[distinto tipo]** pero igual longitud.

---

# .orange[Celdas]: tipos de datos individuales

¬øExisten **variables m√°s all√° de los n√∫meros**?

&amp;nbsp;

Piensa por ejemplo en los **datos guardados de una persona**:

* La edad o el peso ser√° un **.bg-purple_light[n√∫mero]**.
* Su nombre ser√° una cadena de **.bg-purple_light[texto]**.
* Su fecha de nacimiento ser√° precisamente eso, una **.bg-purple_light[fecha]**.
* A la pregunta ¬´¬øest√° usted soltero/a?¬ª la respuesta ser√° lo que llamamos una **.bg-purple_light[variable l√≥gica]** (`TRUE` si est√° soltero/a o `FALSE` en otro caso).

&lt;img src="./img/celdas.jpg" width="40%" style="display: block; margin: auto;" /&gt;

---

# Variables .orange[NUM√âRICAS]

El **dato m√°s sencillo**, dato que ya hemos usado en nuestros primeros pasos como calculadora, ser√°n las variables que guardan simplemente n√∫meros


```r
a &lt;- 1
b &lt;- 2
a + b
```

```
&gt; [1] 3
```

--

En el c√≥digo anterior, tanto `a` como `b` como la suma `a + b` son de **.bg-purple_light[tipo num√©rico]**


```r
*class(a)
```

```
&gt; [1] "numeric"
```

```r
*typeof(a)
```

```
&gt; [1] "double"
```


---

# Variables .orange[NUM√âRICAS]

Como ya hemos visto, con los datos num√©ricos podemos realizar todas las **.bg-purple_light[operaciones aritm√©ticas]** que se nos ocurrir√≠a hacer en una **calculadora** como sumar (`+`), restar (`-`), multiplicar (`+`), dividir (`/`), ra√≠z cuadrada (`sqrt()`), valor absoluto (`abs()`), elevar al cuadrado (`^2`), elevar al cubo (`^3`), etc.




```r
a &lt;- 5
a^3 # Elevar al cubo
```

```
&gt; [1] 125
```


```r
b &lt;- -43
abs(b) # valor absoluto
```

```
&gt; [1] 43
```

---

# Variables de .orange[TEXTO]

No solo de n√∫meros viven los datos: imagina que adem√°s de la edad de una persona queremos **guardar su nombre** (**.bg-purple_light[tipo caracter]**: una **cadena de texto**)


```r
*nombre &lt;- "Javier"
class(nombre)
```

```
&gt; [1] "character"
```

--

Las cadenas de texto son un **tipo especial de dato** con los que obviamente no podremos hacer operaciones aritm√©ticas (pero s√≠ **.bg-purple_light[otras operaciones]** como pegar o localizar patrones).


```r
nombre + 1 # error al sumar n√∫mero a texto
```

```
&gt; Error in nombre + 1: argumento no-num√©rico para operador binario
```

&amp;nbsp;

--

**.bg-green_light[IMPORTANTE]**: las variables de tipo texto van **.bg-red_light[SIEMPRE ENTRE comillas]**.

---

name: primer-paquete

# .orange[PRIMERA FUNCI√ìN]: paste

Una **.bg-purple_light[funci√≥n]** es un **trozo de c√≥digo encapsulado** bajo un nombre, que depende de unos **.bg-purple_light[argumentos de entrada]**.

--

Nuestra primera funci√≥n ser√° `paste()`: dadas dos cadenas de texto como argumento de entrada nos permite pegarlas, indic√°ndole en el argumento `sep = ` el caracter que queremos entre medias.


```r
# todo junto, sin espacios, igual a paste0("Javier", "√Ålvarez")
paste("Javier", "√Ålvarez", sep = "") 
```

```
&gt; [1] "Javier√Ålvarez"
```




```r
paste("Javier", "√Ålvarez", sep = "?*?") # separados por un ?*?
```

```
&gt; [1] "Javier?*?√Ålvarez"
```


---

# .orange[PRIMERA FUNCI√ìN]: paste



```r
*paste("Javier", "√Ålvarez")
```

```
&gt; [1] "Javier √Ålvarez"
```

Por defecto, `paste()` a√±ade un espacio, es decir, `sep = " "`. Muchas funciones en `R` tendr√°n lo que llamamos **.bg-purple_light[argumentos por defecto]**, el valor que tomar√° sino se le asigna otro. Puedes mirar la **.bg-green_light[ayuda de la funci√≥n]** escribiendo en consola `? paste`

Existe una funci√≥n similar llamada `paste0()` que pega por defecto con `sep = ""` (sin nada).


```r
paste0("Javier", "√Ålvarez") 
```

```
&gt; [1] "Javier√Ålvarez"
```

```r
paste("Javier", "√Ålvarez", sep = "") 
```

```
&gt; [1] "Javier√Ålvarez"
```

---

# .orange[PRIMER PAQUETE]: glue

Otra forma **m√°s intuitiva de trabajar con textos** es usar el **paquete** `{glue}`.


```r
library(glue) # solo la 1¬™ vez install.packages("glue")
```

--

Con dicho paquete podemos **.bg-purple_light[usar variables dentro de cadenas]** de texto. Por ejemplo, la frase ¬´la edad es de ... a√±os¬ª, donde la edad concreta la tenemos guardada en una variable.


```r
edad &lt;- 33
*glue("La edad es de {edad} a√±os")
```

```
&gt; La edad es de 33 a√±os
```

Dentro de las llaves tambi√©n podemos ejecutar operaciones


```r
unidades &lt;- "d√≠as"
*glue("La edad es de {edad * 365} {unidades}")
```

```
&gt; La edad es de 12045 d√≠as
```

---


# .orange[VECTORES]: concatenaci√≥n

¬øY si en lugar de querer almacenar un solo elemento, por ejemplo , tenemos una **colecci√≥n de elementos**?

Hasta ahora solo hemos operado con el contenido de las **celdas**, pero cuando trabajamos con datos normalmente tendremos columnas que representan variables o caracter√≠sticas: llamaremos **.bg-purple_light[vectores]** a una **.bg-orange[concatenaci√≥n]** de variables del **.bg-orange[mismo tipo]**
 
--

La forma m√°s sencilla es con el comando `c()` (c de concatenar), y basta con introducir sus **elementos entre par√©ntesis y separados por comas** (por ejemplo, la edad de 4 personas).


```r
*edades &lt;- c(33, 27, 60, 61)
edades
```

```
&gt; [1] 33 27 60 61
```


&amp;nbsp;

--

**.bg-green_light[IMPORTANTE]**: un n√∫mero individual (`x &lt;- 1`) es en realidad un vector de longitud uno. 

---

# .orange[VECTORES]: concatenaci√≥n


Como ves ahora en el `environment` tenemos una **.bg-purple_light[colecci√≥n de elementos]** guardada

.pull-left[


```r
edades
```

```
&gt; [1] 33 27 60 61
```

]


.pull-right[
&lt;img src="./img/vectores_enviroment.jpg" width="80%" style="display: block; margin: auto auto auto 0;" /&gt;
]

--

.pull-left[

La **.bg-purple_light[longitud de un vector]** se puede calcular con `length()`


```r
*length(edades)
```

```
&gt; [1] 4
```

]


.pull-right[

Tambi√©n podemos **.bg-purple_light[concatenar vectores]**


```r
c(edades, edades, 8)
```

```
&gt; [1] 33 27 60 61 33 27 60 61  8
```

]

---

# Vectores: .orange[SECUENCIAS NUM√âRICAS]

En muchas ocasiones querremos **.bg-purple_light[crear secuencias num√©ricas]** mucho m√°s r√°pido (por ejemplo, un vector con los d√≠as del mes). El comando `seq()` nos permite crear una **secuencia** desde un elemento inicial hasta un elemento final, avanzando de uno en uno.


```r
seq(1, 31)
```

```
&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
&gt; [26] 26 27 28 29 30 31
```

--

El comando `1:n` nos devuelve lo mismo que la orden `seq(1, n)`. Adem√°s, si el elemento inicial es mayor que el final, `R` entender√° solo que la secuencia es **decreciente**.


```r
n &lt;- 5
n:1
```

```
&gt; [1] 5 4 3 2 1
```

---

# Vectores: .orange[SECUENCIAS NUM√âRICAS]

Tambi√©n podemos definir **.bg-purple_light[otro tipo de distancia]** (**.bg-orange[paso de discretizaci√≥n]**) entre dos elementos consecutivos


```r
seq(1, 7, by = 0.5) # secuencia desde 1 a 7 de 0.5 en 0.5
```

```
&gt;  [1] 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5 6.0 6.5 7.0
```

--

Otras veces nos interesar√° definir una **.bg-purple_light[secuencia con un n√∫mero concreto]** de elementos.


```r
seq(1, 50, l = 7) # secuencia desde 1 a 50 de longitud 7
```

```
&gt; [1]  1.000000  9.166667 17.333333 25.500000 33.666667 41.833333 50.000000
```

--

Tambi√©n podemos crear **.bg-purple_light[vectores de elementos repetidos]** con la funci√≥n `rep()`


```r
rep(0, 7) # vector de 7 ceros
```

```
&gt; [1] 0 0 0 0 0 0 0
```


---

# Vectores: .orange[CARACTERES]

Un vector es una **.bg-purple_light[concatenaci√≥n de elementos del mismo tipo]**, pero no tienen porque ser necesariamente n√∫meros. Vamos a crear una frase de ejemplo, con 4 elementos.

.pull-left[


```r
*vector &lt;- c("Me", "llamo", "Javi")
vector
```

```
&gt; [1] "Me"    "llamo" "Javi"
```

```r
length(vector)
```

```
&gt; [1] 3
```

]

.pull-right[


```r
frase &lt;- "Mi llamo Javi"
frase
```

```
&gt; [1] "Mi llamo Javi"
```

```r
length(frase)
```

```
&gt; [1] 1
```

]

F√≠jate la **diferencia** entre tenerlo guardado en un vector o tenerlo como una sola cadena de texto (unida).

---

# Vectores: .orange[CARACTERES]

Cuando usamos la funci√≥n `paste()` con variables diferentes, us√°bamos `sep = ...`. Cuando la funci√≥n `paste()` la aplicamos a un vector de caracteres, decidiremos que caracter queremos que vaya entre palabra con el argumento `collapse = ...`.


```r
paste(vector, collapse = ".") # separados por un punto
```

```
&gt; [1] "Me.llamo.Javi"
```

Podemos **combinar las secuencias de n√∫meros y un vector de caracteres** con `glue()`


```r
edad &lt;- 10:12 # edades
glue("La edad es de {edad} a√±os")
```

```
&gt; La edad es de 10 a√±os
&gt; La edad es de 11 a√±os
&gt; La edad es de 12 a√±os
```

---

name: logicas

# Datos de tipo .orange[L√ìGICO]

Un tipo de datos muy importante en todo lenguaje de programaci√≥n: los **.bg-purple_light[valores l√≥gicos]**. Un valor l√≥gico puede tomar **tres valores**:

* `TRUE` (guardado internamente como un `1`).
* `FALSE` (guardado internamente como un `0`).
* `NA` (**.bg-purple_light[dato ausente]**, son las siglas de **.bg-orange[not available]**).

--

Los valores l√≥gicos suelen ser resultado de evaluar **.bg-purple_light[condiciones l√≥gicas]** (preguntar a los datos). Por ejemplo, imaginemos que definimos un vector de temperaturas. ¬øQu√© d√≠as hizo menos de 22 grados?


```r
x &lt;- c(15, 20, 31, 27, 15, 29)
*x &lt; 22
```

```
&gt; [1]  TRUE  TRUE FALSE FALSE  TRUE FALSE
```

Nos devolver√° un **vector l√≥gico** con `TRUE` o `FALSE` en cada hueco, en funci√≥n de si cumple o no la condici√≥n pedida.

---

# Datos de tipo .orange[L√ìGICO]


Dicha condici√≥n l√≥gica puede hacerse con `&lt;=` (menor o igual), `&gt;` (mayor) o `&gt;=` (mayor igual).


```r
x &lt;= 22
```

```
&gt; [1]  TRUE  TRUE FALSE FALSE  TRUE FALSE
```

--


```r
x &gt; 30
```

```
&gt; [1] FALSE FALSE  TRUE FALSE FALSE FALSE
```

--


```r
x &gt;= 15
```

```
&gt; [1] TRUE TRUE TRUE TRUE TRUE TRUE
```

---

# Datos de tipo .orange[L√ìGICO]

Tambi√©n podemos comparar **.bg-purple_light[si es igual a otro elemento]**, para lo que usaremos el operador `==`, pudiendo usar tambi√©n su opuesto `!=` (¬´distinto de¬ª).


```r
x == 15
```

```
&gt; [1]  TRUE FALSE FALSE FALSE  TRUE FALSE
```

```r
x != 15
```

```
&gt; [1] FALSE  TRUE  TRUE  TRUE FALSE  TRUE
```

--

Si tuvi√©ramos un **.bg-purple_light[dato ausente]** (por error del aparato ese d√≠a, marcado como `NA`), la condici√≥n evaluada tambi√©n ser√≠a `NA`


```r
y &lt;- c(15, 20, NA, 31, 27, 7, 29, 10)
y &lt; 22
```

```
&gt; [1]  TRUE  TRUE    NA FALSE FALSE  TRUE FALSE  TRUE
```

---

# Datos de tipo .orange[L√ìGICO]

Las **.bg-purple_light[condiciones pueden ser combinadas]**, principalmente de dos maneras:

.pull-left[

* **.bg-purple_light[Intersecci√≥n]**: **.bg-orange[TODAS]** las condiciones concatenadas se deben cumplir (conjunci√≥n y) para devolver un `TRUE`.


```r
x
```

```
&gt; [1] 15 20 31 27 15 29
```

```r
x &lt; 30 &amp; x &gt; 15
```

```
&gt; [1] FALSE  TRUE FALSE  TRUE FALSE  TRUE
```

]

.pull-right[

* **.bg-purple_light[Uni√≥n]**: basta con que **.bg-orange[AL MENOS UNA]** de las condiciones se cumpla (conjunci√≥n o) para devolver un `TRUE`.


```r
x
```

```
&gt; [1] 15 20 31 27 15 29
```

```r
x &lt; 30 | x &gt; 15
```

```
&gt; [1] TRUE TRUE TRUE TRUE TRUE TRUE
```

]

---

name: fecha

# Datos de tipo .orange[FECHA]


Un tipo de datos muy especial: los **.bg-purple_light[datos de tipo fecha]**. 


```r
# Cadena de texto
fecha_char &lt;- "2021-04-21"
class(fecha_char)
```

```
&gt; [1] "character"
```

Podr√≠amos pensar que no tiene nada de especial ya que parece una simple cadena de texto pero representa un **.bg-purple_light[instante en el tiempo]**, que deber√≠amos poder operar como tal.

--

¬øQu√© suceder√≠a si **sumamos un 1 (un d√≠a)** a una fecha definida como una cadena de texto?


```r
fecha_char + 1
```

```
&gt; Error in fecha_char + 1: argumento no-num√©rico para operador binario
```

--

Si guardamos las fechas como un cadena de texto **.bg-red_light[no podemos operar con ellas]**

---

# Datos de tipo .orange[FECHA]

Para trabajar con fechas tenemos el paquete `{lubridate}`, y su funci√≥n `as_date()`: nos **.bg-purple_light[convierte texto a fecha]**.


```r
library(lubridate)
*fecha &lt;- as_date(fecha_char)
class(fecha)
```

```
&gt; [1] "Date"
```

--


```r
fecha + 1 # d√≠a siguiente
```

```
&gt; [1] "2021-04-22"
```

--


```r
fecha - 3 # 3 d√≠as antes
```

```
&gt; [1] "2021-04-18"
```

--

Al convertir texto a fecha, aunque se visualice como un texto, **.bg-purple_light[internamente es un n√∫mero]**. 

---

# Datos de tipo .orange[FECHA]

La funci√≥n `as_date()` tiene un argumento opcional, el **.bg-purple_light[formato]**, que por defecto ser√° `format = "yyyy-mm-dd"` (que podemos cambiar)



```r
*as_date("10-03-2020", format = "%d-%m-%Y")
```

```
&gt; [1] "2020-03-10"
```

--


```r
as_date("10-03-20", format = "%d-%m-%y")
```

```
&gt; [1] "2020-03-10"
```

--


```r
as_date("03-10-2020", format = "%m-%d-%Y")
```

```
&gt; [1] "2020-03-10"
```

--


```r
as_date("Octubre 21, 1995 21:24", format = "%B %d, %Y %H:%M")
```

```
&gt; [1] "1995-10-21"
```

---

# Datos de tipo .orange[FECHA]

Para facilitar conversiones de formatos habituales, el paquete tambi√©n tiene a nuestra disposici√≥n diferentes funciones preparadas para directamente **.bg-purple_light[convertir fechas en distintos formatos]**, como la funci√≥n `ymd_hms()` o `ydm_hms()`


```r
ymd_hms("2017-11-28 14:02:00") # convertir a fecha una cadena a√±o-mes-d√≠a + hora
```

```
&gt; [1] "2017-11-28 14:02:00 UTC"
```

```r
ydm_hms("2017-22-12 10:00:00") # convertir a fecha una cadena a√±o-d√≠a-mes + hora
```

```
&gt; [1] "2017-12-22 10:00:00 UTC"
```

--

De la misma manera tenemos la funci√≥n `dmy_hms()`


```r
dmy_hms("1 Jan 2017 23:59:59") # convertir a fecha una cadena textual de fecha + hora
```

```
&gt; [1] "2017-01-01 23:59:59 UTC"
```

 
---

# Datos de tipo .orange[FECHA]


Tambi√©n podemos hacerlo de forma muy simplificada con `ymd()`


```r
ymd(20170131)
```

```
&gt; [1] "2017-01-31"
```

--

Otra de las funcionalidades que nos proporciona dicho paquete es obtener autom√°ticamente la **.bg-purple_light[fecha de hoy]**, haciendo uso de la funci√≥n `today()`


```r
*hoy &lt;- today()
hoy
```

```
&gt; [1] "2022-11-21"
```

--

Tambi√©n podemos obtener el **.bg-purple_light[¬´hoy y ahora¬ª]** con la funci√≥n `now()`


```r
*now()
```

```
&gt; [1] "2022-11-21 21:52:26 CET"
```
 
---

# Datos de tipo .orange[FECHA]

Tambi√©n tenemos disponibles funciones para **.bg-purple_light[extraer facilmente algunas variables]**.

.pull-left[


```r
year(fecha)
```

```
&gt; [1] 2021
```

```r
month(fecha)
```

```
&gt; [1] 4
```

```r
hour(fecha)
```

```
&gt; [1] 0
```

```r
second(fecha)
```

```
&gt; [1] 0
```

]

.pull-right[

```r
week(fecha)
```

```
&gt; [1] 16
```

```r
wday(fecha)
```

```
&gt; [1] 4
```

```r
wday(fecha, week_start = 1) # D√≠a de la semana 
```

```
&gt; [1] 3
```

]


---

# Datos de tipo .orange[FECHA]


Tambi√©n podemos **.bg-purple_light[realizar comparaciones]**


```r
fecha_actual &lt;- today()
fecha_actual &gt; ymd(20170131) # Actual vs 2017-01-31
```

```
&gt; [1] TRUE
```

```r
fecha_actual &gt; ymd(21000131) # Actual vs 2100-01-31
```

```
&gt; [1] FALSE
```
 
--

Con la funci√≥n `leap_year()` podremos saber si la fecha **.bg-purple_light[corresponde a un a√±o bisiesto]**


```r
leap_year(as_date(ymd(20190131)))
```

```
&gt; [1] FALSE
```

---

# Datos de tipo .orange[FECHA]

.pull-left[

&lt;div class="figure" style="text-align: right"&gt;
&lt;img src="./img/lubridate.png" alt="Chuleta de https://lubridate.tidyverse.org/" width="101%" /&gt;
&lt;p class="caption"&gt;Chuleta de https://lubridate.tidyverse.org/&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

Tambi√©n podemos hacer uso de diferentes funciones para **.bg-purple_light[a√±adir intervalos]** de tiempo.


```r
fecha + weeks(0:2)
```

```
&gt; [1] "2021-04-21" "2021-04-28" "2021-05-05"
```

```r
fecha + seconds(2)
```

```
&gt; [1] "2021-04-21 00:00:02 UTC"
```

]

---


name: ejercicios2

# Ejercicios


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: define una variable `edad` que guarde tu edad y otra `nombre` con tu nombre.

* üìù **Ejercicio 2**: define otra variable con tus apellidos y junta las variables `nombre` y `apellidos` en una sola cadena de texto que guardes en `nombre_completo`.
 
* üìù **Ejercicio 3**: define un vector que contenga los n√∫meros `1`, `10`, `-1` y `2`, y gu√°rdalo en una variable llamada `vector_num`. Obt√©n la longitud del vector anterior.
 
* üìù **Ejercicio 4**: crea una secuencia de -2 a 17 de forma que salte de uno en uno (y tambi√©n de forma decreciente). Repite el proceso pero saltando de 3 en 3.


]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
# variable num√©rica
edad &lt;- 33
edad
```

```
&gt; [1] 33
```

```r
# variable de tipo texto
nombre &lt;- "Javi"
nombre
```

```
&gt; [1] "Javi"
```
]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
apellidos &lt;- "√Ålvarez Li√©bana"

# Opci√≥n 1
nombre_completo &lt;- glue("{nombre} {apellidos}")
nombre_completo
```

```
&gt; Javi √Ålvarez Li√©bana
```

```r
# Opci√≥n 2
nombre_completo &lt;- paste(nombre, apellidos)
nombre_completo
```

```
&gt; [1] "Javi √Ålvarez Li√©bana"
```
]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
vector_num &lt;- c(1, 10, -1, 2)
vector_num
```

```
&gt; [1]  1 10 -1  2
```

```r
# longitud
length(vector_num)
```

```
&gt; [1] 4
```

]

.panel[.panel-name[Soluci√≥n ej. 4]


```r
secuencia &lt;- -2:17
secuencia
```

```
&gt;  [1] -2 -1  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
```

```r
# otra forma
secuencia &lt;- seq(-2, 17, by = 1)

# decreciente
17:-2
```

```
&gt;  [1] 17 16 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0 -1 -2
```

```r
# de 3 en 3
seq(-2, 17, by = 3)
```

```
&gt; [1] -2  1  4  7 10 13 16
```

]

]

---

# Ejercicios


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 5**: crea una secuencia que repita 7 veces el patr√≥n -1, 2, 4. Despu√©s crea otra que repita dicho patr√≥n pero de forma intercalada.
 
* üìù **Ejercicio 6**: crea una secuencia de 7 valores l√≥gicos en los que haya 2 valores ciertos, 3 valores falsos y 2 valores ausentes.


* üìù **Ejercicio 7**: toma el vector `vector_num` del ejercicio 3 y obt√©n un vector l√≥gico que nos diga que valores son mayores de 0. Obt√©n otro vector l√≥gico que nos diga que valores est√°n entre 0 y 7. Obt√©n otro vector l√≥gico que nos diga que valores son distintos de 1 en valor absoluto.

* üìù **Ejercicio 8**: obt√©n la fecha de hoy, define la fecha de tu cumplea√±os, y calcula la diferencia de d√≠as.
 
* üìù **Ejercicio 9**: suma un mes y una semana a la fecha de tu cumplea√±os

 

]

.panel[.panel-name[Sol ej. 5]


```r
secuencia &lt;- rep(c(-1, 2, 4), 7)
secuencia
```

```
&gt;  [1] -1  2  4 -1  2  4 -1  2  4 -1  2  4 -1  2  4 -1  2  4 -1  2  4
```

```r
# intercalada
rep(c(-1, 2, 4), each = 7)
```

```
&gt;  [1] -1 -1 -1 -1 -1 -1 -1  2  2  2  2  2  2  2  4  4  4  4  4  4  4
```

]

.panel[.panel-name[Sol ej. 6]


```r
secuencia &lt;- c(FALSE, TRUE, NA, FALSE, NA, TRUE, FALSE)
secuencia
```

```
&gt; [1] FALSE  TRUE    NA FALSE    NA  TRUE FALSE
```

]

.panel[.panel-name[Sol ej. 7]


```r
vector_num &gt; 0
```

```
&gt; [1]  TRUE  TRUE FALSE  TRUE
```

```r
vector_num &gt; 0 &amp; vector_num &lt; 7
```

```
&gt; [1]  TRUE FALSE FALSE  TRUE
```

```r
abs(vector_num) != 1
```

```
&gt; [1] FALSE  TRUE FALSE  TRUE
```

]


.panel[.panel-name[Sol ej. 8]


```r
library(lubridate)
hoy &lt;- today()
cumple &lt;- as_date("1989-09-10")
hoy - cumple
```

```
&gt; Time difference of 12125 days
```

]

.panel[.panel-name[Sol ej. 9]


```r
cumple + months(1) + weeks(1)
```

```
&gt; [1] "1989-10-17"
```

]

]

---

# Ejercicios extras

.panelset[
.panel[.panel-name[Ejercicios extra]


* üìù **Ejercicio 10**: construye con `glue()` una frase que diga ¬´Hola, me llamo ‚Ä¶ y tengo ‚Ä¶ a√±os¬ª.

* üìù **Ejercicio 11**: modifica el c√≥digo inferior para crear un vector de nombre `vector_num` que contenga los n√∫meros 1, 5 y -7.


```r
# Vector de n√∫meros
vector_num &lt;- c(1)
vector_num
```

* üìù **Ejercicio 12**:  extrae el mes, a√±o y d√≠a de la semana de tu cumplea√±os

]

.panel[.panel-name[Soluci√≥n ej. 10]


```r
nombre &lt;- "Javi"
edad &lt;- 33
glue("Hola, me llamo {nombre} y tengo {edad} a√±os")
```

```
&gt; Hola, me llamo Javi y tengo 33 a√±os
```
]

.panel[.panel-name[Soluci√≥n ej. 11]


```r
# Vector de n√∫meros
vector_num &lt;- c(1, 5, -7)
vector_num
```

```
&gt; [1]  1  5 -7
```

```r
# longitud
length(vector_num)
```

```
&gt; [1] 3
```

]

.panel[.panel-name[Soluci√≥n ej. 12]


```r
library(lubridate)
cumple &lt;- as_date("1989-09-10")
month(cumple)
```

```
&gt; [1] 9
```

```r
day(cumple)
```

```
&gt; [1] 10
```

```r
year(cumple)
```

```
&gt; [1] 1989
```

```r
wday(cumple, week_start = 1, label = TRUE)
```

```
&gt; [1] dom
&gt; Levels: lun &lt; mar &lt; mi√© &lt; jue &lt; vie &lt; s√°b &lt; dom
```

]


]


---

class: inverse center middle
name: clase-3

# CLASE 3: primeros datos

&amp;nbsp;

### [Operaciones con vectores](#operaciones-vectores)

### [Ejercicios vectores](#ejercicios-vectores)

### [Matrices](#matrices)

### [Ejercicios matrices](#ejercicios-matrices)

---

name: operaciones-vectores

# .green[OPERACIONES] .orange[ARITM√âTICAS]
 
Dado que un **.bg-purple_light[n√∫mero es un vector]** de longitud 1, toda **.bg-orange[operaci√≥n aritm√©tica]** (suma, resta, multiplicaci√≥n, etc) que podamos hacer con un n√∫mero la vamos a poder a hacer con un vector de n√∫meros.

--

Si hacemos por ejemplo la operaci√≥n `2 * x`, siendo `x` un vector, lo que suceder√° es que la operaci√≥n se realizar√° en **.bg-purple_light[CADA ELEMENTO]** del vector (una sola l√≠nea de c√≥digo paro realizar operaciones en 10, 20, 1000 o 100000 elementos).


```r
# Multiplicamos por 2 a CADA ELEMENTO del vector
x &lt;- c(2, 4, 6)
*2 * x
```

```
&gt; [1]  4  8 12
```

--

&amp;nbsp;

**.bg-green_light[IMPORTANTE]**: el **.bg-purple_light[resultado]** de una operaci√≥n aritm√©tica sobre un vector ser√° **.bg-orange[otro vector]**.

---

# .green[OPERACIONES] .orange[ARITM√âTICAS]
 
 
De la misma manera podemos **.bg-purple_light[sumar o restar una constante]** al vector


```r
# Sumamos 3 a CADA ELEMENTO DEL VECTOR
x + 3
```

```
&gt; [1] 5 7 9
```

--

Los vectores tambi√©n pueden **.bg-purple_light[interactuar entre ellos]**, as√≠ que podemos definir sumas de vectores, como `x + y`


```r
y &lt;- c(1, 3, 5)

# suma de vectores 
*x + y
```

```
&gt; [1]  3  7 11
```

--

**.bg-green_light[IMPORTANTE]**: salvo que especifiquemos lo contrario, toda operaci√≥n aritm√©tica que hagas a un vector ser√° **.bg-purple_light[elemento a elemento]**.

 
---

# .green[OPERACIONES] .orange[ARITM√âTICAS]
 

Dado que la operaci√≥n (por ejemplo, una suma) se realiza elemento a elemento, ¬øqu√© suceder√° si **.bg-purple_light[sumamos dos vectores de distinta longitud]**?

--

Por ejemplo, definamos `z` con los 4 primeros impares, e intentemos hacer la suma `x + z`.


```r
z &lt;- c(1, 3, 5, 7)
x + z
```

```
&gt; [1]  3  7 11  9
```

--

.pull-left[


&lt;img src="./img/recycle.jpg" width="99%" style="display: block; margin: auto auto auto 0;" /&gt;


]

.pull-right[

`R` intenta molestarte lo menos posible, as√≠ que lo que hace es **.bg-purple_light[reciclar elementos]**: si tiene un vector de 4 elementos y le intentas sumar uno de 3 elementos, lo que har√° ser√° reciclar elementos del vector con menor longitud: har√° `1 + 2`, `3 + 4`, `5 + 6` pero‚Ä¶ `7 + 2` (vuelve al primero).

]

---


# .green[OPERACIONES] .orange[ARITM√âTICAS]


Los **.bg-purple_light[valores l√≥gicos]** `TRUE` y `FALSE` son **.bg-orange[guardados internamente]** como `0` y `1`, por lo que podemos usar operaciones aritm√©ticas con ellos.

--

Por ejemplo, si queremos **.bg-purple_light[averiguar el n√∫mero de elementos que cumplen una condici√≥n]** (por ejemplo, `&lt; 3`), los que lo hagan tendr√°n asignado un 1 y los que no un 0, por lo que basta con sumar dicho vector l√≥gico para obtener el n√∫mero de elementos que cumplen dicha condici√≥n (elementos que son `TRUE`).


```r
# sumamos el vector de TRUE/FALSE
x
```

```
&gt; [1] 2 4 6
```

```r
sum(x &lt; 3) 
```

```
&gt; [1] 1
```

---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

Tambi√©n podemos realizar **.bg-purple_light[operaciones estad√≠sticas]** con los vectores, como calcular su **suma**, su **media**, su **mediana**, entre otros.

--

Hagamos antes un **.bg-purple_light[breve repaso]** de algunos t√©rminos estad√≠sticos:

* **.bg-purple_light[Media]**: medida de **.bg-orange[centralizaci√≥n]** que consiste en sumar todos los elementos y dividirlos entre la cantidad de elementos sumados (funci√≥n `mean()`). La m√°s conocida pero la menos robusta: dado un conjunto, si se introducen valores at√≠picos o outliers (valores muy grandes o muy peque√±os), la media se perturba con mucha facilidad.

`$$\overline{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$$`


```r
x &lt;- c(165, 170, 181, 191, 150, 155, 167, 173, 177)
mean(x)
```

```
&gt; [1] 169.8889
```

---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

Tambi√©n podemos realizar **.bg-purple_light[operaciones estad√≠sticas]** con los vectores, como calcular su **suma**, su **media**, su **mediana**, entre otros.


Hagamos antes un **.bg-purple_light[breve repaso]** de algunos t√©rminos estad√≠sticos:

* **.bg-purple_light[Mediana]**: medida de **.bg-orange[centralizaci√≥n]** (funci√≥n `median()`) que consiste en, tras **.bg-orange[ordenar]** los datos de menor a mayor, quedarnos con el valor que ocupa el medio (deja tantos n√∫meros por debajo como por encima). 


`$$Me_{x} = \displaystyle \arg \min_{x_i} \left\lbrace F_i &gt; 0.5 \right\rbrace, \quad F_i = \frac{\# \left\lbrace x_j \leq x_i \right\rbrace}{n}$$`


```r
x &lt;- c(165, 170, 181, 191, 150, 155, 167, 173, 177)
median(x)
```

```
&gt; [1] 170
```

---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

Tambi√©n podemos realizar **.bg-purple_light[operaciones estad√≠sticas]** con los vectores, como calcular su **suma**, su **media**, su **mediana**, entre otros.


Hagamos antes un **.bg-purple_light[breve repaso]** de algunos t√©rminos estad√≠sticos:

* **.bg-purple_light[Moda]**: medida de **.bg-orange[centralizaci√≥n]** que consiste en encontrar el **.bg-orange[valor o valores m√°s repetidos]**. Es la medida de centralizaci√≥n m√°s robusta. 

`$$Mo_{x} = \displaystyle \arg \max_{x_i}  f_i , \quad f_i = \frac{\# \left\lbrace x_j = x_i \right\rbrace}{n}$$`

&amp;nbsp;

**.bg-red_light[PROBLEMA]**: la moda no siempre es f√°cil de calcular (aunque existen paquetes para calcularla como `{modeest}`)


---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

Otra de las funciones m√°s √∫til es la **.bg-purple_light[suma de elementos]** de un vector con `sum()`


```r
# suma
*sum(x)
```

```
&gt; [1] 1529
```

```r
sum(x) / length(x) # media artesanal
```

```
&gt; [1] 169.8889
```

--

Otra funci√≥n √∫til es la **.bg-purple_light[suma acumulada]** de un vector haciendo uso de `cumsum()`


```r
# suma acumulada
*cumsum(c(1, 2, 4, 7, 7, 10))
```

```
&gt; [1]  1  3  7 14 21 31
```

---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

No solo de medidas de centralizaci√≥n vive la estad√≠stica: **.bg-purple_light[¬øc√≥mo calcular las medidas de dispersi√≥n?]**

* **.bg-purple_light[Varianza]**: definida como la media de desviaciones (respecto a la media) al cuadrado, tal que `\(s_{x}^{2} = \frac{1}{n} \sum_{i = 1}^{n} \left(x_i - \overline{x} \right)^2 = \overline{x^2} - \overline{x}^2\)`


```r
var(x)
```

```
&gt; [1] 159.8611
```

--

**.bg-green_light[IMPORTANTE]**: las funciones de `R` (y de cualquier calculadora) nos devuelve la **.bg-red_light[cuasivarianza]** (dividido entre `\(n-1\)`)
 

```r
# Varianza real
mean((x - mean(x))^2)
```

```
&gt; [1] 142.0988
```

---


# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

No solo de medidas de centralizaci√≥n vive la estad√≠stica: **.bg-purple_light[¬øc√≥mo calcular las medidas de dispersi√≥n?]**

* **.bg-purple_light[Desv. t√≠pica (standard deviation)]**: definida como la ra√≠z cuadrada de la varianza, tal que `\(s_{x} = \sqrt{s_{x}^{2} }\)`


```r
sd(x)
```

```
&gt; [1] 12.64362
```

--

**.bg-green_light[IMPORTANTE]**: las funciones de `R` (y de cualquier calculadora) nos devuelve la **.bg-red_light[cuasidesviaci√≥n t√≠pica]** (ra√≠z de la cuasivarianza, dividida entre `\(n-1\)`)
 

```r
# Desv. t√≠pica real
sqrt(mean((x - mean(x))^2))
```

```
&gt; [1] 11.92052
```


---

# .green[OPERACIONES] .orange[ESTAD√çSTICAS]

Tambi√©n pueden sernos √∫tiles las **.bg-purple_light[medidas de posici√≥n/localizaci√≥n]**, como los **.bg-orange[percentiles]** (valores que nos dividen en partes iguales los datos).


```r
y &lt;- c(1, 2, 5, 5, 10, 10, 10, 13, 15, 20, 25)

# Percentiles por defecto: cuartiles
*quantile(y)
```

```
&gt;   0%  25%  50%  75% 100% 
&gt;    1    5   10   14   25
```

--

En `quantile()` hay un argumento por defecto `probs = c(0, 0.25, 0.5, 0.75, 1)` (**percentiles** a calcular) que puede ser cambiado, por ejemplo, para percentiles 20%-30%-70%-90%.


```r
quantile(y, probs = c(0.2, 0.3, 0.7, 0.9))
```

```
&gt; 20% 30% 70% 90% 
&gt;   5   5  13  20
```

---

# .green[OPERACIONES] con .orange[AUSENTES]

Imagina que tenemos un vector de temperaturas pero varios de los d√≠as el aparato de medici√≥n no funcionaba, por lo que tenemos un **.bg-purple_light[dato ausente]** marcado como `NA`.


```r
x &lt;- c(21, NA, 13, NA, NA, 25, 36, 17, 19, 5)
sum(x)
```

```
&gt; [1] NA
```

--

Dado que hay d√≠as que no tenemos disponibles, la suma tampoco la podemos conocer.  Para evitar que nos impida hacer ciertas operaciones, en muchas funciones de `R` podemos a√±adir el **argumento** `na.rm = TRUE`: primero elimina ausentes, y luego ejecuta la funci√≥n.


```r
# eliminando datos ausentes antes de aplicar la funci√≥n
*sum(x, na.rm = TRUE)
```

```
&gt; [1] 136
```

```r
mean(x, na.rm = TRUE)
```

```
&gt; [1] 19.42857
```


---

# .green[OPERACIONES] con .orange[AUSENTES]

Para **comprobar** si tenemos un **dato ausente**  podemos hacer uso de la funci√≥n `is.na()`


```r
is.na(x)
```

```
&gt;  [1] FALSE  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE
```

--

Tambi√©n puede aparecernos un **.bg-purple_light[resultado no permitido]**, marcado como `NaN` (not a number): no es un dato ausente, es un dato resultado de una **operaci√≥n no permitida**.


```r
x &lt;- c(1, NA, 3, 4, 6, 7, sqrt(-1), NA)
x
```

```
&gt; [1]   1  NA   3   4   6   7 NaN  NA
```

```r
is.nan(x)
```

```
&gt; [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
```


---

# .orange[SELECCIONAR] elementos

Otra operaci√≥n muy habitual es la **.bg-purple_light[extraer un subconjunto del mismo]**. La forma m√°s sencilla es **usar el operador de selecci√≥n** `[i]` para **acceder al elemento i-√©simo**


```r
edades &lt;- c(20, 30, 33, NA, 61)

# accedemos a la edad de la tercera persona en la lista
*edades[3]
```

```
&gt; [1] 33
```

```r
# accedemos a la edad de la cuarta persona
edades[4]
```

```
&gt; [1] NA
```

---

# .orange[SELECCIONAR] elementos

Un n√∫mero no es m√°s que un vector de longitud uno, as√≠ que esta operaci√≥n tambi√©n la podemos aplicar usando un **.bg-purple_light[vector de √≠ndices a seleccionar]**


```r
# Tercer y cuarto elemento
*edades[c(3, 4)]
```

```
&gt; [1] 33 NA
```

--

Esta l√≥gica para acceder a elementos tambi√©n sirve para **vectores de caracteres**.


```r
y &lt;- c("hola", "qu√©", "tal", "todo", "ok", "?")
y[1:2]
```

```
&gt; [1] "hola" "qu√©"
```

--

**.bg-green_light[TIP]**: para **.bg-purple_light[acceder al √∫ltimo elemento]** podemos pasarle como √≠ndice la longitud del vector 


```r
y[length(y)] 
```

```
&gt; [1] "?"
```

---


# Valores .orange[UNICOS]

Con la funci√≥n `unique()` podemos tambi√©n extraer los **.bg-purple_light[valores √∫nicos de una variable]**


```r
colores &lt;- c("azul", "azul", "verde", "amarillo",
             "azul", "rojo", "rojo", "azul", "rojo",
             "verde", "morado")
*unique(colores)
```

```
&gt; [1] "azul"     "verde"    "amarillo" "rojo"     "morado"
```

---



# .orange[FILTRAR] elementos


Otras veces no querremos seleccionar un elemento en concreto sino **.bg-purple_light[filtrar algunos elementos en concreto]** y no extraerlos, **.bg-orange[eliminarlos]**.

Deberemos repetir la misma operaci√≥n pero con el signo `-` delante: el operador `[-i]` **no selecciona** el elemento i-√©simo del vector sino que lo **elimina**


```r
y
```

```
&gt; [1] "hola" "qu√©"  "tal"  "todo" "ok"   "?"
```

```r
y[-2] 
```

```
&gt; [1] "hola" "tal"  "todo" "ok"   "?"
```

---

# .orange[FILTRAR] elementos

Lo habitual es que dicho filtro lo hagamos **.bg-purple_light[en base a una condici√≥n l√≥gica]**. Supongamos que tenemos las edades de dos grupos de personas y que queremos quedarnos **solo con los mayores edad**: vamos a seleccionar los **elementos que cumplen una condici√≥n dada**.


```r
edades_1 &lt;- c(7, 20, 18, 3, 19, 9, 13, 3, 45)
edades_2 &lt;- c(17, 21, 58, 33, 15, 59, 13, 1, 45)
```

--


```r
*edades_1[edades_1 &gt;= 18]
```

```
&gt; [1] 20 18 19 45
```

```r
edades_2[edades_2 &gt;= 18]
```

```
&gt; [1] 21 58 33 59 45
```

Lo que hemos hecho ha sido pasar como **√≠ndices a seleccionar un vector l√≥gico** `TRUE/FALSE`: solo filtrar√° los lugares donde se guarde un `TRUE`.

---

# .orange[FILTRAR] elementos

Esto tambi√©n nos puede servir para **.bg-purple_light[limpiar de datos ausentes]**, combinando la funci√≥n `is.na()`: nos localiza el lugar que ocupan los ausentes, con el operador `!` (**negar el valor l√≥gico** que venga detr√°s).


```r
x &lt;- c(7, NA, 20, 3, 19, 21, 25, 80, NA)
x[is.na(x)] # solo valores ausentes
```

```
&gt; [1] NA NA
```

```r
x[!is.na(x)] # sin valores ausentes: ! es el s√≠mbolo de 
```

```
&gt; [1]  7 20  3 19 21 25 80
```

--

Tambi√©n podemos probar a **combinar condiciones l√≥gicas** para nuestra selecci√≥n.


```r
x[x &gt;= 18 &amp; x &lt;= 25] # los valores que cumplen ambas (&amp;): entre 18 y 25 a√±os
```

```
&gt; [1] NA 20 19 21 25 NA
```

---
 

# .green[SELECCIONAR] elementos: .orange[WHICH]

A veces no querremos el elemento en s√≠, sino el **.bg-purple_light[lugar que ocupa]**: ¬øqu√© valores de un vector cumplen una condici√≥n l√≥gica? Para obtener dicho √≠ndice usaremos la funci√≥n `which()`.


```r
x &lt;- c(7, NA, 20, 3, 19, 21, 25, 80, NA)
which(x &gt;= 18) # Obtenemos los lugares 
```

```
&gt; [1] 3 5 6 7 8
```

--

Esta funci√≥n es muy √∫til especialmente cuando queremos el valor que ocupa el **.bg-purple_light[m√°ximo/m√≠nimo]** de un vector, con las funciones `which.max()` y `which.min()`.


```r
max(x, na.rm = TRUE)
```

```
&gt; [1] 80
```

```r
which.max(x) # Lugar que ocupa el m√°ximo
```

```
&gt; [1] 8
```


---

# .green[SELECCIONAR] elementos: .orange[any/all]
 

Existen dos funciones muy √∫tiles para saber si **.bg-purple_light[todos o alguno de los elementos]** de un vector cumple una condici√≥n: `all()` y `any()` nos devolver√° un √∫nico valor l√≥gico.


```r
x &lt;- c(1, 2, 3, 4, 5, NA, 7)
*all(x &lt; 3)
```

```
&gt; [1] FALSE
```

```r
any(x &lt; 3)
```

```
&gt; [1] TRUE
```

```r
all(x &gt; 0)
```

```
&gt; [1] NA
```


---

# .orange[NOMBRAR] elementos

`R` nos permite dar **.bg-purple_light[significado l√©xico a nuestros valores]** (significan algo, no solo n√∫meros), pudiendo poner **nombres a los elementos** de un vector.


```r
x &lt;- c("edad" = 31, "tlf" = 613910687, "cp" = 33007)
x
```

```
&gt;      edad       tlf        cp 
&gt;        31 613910687     33007
```

--

Esto es una ventaja ya que nos permite su **.bg-purple_light[selecci√≥n usando dichos nombres]**


```r
x[c("edad", "cp")] # seleccionamos los elementos que tienen ese nombre asignado
```

```
&gt;  edad    cp 
&gt;    31 33007
```

--

Con la funci√≥n `names()` podemos, no solo **.bg-purple_light[consultar los nombres]** sino **cambiarlos**.

---

# .orange[ORDENAR] vectores


Una acci√≥n tambi√©n habitual al trabajar con datos es saber **.bg-purple_light[ordenarlos]**: de menor a mayor edad, datos m√°s recientes vs antiguos, etc. Para ello tenemos la funci√≥n `sort()`, que podemos usar directamente para ordenar de **menor a mayor**.


```r
edades &lt;- c(81, 7, 25, 41, 65, 20, 33, 23, 77)

# orden de joven a mayor
*sort(edades)
```

```
&gt; [1]  7 20 23 25 33 41 65 77 81
```

--

Por defecto, `sort()` ordena de menor a mayor. Con el argumento opcional `decreasing = TRUE` podemos **ordenar de mayor a menor**.


```r
# orden de mayor a joven
*sort(edades, decreasing = FALSE)
```

```
&gt; [1]  7 20 23 25 33 41 65 77 81
```

---

# .orange[ORDENAR] vectores

Otra forma de ordenar es obtener los **√≠ndices de los elementos ordenados**, y luego usar dichos √≠ndices para **reorganizar los elementos**, con la funci√≥n `order()`.


```r
*order(x)
```

```
&gt; [1] 1 3 2
```

```r
x[order(x)]
```

```
&gt;      edad        cp       tlf 
&gt;        31     33007 613910687
```

---


# .orange[MEDIR] tiempos de ejecuci√≥n

Hay un paquete muy √∫til para **.bg-purple_light[medir tiempos de distintas √≥rdenes]** que hacen lo mismo (el paquete `{microbenchmark}`). Vamos a comparar `order()` y `sort()`.


```r
library(microbenchmark) # instalar primera vez
x &lt;- rnorm(1e3) # 1000 elementos aleatorias
*microbenchmark(sort(x), x[order(x)], times = 1e3)
```

```
&gt; Unit: microseconds
&gt;         expr    min      lq     mean  median      uq     max neval cld
&gt;      sort(x) 47.397 50.9930 64.01099 55.7910 66.4130 198.002  1000   b
&gt;  x[order(x)] 33.098 35.7955 43.66483 37.9815 44.9765 204.596  1000  a
```

--

# .orange[DIFERENCIA] de conjuntos
 
Por √∫ltimo, una funci√≥n muy √∫til para ver las **.bg-purple_light[diferencias entre dos conjuntos]** es `setdiff()`, una funci√≥n que nos devuelve los elementos distintos entre dos conjuntos.


```r
y &lt;- 1:10
z &lt;- c(1, 3, 7, 10)
setdiff(y, z)
```

```
&gt; [1] 2 4 5 6 8 9
```


---

name: ejercicios-vectores

# Ejercicios de vectores


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: define el vector `x` como la concatenaci√≥n de los 5 primeros n√∫meros impares, y calcula su suma.
 
* üìù **Ejercicio 2**: obt√©n los elementos de `x` mayores que 4. Determina los lugares que ocupan. Calcula el n√∫mero de elementos de `x` mayores que 4.

* üìù **Ejercicio 3**: calcula el vector `1/x` y obt√©n la versi√≥n ordenada (de menor a mayor).

* üìù **Ejercicio 4**: define un vector con tu estatura y peso, y nombra cada elemento.

 
]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
x &lt;- c(1, 3, 5, 7, 9)

# otra forma
x &lt;- seq(1, 9, by = 2)

# Suma
sum(x)
```

```
&gt; [1] 25
```
]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
# Elementos mayores que 4
x[x &gt; 4]
```

```
&gt; [1] 5 7 9
```

```r
# Lugares que ocupan
which(x &gt; 4)
```

```
&gt; [1] 3 4 5
```

```r
# Cantidad de elementos mayores que 4
sum(x &gt; 4)
```

```
&gt; [1] 3
```
]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
y &lt;- 1/x

# una forma
sort(y)
```

```
&gt; [1] 0.1111111 0.1428571 0.2000000 0.3333333 1.0000000
```

```r
# otra forma
y[order(y)]
```

```
&gt; [1] 0.1111111 0.1428571 0.2000000 0.3333333 1.0000000
```

]


.panel[.panel-name[Soluci√≥n ej. 4]


```r
x &lt;- c("estatura" = 180, "peso" = 80)
x
```

```
&gt; estatura     peso 
&gt;      180       80
```

]

]

---

# Ejercicios de vectores

.panelset[
.panel[.panel-name[Ejercicios]

 
* üìù **Ejercicio 5**:  encuentra del vector `x` del ejercicio 1 los elementos mayores (estrictos) que 1 y menores (estrictos) que 7. Encuentra una forma de averiguar si todos los elementos son o no positivos.
 
 
* üìù **Ejercicio 6**: define el vector `x &lt;- c(-1, 0, -2, 5, 3, 7)` y obt√©n los elementos que ocupan una posici√≥n impar.
 
 
* üìù **Ejercicio 7**: define el vector de los primeros n√∫meros impares (hasta el 21) y extrae los elementos que ocupan los lugares `1, 4, 5, 8`. Elimina del vector el segundo elemento

 
* üìù **Ejercicio 8**: define un vector de 8 valores y determina la media, la mediana y los cuartiles.

]

.panel[.panel-name[Soluci√≥n ej. 5]


```r
x &lt;- c(1, 3, 5, 7, 9)
# valores &gt;1 y &lt;7
x[x &gt; 1 &amp; x &lt; 7]
```

```
&gt; [1] 3 5
```

```r
# ¬øTodos positivos?
all(x &gt; 0)
```

```
&gt; [1] TRUE
```

```r
sum(all(x &lt;= 0)) # debe dar 0
```

```
&gt; [1] 0
```

]

 
 
.panel[.panel-name[Soluci√≥n ej. 6]


```r
x &lt;- c(-1, 0, -2, 5, 3, 7)
x[seq(1, length(x), by = 2)]
```

```
&gt; [1] -1 -2  3
```

]

.panel[.panel-name[Soluci√≥n ej. 7]


```r
x &lt;- seq(1, 21, by = 2)

# posiciones pedidas
x[c(1, 4, 5, 8)]
```

```
&gt; [1]  1  7  9 15
```

```r
# sin las posiciones pedidas
x[-c(1, 4, 5, 8)]
```

```
&gt; [1]  3  5 11 13 17 19 21
```

```r
# eliminamos del vector el segundo elemento
x[-2]
```

```
&gt;  [1]  1  5  7  9 11 13 15 17 19 21
```
]

.panel[.panel-name[Soluci√≥n ej. 8]


```r
x &lt;- c(0, -2, 3, 7, -5, 9, 3, 1)
mean(x)
```

```
&gt; [1] 2
```

```r
median(x)
```

```
&gt; [1] 2
```

```r
quantile(x)
```

```
&gt;   0%  25%  50%  75% 100% 
&gt; -5.0 -0.5  2.0  4.0  9.0
```
]


]

---

name: matrices

# De la .orange[celda] a la .green[tabla]
 

&lt;img src="./img/celdas.jpg" width="55%" style="display: block; margin: auto;" /&gt;

* **.bg-purple_light[Celda]**: un dato **.bg-orange[individual]** de un tipo concreto.

* **.bg-purple_light[Variable]**: una **.bg-orange[concatenaci√≥n de valores]** del mismo tipo (**vectores**).


&amp;nbsp;

--

**.bg-purple_light[Matriz]**: **.bg-orange[concatenaci√≥n de variables]** del **.bg-yellow[mismo tipo]** y longitud.

---

# .orange[MATRICES]: concatenando variables


Cuando analizamos datos solemos tener varias **variables distintas** de cada individuo: necesitamos una ¬´tabla¬ª con **.bg-purple_light[distintas variables]** (de **.bg-orange[IGUAL longitud]**).

Las **.bg-purple_light[matrices]** son una concatenaci√≥n de variables, del **.bg-orange[mismo tipo e igual longitud]**, dispuestas en **p columnas** (datos p-dimensionales) 

--

&amp;nbsp;

Vamos a empezar definiendo una **matriz sencilla**: imagina que tenemos las estaturas y pesos de 5 personas. ¬øC√≥mo juntar las dos variables creando nuestro primer conjunto de datos? F√≠jate que son del mismo tipo e igual longitud.


```r
estaturas &lt;- c(150, 160, 170, 180, 190)
pesos &lt;- c(60, 70, 80, 90, 100)
```

---

# .orange[MATRICES]: concatenando variables


```r
estaturas &lt;- c(150, 160, 170, 180, 190)
pesos &lt;- c(60, 70, 80, 90, 100)
```

¬øC√≥mo juntar las dos variables creando nuestro primer conjunto de datos? Vamos a **.bg-purple_light[crear una matriz]**, un conjunto de n√∫meros organizado en 2 columnas (una por variable) y 5 filas o registros (una por persona). Para ello usaremos la funci√≥n `cbind()`, que nos **concatena vectores de igual longitud en columnas**.

 

```r
# Construimos la matriz por columnas
*datos_matriz &lt;- cbind(estaturas, pesos)
datos_matriz
```

```
&gt;      estaturas pesos
&gt; [1,]       150    60
&gt; [2,]       160    70
&gt; [3,]       170    80
&gt; [4,]       180    90
&gt; [5,]       190   100
```

---

# .orange[MATRICES]: concatenando variables


.pull-left[

&lt;img src="./img/datos_matriz_1.jpg" width="99%" style="display: block; margin: auto auto auto 0;" /&gt;


]


.pull-right[


```r
View(datos_matriz)
```

Podemos **.bg-purple_light[visualizar la matriz]** en un formato ¬´excelizado¬ª con la funci√≥n `View()`.


Tambi√©n podemos **.bg-purple_light[construir la matriz por filas]** con la funci√≥n `rbind()` (aunque lo recomendable es tener cada variable en  columna y cada individuo en fila).


```r
# Construimos la matriz por filas
rbind(estaturas, pesos) 
```

```
&gt;           [,1] [,2] [,3] [,4] [,5]
&gt; estaturas  150  160  170  180  190
&gt; pesos       60   70   80   90  100
```

]

---
 
 
# .orange[MATRICES]: concatenando variables

Podemos comprobar las **.bg-purple_light[dimensiones de una matriz]** con `dim()`, `nrow()` y `ncol()`: nuestros datos est√°n **.bg-orange[tabulados]**:


```r
dim(datos_matriz) # vector
```

```
&gt; [1] 5 2
```

```r
nrow(datos_matriz)
```

```
&gt; [1] 5
```

```r
ncol(datos_matriz)
```

```
&gt; [1] 2
```

---

# .orange[MATRICES]: concatenando variables


Veamos un ejemplo con **tres variables/columnas**: edades, tel√©fonos y c√≥digos postales.


```r
edades &lt;- c(14, 24, 56, 31, 20, 87, 73) 
tlf &lt;- c(NA, 683839390, 621539732, 618211286, NA, 914727164, NA)
cp &lt;- c(33007, 28019, 37005, 18003, 33091, 25073, 17140)

# Construimos la matriz por columnas
*datos_matriz &lt;- cbind(edades, tlf, cp)
datos_matriz
```

```
&gt;      edades       tlf    cp
&gt; [1,]     14        NA 33007
&gt; [2,]     24 683839390 28019
&gt; [3,]     56 621539732 37005
&gt; [4,]     31 618211286 18003
&gt; [5,]     20        NA 33091
&gt; [6,]     87 914727164 25073
&gt; [7,]     73        NA 17140
```


---

# .orange[MATRICES]: a√±adir registros/variables

Las funciones `cbind()` y `rbind()` no solo nos permiten crear matrices desde cero sino tambi√©n **.bg-purple_light[a√±adir filas o columnas]** a matrices existentes.


```r
# A√±adimos una fila
rbind(datos_matriz, c(27, 620125780, 28051))
```

```
&gt;      edades       tlf    cp
&gt; [1,]     14        NA 33007
&gt; [2,]     24 683839390 28019
&gt; [3,]     56 621539732 37005
&gt; [4,]     31 618211286 18003
&gt; [5,]     20        NA 33091
&gt; [6,]     87 914727164 25073
&gt; [7,]     73        NA 17140
&gt; [8,]     27 620125780 28051
```

---

# .orange[MATRICES]: transpuesta

Tambi√©n podemos ¬´darle vuelta¬ª (**.bg-purple_light[matriz transpuesta]**) con `t()`.


```r
datos_matriz
```

```
&gt;      edades       tlf    cp
&gt; [1,]     14        NA 33007
&gt; [2,]     24 683839390 28019
&gt; [3,]     56 621539732 37005
&gt; [4,]     31 618211286 18003
&gt; [5,]     20        NA 33091
&gt; [6,]     87 914727164 25073
&gt; [7,]     73        NA 17140
```

```r
*t(datos_matriz)
```

```
&gt;         [,1]      [,2]      [,3]      [,4]  [,5]      [,6]  [,7]
&gt; edades    14        24        56        31    20        87    73
&gt; tlf       NA 683839390 621539732 618211286    NA 914727164    NA
&gt; cp     33007     28019     37005     18003 33091     25073 17140
```

---

# .orange[MATRICES]: valores repetidos

Podemos definir una **.bg-purple_light[matriz de n¬∫ repetidos]** con `matrix(..., nrow = ..., ncol = ...)`


```r
# matriz de ceros de 3 filas, 2 columnas,
*matrix(0, nrow = 3, ncol = 2)
```

```
&gt;      [,1] [,2]
&gt; [1,]    0    0
&gt; [2,]    0    0
&gt; [3,]    0    0
```

--

Tambi√©n podemos definir una **.bg-purple_light[matriz a partir de un vector num√©rico]**, reorganizando los valores en forma de matriz (sabiendo que los elementos se van colocando por columnas).


```r
matrix(1:15, ncol = 5) # Matriz con el vector 1:15
```

```
&gt;      [,1] [,2] [,3] [,4] [,5]
&gt; [1,]    1    4    7   10   13
&gt; [2,]    2    5    8   11   14
&gt; [3,]    3    6    9   12   15
```

---

# .green[OPERACIONES] con .orange[MATRICES]

Con las matrices sucede como con los vectores: cuando aplicamos una **.bg-purple_light[operaci√≥n aritm√©tica]** lo hacemos **.bg-orange[elemento a elemento]**


```r
z &lt;- matrix(1:15, ncol = 5) 
z / 5
```

```
&gt;      [,1] [,2] [,3] [,4] [,5]
&gt; [1,]  0.2  0.8  1.4  2.0  2.6
&gt; [2,]  0.4  1.0  1.6  2.2  2.8
&gt; [3,]  0.6  1.2  1.8  2.4  3.0
```

```r
z + 3
```

```
&gt;      [,1] [,2] [,3] [,4] [,5]
&gt; [1,]    4    7   10   13   16
&gt; [2,]    5    8   11   14   17
&gt; [3,]    6    9   12   15   18
```

---

# .orange[MATRICES] de .green[CARACTERES]

Tambi√©n podemos crear matrices de otros tipos de datos, siempre y cuando las **.bg-purple_light[columnas sean del mismo tipo e igual longitud]**, por ejemplo una **.bg-orange[matriz de caracteres]**.


```r
# matriz de caracteres
nombres &lt;- c("Javier", "Carlos", "Mar√≠a")
apellidos &lt;- c("√Ålvarez", "Garc√≠a", "P√©rez")
cbind(nombres, apellidos)
```

```
&gt;      nombres  apellidos
&gt; [1,] "Javier" "√Ålvarez"
&gt; [2,] "Carlos" "Garc√≠a" 
&gt; [3,] "Mar√≠a"  "P√©rez"
```

--


```r
# matriz de valores l√≥gicos
cbind(c(TRUE, FALSE), c(FALSE, TRUE))
```

```
&gt;       [,1]  [,2]
&gt; [1,]  TRUE FALSE
&gt; [2,] FALSE  TRUE
```

---

# .orange[SELECCIONAR] elementos

Si recuerdas para los vectores, us√°bamos el operador `[i]` para **acceder al elemento i-√©simo**. En el caso de las matrices la l√≥gica ser√° la misma:

* para **.bg-purple_light[acceder a la fila i-√©sima]** se usa el operador `[i, ]` (dejando libre la columna).


```r
datos_matriz[1, ] # fila 1
```

```
&gt; edades    tlf     cp 
&gt;     14     NA  33007
```

---

# .orange[SELECCIONAR] elementos

Si recuerdas para los vectores, us√°bamos el operador `[i]` para **acceder al elemento i-√©simo**. En el caso de las matrices la l√≥gica ser√° la misma:

* para **.bg-purple_light[acceder a la columna j-√©sima]** se usa el operador `[, j]` (dejando libre la fila).


```r
datos_matriz[, 3] # columna 3
```

```
&gt; [1] 33007 28019 37005 18003 33091 25073 17140
```


---

# .orange[SELECCIONAR] elementos

Si recuerdas para los vectores, us√°bamos el operador `[i]` para **acceder al elemento i-√©simo**. En el caso de las matrices la l√≥gica ser√° la misma:

* para **.bg-purple_light[acceder conjuntamente al elemento (i, j)]** se usa el operador `[i, j]`.


```r
datos_matriz[1, 3] # elemento (1, 3)
```

```
&gt;    cp 
&gt; 33007
```

```r
datos_matriz[2, 2] # elemento (1, 3)
```

```
&gt;       tlf 
&gt; 683839390
```


---

# .orange[NOMBRAR] variables

Una matriz por defecto adopta los nombres de los vectores como los nombres de columnas, pero podemos 
**.bg-purple_light[personalizar los nombres de las variables]**


```r
estaturas &lt;- c(150, 160, 170)
pesos &lt;- c(60, 70, 80)
cbind("altura" = estaturas, "pesaje" = pesos)
```

```
&gt;      altura pesaje
&gt; [1,]    150     60
&gt; [2,]    160     70
&gt; [3,]    170     80
```


--

Si las columnas tienen nombres podemos hacer uso de ellos para **acceder a las columnas**


```r
datos_matriz[, c("edades", "tlf")]
```

```
&gt;      edades       tlf
&gt; [1,]     14        NA
&gt; [2,]     24 683839390
&gt; [3,]     56 621539732
&gt; [4,]     31 618211286
&gt; [5,]     20        NA
&gt; [6,]     87 914727164
&gt; [7,]     73        NA
```

---

# .orange[NOMBRAR] variables

Tambi√©n podemos **.bg-purple_light[asignar nombres]** a las filas de una matriz con `row.names()` y acceder a filas y columnas por nombres.


```r
row.names(datos_matriz) &lt;- c("Javi", "Laura", "Patricia", "Carlos", "Juan", "Luis", "Carla")
datos_matriz
```

```
&gt;          edades       tlf    cp
&gt; Javi         14        NA 33007
&gt; Laura        24 683839390 28019
&gt; Patricia     56 621539732 37005
&gt; Carlos       31 618211286 18003
&gt; Juan         20        NA 33091
&gt; Luis         87 914727164 25073
&gt; Carla        73        NA 17140
```

```r
datos_matriz["Javi", "edades"]
```

```
&gt; [1] 14
```

---

# .orange[OPERACIONES] por filas/columnas

Normalmente, para explicar las **operaciones con matrices** en un lenguaje de programaci√≥n al uso, necesitar√≠amos hablar de una **herramienta llamada bucles**. Lo mencionaremos m√°s adelante pero no los vamos a necesitar de momento (cu√°ntos menos los usemos en `R`, mejor)

--

Imagina que tuvi√©semos nuestra matriz de estaturas y pesos.


```r
datos_matriz &lt;- cbind(estaturas, pesos)
datos_matriz
```

```
&gt;      estaturas pesos
&gt; [1,]       150    60
&gt; [2,]       160    70
&gt; [3,]       170    80
```

--

¬øC√≥mo podemos **.bg-purple_light[aplicar una operaci√≥n para cada una de las filas o columnas]** de una matriz?

---

# .orange[OPERACIONES] por filas/columnas

Imagina que queremos obtener la **.bg-purple_light[media de cada columna]**. Lo haremos con la funci√≥n `apply()`, y le indicaremos como argumentos la matriz, el **.bg-orange[sentido de la operaci√≥n]** (`MARGIN = 1` por filas, `MARGIN = 2` por columnas) y la **funci√≥n a aplicar**


```r
# Media (mean) por columnas (MARGIN = 2)
apply(datos_matriz, MARGIN = 2, FUN = "mean")
```

```
&gt; estaturas     pesos 
&gt;       160        70
```

--

Si la funci√≥n **requiere de argumentos extras** se lo podemos indicar al final.


```r
estaturas_bis &lt;- c(150, NA, 170, 180, 190)
datos_matriz_bis &lt;- cbind(estaturas_bis, pesos) 
apply(datos_matriz_bis, MARGIN = 2, FUN = "mean")
```

```
&gt; estaturas_bis         pesos 
&gt;            NA            68
```

---

name: ejercicios-matrices

# Ejercicios de matrices

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: modifica el c√≥digo para definir una matriz `x` de ceros de 3 filas y 7 columnas.
 

```r
# Matriz
x &lt;- matrix(0, nrow = 2, ncol = 3)
x
```

* üìù **Ejercicio 2**: a la matriz anterior, suma un 1 a cada n√∫mero de la matriz y divide el resultado entre 5.
 

* üìù **Ejercicio 3**: tras definir la matriz `x` calcula su transpuesta y obt√©n sus dimensiones
 

]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
x &lt;- matrix(0, nrow = 3, ncol = 7)
x
```

```
&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
&gt; [1,]    0    0    0    0    0    0    0
&gt; [2,]    0    0    0    0    0    0    0
&gt; [3,]    0    0    0    0    0    0    0
```

]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
# sumamos 1
x + 1
```

```
&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
&gt; [1,]    1    1    1    1    1    1    1
&gt; [2,]    1    1    1    1    1    1    1
&gt; [3,]    1    1    1    1    1    1    1
```

```r
# dividimos entre 5
(x + 1) / 5
```

```
&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
&gt; [1,]  0.2  0.2  0.2  0.2  0.2  0.2  0.2
&gt; [2,]  0.2  0.2  0.2  0.2  0.2  0.2  0.2
&gt; [3,]  0.2  0.2  0.2  0.2  0.2  0.2  0.2
```

]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
# dimensiones originales
dim(x)
```

```
&gt; [1] 3 7
```

```r
# transpuesta
y &lt;- t(x)
y
```

```
&gt;      [,1] [,2] [,3]
&gt; [1,]    0    0    0
&gt; [2,]    0    0    0
&gt; [3,]    0    0    0
&gt; [4,]    0    0    0
&gt; [5,]    0    0    0
&gt; [6,]    0    0    0
&gt; [7,]    0    0    0
```

```r
dim(y)
```

```
&gt; [1] 7 3
```

]


]

---

# Ejercicios de matrices

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 4**: define la matriz `x &lt;- matrix(1:12, nrow = 4)`. Obt√©n la primera fila, la tercera columna, y el elemento (4, 1).

* üìù **Ejercicio 5**: en la matriz anterior, pon a cada fila `i` el nombre `fila_i` (fila_1, fila_2, fila_3, fila_4).

* üìù **Ejercicio 6**: con la matriz anterior definida como `matrix(1:12, nrow = 4)`, calcula la media de todos los elementos, la media de cada fila y la media de cada columna. Calcula la suma de de cada fila y de cada columna

]

.panel[.panel-name[Soluci√≥n ej. 4]


```r
x &lt;- matrix(1:12, nrow = 4)

# primera fila
x[1, ]
```

```
&gt; [1] 1 5 9
```

```r
# tercera columna
x[, 3]
```

```
&gt; [1]  9 10 11 12
```

```r
# (4, 1)
x[4, 1]
```

```
&gt; [1] 4
```

]

.panel[.panel-name[Soluci√≥n ej. 5]


```r
x
```

```
&gt;      [,1] [,2] [,3]
&gt; [1,]    1    5    9
&gt; [2,]    2    6   10
&gt; [3,]    3    7   11
&gt; [4,]    4    8   12
```

```r
row.names(x) &lt;- glue("fila_{1:4}")
x
```

```
&gt;        [,1] [,2] [,3]
&gt; fila_1    1    5    9
&gt; fila_2    2    6   10
&gt; fila_3    3    7   11
&gt; fila_4    4    8   12
```

]

.panel[.panel-name[Soluci√≥n ej. 6]


```r
# media por filas
apply(x, MARGIN = 1, FUN = mean)
```

```
&gt; fila_1 fila_2 fila_3 fila_4 
&gt;      5      6      7      8
```

```r
# media por columnas
apply(x, MARGIN = 2, FUN = mean)
```

```
&gt; [1]  2.5  6.5 10.5
```

```r
# suma por filas
apply(x, MARGIN = 1, FUN = sum)
```

```
&gt; fila_1 fila_2 fila_3 fila_4 
&gt;     15     18     21     24
```

```r
# suma por columnas
apply(x, MARGIN = 2, FUN = sum)
```

```
&gt; [1] 10 26 42
```

]

]


---

# Ejercicios extras (matrices y vectores)

.panelset[
.panel[.panel-name[Ejercicios extra]

* üìù **Ejercicio 1**: define un vector `y` que contenga los 5 primeros pares, y otro `x` con los 5 primeros impares. Haz la suma de `x` (ejercicio 1 anterior) e `y`.
 
* üìù **Ejercicio 2**: encuentra del vector `x &lt;- c(-1, 0, -2, 5, 3, 7)` el lugar (el √≠ndice) que ocupa su m√≠nimo y su m√°ximo.
 

* üìù **Ejercicio 3**: define el vector `c(-1, 0, 4, 5, -2)`, calcula la ra√≠z cuadrada del vector y determina que lugares son de tipo `NaN`.

* üìù **Ejercicio 4**:  el siguiente c√≥digo define una matriz de dimensiones `4 x 3` y calcula la suma por columnas. Modifica el c√≥digo para que realice la suma por filas.
 

```r
matriz &lt;- matrix(1:12, nrow = 4)
apply(matriz, MARGIN = 2, FUN = "sum")
```

]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
y &lt;- c(0, 2, 4, 6, 8)
x &lt;- y + 1 # forma m√°s r√°pida de (1, 3, 5, 7, 9)
x + y
```

```
&gt; [1]  1  5  9 13 17
```

]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
x &lt;- c(-1, 0, -2, 5, 3, 7)
which.max(x)
```

```
&gt; [1] 6
```

```r
which.min(y)
```

```
&gt; [1] 1
```

]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
x &lt;- c(-1, 0, 4, 5, -2)
sqrt(x)
```

```
&gt; [1]      NaN 0.000000 2.000000 2.236068      NaN
```

```r
is.nan(sqrt(x))
```

```
&gt; [1]  TRUE FALSE FALSE FALSE  TRUE
```

]

.panel[.panel-name[Soluci√≥n ej. 4]


```r
matriz &lt;- matrix(1:12, nrow = 4)
apply(matriz, MARGIN = 1, FUN = "sum")
```

```
&gt; [1] 15 18 21 24
```

]

]

---

class: inverse center middle
name: clase-4

# CLASE 4: primeros datos

&amp;nbsp;

### [data.frame](#data.frame)

### [tibble](#tibble)

### [Ejercicios datasets](#ejercicios-tibble)

### [Rmarkdown](#rmd)


---

name: data.frame

# .orange[TABLAS]: variables .green[data.frame]
 


&lt;img src="./img/celdas.jpg" width="45%" style="display: block; margin: auto;" /&gt;

* **.bg-purple_light[Celda]**: un dato **.bg-orange[individual]** de un tipo concreto.

* **.bg-purple_light[Variable]**: una **.bg-orange[concatenaci√≥n de valores]** del mismo tipo (**vectores**).

* **.bg-purple_light[Matriz]**: **.bg-orange[concatenaci√≥n de variables]** del **.bg-yellow[mismo tipo]** y longitud.

&amp;nbsp;

--

* **.bg-purple_light[data.frame (tabla)]**: **.bg-orange[concatenaci√≥n de variables]** de **.bg-yellow[DISTINTO tipo]** e igual longitud.


---

# .red[PROBLEMAS] de las .green[MATRICES]


Retomemos nuestra matriz de edades, tel√©fonos y c√≥digos postales.


```r
edades &lt;- c(14, 24, 56, 31, 20, 87) 
tlf &lt;- c(NA, 683839390, 621539732, 618211286, NA, 914727164)
cp &lt;- c(33007, 28019, 37005, 18003, 33091, 25073)

# Construimos la matriz por columnas
*datos_matriz &lt;- cbind(edades, tlf, cp)
datos_matriz
```

```
&gt;      edades       tlf    cp
&gt; [1,]     14        NA 33007
&gt; [2,]     24 683839390 28019
&gt; [3,]     56 621539732 37005
&gt; [4,]     31 618211286 18003
&gt; [5,]     20        NA 33091
&gt; [6,]     87 914727164 25073
```

--

¬øQu√© suceder√° si ahora **.bg-purple_light[a√±adimos una columna con los nombres]** (tipo caracter) de cada persona?

---


# .red[PROBLEMAS] de las .green[MATRICES]


```r
nombres &lt;- c("Sonia", "Carla", "Pepito", "Carlos", "Lara", "Sandra", "Javi")
datos_matriz_nueva &lt;- cbind(nombres, datos_matriz)
```


```
&gt;      nombres  edades tlf         cp     
&gt; [1,] "Sonia"  "14"   NA          "33007"
&gt; [2,] "Carla"  "24"   "683839390" "28019"
&gt; [3,] "Pepito" "56"   "621539732" "37005"
&gt; [4,] "Carlos" "31"   "618211286" "18003"
&gt; [5,] "Lara"   "20"   NA          "33091"
&gt; [6,] "Sandra" "87"   "914727164" "25073"
```

**.bg-red_light[¬øHas visto lo que ha sucedido?]**

--

Como una **.bg-purple_light[matriz solo puedes tener un tipo de dato]**, al a√±adir una variable de tipo texto, `R` se ha visto obligado a **convertir los n√∫meros en texto** (poni√©ndole **comillas**). 


```r
datos_matriz_nueva[, "edades"] + 1
```

```
&gt; Error in datos_matriz_nueva[, "edades"] + 1: argumento no-num√©rico para operador binario
```

---

# .red[PROBLEMAS] de las .green[MATRICES]

Las **.bg-purple_light[matrices]** nos permiten almacenar distintas variables SIEMPRE Y CUANDO tengan

* **.bg-orange[Misma longitud]**.
* **.bg-orange[Mismo tipo]** de dato (sin mezclar).

Esto es bastante limitante en la vida real nuestros datos tendr√°n variables de todo tipo: supongamos que queremos **guardar de 7 personas las siguientes variables**.



```r
# Nombres
nombres &lt;- c("Sonia", "Carla", "Pepito", "Carlos", "Lara", "Sandra", "Javi")

# Apellidos
apellidos &lt;- c(NA, "Gonz√°lez", "Fern√°ndez", "Mart√≠nez", "Li√©bana", "Garc√≠a", "Ortiz")

# C√≥digo postal
cp &lt;- c(28019, 28001, 34005, 18410, 33007, 34500, 28017)

# Edades
edades &lt;- c(45, 67, NA, 31, 27, 19, 50)
```

---


# .red[PROBLEMAS] de las .green[MATRICES]

Las **.bg-purple_light[matrices]** nos permiten almacenar distintas variables SIEMPRE Y CUANDO tengan

* **.bg-orange[Misma longitud]**.
* **.bg-orange[Mismo tipo]** de dato (sin mezclar).

Esto es bastante limitante en la vida real nuestros datos tendr√°n variables de todo tipo: supongamos que queremos **guardar de 7 personas las siguientes variables**.



```r
# Tel√©fono
tlf &lt;- c(618910564, 914718475, 934567891, 620176565, NA, NA, 688921344)

# Estado civil (no lo sabemos de una persona)
casado &lt;- c(TRUE, FALSE, FALSE, NA, TRUE, FALSE, FALSE)

# Fecha de creaci√≥n (fecha en el que esa persona entra en el sistema)
# lo convertimos a tipo fecha
fecha_creacion &lt;-
  as_date(c("2021-03-04", "2020-10-12", "1990-04-05",
            "2019-09-10", "2017-03-21", "2020-07-07",
            "2000-01-28"))
```


---

# .red[PROBLEMAS] de las .green[MATRICES]

Aahora tenemos un **popurr√≠ de variables**, de la misma longitud pero de tipos distintos:

* `(edades, tlf, cp)` son variables **num√©ricas**.
* `(nombres, apellidos)` son variables de **texto**.
* `casado` es una variable **l√≥gica**.
* `fecha_creacion` de tipo **fecha**.

¬øQu√© suceder√≠a si **.bg-purple_light[intentamos mezclar todo en una matriz]**?

--


```r
# Juntamos por columnas
datos_matriz &lt;-
  cbind(nombres, apellidos, edades, tlf, cp, casado, fecha_creacion)
datos_matriz
```

```
&gt;      nombres  apellidos   edades tlf         cp      casado  fecha_creacion
&gt; [1,] "Sonia"  NA          "45"   "618910564" "28019" "TRUE"  "18690"       
&gt; [2,] "Carla"  "Gonz√°lez"  "67"   "914718475" "28001" "FALSE" "18547"       
&gt; [3,] "Pepito" "Fern√°ndez" NA     "934567891" "34005" "FALSE" "7399"        
&gt; [4,] "Carlos" "Mart√≠nez"  "31"   "620176565" "18410" NA      "18149"       
&gt; [5,] "Lara"   "Li√©bana"   "27"   NA          "33007" "TRUE"  "17246"       
&gt; [6,] "Sandra" "Garc√≠a"    "19"   NA          "34500" "FALSE" "18450"       
&gt; [7,] "Javi"   "Ortiz"     "50"   "688921344" "28017" "FALSE" "10984"
```

---

# .red[PROBLEMAS] de las .green[MATRICES]


```r
datos_matriz
```

```
&gt;      nombres  apellidos   edades tlf         cp      casado  fecha_creacion
&gt; [1,] "Sonia"  NA          "45"   "618910564" "28019" "TRUE"  "18690"       
&gt; [2,] "Carla"  "Gonz√°lez"  "67"   "914718475" "28001" "FALSE" "18547"       
&gt; [3,] "Pepito" "Fern√°ndez" NA     "934567891" "34005" "FALSE" "7399"        
&gt; [4,] "Carlos" "Mart√≠nez"  "31"   "620176565" "18410" NA      "18149"       
&gt; [5,] "Lara"   "Li√©bana"   "27"   NA          "33007" "TRUE"  "17246"       
&gt; [6,] "Sandra" "Garc√≠a"    "19"   NA          "34500" "FALSE" "18450"       
&gt; [7,] "Javi"   "Ortiz"     "50"   "688921344" "28017" "FALSE" "10984"
```

Dado que en una **.bg-purple_light[matriz solo podemos almacenar datos del mismo tipo]**, los n√∫meros los convierte a texto, las variables l√≥gicas las convierte a texto (`TRUE` era un valor l√≥gico, `"TRUE"` es un texto, sin significado de verdadero/falso) y las fechas las ha convertido a texto.


```r
datos_matriz[1, "fecha_creacion"] - datos_matriz[2, "fecha_creacion"]
```

```
&gt; Error in datos_matriz[1, "fecha_creacion"] - datos_matriz[2, "fecha_creacion"]: argumento no-num√©rico para operador binario
```

---

# .orange[TABLAS]: variables .green[data.frame]

Vamos a aprender c√≥mo juntar variables de distinto tipo, sin **modificar la integridad** del dato. El formato de **.bg-purple_light[tabla de datos]** que vamos a empezar a usar se llama `data.frame`: una **.bg-purple_light[colecci√≥n de variables de igual longitud]** pero cada una puede ser de un **.bg-orange[tipo distinto]**.

--

Para crearlo basta con usar la funci√≥n `data.frame()`, pas√°ndole como argumentos (separados por comas) las variables que queremos reunir.


```r
# Creamos nuestro primer data.frame
tabla &lt;- data.frame(nombres, apellidos, edades, tlf,
*                   cp, casado, fecha_creacion)
tabla
```

```
&gt;   nombres apellidos edades       tlf    cp casado fecha_creacion
&gt; 1   Sonia      &lt;NA&gt;     45 618910564 28019   TRUE     2021-03-04
&gt; 2   Carla  Gonz√°lez     67 914718475 28001  FALSE     2020-10-12
&gt; 3  Pepito Fern√°ndez     NA 934567891 34005  FALSE     1990-04-05
&gt; 4  Carlos  Mart√≠nez     31 620176565 18410     NA     2019-09-10
&gt; 5    Lara   Li√©bana     27        NA 33007   TRUE     2017-03-21
&gt; 6  Sandra    Garc√≠a     19        NA 34500  FALSE     2020-07-07
&gt; 7    Javi     Ortiz     50 688921344 28017  FALSE     2000-01-28
```

---

# .orange[TABLAS]: variables .green[data.frame]


```r
tabla
```

```
&gt;   nombres apellidos edades       tlf    cp casado fecha_creacion
&gt; 1   Sonia      &lt;NA&gt;     45 618910564 28019   TRUE     2021-03-04
&gt; 2   Carla  Gonz√°lez     67 914718475 28001  FALSE     2020-10-12
&gt; 3  Pepito Fern√°ndez     NA 934567891 34005  FALSE     1990-04-05
&gt; 4  Carlos  Mart√≠nez     31 620176565 18410     NA     2019-09-10
&gt; 5    Lara   Li√©bana     27        NA 33007   TRUE     2017-03-21
&gt; 6  Sandra    Garc√≠a     19        NA 34500  FALSE     2020-07-07
&gt; 7    Javi     Ortiz     50 688921344 28017  FALSE     2000-01-28
```

```r
class(tabla)
```

```
&gt; [1] "data.frame"
```

```r
dim(tabla)
```

```
&gt; [1] 7 7
```

---

# .orange[TABLAS]: variables .green[data.frame]

Al igual que con matrices, podemos **.bg-purple_light[crear un data.frame]** indicando **nombre de columnas**


```r
tabla &lt;- data.frame("nombre" = nombres, "apellido" = apellidos, "edad" = edades, "tel√©fono" = tlf, 
                    "cp" = cp, "casado" = casado, "fecha_registro" = fecha_creacion)
tabla
```

```
&gt;   nombre  apellido edad  tel√©fono    cp casado fecha_registro
&gt; 1  Sonia      &lt;NA&gt;   45 618910564 28019   TRUE     2021-03-04
&gt; 2  Carla  Gonz√°lez   67 914718475 28001  FALSE     2020-10-12
&gt; 3 Pepito Fern√°ndez   NA 934567891 34005  FALSE     1990-04-05
&gt; 4 Carlos  Mart√≠nez   31 620176565 18410     NA     2019-09-10
&gt; 5   Lara   Li√©bana   27        NA 33007   TRUE     2017-03-21
&gt; 6 Sandra    Garc√≠a   19        NA 34500  FALSE     2020-07-07
&gt; 7   Javi     Ortiz   50 688921344 28017  FALSE     2000-01-28
```

&amp;nbsp;

**.bg-green_light[¬°TENEMOS NUESTRO PRIMER CONJUNTO DE DATOS!]** Puedes visualizarlo escribiendo su nombre en consola o con `View(tabla)`

---

# .orange[TABLAS]: variables .green[data.frame]

Si tenemos uno ya creado y queremos **.bg-purple_light[a√±adir una columna]** es tan simple como usar la `funci√≥n data.frame()` que ya hemos visto para concatenar la columna. Vamos a√±adir por ejemplo una nueva variable, el **n√∫mero de hermanos** de cada individuo.


```r
# A√±adimos una nueva columna con n¬∫ de hermanos/as
hermanos &lt;- c(0, 0, 1, 5, 2, 3, 0)
tabla &lt;- data.frame(tabla, "n_hermanos" = hermanos)
tabla
```

```
&gt;   nombre  apellido edad  tel√©fono    cp casado fecha_registro n_hermanos
&gt; 1  Sonia      &lt;NA&gt;   45 618910564 28019   TRUE     2021-03-04          0
&gt; 2  Carla  Gonz√°lez   67 914718475 28001  FALSE     2020-10-12          0
&gt; 3 Pepito Fern√°ndez   NA 934567891 34005  FALSE     1990-04-05          1
&gt; 4 Carlos  Mart√≠nez   31 620176565 18410     NA     2019-09-10          5
&gt; 5   Lara   Li√©bana   27        NA 33007   TRUE     2017-03-21          2
&gt; 6 Sandra    Garc√≠a   19        NA 34500  FALSE     2020-07-07          3
&gt; 7   Javi     Ortiz   50 688921344 28017  FALSE     2000-01-28          0
```

---

# .orange[TABLAS]: variables .green[data.frame]

Si queremos **.bg-purple_light[acceder a una columna, fila o elemento]** en concreto, los `data.frame` tienen las mismas ventajas que una matriz, as√≠ que bastar√≠a con usar los mismos operadores.


```r
tabla[5, ] # Accedemos a la quinta fila
```

```
&gt;   nombre apellido edad tel√©fono    cp casado fecha_registro n_hermanos
&gt; 5   Lara  Li√©bana   27       NA 33007   TRUE     2017-03-21          2
```

--

.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/tabla_dolar.jpg" alt="Men√∫ desplegable de variables (columnas)" width="99%" /&gt;
&lt;p class="caption"&gt;Men√∫ desplegable de variables (columnas)&lt;/p&gt;
&lt;/div&gt;
]

.pull-right[

No solo tiene las ventajas de una matriz sino que tambi√©n tiene las **.bg-purple_light[ventajas de una ¬´base¬ª de datos]**: podemos aceder a las variables por el √≠ndice de columna que ocupan pero tambi√©n **.bg-purple_light[acceder por su nombre]**, poniendo el nombre de la tabla, el s√≠mbolo `$` y, con el tabulador, nos aparecer√° un men√∫ de columnas a elegir.

]

---

# Primer .orange[AN√ÅLISIS DE DATOS]

.panelset[
.panel[.panel-name[USArrests]

Nuestro primer conjunto ser√° `USArrests`, un dataset de **.bg-purple_light[arrestos en EE.UU.]** del paquete `{datasets}` (si escribimos `datasets::` y pulsamos tabulador, se nos abre un desplegable con distintos conjuntos de datos para ser usado)


```r
# install.packages("datasets") # Descomentar si nunca se ha instalado
library(datasets)
datasets::USArrests
```

```
&gt;                Murder Assault UrbanPop Rape
&gt; Alabama          13.2     236       58 21.2
&gt; Alaska           10.0     263       48 44.5
&gt; Arizona           8.1     294       80 31.0
&gt; Arkansas          8.8     190       50 19.5
&gt; California        9.0     276       91 40.6
&gt; Colorado          7.9     204       78 38.7
&gt; Connecticut       3.3     110       77 11.1
&gt; Delaware          5.9     238       72 15.8
&gt; Florida          15.4     335       80 31.9
&gt; Georgia          17.4     211       60 25.8
&gt; Hawaii            5.3      46       83 20.2
&gt; Idaho             2.6     120       54 14.2
&gt; Illinois         10.4     249       83 24.0
&gt; Indiana           7.2     113       65 21.0
&gt; Iowa              2.2      56       57 11.3
&gt; Kansas            6.0     115       66 18.0
&gt; Kentucky          9.7     109       52 16.3
&gt; Louisiana        15.4     249       66 22.2
&gt; Maine             2.1      83       51  7.8
&gt; Maryland         11.3     300       67 27.8
&gt; Massachusetts     4.4     149       85 16.3
&gt; Michigan         12.1     255       74 35.1
&gt; Minnesota         2.7      72       66 14.9
&gt; Mississippi      16.1     259       44 17.1
&gt; Missouri          9.0     178       70 28.2
&gt; Montana           6.0     109       53 16.4
&gt; Nebraska          4.3     102       62 16.5
&gt; Nevada           12.2     252       81 46.0
&gt; New Hampshire     2.1      57       56  9.5
&gt; New Jersey        7.4     159       89 18.8
&gt; New Mexico       11.4     285       70 32.1
&gt; New York         11.1     254       86 26.1
&gt; North Carolina   13.0     337       45 16.1
&gt; North Dakota      0.8      45       44  7.3
&gt; Ohio              7.3     120       75 21.4
&gt; Oklahoma          6.6     151       68 20.0
&gt; Oregon            4.9     159       67 29.3
&gt; Pennsylvania      6.3     106       72 14.9
&gt; Rhode Island      3.4     174       87  8.3
&gt; South Carolina   14.4     279       48 22.5
&gt; South Dakota      3.8      86       45 12.8
&gt; Tennessee        13.2     188       59 26.9
&gt; Texas            12.7     201       80 25.5
&gt; Utah              3.2     120       80 22.9
&gt; Vermont           2.2      48       32 11.2
&gt; Virginia          8.5     156       63 20.7
&gt; Washington        4.0     145       73 26.2
&gt; West Virginia     5.7      81       39  9.3
&gt; Wisconsin         2.6      53       66 10.8
&gt; Wyoming           6.8     161       60 15.6
```

Contiene **.bg-purple_light[estad√≠sticas de arrestos en 1973 (por cada 100 000 habitantes)]** por agresi√≥n, asesinato y violaci√≥n, en cada uno de los 50 estados de Estados Unidos.
]

.panel[.panel-name[Visualizar]

Con `View()` se nos abrir√° el conjunto en un formato ¬´excelizado¬ª. Adem√°s con `head()` podemos **.bg-purple_light[visualizar la cabecera]** (primeras) del conjunto de datos.


```r
head(USArrests)
```

```
&gt;            Murder Assault UrbanPop Rape
&gt; Alabama      13.2     236       58 21.2
&gt; Alaska       10.0     263       48 44.5
&gt; Arizona       8.1     294       80 31.0
&gt; Arkansas      8.8     190       50 19.5
&gt; California    9.0     276       91 40.6
&gt; Colorado      7.9     204       78 38.7
```

]

.panel[.panel-name[Variables]

Con la funci√≥n `names()` podemos obtener directamente el **.bg-purple_light[nombre de las variables]** (tambi√©n podemos usarlo para renombrarlas)


```r
names(USArrests)
```

```
&gt; [1] "Murder"   "Assault"  "UrbanPop" "Rape"
```

El conjunto contiene los **3 tipos de delito** mencionados (para cada estado), y adem√°s el **porcentaje de poblaci√≥n que vive en √°reas urbanas**. Esto lo podemos saber ejecutando la ayuda con `? datasets::USArrests`.

]

.panel[.panel-name[Individuos]

Con la funci√≥n `row.names()` podemos obtener el **.bg-purple_light[nombre de las filas]** (de los estados) para cada uno de ellos.


```r
row.names(USArrests)
```

```
&gt;  [1] "Alabama"        "Alaska"         "Arizona"        "Arkansas"      
&gt;  [5] "California"     "Colorado"       "Connecticut"    "Delaware"      
&gt;  [9] "Florida"        "Georgia"        "Hawaii"         "Idaho"         
&gt; [13] "Illinois"       "Indiana"        "Iowa"           "Kansas"        
&gt; [17] "Kentucky"       "Louisiana"      "Maine"          "Maryland"      
&gt; [21] "Massachusetts"  "Michigan"       "Minnesota"      "Mississippi"   
&gt; [25] "Missouri"       "Montana"        "Nebraska"       "Nevada"        
&gt; [29] "New Hampshire"  "New Jersey"     "New Mexico"     "New York"      
&gt; [33] "North Carolina" "North Dakota"   "Ohio"           "Oklahoma"      
&gt; [37] "Oregon"         "Pennsylvania"   "Rhode Island"   "South Carolina"
&gt; [41] "South Dakota"   "Tennessee"      "Texas"          "Utah"          
&gt; [45] "Vermont"        "Virginia"       "Washington"     "West Virginia" 
&gt; [49] "Wisconsin"      "Wyoming"
```

]


.panel[.panel-name[Dimensiones]

¬øC√≥mo averiguar el **.bg-purple_light[n√∫mero de registros y el n√∫mero de variables]**?


```r
dim(USArrests)
```

```
&gt; [1] 50  4
```

```r
nrow(USArrests)
```

```
&gt; [1] 50
```

```r
ncol(USArrests)
```

```
&gt; [1] 4
```

]

.panel[.panel-name[Selecci√≥n]

Al igual que antes, podemos **.bg-purple_light[seleccionar filas por √≠ndices]** y **.bg-purple_light[variables nombre]**.



```r
USArrests[c(2, 10), c("Murder", "Assault")]
```

```
&gt;         Murder Assault
&gt; Alaska    10.0     263
&gt; Georgia   17.4     211
```

Tambi√©n podemos usar las ventajas de los `data.frame` para acceder a las variables.


```r
USArrests$Murder
```

```
&gt;  [1] 13.2 10.0  8.1  8.8  9.0  7.9  3.3  5.9 15.4 17.4  5.3  2.6 10.4  7.2  2.2
&gt; [16]  6.0  9.7 15.4  2.1 11.3  4.4 12.1  2.7 16.1  9.0  6.0  4.3 12.2  2.1  7.4
&gt; [31] 11.4 11.1 13.0  0.8  7.3  6.6  4.9  6.3  3.4 14.4  3.8 13.2 12.7  3.2  2.2
&gt; [46]  8.5  4.0  5.7  2.6  6.8
```

]

.panel[.panel-name[subset]

En el caso de los `data.frame` tenemos adem√°s a nuestro disposici√≥n una **herramienta muy potente**: la funci√≥n `subset()`. Dicha funci√≥n nos va a permitir **.bg-purple_light[seleccionar filas y columnas a la vez]**, tomando de entrada la tabla, `subset = ...` igual a la **condici√≥n l√≥gica** para filtrar registros (filas) y `select = ...` igual al  nombre de las columnas que queremos seleccionar.


```r
subset(USArrests, subset = UrbanPop &gt; 70, select = c("Murder"))
```

```
&gt;               Murder
&gt; Arizona          8.1
&gt; California       9.0
&gt; Colorado         7.9
&gt; Connecticut      3.3
&gt; Delaware         5.9
&gt; Florida         15.4
&gt; Hawaii           5.3
&gt; Illinois        10.4
&gt; Massachusetts    4.4
&gt; Michigan        12.1
&gt; Nevada          12.2
&gt; New Jersey       7.4
&gt; New York        11.1
&gt; Ohio             7.3
&gt; Pennsylvania     6.3
&gt; Rhode Island     3.4
&gt; Texas           12.7
&gt; Utah             3.2
&gt; Washington       4.0
```

]

.panel[.panel-name[Caso pr√°ctico]

* üìù **Ejercicio**: filtra aquellos estados cuyo porcentaje de poblaci√≥n urbana sea inferior al 70% y donde las agresiones sean superiores a 250 por cada 100 000 habitantes, seleccionando solo las variables.

]

.panel[.panel-name[Caso pr√°ctico]

* üìù **Ejercicio**: filtra aquellos estados cuyo porcentaje de poblaci√≥n urbana sea inferior al 70% y donde las agresiones sean superiores a 250 por cada 100 000 habitantes, seleccionando solo las variables.


```r
subset(USArrests, subset = UrbanPop &lt; 70 &amp; Assault &gt; 250,
       select = c("Murder", "Rape"))
```

```
&gt;                Murder Rape
&gt; Alaska           10.0 44.5
&gt; Maryland         11.3 27.8
&gt; Mississippi      16.1 17.1
&gt; North Carolina   13.0 16.1
&gt; South Carolina   14.4 22.5
```

]

]

---

name: tibble

# Mejorando los data.frame: .orange[TIBBLE]
 
Las tablas en formato `tibble` (con `tibble()` del paquete `{tibble}`, su clase ser√° `tbl_df`) son un tipo de `data.frame` mejorado, para una gesti√≥n **.bg-purple_light[m√°s √°gil, eficiente y coherente]**. Las tablas en formato `tibble` tienen **.bg-purple_light[4 ventajas principales]**

&lt;img src="./img/tibble.svg" width="30%" style="display: block; margin: auto;" /&gt;

---

# Mejorando los data.frame: .orange[TIBBLE]


*  Muestran **.bg-purple_light[metainformaci√≥n de las variables]**, y solo imprime por defecto las primeras filas.


```r
library(tibble)
tabla_tb &lt;- tibble("x" = 1:50, "y" = rep(c("a", "b", "c", "d", "e"), 10),
                   "logica" = rep(c(TRUE, FALSE), 25))
tabla_tb
```

```
&gt; # A tibble: 50 √ó 3
&gt;        x y     logica
&gt;    &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; 
&gt;  1     1 a     TRUE  
&gt;  2     2 b     FALSE 
&gt;  3     3 c     TRUE  
&gt;  4     4 d     FALSE 
&gt;  5     5 e     TRUE  
&gt;  6     6 a     FALSE 
&gt;  7     7 b     TRUE  
&gt;  8     8 c     FALSE 
&gt;  9     9 d     TRUE  
&gt; 10    10 e     FALSE 
&gt; # ‚Ä¶ with 40 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```



---

# Mejorando los data.frame: .orange[TIBBLE]
 
Puedes **imprimir las filas y columnas** que quieras con `print()`


```r
*print(tabla_tb, n = 12, width = Inf)
```

```
&gt; # A tibble: 50 √ó 3
&gt;        x y     logica
&gt;    &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; 
&gt;  1     1 a     TRUE  
&gt;  2     2 b     FALSE 
&gt;  3     3 c     TRUE  
&gt;  4     4 d     FALSE 
&gt;  5     5 e     TRUE  
&gt;  6     6 a     FALSE 
&gt;  7     7 b     TRUE  
&gt;  8     8 c     FALSE 
&gt;  9     9 d     TRUE  
&gt; 10    10 e     FALSE 
&gt; 11    11 a     TRUE  
&gt; 12    12 b     FALSE 
&gt; # ‚Ä¶ with 38 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# Mejorando los data.frame: .orange[TIBBLE]
 

* La funci√≥n `tibble()` **.bg-purple_light[construye las variables secuencialmente]**, pudiendo hacer uso en la propia definici√≥n de variables reci√©n definidas en dicha definici√≥n.


```r
# data.frame
data.frame("x1" = 1:3, "x2" = 4:6, "y" = x1 * x2)
```

```
&gt; Error in data.frame(x1 = 1:3, x2 = 4:6, y = x1 * x2): objeto 'x1' no encontrado
```


```r
# tibble
tibble("x1" = 1:3, "x2" = 4:6, "y" = x1 * x2)
```

```
&gt; # A tibble: 3 √ó 3
&gt;      x1    x2     y
&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
&gt; 1     1     4     4
&gt; 2     2     5    10
&gt; 3     3     6    18
```


---

# Mejorando los data.frame: .orange[TIBBLE]
 
* Si accedes a una **.bg-purple_light[columna que no existe]** avisa con un **.bg-red[warning]**.


```r
tabla_df &lt;- data.frame("x" = 1:50, "y" = rep(c("a", "b", "c", "d", "e"), 10),
                   "logica" = rep(c(TRUE, FALSE), 25))
```

.pull-left[


```r
# data.frame
tabla_df$variable_inexistente
```

```
&gt; NULL
```

]

.pull-right[


```r
# tibble
tabla_tb$variable_inexistente
```

```
&gt; Warning: Unknown or uninitialised column: `variable_inexistente`.
```

```
&gt; NULL
```

]

---


# Mejorando los data.frame: .orange[TIBBLE]

* No solo no te cambiar√° el tipo de datos sino que **.bg-purple_light[no te cambiar√° el nombre de las variables]**.

.pull-left[


```r
data.frame(":)" = "emoticono",
           " " = "en blanco",
           "2000" = "n√∫mero")
```

```
&gt;         X..        X.  X2000
&gt; 1 emoticono en blanco n√∫mero
```

]

.pull-right[


```r
tibble(":)" = "emoticono",
       " " = "en blanco",
       "2000" = "n√∫mero")
```

```
&gt; # A tibble: 1 √ó 3
&gt;   `:)`      ` `       `2000`
&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; 
&gt; 1 emoticono en blanco n√∫mero
```

]

---


# Mejorando los data.frame: .orange[TIBBLE]

Si ya tienes un `data.frame` es altamente recomendable **.bg-purple_light[convertirlo a tibble]** con `as_tibble()` (del paquete `{dplyr}`)


```r
library(dplyr)
as_tibble(USArrests)
```

```
&gt; # A tibble: 50 √ó 4
&gt;    Murder Assault UrbanPop  Rape
&gt;     &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt; &lt;dbl&gt;
&gt;  1   13.2     236       58  21.2
&gt;  2   10       263       48  44.5
&gt;  3    8.1     294       80  31  
&gt;  4    8.8     190       50  19.5
&gt;  5    9       276       91  40.6
&gt;  6    7.9     204       78  38.7
&gt;  7    3.3     110       77  11.1
&gt;  8    5.9     238       72  15.8
&gt;  9   15.4     335       80  31.9
&gt; 10   17.4     211       60  25.8
&gt; # ‚Ä¶ with 40 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

Puedes consultar **m√°s funcionalidades** de dichos datos en &lt;https://tibble.tidyverse.org/&gt;

---

# Mejorando los data.frame: .orange[TIBBLE]

Una de las ventajas es la funci√≥n `glimpse()`, que nos permite obtener el **.bg-purple_light[resumen de columnas]** (no es para tener un resumen de los datos sino para ver las variables que tenemos y su tipo).


```r
glimpse(tabla_tb)
```

```
&gt; Rows: 50
&gt; Columns: 3
&gt; $ x      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, ‚Ä¶
&gt; $ y      &lt;chr&gt; "a", "b", "c", "d", "e", "a", "b", "c", "d", "e", "a", "b", "c"‚Ä¶
&gt; $ logica &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE‚Ä¶
```

---

# Mejorando los data.frame: .orange[TIBBLE]

Am√©n de poder convetir con `as_tibble()` podemos **.bg-purple_light[crearlos por filas]** (como copiar y pegar de una tabla en documento) en lugar de por columnas con `tribble()`


```r
datos &lt;- tribble(
  ~colA, ~colB,
  "a",   1,
  "b",   2)
datos
```

```
&gt; # A tibble: 2 √ó 2
&gt;   colA   colB
&gt;   &lt;chr&gt; &lt;dbl&gt;
&gt; 1 a         1
&gt; 2 b         2
```

&amp;nbsp;

--

**.bg-green_light[CONSEJO]**: prueba adem√°s el paquete `{datapasta}`, que nos permite **.bg-purple_light[copiar y pegar tablas de p√°ginas web]**


---

name: ejercicios-tibble

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: carga del paquete `{datasets}` el conjunto de datos `airquality` (contiene variables de la calidad del aire de la ciudad de Nueva York desde mayo hasta septiembre de 1973). ¬øEs el conjunto de datos airquality de tipo tibble? En caso negativo, convi√©rtelo a `tibble`.

* üìù **Ejercicio 2**: obt√©n el nombre de las variables y las dimensiones del conjunto de datos. ¬øCu√°ntas variables hay? ¬øCu√°ntos d√≠as se han medido?
 
* üìù **Ejercicio 3**:  modifica el c√≥digo inferior para que nos filtre solo los datos del mes de agosto.
 

```r
# Filtramos filas
filtro_fila &lt;- subset(., subset = Month &lt; 6)
filtro_fila
```

]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
library(datasets)
class(airquality) # no es data.frame
```

```
&gt; [1] "data.frame"
```

```r
# Convertimos a tibble
airquality &lt;- as_tibble(airquality)
class(airquality)
```

```
&gt; [1] "tbl_df"     "tbl"        "data.frame"
```

]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
names(airquality)
```

```
&gt; [1] "Ozone"   "Solar.R" "Wind"    "Temp"    "Month"   "Day"
```

```r
dim(airquality)
```

```
&gt; [1] 153   6
```

```r
# N√∫mero variables
ncol(airquality)
```

```
&gt; [1] 6
```

```r
# N√∫mero d√≠as
nrow(airquality)
```

```
&gt; [1] 153
```

]


.panel[.panel-name[Soluci√≥n ej. 3]


```r
# Filtramos filas
filtro_fila &lt;- subset(airquality, subset = Month == 8)
filtro_fila
```

```
&gt; # A tibble: 31 √ó 6
&gt;    Ozone Solar.R  Wind  Temp Month   Day
&gt;    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
&gt;  1    39      83   6.9    81     8     1
&gt;  2     9      24  13.8    81     8     2
&gt;  3    16      77   7.4    82     8     3
&gt;  4    78      NA   6.9    86     8     4
&gt;  5    35      NA   7.4    85     8     5
&gt;  6    66      NA   4.6    87     8     6
&gt;  7   122     255   4      89     8     7
&gt;  8    89     229  10.3    90     8     8
&gt;  9   110     207   8      90     8     9
&gt; 10    NA     222   8.6    92     8    10
&gt; # ‚Ä¶ with 21 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```
]

]

---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 4**: del conjunto selecciona aquellos datos que no sean ni de julio ni de agosto.

* üìù **Ejercicio 5**: modifica el siguiente c√≥digo para quedarte solo con las variable de ozono y temperatura.
 

```r
filtro_col &lt;- subset(.,  select = c("Ozone"))
filtro_col
```

* üìù **Ejercicio 6**:  selecciona los datos de temperatura y viento de agosto. Traduce a castellano el nombre de las columnas del conjunto filtrado.


* üìù **Ejercicio 7**: a√±ade a los datos originales una columna con la fecha completa (recuerda que es del a√±o 1973 todas las observaciones).

]

.panel[.panel-name[Soluci√≥n ej. 4]


```r
subset(airquality, subset = !(Month %in% c(7, 8)))
```

```
&gt; # A tibble: 91 √ó 6
&gt;    Ozone Solar.R  Wind  Temp Month   Day
&gt;    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
&gt;  1    41     190   7.4    67     5     1
&gt;  2    36     118   8      72     5     2
&gt;  3    12     149  12.6    74     5     3
&gt;  4    18     313  11.5    62     5     4
&gt;  5    NA      NA  14.3    56     5     5
&gt;  6    28      NA  14.9    66     5     6
&gt;  7    23     299   8.6    65     5     7
&gt;  8    19      99  13.8    59     5     8
&gt;  9     8      19  20.1    61     5     9
&gt; 10    NA     194   8.6    69     5    10
&gt; # ‚Ä¶ with 81 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Soluci√≥n ej. 5]


```r
# Filtramos columnas
filtro_col &lt;- subset(airquality,  select = c("Ozone", "Temp"))
filtro_col
```

```
&gt; # A tibble: 153 √ó 2
&gt;    Ozone  Temp
&gt;    &lt;int&gt; &lt;int&gt;
&gt;  1    41    67
&gt;  2    36    72
&gt;  3    12    74
&gt;  4    18    62
&gt;  5    NA    56
&gt;  6    28    66
&gt;  7    23    65
&gt;  8    19    59
&gt;  9     8    61
&gt; 10    NA    69
&gt; # ‚Ä¶ with 143 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Soluci√≥n ej. 6]


```r
datos &lt;- subset(airquality, subset = Month == 8, select = c("Temp", "Wind"))
datos 
```

```
&gt; # A tibble: 31 √ó 2
&gt;     Temp  Wind
&gt;    &lt;int&gt; &lt;dbl&gt;
&gt;  1    81   6.9
&gt;  2    81  13.8
&gt;  3    82   7.4
&gt;  4    86   6.9
&gt;  5    85   7.4
&gt;  6    87   4.6
&gt;  7    89   4  
&gt;  8    90  10.3
&gt;  9    90   8  
&gt; 10    92   8.6
&gt; # ‚Ä¶ with 21 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

```r
# Traducimos a castellano el nombre
names(datos) &lt;- c("temperatura", "viento")
glimpse(datos)
```

```
&gt; Rows: 31
&gt; Columns: 2
&gt; $ temperatura &lt;int&gt; 81, 81, 82, 86, 85, 87, 89, 90, 90, 92, 86, 86, 82, 80, 79‚Ä¶
&gt; $ viento      &lt;dbl&gt; 6.9, 13.8, 7.4, 6.9, 7.4, 4.6, 4.0, 10.3, 8.0, 8.6, 11.5, ‚Ä¶
```

]

.panel[.panel-name[Soluci√≥n ej. 7]


```r
nuevos_datos &lt;- 
  tibble(airquality, "fecha" = as_date(glue("1973-{Month}-{Day}")))
nuevos_datos
```

```
&gt; # A tibble: 153 √ó 7
&gt;    Ozone Solar.R  Wind  Temp Month   Day fecha     
&gt;    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;date&gt;    
&gt;  1    41     190   7.4    67     5     1 1973-05-01
&gt;  2    36     118   8      72     5     2 1973-05-02
&gt;  3    12     149  12.6    74     5     3 1973-05-03
&gt;  4    18     313  11.5    62     5     4 1973-05-04
&gt;  5    NA      NA  14.3    56     5     5 1973-05-05
&gt;  6    28      NA  14.9    66     5     6 1973-05-06
&gt;  7    23     299   8.6    65     5     7 1973-05-07
&gt;  8    19      99  13.8    59     5     8 1973-05-08
&gt;  9     8      19  20.1    61     5     9 1973-05-09
&gt; 10    NA     194   8.6    69     5    10 1973-05-10
&gt; # ‚Ä¶ with 143 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]


]

---

# Ejercicios extras

.panelset[
.panel[.panel-name[Ejercicios extras]


* üìù **Ejercicio 8**: define un `tibble` con tres variables num√©ricas `a, b, c`, tal que la tercera sea el producto de las dos primeras `c = a * b`.

* üìù **Ejercicio 9**:  define un tibble con tres variables de nombres `variable`, `2`, `tercera` y `:)`, e intenta acceder a ellas.
 
* üìù **Ejercicio 10**:  obten de los paquetes `{dplyr}` y `{gapminder}` los conjuntos de datos `starwars` y `gapminder`. Comprueba el n√∫mero de variables, de registros e imprime los datos

]

.panel[.panel-name[Soluci√≥n ej. 8]


```r
tibble("a" = 1:4, "b" = 11:14, "c" = a * b)
```

```
&gt; # A tibble: 4 √ó 3
&gt;       a     b     c
&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
&gt; 1     1    11    11
&gt; 2     2    12    24
&gt; 3     3    13    39
&gt; 4     4    14    56
```

]

.panel[.panel-name[Soluci√≥n ej. 9]


```r
datos &lt;- tibble("variable" = 1, "2" = "a", "tercera" = 3, ":)" = "b")

# Accedemos
datos$variable
```

```
&gt; [1] 1
```

```r
datos$`2`
```

```
&gt; [1] "a"
```

```r
datos$tercera
```

```
&gt; [1] 3
```

```r
datos$`:)`
```

```
&gt; [1] "b"
```

]

.panel[.panel-name[Soluci√≥n ej. 10]


```r
library(dplyr)
dim(starwars)
```

```
&gt; [1] 87 14
```

```r
library(gapminder)
dim(gapminder)
```

```
&gt; [1] 1704    6
```

]

]

---

name: rmd

# .orange[COMUNICANDO] resultados: archivos .green[.Rmd] 


Una de las principales **.bg-purple_light[fortalezas]** de `R` es la facilidad para generar informes, libros, webs, **.bg-purple_light[apuntes y hasta diapositivas]** (este material por ejemplo).

&amp;nbsp;

Para ello instalaremos antes el paquete `{rmarkdown}` que nos permitir√° generar documentos `.Rmd`


```r
install.packages("rmarkdown")
```

---

# .orange[COMUNICANDO] resultados: archivos .green[.Rmd] 

¬øCu√°l son las **ventajas** de generarlos desde **.bg-purple_light[rmarkdown]**?

--

* Al hacerlo desde `RStudio`, puedes generar un informe o una presentaci√≥n **.bg-purple_light[sin salirte del entorno]** de programaci√≥n en el que est√°s trabajando

--

* Podr√°s analizar los datos, resumirlos y a la vez **.bg-purple_light[comunicarlos]**. 

--

* Permite **.bg-purple_light[integrar f√°cilmente c√≥digo]** `R`, de forma que no solo podremos integrar las salidas de nuestro trabajo sino tambi√©n el c√≥digo con el que lo hemos generado.

---

# ¬øQu√© es .orange[RMARKDOWN]? 


Una herramienta que nos permite crear de forma sencilla **documentos combinando**:

--

* **.bg-purple_light[Markdown]**: creado en 2004 por John Gruber, y de uso libre, es un ¬´lenguaje¬ª que nos permite crear contenido de una manera sencilla de escribir, y que en todo momento mantenga un dise√±o legible, con algunas de las ventajas de un HTML (si acostumbras a escribir en wordpress o blogs, seguramente hayas escrito de esta forma).

--

* **.bg-green_light[Matem√°ticas (latex)]**: herramienta (lenguaje en realidad) para escribir notaci√≥n matem√°tica como `\(x^2\)` o `\(\sqrt{2}\)` (si escribes notaci√≥n similar en editores de texto, seguramente sin saberlo est√©s usando ya latex).

--

* **.bg-purple_light[C√≥digo]** y salidas de `R`: podremos no solo mostrar el paso final sino el c√≥digo que has ido realizando, con **cajitas de c√≥digo** como las del manual.

--

* **.bg-green_light[Im√°genes y tablas]**.

--

* **.bg-purple_light[Estilos]** (css, js, etc).

---

# Creando nuestro .orange[PRIMER INFORME] 

.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/file_rmarkdown.jpg" alt="Creando el primer fichero .rmd" width="80%" /&gt;
&lt;p class="caption"&gt;Creando el primer fichero .rmd&lt;/p&gt;
&lt;/div&gt;


]

.pull-right[

Vamos a crear el **.bg-purple_light[primer fichero]** con extensi√≥n `.Rmd` (la extensi√≥n de los archivos R Markdown).

&amp;nbsp;

Haz click en el bot√≥n `File &lt;&lt; New File &lt;&lt; R Markdown`.

]

---

# Creando nuestro .orange[PRIMER INFORME] 

.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/new_rmd.jpg" alt="Creando el primer fichero .rmd" width="80%" /&gt;
&lt;p class="caption"&gt;Creando el primer fichero .rmd&lt;/p&gt;
&lt;/div&gt;


]

.pull-right[

Tras hacerlo, nos aparecer√°n **.bg-purple_light[varias opciones]**de formatos de salida:

* archivo `.pdf`

* archivo `.html` (**.bg-purple_light[recomendable]**): documento din√°mico, permite la interacci√≥n con el usuario, como una ¬´p√°gina web¬ª)

* archivo `.doc` (nada recomendable)

De momento dejaremos marcado el **.bg-purple_light[formato HTML que viene por defecto]**, y escribiremos el t√≠tulo de nuestro documento. Tras ello tendremos nuestro archivo `.Rmd` (ya no es un script `.R` como los que hemos abierto hasta ahora)

]

---


# Creando nuestro .orange[PRIMER INFORME] 

Un fichero `.Rmd` se divide b√°sicamente en **.bg-purple_light[tres partes]**

1. **.bg-purple_light[Cabecera]**: la parte que tienes al inicio entre `---`.

2.  **.bg-purple_light[Texto]**: que podremos formatear y mejorar con **negritas** (escrito como `**negritas**`, con doble ast√©risco al inicio y final), _cursivas_ (`_cursivas_`, con barra baja al inicio y final) o destacar nombres de funciones o variables de `R` (con ``R`). Recuerda que puedes a√±adir adem√°s ecuaciones como `\(x^2\)` (he escrito `$x^2$`, la ecuaci√≥n entre d√≥lares).

3. **.bg-purple_light[C√≥digo R]**.

---

# .orange[PRIMER INFORME]: .green[CABECERA]


La cabecera est√°n en formato `YAML`, y contiene los **.bg-purple_light[metadatos del documento]**: t√≠tulo, autor, fecha, estilos (si los tuvi√©semos), etc. Para probar, vamos a cambiar la cabecera que nos ha generado por defecto de la siguiente forma:


```r
---
title: "Probando Probando"
author: "Se√±or/a X"
date: "11/7/2014"
output: html_document
---
```

Tras tunear nuestra cabecera borraremos todo lo que viene despu√©s para **.bg-purple_light[empezar desde cero]**.

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/rmd_vacio.jpg" alt="Fichero .Rmd vac√≠o, solo con la cabecera" width="27%" /&gt;
&lt;p class="caption"&gt;Fichero .Rmd vac√≠o, solo con la cabecera&lt;/p&gt;
&lt;/div&gt;

---

# .orange[PRIMER INFORME]: .green[TEXTO]

Solo hay una cosa **.bg-purple_light[importante]** a tener en cuenta en este entorno: salvo que indiquemos lo contrario, **.bg-purple_light[TODO lo que vamos a escribir en el documento es texto]**. No c√≥digo R. Texto plano que podremos mejorar un poco con algun detalle, pero texto.

Vamos a empezar nuestro documento escribiendo por ejemplo la siguiente frase



```r
Este material ha sido dise√±ado por el profesor Javier √Ålvarez Li√©bana,
docente en la Universidad Complutense de Madrid
```

---

# .orange[PRIMER INFORME]: .green[TEXTO]


.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/html_con_texto.jpg" alt="Primer informe html" width="99%" /&gt;
&lt;p class="caption"&gt;Primer informe html&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

Una vez que hemos escrito el texto vamos a **.bg-purple_light[guardar el archivo .Rmd]** haciendo click en el bot√≥n `Guardar` (yo he llamado al archivo `primer_rmarkdown.Rmd`). Tras guardar el documento, **.bg-purple_light[¬´tejeremos¬ª nuestro documento]** haciendo click en el bot√≥n `Knit`.

Al ¬´tejer¬ª se nos habr√° generado (seguramente en una ventana al margen) un archivo .html, que podemos incluso **.bg-purple_light[abrir en nuestro navegador]**. Hemos creado nuestro primer informe, obviamente vac√≠o de momento. 


]



---

# .orange[PRIMER INFORME]: .green[TEXTO]


.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/rmd_con_formato.jpg" alt="Tuneando nuestro primer informe html" width="99%" /&gt;
&lt;p class="caption"&gt;Tuneando nuestro primer informe html&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

Vamos a **.bg-purple_light[mejorar]** un poco el texto haciendo lo siguiente:

* Vamos a a√±adir **.bg-purple_light[negrita]** al nombre (poniendo `**` al inicio y al final).

* Vamos a√±adir _cursiva_ a la palabra `material` (poniendo `_` al inicio y al final).

*  Vamos a√±adir un enlace `https://www.ucm.es`, asoci√°ndolo al nombre de la Universidad. Para ello el t√≠tulo lo ponemos entre corchetes y justo detr√°s el enlace entre par√©ntesis `[¬´Universidad Complutense de Madrid¬ª](https://www.ucm.es)`

]

---


# .orange[PRIMER INFORME]: .green[CHUNKS] de R

Para a√±adir **.bg-purple_light[c√≥digo R]** debemos crear nuestras **.bg-purple_light[cajas de c√≥digo]** llamadas **.bg-orange[chunks]**: altos en el camino en nuestro texto markdown donde podremos incluir **c√≥digo**. Para incluir uno deber√° de ir encabezado de la siguiente forma.

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/chunk_1.jpg" alt="Encabezado/final del chunk" width="90%" /&gt;
&lt;p class="caption"&gt;Encabezado/final del chunk&lt;/p&gt;
&lt;/div&gt;

---

# .orange[PRIMER INFORME]: .green[CHUNKS] de R


Dentro de dicha **.bg-purple_light[cajita]** (que tiene ahora **otro color** en el documento) escribiremos **.bg-purple_light[c√≥digo R]**, como lo ven√≠amos haciendo hasta ahora. Vamos por ejemplo a **.bg-purple_light[definir dos variables]** y su suma de la siguiente manera, escribiendo dicho c√≥digo en nuestro `.Rmd` (dentro de ese chunk)

.pull-left[


```r
# C√≥digo R
x &lt;- 1
y &lt;- 2
x + y
```

```
&gt; [1] 3
```

]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/rmd_3.jpg" alt="Primer chunk con c√≥digo" width="99%" /&gt;
&lt;p class="caption"&gt;Primer chunk con c√≥digo&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[PRIMER INFORME]: .green[CHUNKS] de R

.pull-left[


```r
# C√≥digo R
x &lt;- 1
y &lt;- 2
x + y
```

```
&gt; [1] 3
```

]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/rmd_3.jpg" alt="Primer chunk con c√≥digo" width="70%" /&gt;
&lt;p class="caption"&gt;Primer chunk con c√≥digo&lt;/p&gt;
&lt;/div&gt;

]

Como ves dentro de esos _chunks_ puedes **.bg-purple_light[comentar c√≥digo]** con `#` (ahora veremos que hace `#` fuera de esas cajas de c√≥digo). Tras hacerlo tejemos de nuevo y obtenemos ahora un documento que tiene una caja de c√≥digo y su salida.

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/html_rmd_3.jpg" alt="Salida del html con el primer chunk" width="40%" /&gt;
&lt;p class="caption"&gt;Salida del html con el primer chunk&lt;/p&gt;
&lt;/div&gt;



---

# .orange[PRIMER INFORME]: .green[CHUNKS] de R


Somos capaces de **.bg-purple_light[escribir en un mismo documento texto]** con cierto formato, **.bg-purple_light[c√≥digo R y la salida]** del resultado, permiti√©ndonos generar informes (ya veremos como incluir gr√°ficas). De hecho, lo m√°s pr√°ctico para **.bg-purple_light[tomar apuntes de R]** es ir anotando en un archivo `.Rmd`.

Los chunks pueden tener un **.bg-purple_light[nombre o etiqueta]**, de forma que podamos referenciarlos de nuevo para no repetir c√≥digo.

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/chunk_repe_tag.jpg" alt="Etiquetando un chunk y recicl√°ndolo" width="40%" /&gt;
&lt;p class="caption"&gt;Etiquetando un chunk y recicl√°ndolo&lt;/p&gt;
&lt;/div&gt;



---

# .orange[PRIMER INFORME]: .green[ORGANIZANDO]

Con todo incluido en el documento podemos **.bg-purple_light[dividirlo en secciones y subsecciones]**. Para ello usaremos la sintaxis de markdown, poniendo **.bg-purple_light[almohadillas]**: una `#` para secciones, `##` para subsecciones, `###` para subsubsecciones, etc. Por ejemplo, vamos a

* Hacer una secci√≥n principal que sea `# Primer informe`
* Tras ello a√±adiremos la parte de texto.
* Creamos una subsecci√≥n que se titule `## Chunks de c√≥digo` donde incluiremos los dos chunks que tenemos hasta ahora.


.pull-left[

&lt;div class="figure" style="text-align: right"&gt;
&lt;img src="./img/secciones_rmd.jpg" alt="Secciones en el rmd" width="80%" /&gt;
&lt;p class="caption"&gt;Secciones en el rmd&lt;/p&gt;
&lt;/div&gt;


]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/secciones_html.jpg" alt="Secciones en el html" width="80%" /&gt;
&lt;p class="caption"&gt;Secciones en el html&lt;/p&gt;
&lt;/div&gt;


]

---


# .orange[PRIMER INFORME]: .green[ORGANIZANDO]

Adem√°s podemos incluir tras el t√≠tulo (y entre llaves `{}`) **.bg-purple_light[etiquetas]** (con `{#etiqueta}`) para luego **.bg-purple_light[referenciar dichas secciones]** en el documento.

.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/ref_rmd.jpg" alt="Referencias a secciones y subsecciones" width="75%" /&gt;
&lt;p class="caption"&gt;Referencias a secciones y subsecciones&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

Tambi√©n podemos organizar nuestro c√≥digo **.bg-purple_light[creando listas]**, usando `*` como √≠tems.

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/items_rmd.jpg" alt="Creando listas con √≠tems" width="85%" /&gt;
&lt;p class="caption"&gt;Creando listas con √≠tems&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[PRIMER INFORME]: .green[PERSONALIZAR]

En cada chunk aparece una **.bg-purple_light[bot√≥n de play]**: puls√°ndolo podemos tener la **ejecuci√≥n y salida** de cada chunk en nuestro `.Rmd`, sin tener que esperar a ¬´tejer¬ª (con Knit) todo el documento para ver lo que vamos ejecutando.


.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/play_chunk.jpg" alt="Pulsando al bot√≥n play" width="99%" /&gt;
&lt;p class="caption"&gt;Pulsando al bot√≥n play&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/chunk_ejecutado.jpg" alt="Chunk ejecutado in-line" width="99%" /&gt;
&lt;p class="caption"&gt;Chunk ejecutado in-line&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[PRIMER INFORME]: .green[PERSONALIZAR]


Adem√°s podemos **.bg-purple_light[incluir c√≥digo R dentro de la l√≠nea de texto]** (en lugar de mostrar el texto x ejecuta el c√≥digo R mostrando la variable).



.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/codigo_inline_rmd.jpg" alt="C√≥digo R inline" width="99%" /&gt;
&lt;p class="caption"&gt;C√≥digo R inline&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/codigo_inline_html.jpg" alt="Salida del c√≥digo in-line" width="99%" /&gt;
&lt;p class="caption"&gt;Salida del c√≥digo in-line&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[PRIMER INFORME]: .green[PERSONALIZAR]


Los chunk podemos **.bg-purple_light[personalizar su salida]** con algunas opciones, pas√°ndolos como argumentos dentro de las llaves ({r etiqueta, ...}).

* `include = FALSE`: **.bg-green_light[ejecuta c√≥digo]** pero **.bg-red_light[no se muestra (ni resultados)]** en la salida.

* `echo = FALSE`: **.bg-green_light[ejecuta c√≥digo]** y se **.bg-green_light[muestra resultado]** pero **.bg-red_light[no el c√≥digo]** en la salida.

* `eval = FALSE`: se **.bg-green_light[muestra el c√≥digo]** pero **.bg-red_light[no se ejecuta]** en la salida final.

* `message = FALSE`: se **.bg-green_light[ejecuta el c√≥digo]** pero **.bg-red_light[no se muestran mensajes]** de salida que tendr√≠amos en consola.

* `warning = FALSE`: **.bg-green_light[ejecuta c√≥digo]** pero **.bg-red_light[no se muestran warning]**.

* `error = TRUE`: se **.bg-green_light[ejecuta el c√≥digo]** pero permite ejecutar el c√≥digo **.bg-green_light[con errores]** mostrando los mensajes de error.
 
--

Estas opciones podemos aplicarlas chunk a chunk o fijar los par√°metros de forma global con `knitr::opts_chunk$set()` (dentro de un chunk), pas√°ndole como argumentos dichas opciones (por ejemplo, `knitr::opts_chunk$set(echo = FALSE)`).

---

# .orange[PRIMER INFORME]: .green[VARIABLES/ECUACIONES]

Por √∫ltimo en este primer documento vamos a a√±adir una subsecci√≥n `## Variables y ecuaciones` donde a√±adiremos un chunk asignando la suma `x + y` a una variable `z`, escribiendo antes en texto el nombre de la variable y la **.bg-purple_light[f√≥rmula]** ($z = x + y$ entre d√≥lares).


.pull-left[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/variables_rmd.jpg" alt="A√±adiendo variables en el .rmd" width="90%" /&gt;
&lt;p class="caption"&gt;A√±adiendo variables en el .rmd&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="./img/variables_html.jpg" alt="A√±adiendo variables en el .rmd" width="110%" /&gt;
&lt;p class="caption"&gt;A√±adiendo variables en el .rmd&lt;/p&gt;
&lt;/div&gt;

]


---

class: inverse center middle
name: clase-5

# CLASE 5: ESTRUCTURAS DE CONTROL.

&amp;nbsp;

### [Estructuras condicionales: if-else](#estructuras-condicionales)

### [Bucles: for, while](#bucles)

### [Replicate. Sample](#replicate)

### [Ejercicios](#ejercicios-5)


---

name: estructuras-condicionales

# Estructuras de control: .orange[IF-ELSE]


Una **.bg-purple_light[expresi√≥n de control]** ser√° un conjunto de √≥rdenes que nos permiten **.bg-purple_light[decidir el camino]** por el que queremos que avance nuestro c√≥digo:

* ¬øQu√© hacemos si sucede A?

* ¬øY si sucede B?

* ¬øTengo que programar X veces lo mismo si quiere que se repita?

&amp;nbsp;

Si has programado en alg√∫n otro lenguaje, estar√°s familiarizado/a con **.bg-purple_light[estructuras condicionales]** como un `if (blabla) {...} else {...}` (que los usaremos a veces) o **.bg-purple_light[bucles]** `for/while` (que intentaremos evitarlos lo m√°ximo posible).

---

# Estructuras de control: .orange[IF]

Una de las estructuras de control m√°s famosas de cualquier lenguaje de programaci√≥n es la **.bg-purple_light[estructura condicional]** `if`

&gt; SI las condiciones impuestas se cumplen (TRUE), ejecuta las √≥rdenes que tengamos dentro de la misma.

Por ejemplo, la estructura `if (x == 1) { c√≥digo A }` lo que har√° ser√° **.bg-purple_light[ejecutar el c√≥digo entre llaves]** pero **.bg-orange[SI Y SOLO SI]** la **.bg-purple_light[condici√≥n es cierta]** (en este caso, solo si `x` es igual 1). En **caso contrario, no hace nada**.

--

Definamos por ejemplo una variable sencilla, las edades de 8 personas y comprobemos cuales son menores de edad.


```r
edades &lt;- c(14, 17, 24, 56, 31, 20, 87, 73)
edades &lt; 18
```

```
&gt; [1]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
```

---

# Estructuras de control: .orange[IF]


Recuerda que con las funciones `any()` y `all()` podemos saber si **.bg-purple_light[todos o alguno de los elementos]** de un vector cumplen una condici√≥n.


```r
any(edades &lt; 18) # existe algun menor de edad
```

```
&gt; [1] TRUE
```

--

Con dichos elementos vamos a construir nuestra primera estructura condicional: queremos que, **.bg-purple_light[SI existe alg√∫n menor de edad, nos imprima un mensaje]**.


```r
if (any(edades &lt; 18)) { 
  
  print("existe alguna persona mayor de edad")
  
}
```

```
&gt; [1] "existe alguna persona mayor de edad"
```

---

# Estructuras de control: .orange[IF]


```r
if (any(edades &lt; 18)) { 
  
  print("existe alguna persona mayor de edad")
  
}
```


En caso de que **.bg-purple_light[no se cumplan las condiciones]** dentro del `if()` (FALSE), no suceder√° nada. 



```r
if (all(edades &gt;= 18)) { 
  
  print("todas las personas son mayores de edad")
  
}
```

F√≠jate que en este caso **no hemos obtenido ning√∫n mensaje** porque la condici√≥n `all(edades &gt;= 18)` no es cierta (no son todos mayores de 18 a√±os), as√≠ que **no ha ejecutado el c√≥digo**.

---

# Estructuras de control: .orange[IF-ELSE]

La estructura `if (condicion) { }` puede ser combinada con un `else { }`: cuando la **.bg-purple_light[condici√≥n no se cumpla]** (como en el √∫ltimo ejemplo), se **.bg-purple_light[ejecutar√° el c√≥digo alternativo]** que haya dentro del `else { }`, permiti√©ndonos decidir que sucede cuando S√ç se cumple y cuando NO se cumple.

--

Por ejemplo, la estructura `if (x == 1) { c√≥digo A } else { c√≥digo B }` ejecutar√° A si `x` es 1 y B en cualquier otro caso.


```r
if (all(edades &gt;= 18)) { 
  
  print("todas las personas son mayores de edad")
  
*} else {
  
  print("existe alguna persona menor de edad")
}
```

```
&gt; [1] "existe alguna persona menor de edad"
```

---

# Estructuras de control: .orange[IF-ELSE]

Dicha estructura `if - else` puede **.bg-purple_light[anidarse]**: imagina que queremos realizar una acci√≥n si todos fuesen mayores de edad; en caso contrario, pero si todos los menores tienen 16 a√±os o m√°s, realizar otra acci√≥n; en caso contrario, otra acci√≥n


```r
if (all(edades &gt;= 18)) { 
  
  print("todas las personas son mayores de edad")
  
} else if (all(edades &gt;= 16)) {
  
  print("Existe alguna persona menor de edad pero todos con 16 a√±os o m√°s")
  
} else { print("Existe alguna persona menor de 16 a√±os") }
```

```
&gt; [1] "Existe alguna persona menor de 16 a√±os"
```

**.bg-green_light[CONSEJO]**: puedes **colapsar las estructuras de control** pulsando en la flecha que aparece a la izquierda de ellas en tu script.


---

# Estructuras de control: .orange[IFELSE()]


Esta estructura condicional puede ser **.bg-purple_light[vectorizada]**: reunir en una sola fila un n√∫mero elevado de estructuras de comparaci√≥n con la funci√≥n `ifelse()`, cuyos argumentos de entrada ser√°n

* la condici√≥n a evaluar
* lo que sucede cuando se cumple
* lo que sucede cuando no se cumple

Con el ejemplo de las edades, vamos a dejar el dato ausente si son menores de edad, y si son mayores de edad se queda como est√°.


```r
# NA si no cumple la condici√≥n, la edad si se cumple.
*ifelse(edades &gt;= 18, edades, NA)
```

```
&gt; [1] NA NA 24 56 31 20 87 73
```

---

# Estructuras de control: .orange[IFELSE()]


Todas estas estructuras **.bg-purple_light[no solo sirven para datos num√©ricos]**. Vamos a definir un vector de nombres con algunos ausentes, y vamos a sustituir los ausentes por el texto `"nombre_desconocido"` (los que no sean ausentes, es decir los que `is.na()` devuelva FALSE, se quedan como est√°n).


```r
nombres &lt;- c("Juan", "Mar√≠a", NA, NA, "Luc√≠a",
             "Carmen", "Javier", NA, "Carlos", 
             NA, "Gregorio", "Paloma")

# Si tiene ausente --&gt; "nombre_desconocido"
# Si no tiene ausente --&gt; nombres originales
nombres &lt;-
  ifelse(is.na(nombres), "nombre_desconocido", nombres)
nombres
```

```
&gt;  [1] "Juan"               "Mar√≠a"              "nombre_desconocido"
&gt;  [4] "nombre_desconocido" "Luc√≠a"              "Carmen"            
&gt;  [7] "Javier"             "nombre_desconocido" "Carlos"            
&gt; [10] "nombre_desconocido" "Gregorio"           "Paloma"
```

---

name: bucles

# Estructuras de control: .orange[BUCLES]

Aunque la mayor√≠a de veces son sustituibles por otras expresiones m√°s legibles y eficientes, es importante que conozcamos otra archiconocida expresion de control: **.bg-purple_light[los bucles]**.

* `for { }`: permite **.bg-purple_light[repetir el mismo c√≥digo]** un **.bg-orange[n√∫mero fijo y conocido]** de veces (normalmente en funci√≥n de un √≠ndice).

* `while { }`: permite **.bg-purple_light[repetir el mismo c√≥digo]** un **.bg-orange[n√∫mero indeterminado de veces]**, hasta que una **condici√≥n** dada se deje de cumplir.

---

# Estructuras de control: .orange[BUCLES FOR]

Un **.bg-purple_light[bucle for]** es una estructura que nos permite **.bg-purple_light[repetir]** un conjunto de √≥rdenes un **.bg-orange[n√∫mero finito y conocido]** de veces: dado un **conjunto de √≠ndices**, el bucle ir√° recorriendo cada uno de ellos.

Vamos a definir un vector `x`. Si quisi√©ramos el primer elemento al cuadrado escribir√≠amos `x[1]^2`; si quisi√©ramos el segundo elemento al cuadrado `x[2]^2`; si lo quisi√©ramos hacer en general, para el elemento i-√©simo, `x[i]^2`. Lo que haremos dentro del `for (indices) { √≥rdenes }` es indicarle que valores ir√° tomando `i` (**.bg-purple_light[vector de √≠ndices]**).


```r
x &lt;- c(0, -7, 1, 4)
*for (i in 1:4) {
  
  print(x[i]^2) # √≥rdenes
  
}
```

```
&gt; [1] 0
&gt; [1] 49
&gt; [1] 1
&gt; [1] 16
```

---

# Estructuras de control: .orange[BUCLES FOR]


```r
*for (i in 1:4) {
  print(x[i]^2) # √≥rdenes
}
```

Lo que tenemos dentro de los par√©ntesis `for ()` no es m√°s que la **.bg-purple_light[secuencia de n√∫meros]** que hemos aprendido a construir. Si quisi√©ramos que haga lo mismo pero excluyendo por ejemplo el segundo elemento bastar√≠a con definir los √≠ndices a recorrer como `c(1, 3, 4)`.


```r
for (i in c(1, 3, 4)) {
  
  print(x[i]^2) # que lo imprima
  
}
```

```
&gt; [1] 0
&gt; [1] 1
&gt; [1] 16
```

---

# Estructuras de control: .orange[BUCLES FOR]

Podemos definir tambi√©n una variable `y &lt;- rep(0, 4)` (un **vector ¬´vac√≠o¬ª** lleno de ceros), y hacer que el **.bg-purple_light[elemento i-√©simo del vector]** se defina como `x[i]^2`


```r
y &lt;- rep(0, 4)
for (i in 1:4) {
  
  y[i] &lt;- x[i]^2
  
}
y
```

```
&gt; [1]  0 49  1 16
```

--

Lo anterior es equivalente a esto


```r
y &lt;- x^2
y
```

```
&gt; [1]  0 49  1 16
```

---

# .orange[BUCLES] suelen ser .red[INEFICIENTES]


Haciendo uso del paquete `microbenchmark` podemos comprobar como los **.bg-purple_light[bucles son menos eficientes]** (de ah√≠ que la mayor√≠a de veces los intentemos evitar si existe otra alternativa)


```r
library(microbenchmark)
x &lt;- 1:100
microbenchmark(x^2, 
               for (i in 1:100) { y[i] &lt;- x[i]^2 },
               times = 1000)
```

```
&gt; Unit: nanoseconds
&gt;                                     expr     min      lq       mean    median
&gt;                                      x^2     396     559    1627.08    1145.5
&gt;  for (i in 1:100) {     y[i] &lt;- x[i]^2 } 1868879 2222565 2835195.41 2525351.0
&gt;         uq      max neval cld
&gt;     2257.5    29838  1000  a 
&gt;  3104661.0 11961315  1000   b
```

---
 
# Estructuras de control: .orange[BUCLES FOR]


Veamos otro ejemplo **.bg-purple_light[combinando vectores num√©ricos y de caracteres]**: vamos a definir de nuevo un vector de edades y nombres, y vamos a recorrer cada uno imprimiento un mensaje por pantalla.


```r
nombres &lt;- c("Javi", "Laura", "Carlos", "Luc√≠a", "Mar")
edades &lt;- c(33, 51, 18, 43, 29)

# Recorremos cada uno de los 5 elementos e imprimimos un
# mensaje que depende de ese √≠ndice i
for (i in 1:5) { 
  
  print(glue("{nombres[i]} tiene {edades[i]} a√±os")) 
  
}
```

```
&gt; Javi tiene 33 a√±os
&gt; Laura tiene 51 a√±os
&gt; Carlos tiene 18 a√±os
&gt; Luc√≠a tiene 43 a√±os
&gt; Mar tiene 29 a√±os
```

---

# Estructuras de control: .orange[BUCLES FOR]

F√≠jate que **.bg-purple_light[si no nos queremos preocupar de si a√±adimos otra persona]**, podemos hacer que el bucle empiece en 1 y termine en el **.bg-purple_light[√∫ltimo lugar]** (sea el que sea), usando `length()`.


```r
for (i in 1:length(nombres)) { 
  
  print(glue("{nombres[i]} tiene {edades[i]} a√±os")) 
  
}
```

```
&gt; Javi tiene 33 a√±os
&gt; Laura tiene 51 a√±os
&gt; Carlos tiene 18 a√±os
&gt; Luc√≠a tiene 43 a√±os
&gt; Mar tiene 29 a√±os
```

---

# Estructuras de control: .orange[BUCLES FOR]

Aunque normalmente el conjunto que recorre el bucle suelen ser √≠ndices num√©ricos, podemos **.bg-purple_light[recorrer cualquier tipo de objeto]**, por ejemplo d√≠as e la semana


```r
library(stringr)
dias_semana &lt;- c("lunes", "martes", "mi√©rcoles", "jueves",
                 "viernes", "s√°bado", "domingo")

for (dias in dias_semana) { # dias recorre los d√≠as de la semana
  
  print(str_to_upper(dias)) # Imprimimos en may√∫sculas el d√≠a
}
```

```
&gt; [1] "LUNES"
&gt; [1] "MARTES"
&gt; [1] "MI√âRCOLES"
&gt; [1] "JUEVES"
&gt; [1] "VIERNES"
&gt; [1] "S√ÅBADO"
&gt; [1] "DOMINGO"
```

---

# Estructuras de control: .orange[BUCLES FOR]

Un √∫ltimo ejemplo: vamos a recorrer nuestro conjunto de datos `swiss` del paquete `{datasets}` y vamos a **pasar a dato ausente** todos los valores de fertilidad superiores a 80. Para ello recorreremos cada fila para despu√©s ejecutar un `if`.


```r
for (i in 1:nrow(swiss)) {
  
  # si cumple la condici√≥n dicha fila, ponemos ausente.
  if (swiss$Fertility[i] &gt; 80) { 
    
    swiss$Fertility[i] &lt;- NA
    
  }
}
```

--

Esto ser√≠a exactamente equivalente al `ifelse()` vectorizado que vimos en el tema anterior


```r
data("swiss") # lo cargamos de 0
swiss$Fertility &lt;- ifelse(swiss$Fertility &gt; 80, NA, swiss$Fertility)
```


---

# Estructuras de control: .orange[BUCLES WHILE]

Otra manera de dise√±ar un bucle es con la estructura `while { }`, que ejecutar√° el bucle un **.bg-purple_light[n√∫mero de veces a priori  desconocido]**, lo har√° hasta que la **.bg-purple_light[condici√≥n impuesta deje de ser cierta]**. Por ejemplo, vamos a inicializar una variable `ciclos &lt;- 1`, y en cada paso aumentaremos una unidad, y no saldremos del bucle hasta que `ciclos &gt; 4`


```r
ciclos &lt;- 1

# Mientras el n√∫mero de ciclos sea inferior 4, imprime
while(ciclos &lt;= 4) {
  
  print(paste("Todav√≠a no, vamos por el ciclo ", ciclos)) # Pegamos la frase al n√∫mero de ciclo por el que vayamos con paste
  ciclos &lt;- ciclos + 1
  
}
```

```
&gt; [1] "Todav√≠a no, vamos por el ciclo  1"
&gt; [1] "Todav√≠a no, vamos por el ciclo  2"
&gt; [1] "Todav√≠a no, vamos por el ciclo  3"
&gt; [1] "Todav√≠a no, vamos por el ciclo  4"
```


---
  
# Estructuras de control: .orange[BUCLES WHILE]


¬øY qu√© sucede cuando la **.bg-purple_light[condici√≥n nunca llega a ser FALSE]**? Compru√©balo t√∫ mismo/a.


```r
while (1 &gt; 0) { # Nunca va a dejar de ser cierto
  
  print("Presiona ESC para salir del bucle")
  
}
```

&amp;nbsp;

**.bg-red_light[CUIDADO]**: un bucle `while { }` puede ser muy peligroso sino se controla bien que el bucle acaba en alg√∫n momento.

---

# Estructuras de control: .orange[BUCLES WHILE]

Tenemos dos comandos reservados para poder **.bg-purple_light[abortar un bucle o avanzar forzosamente]**:

* `break`: os habilita para **.bg-purple_light[parar un bucle]** aunque no haya llegado al final de su conjunto de √≠ndices a recorrer (o se siga cumpliendo la condici√≥n).


```r
for(i in 1:10) {
  if (i == 3) {
    
    break # si i es 3, el bucle frena aqu√≠
    
  }
  print(i)
}
```

```
&gt; [1] 1
&gt; [1] 2
```

---

# Estructuras de control: .orange[BUCLES WHILE]

Tenemos dos comandos reservados para poder **.bg-purple_light[abortar un bucle o avanzar forzosamente]**:

* `next`: **.bg-purple_light[obliga al bucle a avanzar]** a la siguiente iteracci√≥n, abortando la iteraci√≥n actual en la que se encuentra. 


```r
for(i in 1:5) {
  if (i == 3) {
    
    next # si i es 3, pasar√° a la siguiente
    
  }
  print(i)
}
```

```
&gt; [1] 1
&gt; [1] 2
&gt; [1] 4
&gt; [1] 5
```

---

# Estructuras de control: .orange[BUCLES REPEAT]

Aunque es una opci√≥n muy poco usada, existe una estructura de control llamada `repeat { }` que nos ejecuta un **.bg-purple_light[bucle de forma infinita hasta que le ordenemos parar]** con un break.


```r
conteo &lt;- 0
repeat { 
  
  conteo &lt;- conteo + 1
  if (conteo &gt;= 100) { break }
  
}
conteo
```

```
&gt; [1] 100
```


---


name: replicate

# Replicando c√≥digo: .orange[REPLICATE]

Otra forma de **.bg-purple_light[repetir o replicar]** c√≥digo, al margen de las estructuras de bucle ya vistas, es haciendo uso de `replicate()`, que de momento no lo haremos depender de un √≠ndice: simplemente **.bg-purple_light[repetira n veces]** el mismo c√≥digo.


```r
x &lt;- 1:3
replicate(n = 3, x^2)
```

```
&gt;      [,1] [,2] [,3]
&gt; [1,]    1    1    1
&gt; [2,]    4    4    4
&gt; [3,]    9    9    9
```
          
---

# Simulando muestras: .orange[SAMPLE]

Es habitual que `replicate()` se use conjuntamente con la funci√≥n `sample()` que nos permitir√° **.bg-purple_light[generar muestras aleatorias]** indicando cu√°l es la **.bg-purple_light[funci√≥n de probabilidad]** asociada] (generar **¬´tiradas de dados¬ª** indicando cu√°l es la **probabilidad** de cada cara).

* `x`: **.bg-purple_light[soporte]** (valores permitidos, caras del dado).
* `size`: **.bg-purple_light[tama√±o]** (n√∫mero de tiradas)
* `replace`: **.bg-purple_light[¬øcon reemplazamiento?]** (¬øpuede salir un elemento que ya ha salido?)
* `prob`: **.bg-purple_light[vector de probabilidades]** (probabilidad de cada cara)

--

Por ejempo, vamos a simular **.bg-purple_light[2 tiradas de una moneda]**, indicando el soporte (0 y 1, cara y cruz), y `size = 2`


```r
sample(x = 0:1, size = 2)
```

```
&gt; [1] 1 0
```

**.bg-red_light[IMPORTANTE]**: si no indicamos nada en el vector de probabilidades `prob`, asume que son equiprobables (en este caso, `\(1/2\)` para cada cara).


---

# Simulando muestras: .orange[SAMPLE]

F√≠jate que tampoco le hemos indicado nada en `replace`, ya que por defecto toma el valor `FALSE`. ¬øQu√© sucede si hubi√©semos querido generar 10 tiradas de una moneda?


```r
sample(x = 0:1, size = 10)
```

```
&gt; Error in sample.int(length(x), size, replace, prob): cannot take a sample larger than the population when 'replace = FALSE'
```

--

&amp;nbsp;

Dado que solo tenemos 2 posibles valores a elegir, y le hemos pedido 10 tiradas, al llegar a la segunda **.bg-purple_light[no tiene opciones de seguir eligiendo]**. Para poder generarlas deberemos asignar `replace = TRUE` (ahora podr√°n repetirse las caras).



```r
# 30 tiradas
sample(x = 0:1, size = 30, replace = TRUE)
```

```
&gt;  [1] 0 1 0 0 1 0 1 0 0 1 0 1 0 0 0 0 0 0 1 0 0 0 0 0 1 1 1 0 0 0
```

---

# Simulando muestras: .orange[SAMPLE]

El soporte no solo tiene porqu√© ser num√©rico, sino que podr√≠amos definir un **.bg-purple_light[soporte de valores de texto]**, de forma que asignemos en los posibles valores directamente `"cara"` y `"cruz"`


```r
sample(x = c("cara", "cruz"), size = 10, replace = TRUE)
```

```
&gt;  [1] "cara" "cruz" "cara" "cara" "cara" "cruz" "cara" "cruz" "cruz" "cruz"
```

--

El comando `sample()` nos genera **.bg-purple_light[valores (pseudo) aleatorios]**, por lo que si volvemos a ejecutar la misma √≥rden tendremos (seguramente) **.bg-red_light[valores diferentes]**.


```r
sample(x = c("cara", "cruz"), size = 10, replace = TRUE)
```

```
&gt;  [1] "cruz" "cruz" "cruz" "cara" "cruz" "cruz" "cara" "cara" "cara" "cruz"
```

---

# Simulando muestras: .orange[SAMPLE]

Si quisi√©ramos generar resultados que no dependiesen de la aleatoriedad de una muestra simulada (por ejemplo, para ver si un m√©todo es mejor que otro), tenemos la opci√≥n de **.bg-purple_light[fijar semilla]** (valor inicial usado para generar el mecanismo de pseudoaleatoriedad).


```r
set.seed(1234567)
sample(x = c("cara", "cruz"), size = 10, replace = TRUE)
```

```
&gt;  [1] "cara" "cruz" "cruz" "cara" "cruz" "cara" "cara" "cara" "cruz" "cruz"
```



```r
set.seed(1234567)
sample(x = c("cara", "cruz"), size = 10, replace = TRUE)
```

```
&gt;  [1] "cara" "cruz" "cruz" "cara" "cruz" "cara" "cara" "cara" "cruz" "cruz"
```


```r
set.seed(1234567)
sample(x = c("cara", "cruz"), size = 10, replace = TRUE)
```

```
&gt;  [1] "cara" "cruz" "cruz" "cara" "cruz" "cara" "cara" "cara" "cruz" "cruz"
```

---


# Simulando muestras: .orange[SAMPLE]


De esta manera podemos **.bg-purple_light[simular una gran cantidad de datos]** y ver c√≥mo evoluciona por ejemplo la media muestral.

&gt; ¬øC√≥mo hacer uso de un bucle para generar 1 tirada, 2 tiradas, 3 tiradas, ..., 25 tiradas (con `sample()`), y guardar la media de caras?

--


```r
tiradas &lt;- 1:25
media &lt;- rep(0, length(tiradas))

for (i in tiradas) {
  
  tirada &lt;- sample(x = c("cara", "cruz"), size = i, replace = TRUE)
  media[i] &lt;- sum(tirada == "cruz") / i

}
media
```

```
&gt;  [1] 0.0000000 0.5000000 0.3333333 0.7500000 0.6000000 0.8333333 0.1428571
&gt;  [8] 0.5000000 0.5555556 0.5000000 0.3636364 0.7500000 0.6153846 0.4285714
&gt; [15] 0.5333333 0.3750000 0.4705882 0.4444444 0.4210526 0.4500000 0.5238095
&gt; [22] 0.5000000 0.6086957 0.5833333 0.3600000
```

---


# Simulando muestras: .orange[SAMPLE]


Esto nos permite comprobar de primera mano algo muy importante a la hora de simular: nuestra muestra ser√° (seguramente) distinta pero seg√∫n  **.bg-purple_light[aumenta el tama√±o muestral]**, los **.bg-purple_light[par√°metros muestrales]** (media, por ejemplo) tender√°n a los **.bg-purple_light[par√°metros te√≥ricos o poblacionales]** (la media si aumentamos el tama√±o deber√≠a tender a `\(0.5\)`).



```r
tiradas &lt;- c(1, 5, 10, 15, 25, 50, 100, 500, 1000, 5000,
             10000, 25000, 50000, 100000, 200000, 500000)
media &lt;- rep(0, length(tiradas))

for (i in 1:length(tiradas)) {
  
  tirada &lt;- sample(x = c(0, 1), size = tiradas[i], 
                   replace = TRUE)
  media[i] &lt;- mean(tirada)

}
media
```

```
&gt;  [1] 1.000000 0.200000 0.600000 0.600000 0.440000 0.500000 0.560000 0.490000
&gt;  [9] 0.502000 0.496800 0.491800 0.499960 0.499400 0.499740 0.498540 0.498536
```


Lo anterior se debe al **.bg-purple_light[TEOREMA CENTRAL DEL L√çMITE]**

---

# Simulando muestras: .orange[SAMPLE]

Como has podido ver, aunque el par√°metro poblacional tienda al muestral, rara vez ser√° justo igual (dado que `\(n\)` nunca podr√° ser infinito en el ordenador). ¬øY si **.bg-purple_light[repetimos]** el experimento de `\(n\)` tiradas `\(m\)` veces? ¬øCu√°l ser√° la media de las medias obtenidas?

Para ello nos sirve `replicate()`. ¬øSe te ocurre c√≥mo, por ejemplo repitiendo `\(m = 1000\)` veces `\(n=10000\)` tiradas?


--


```r
tiradas &lt;- replicate(1000, sample(x = c(0, 1), size = 10000,
                                 replace = TRUE))
dim(tiradas)
```

```
&gt; [1] 10000  1000
```

```r
medias &lt;- apply(tiradas, MARGIN = 2, FUN = mean)
mean(medias)
```

```
&gt; [1] 0.500114
```


---

# Simulando muestras: .orange[SAMPLE]

¬øY si lo hici√©semos con la **.bg-purple_light[varianza]**? Sabemos que la varianza (te√≥rica) debe ser `\(\sigma^2  = 0.25\)` (varianza de una binomial de par√°metro `\(p\)` es igual a `\(p^2\)`)

.pull-left[


```r
tirada &lt;- sample(x = c(0, 1), size = 100, replace = TRUE)
mean(tirada^2) - mean(tirada)^2
```

```
&gt; [1] 0.2451
```

```r
tirada &lt;- sample(x = c(0, 1), size = 100, replace = TRUE)
mean(tirada^2) - mean(tirada)^2
```

```
&gt; [1] 0.2484
```

]

.pull-right[


```r
tirada &lt;- sample(x = c(0, 1), size = 100, replace = TRUE)
mean(tirada^2) - mean(tirada)^2
```

```
&gt; [1] 0.2475
```

```r
tirada &lt;- sample(x = c(0, 1), size = 100, replace = TRUE)
mean(tirada^2) - mean(tirada)^2
```

```
&gt; [1] 0.2496
```

]

Parece como si siempre se **quedase un poco por debajo**, de forma sistem√°tica (con un sesgo), de forma que la media tambi√©n quedar√° por debajo.

--

Un estimador (muestral) `\(T\)` de un par√°metro poblacional se dice **.bg-purple_light[ESTIMADOR INSESGADO]** si cumple que la media (esperanza) `\(E[T]\)` es igual a dicho par√°metro.


---

name: ejercicios-5

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: modifica el c√≥digo inferior para imprimir un mensaje por pantalla si todos los datos del conjunto `airquality` son de meses que no sean enero.


```r
# install.packages("dataset") # solo la primera vez
library(datasets) # paquete con los datos
mes &lt;- airquality$Month

if (mes == 2) {
  
  print("Ning√∫n dato es del mes de enero")
  
}
```

]

.panel[.panel-name[Soluci√≥n ej. 1]

* üìù **Ejercicio 1**: modifica el c√≥digo inferior para imprimir un mensaje por pantalla si todos los datos del conjunto `airquality` son de meses que no sean enero.


```r
# install.packages("dataset") # solo la primera vez
library(datasets) # paquete con los datos
mes &lt;- airquality$Month

if (all(mes != 1)) {
  
  print("Ning√∫n dato es del mes de enero")
  
}
```

```
&gt; [1] "Ning√∫n dato es del mes de enero"
```

]

]


---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 2**: modifica el c√≥digo inferior para guardar en una variable llamada `temperatura_alta` un valor `TRUE` si alguno de los registros tiene una temperatura mayor a 90 (est√°n en Farenheit) y un `FALSE` en caso contrario.
 

```r
temperatura &lt;- airquality$Temp

if (temperatura == 100) {
  
  print("Alguno de los registros tiene temperatura superior a 90 Farenheit")
  
}
```

]

.panel[.panel-name[Soluci√≥n ej. 2]

* üìù **Ejercicio 2**: modifica el c√≥digo inferior para guardar en una variable llamada `temperatura_alta` un valor `TRUE` si alguno de los registros tiene una temperatura mayor a 90 (est√°n en Farenheit) y un `FALSE` en caso contrario.
 

```r
# Opci√≥n 1
temperatura &lt;- airquality$Temp
temperatura_alta &lt;- FALSE
if (any(temperatura &gt; 90)) {
  
   temperatura_alta &lt;- TRUE
  
}

# Opci√≥n 2
temperatura_alta &lt;- any(airquality$Temp &gt; 90)
```


]

]

---


# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 3**: modifica el c√≥digo inferior para dise√±ar un bucle `for` de 5 iteraciones que recorra los 5 primeros impares y les sume uno.


```r
for (i in 1:5) {
  
  print(i)
}
```

* üìù **Ejercicio 4**: modifica el c√≥digo inferior para dise√±ar un bucle `while` que parta con una variable `conteo &lt;- 1` y pare cuando llegue a 6.


```r
conteo &lt;- 1
while (conteo == 2) {
  
  print(conteo)
}
```

]

.panel[.panel-name[Soluci√≥n ej. 3]

* üìù **Ejercicio 3**: modifica el c√≥digo inferior para dise√±ar un bucle `for` de 5 iteraciones que recorra los 5 primeros impares y les sume uno.


```r
for (i in c(1, 3, 5, 7, 9)) {
  
  print(i + 1)
}
```

```
&gt; [1] 2
&gt; [1] 4
&gt; [1] 6
&gt; [1] 8
&gt; [1] 10
```

]

.panel[.panel-name[Soluci√≥n ej. 4]

* üìù **Ejercicio 4**: modifica el c√≥digo inferior para dise√±ar un bucle `while` que parta con una variable `conteo &lt;- 1` y pare cuando llegue a 6.


```r
conteo &lt;- 1
while (conteo &lt; 6) {
  
  print(conteo)
  conteo &lt;- conteo + 1
  
}
```

```
&gt; [1] 1
&gt; [1] 2
&gt; [1] 3
&gt; [1] 4
&gt; [1] 5
```

]

]

---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 5**: dise√±a un bucle `for` de 200 iteraciones que, empezando en un valor inicial de 100 (euros), te sume 3‚Ç¨ (actualizando el valor) si el n√∫mero actual de la iteraci√≥n es par, y te reste 5‚Ç¨ si es impar (investiga la funci√≥n `%%`).

* üìù **Ejercicio 6**: dise√±a el anterior bucle pero guardando el dinero de cada iteraci√≥n en alguna variable
 

* üìù **Ejercicio 7**: dise√±a el bucle del ejercicio 5 pero parando cuando no nos quede dinero.

* üìù **Ejercicio 8**: haciendo uso de `sample()`, simula la tirada de 100 dados (cada uno de 6 caras), pero de forma que el dado est√© trucado, y calcula la media de las tiradas.

* üìù **Ejercicio 9**: repite el ejercicio anterior para 1,2,...,200 dados (haz uso de un `for()`), y guarda la media de las tiradas en cada caso.

]

.panel[.panel-name[Sol. ej. 5]

Un n√∫mero par ser√° todo aquel n√∫mero que al dividir entre 2, la divisi√≥n es exacta, es decir, que su resto es nulo. Para calcular ese resto usaremos la funci√≥n `%%`.



```r
# dinero inicial
dinero &lt;- 100

for (i in 1:200) {
  
  dinero &lt;- ifelse(i %% 2 == 0, dinero + 3, dinero  - 5)
  
}
dinero
```

```
&gt; [1] -100
```

]

.panel[.panel-name[Sol. ej. 6]


```r
# vector inicial de importes
dinero &lt;- rep(0, 201)
dinero[1] &lt;- 100 # dinero inicial

# Bucle for
for (i in 2:201) {
  
  # si i es par o  impar
  dinero[i] &lt;- ifelse(i %% 2 == 0, dinero[i - 1] + 3,
                      dinero[i - 1]  - 5)
  
}
dinero
```

```
&gt;   [1]  100  103   98  101   96   99   94   97   92   95   90   93   88   91   86
&gt;  [16]   89   84   87   82   85   80   83   78   81   76   79   74   77   72   75
&gt;  [31]   70   73   68   71   66   69   64   67   62   65   60   63   58   61   56
&gt;  [46]   59   54   57   52   55   50   53   48   51   46   49   44   47   42   45
&gt;  [61]   40   43   38   41   36   39   34   37   32   35   30   33   28   31   26
&gt;  [76]   29   24   27   22   25   20   23   18   21   16   19   14   17   12   15
&gt;  [91]   10   13    8   11    6    9    4    7    2    5    0    3   -2    1   -4
&gt; [106]   -1   -6   -3   -8   -5  -10   -7  -12   -9  -14  -11  -16  -13  -18  -15
&gt; [121]  -20  -17  -22  -19  -24  -21  -26  -23  -28  -25  -30  -27  -32  -29  -34
&gt; [136]  -31  -36  -33  -38  -35  -40  -37  -42  -39  -44  -41  -46  -43  -48  -45
&gt; [151]  -50  -47  -52  -49  -54  -51  -56  -53  -58  -55  -60  -57  -62  -59  -64
&gt; [166]  -61  -66  -63  -68  -65  -70  -67  -72  -69  -74  -71  -76  -73  -78  -75
&gt; [181]  -80  -77  -82  -79  -84  -81  -86  -83  -88  -85  -90  -87  -92  -89  -94
&gt; [196]  -91  -96  -93  -98  -95 -100
```

]

.panel[.panel-name[Sol. ej. 7]


```r
dinero &lt;- 100 # dinero inicial

# Bucle while
while (dinero &gt; 0) {
  
  dinero &lt;- ifelse(i %% 2 == 0, dinero + 3, dinero - 5)
  
}
dinero
```

```
&gt; [1] 0
```

]

.panel[.panel-name[Sol. ej. 8]


* üìù **Ejercicio 8**: haciendo uso de `sample()`, simula la tirada de 100 dados (cada uno de 6 caras), pero de forma que el dado est√© trucado (decide t√∫ c√≥mo), y calcula la media de las tiradas.


```r
# dado sin trucar
tiradas &lt;- sample(x = 1:6, size = 100, replace = TRUE)
mean(tiradas)
```

```
&gt; [1] 3.54
```

```r
# dado trucado (por ejemplo 1/2 la primera cara)
tiradas &lt;-
  sample(x = 1:6, size = 100, replace = TRUE,
         prob = c(1/2, 1/10, 1/10, 1/10, 1/10, 1/10))
mean(tiradas)
```

```
&gt; [1] 2.33
```

]

.panel[.panel-name[Sol. ej. 9]


* üìù **Ejercicio 9**: repite el ejercicio anterior para 1,2,...,200 dados (haz uso de un `for()`), y guarda la media de las tiradas en cada caso.


```r
medias &lt;- rep(0, 200)
for (i in 1:200) {
  
  medias[i] &lt;-
    mean(sample(x = 1:6, size = i, replace = TRUE))
}
medias
```

```
&gt;   [1] 3.000000 5.000000 4.000000 2.750000 2.800000 3.500000 4.428571 4.000000
&gt;   [9] 3.888889 3.600000 3.272727 3.416667 3.538462 3.785714 3.800000 2.875000
&gt;  [17] 3.117647 3.555556 3.684211 3.500000 3.095238 3.090909 2.652174 3.666667
&gt;  [25] 3.240000 3.807692 3.703704 3.107143 3.689655 3.266667 3.612903 3.593750
&gt;  [33] 3.575758 3.441176 3.257143 4.055556 3.783784 3.263158 3.717949 3.550000
&gt;  [41] 3.243902 3.000000 4.023256 3.363636 3.466667 3.369565 3.787234 3.500000
&gt;  [49] 3.612245 3.140000 3.607843 3.961538 3.245283 3.740741 3.727273 3.767857
&gt;  [57] 2.982456 3.310345 3.898305 3.650000 3.098361 3.612903 3.730159 3.375000
&gt;  [65] 3.723077 3.666667 3.522388 3.235294 3.449275 3.328571 3.619718 4.083333
&gt;  [73] 3.424658 3.310811 3.373333 3.434211 3.532468 3.538462 3.518987 3.525000
&gt;  [81] 3.716049 3.475610 3.530120 3.357143 3.705882 3.697674 3.804598 3.727273
&gt;  [89] 3.089888 3.544444 3.549451 3.619565 3.462366 3.553191 3.515789 3.260417
&gt;  [97] 3.402062 3.367347 3.565657 3.490000 3.623762 3.333333 3.398058 3.490385
&gt; [105] 3.419048 3.547170 3.504673 3.435185 3.577982 3.390909 3.396396 3.625000
&gt; [113] 3.283186 3.254386 3.695652 3.318966 3.401709 3.474576 3.285714 3.725000
&gt; [121] 3.504132 3.754098 3.560976 3.653226 3.560000 3.658730 3.456693 3.476562
&gt; [129] 3.279070 3.415385 3.519084 3.477273 3.451128 3.582090 3.362963 3.308824
&gt; [137] 3.233577 3.623188 3.539568 3.492857 3.843972 3.366197 3.566434 3.583333
&gt; [145] 3.682759 3.328767 3.476190 3.554054 3.651007 3.800000 3.562914 3.328947
&gt; [153] 3.450980 3.487013 3.393548 3.352564 3.407643 3.613924 3.566038 3.506250
&gt; [161] 3.670807 3.487654 3.374233 3.506098 3.636364 3.445783 3.473054 3.440476
&gt; [169] 3.242604 3.711765 3.508772 3.558140 3.341040 3.264368 3.548571 3.761364
&gt; [177] 3.491525 3.348315 3.329609 3.538889 3.464088 3.489011 3.754098 3.418478
&gt; [185] 3.529730 3.510753 3.491979 3.436170 3.343915 3.505263 3.502618 3.453125
&gt; [193] 3.611399 3.376289 3.558974 3.571429 3.492386 3.303030 3.472362 3.515000
```


]

]


---

class: inverse center middle
name: clase-6

# CLASE 6: TIDYDATA. ENTREGA I

&amp;nbsp;

### [Tidydata: datos limpios](#tidydata)

### [Entrega I](#entrega-I)

---

name: tidydata

# Datos limpios: .orange[TIDY DATA]

.pull-left[

&lt;img src="./img/tidyverrse_universe.jpg" width="99%" style="display: block; margin: auto;" /&gt;

]

.pull-right[
&lt;img src="./img/flow_tidyverse.jpg" width="99%" style="display: block; margin: auto;" /&gt;
]

Universo de **.bg-purple_light[paquetes tidyverse]**: un conjunto de paquetes para un flujo de **trabajo eficiente, coherente y lexicogr√°ficamente** sencillo de entender.

---

# Datos limpios: .orange[TIDY DATA]

&gt; Tidy datasets are all alike, but every messy dataset is messy in its own way (Hadley Wickham, Chief Scientist en RStudio)

Hasta ahora solo le hemos dado importancia al ¬´qu√©¬ª pero no al **.bg-purple_light[¬´c√≥mo¬ª manejamos los datos]**. La organizaci√≥n de nuestros datos es fundamental para que su **.bg-purple_light[preparaci√≥n y explotaci√≥n]** sea lo m√°s eficiente posible.

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/tidy_flow.jpg" alt="Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de https://r4ds.had.co.nz/wrangle-intro.html" width="60%" /&gt;
&lt;p class="caption"&gt;Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de https://r4ds.had.co.nz/wrangle-intro.html&lt;/p&gt;
&lt;/div&gt;


---

# Datos limpios: .orange[TIDY DATA]

El concepto **.bg-purple_light[tidy data]** fue introducido por **Hadley Wickham** (Wickham, 2014) como el primer paso de un flujo de trabajo eficiente. Para ello haremos uso del paquete `{tidyr}` (dentro de `{tidyverse}`) que nos proporciona herramientas eficientes y sencillaspara su manejo.

--

&amp;nbsp;

Los **.bg-purple_light[conjuntos tidy u ordenados]** tienen tres objetivos

* **.bg-orange[Estandarizaci√≥n]** en su estructura para una depuraci√≥n y an√°lisis eficiente.
* **.bg-orange[Sencillez]** en su manipulaci√≥n.
* Listos para ser **.bg-orange[modelizados y visualizados]**.

&amp;nbsp;

üìö Ver Wickham (2014) en **.bg-green_light[bibliograf√≠a]** en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/biblio&gt;

---

# Datos limpios: .orange[TIDY DATA]



.pull-left[

Los **.bg-purple_light[datos ordenados o tidy data]** deben cumplir:

1. Cada **.bg-green_light[variable en una columna]**.

2. Cada **.bg-orange[observaci√≥n/individuo en una fila]** diferente.

3. Cada **.bg-green_light[celda con un √∫nico valor]**.

4. Cada **.bg-orange[conjunto en un tibble]** (tabla).

5. Si usamos m√∫ltiples tablas a la vez debemos tener una **.bg-green_light[columna com√∫n para poder cruzarlas]**.

]

.pull-right[

&lt;img src="./img/tidy_def.jpg" width="85%" style="display: block; margin: auto;" /&gt;

&amp;nbsp;

&lt;img src="./img/tidyr_1.jpg" width="50%" style="display: block; margin: auto;" /&gt;


]


---

# Tuber√≠a .orange[PIPE]

En este entorno de trabajo tendremos un **.bg-purple_light[operador clave]**: el **.bg-purple_light[operador pipeline]** `%&gt;%` (podemos usar el atajo con `ctrl+shift+M` o `command+shift+M`). Dicho operador lo debemos interpretar como una **.bg-purple_light[tuber√≠a]** que va pasando por los datos y los va transformando.

--

Por ejemplo, si tuvi√©semos tres funciones `first()`, `second()` y `third()`, la opci√≥n m√°s inmediata ser√≠a anidar las tres funciones tal que `third(second(first(x)))`, algo que dificulta la lectura posterior del c√≥digo

--

Con `%&gt;%` podremos escribir (y leer) la concetanci√≥n de acciones como una **.bg-purple_light[tuber√≠a de izquierda a derecha]**:


```r
first(x) %&gt;% second(x) %&gt;% third(x)
```

--

Dicho operador viene del paquete `{magrittr}`. Para **evitar esta dependencia** (cuantos menos paquetes tengamos que cargar, mejor), desde la versi√≥n 4.1.0 de R, disponemos de un pipeline nativo de R, el **operador** `|&gt;` (disponible adem√°s fuera del entorno tidyverse).

---

# Tuber√≠a .orange[PIPE]

.pull-left[


```r
datos %&gt;%
  limpio(...) %&gt;%
  selecciono(...) %&gt;%
  filtro(...) %&gt;%
  ordeno(...) %&gt;%
  agrupo(...) %&gt;%
  cuento(...) %&gt;%
  resumo(...) %&gt;% 
  pinto(...)
```


```r
datos |&gt;
  limpio(...) |&gt;
  selecciono(...) |&gt;
  filtro(...) |&gt;
  ordeno(...) |&gt;
  agrupo(...) |&gt;
  cuento(...) |&gt;
  resumo(...) |&gt;
  pinto(...)
```

]

.pull-right[

&lt;img src="./img/tuberia.jpg" width="90%" style="display: block; margin: auto;" /&gt;

]

---

# Datos .orange[SUCIOS]: messy data

Por ejemplo, vamos a cargar la tabla `table4a` del paquete `{tidyr}` (que ya lo tenemos cargado del entorno `{tidyverse}`).




```r
table4a
```

```
&gt; # A tibble: 3 √ó 3
&gt;   country     `1999` `2000`
&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
&gt; 1 Afghanistan    745   2666
&gt; 2 Brazil       37737  80488
&gt; 3 China       212258 213766
```

**.bg-purple_light[¬øQu√© falla?]**

---


# Datos .orange[SUCIOS]: messy data

.pull-left[




```r
table4a
```

```
&gt; # A tibble: 3 √ó 3
&gt;   country     `1999` `2000`
&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
&gt; 1 Afghanistan    745   2666
&gt; 2 Brazil       37737  80488
&gt; 3 China       212258 213766
```

**.bg-purple_light[¬øQu√© falla?]**

]

.pull-right[


‚ùé Cada **.bg-green_light[variable en una columna]**.

‚ùé Cada **.bg-orange[observaci√≥n/individuo en una fila]** diferente.

‚ùé Cada **.bg-green_light[celda con un √∫nico valor]**.

]

Aunque la columna `$country` representa una variable, las otras columnas no: **.bg-purple_light[ambas son la misma variable]**, solo que medida en a√±os distintos (que deber√≠a ser a su vez otra variable), de forma que **.bg-purple_light[cada fila est√° representando dos observaciones]** (1999, 2000).


---

# Datos .orange[SUCIOS]: messy data


.pull-left[

Lo que haremos ser√° incluir una nueva columna llamada (por ejemplo) `year` que nos marque el a√±o y otra llamada `cases` que nos diga el valor de la variable de inter√©s en cada uno de esos a√±os.

]

.pull-right[

&lt;img src="./img/table4a.jpg" width="65%" style="display: block; margin: auto;" /&gt;


]

--

Con la funci√≥n `pivot_longer()` pivotaremos la tabla para pasarla a **formato long**:


```r
table4a %&gt;%
* pivot_longer(cols = c("1999", "2000"), names_to = "year", values_to = "cases")
```

```
&gt; # A tibble: 6 √ó 3
&gt;   country     year   cases
&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
&gt; 1 Afghanistan 1999     745
&gt; 2 Afghanistan 2000    2666
&gt; 3 Brazil      1999   37737
&gt; 4 Brazil      2000   80488
&gt; 5 China       1999  212258
&gt; 6 China       2000  213766
```

---

# Datos .orange[SUCIOS]: messy data

.pull-left[


```r
table4a %&gt;%
  pivot_longer(cols = c("1999", "2000"),
               names_to = "year", 
*              values_to = "cases")
```

```
&gt; # A tibble: 6 √ó 3
&gt;   country     year   cases
&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
&gt; 1 Afghanistan 1999     745
&gt; 2 Afghanistan 2000    2666
&gt; 3 Brazil      1999   37737
&gt; 4 Brazil      2000   80488
&gt; 5 China       1999  212258
&gt; 6 China       2000  213766
```

]

.pull-right[

&lt;img src="./img/table4a_2.png" width="99%" style="display: block; margin: auto;" /&gt;


]


* `cols`: el **.bg-purple_light[nombre de las columnas a pivotar]** (con comillas por ser n√∫meros y no caracteres).
* `names_to`: el **.bg-purple_light[nombre de la nueva columna]** a la mandamos los **.bg-purple_light[nombres]** de las columnas.
* `values_to`: el **.bg-purple_light[nombre de la nueva columna]** a la que vamos a mandar los **.bg-purple_light[datos]**.


---

# Datos .orange[SUCIOS]: messy data


.panelset[
.panel[.panel-name[table4b]

Echa un vistazo a la tabla `{table4b}`


```r
table4b
```

```
&gt; # A tibble: 3 √ó 3
&gt;   country         `1999`     `2000`
&gt; * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
&gt; 1 Afghanistan   19987071   20595360
&gt; 2 Brazil       172006362  174504898
&gt; 3 China       1272915272 1280428583
```

**.bg-purple_light[TODO TUYO]**: ¬øes tidy o messy? ¬øC√≥mo convertirla a tidy data en caso de que no lo sea ya?

]

.panel[.panel-name[Soluci√≥n]


```r
table4b %&gt;% pivot_longer(cols = "1999":"2000",
                         names_to = "year",
                         values_to = "cases")
```

```
&gt; # A tibble: 6 √ó 3
&gt;   country     year       cases
&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
&gt; 1 Afghanistan 1999    19987071
&gt; 2 Afghanistan 2000    20595360
&gt; 3 Brazil      1999   172006362
&gt; 4 Brazil      2000   174504898
&gt; 5 China       1999  1272915272
&gt; 6 China       2000  1280428583
```

]

]



---

# Datos .orange[SUCIOS]: messy data

.panelset[
.panel[.panel-name[relig_income]


Echa un vistazo a la tabla `{relig_income}`


```r
relig_income
```

```
&gt; # A tibble: 18 √ó 11
&gt;    religion      `&lt;$10k` $10-2‚Ä¶¬π $20-3‚Ä¶¬≤ $30-4‚Ä¶¬≥ $40-5‚Ä¶‚Å¥ $50-7‚Ä¶‚Åµ $75-1‚Ä¶‚Å∂ $100-‚Ä¶‚Å∑
&gt;    &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
&gt;  1 Agnostic           27      34      60      81      76     137     122     109
&gt;  2 Atheist            12      27      37      52      35      70      73      59
&gt;  3 Buddhist           27      21      30      34      33      58      62      39
&gt;  4 Catholic          418     617     732     670     638    1116     949     792
&gt;  5 Don‚Äôt know/r‚Ä¶      15      14      15      11      10      35      21      17
&gt;  6 Evangelical ‚Ä¶     575     869    1064     982     881    1486     949     723
&gt;  7 Hindu               1       9       7       9      11      34      47      48
&gt;  8 Historically‚Ä¶     228     244     236     238     197     223     131      81
&gt;  9 Jehovah's Wi‚Ä¶      20      27      24      24      21      30      15      11
&gt; 10 Jewish             19      19      25      25      30      95      69      87
&gt; 11 Mainline Prot     289     495     619     655     651    1107     939     753
&gt; 12 Mormon             29      40      48      51      56     112      85      49
&gt; 13 Muslim              6       7       9      10       9      23      16       8
&gt; 14 Orthodox           13      17      23      32      32      47      38      42
&gt; 15 Other Christ‚Ä¶       9       7      11      13      13      14      18      14
&gt; 16 Other Faiths       20      33      40      46      49      63      46      40
&gt; 17 Other World ‚Ä¶       5       2       3       4       2       7       3       4
&gt; 18 Unaffiliated      217     299     374     365     341     528     407     321
&gt; # ‚Ä¶ with 2 more variables: `&gt;150k` &lt;dbl&gt;, `Don't know/refused` &lt;dbl&gt;, and
&gt; #   abbreviated variable names ¬π‚Äã`$10-20k`, ¬≤‚Äã`$20-30k`, ¬≥‚Äã`$30-40k`, ‚Å¥‚Äã`$40-50k`,
&gt; #   ‚Åµ‚Äã`$50-75k`, ‚Å∂‚Äã`$75-100k`, ‚Å∑‚Äã`$100-150k`
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

**.bg-purple_light[TODO TUYO]**: ¬øes tidy o messy? ¬øC√≥mo convertirla a tidy data en caso de que no lo sea ya?

]

.panel[.panel-name[Soluci√≥n]


```r
relig_income %&gt;%
  pivot_longer(cols = "&lt;$10k":"Don't know/refused",
               names_to = "income",
               values_to = "people")
```

```
&gt; # A tibble: 180 √ó 3
&gt;    religion income             people
&gt;    &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
&gt;  1 Agnostic &lt;$10k                  27
&gt;  2 Agnostic $10-20k                34
&gt;  3 Agnostic $20-30k                60
&gt;  4 Agnostic $30-40k                81
&gt;  5 Agnostic $40-50k                76
&gt;  6 Agnostic $50-75k               137
&gt;  7 Agnostic $75-100k              122
&gt;  8 Agnostic $100-150k             109
&gt;  9 Agnostic &gt;150k                  84
&gt; 10 Agnostic Don't know/refused     96
&gt; # ‚Ä¶ with 170 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]
]


---

# Datos .orange[SUCIOS]: messy data

Veamos un segundo tipo de dato sucio: vamos a cargar la tabla `table2` del paquete `{tidyr}` (que ya lo tenemos cargado del entorno `{tidyverse}`). **.bg-purple_light[¬øQu√© falla?]**



```r
table2
```

```
&gt; # A tibble: 12 √ó 4
&gt;    country      year type            count
&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
&gt;  1 Afghanistan  1999 cases             745
&gt;  2 Afghanistan  1999 population   19987071
&gt;  3 Afghanistan  2000 cases            2666
&gt;  4 Afghanistan  2000 population   20595360
&gt;  5 Brazil       1999 cases           37737
&gt;  6 Brazil       1999 population  172006362
&gt;  7 Brazil       2000 cases           80488
&gt;  8 Brazil       2000 population  174504898
&gt;  9 China        1999 cases          212258
&gt; 10 China        1999 population 1272915272
&gt; 11 China        2000 cases          213766
&gt; 12 China        2000 population 1280428583
```


---

# Datos .orange[SUCIOS]: messy data

.pull-left[



```r
head(table2)
```

```
&gt; # A tibble: 6 √ó 4
&gt;   country      year type           count
&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          &lt;int&gt;
&gt; 1 Afghanistan  1999 cases            745
&gt; 2 Afghanistan  1999 population  19987071
&gt; 3 Afghanistan  2000 cases           2666
&gt; 4 Afghanistan  2000 population  20595360
&gt; 5 Brazil       1999 cases          37737
&gt; 6 Brazil       1999 population 172006362
```

]

.pull-right[


&lt;img src="./img/table2.jpg" width="69%" style="display: block; margin: auto;" /&gt;
]


‚ùé Cada **.bg-orange[observaci√≥n/individuo en una fila]** diferente.


F√≠jate en las cuatro primeras filas: los registros con el mismo a√±o deber√≠an ser el mismo, es la misma informaci√≥n, **.bg-purple_light[deber√≠a estar en la misma fila]**, pero est√° dividada en dos. 

---


# Datos .orange[SUCIOS]: messy data

Lo que haremos ser√° lo opuesto a antes: con `pivot_wider()` ¬´ampliaremos¬ª la **.bg-purple_light[tabla a lo ancho]**, con menos filas pero con m√°s columnas.


```r
table2 %&gt;%
* pivot_wider(names_from = type, values_from = count)
```

```
&gt; # A tibble: 6 √ó 4
&gt;   country      year  cases population
&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
&gt; 1 Afghanistan  1999    745   19987071
&gt; 2 Afghanistan  2000   2666   20595360
&gt; 3 Brazil       1999  37737  172006362
&gt; 4 Brazil       2000  80488  174504898
&gt; 5 China        1999 212258 1272915272
&gt; 6 China        2000 213766 1280428583
```

* `names_from`: el **.bg-purple_light[nombre de la columna original]** de la que vamos a sacar las **.bg-purple_light[nuevas columnas]** que vamos a crear (`cases` y `population`).
* `values_from`: el **.bg-purple_light[nombre de la columna orignal]** de la que vamos a sacar los **.bg-purple_light[datos]**.


---

# Datos .orange[SUCIOS]: messy data


Por √∫ltimo veamos un tercer tipo de dato sucio: vamos a cargar la tabla `table3` del paquete `{tidyr}` (que ya lo tenemos cargado del entorno `{tidyverse}`). **.bg-purple_light[¬øQu√© falla?]**



```r
table3
```

```
&gt; # A tibble: 6 √ó 3
&gt;   country      year rate             
&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
&gt; 1 Afghanistan  1999 745/19987071     
&gt; 2 Afghanistan  2000 2666/20595360    
&gt; 3 Brazil       1999 37737/172006362  
&gt; 4 Brazil       2000 80488/174504898  
&gt; 5 China        1999 212258/1272915272
&gt; 6 China        2000 213766/1280428583
```

--

‚ùé Cada **.bg-green_light[celda con un √∫nico valor]**.


---

# Datos .orange[SUCIOS]: messy data

Lo que haremos ser√° hacer uso de la funci√≥n `separate()` para mandar **.bg-purple_light[cada valor a una columna diferente]**.


```r
table3 %&gt;%
* separate(rate, into = c("cases", "pop"))
```

```
&gt; # A tibble: 6 √ó 4
&gt;   country      year cases  pop       
&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
&gt; 1 Afghanistan  1999 745    19987071  
&gt; 2 Afghanistan  2000 2666   20595360  
&gt; 3 Brazil       1999 37737  172006362 
&gt; 4 Brazil       2000 80488  174504898 
&gt; 5 China        1999 212258 1272915272
&gt; 6 China        2000 213766 1280428583
```

* `into`: **.bg-purple_light[nombre de nuevas columnas]** donde separaremos valores.



&lt;img src="./img/seperate.jpg" width="50%" style="display: block; margin: auto;" /&gt;

---

# Datos .orange[SUCIOS]: messy data


Por defecto lo que hace es **.bg-purple_light[localizar como separador cualquier caracter que no sea alfa-num√©rico]**. Si queremos un caracter concreto para dividir podemos indic√°rselo expl√≠citamente. Si usas un separador que no est√° en los datos te devolver√° dichas columnas vac√≠as ya que no ha podido dividirlas.



```r
table3 %&gt;% separate(rate, into = c("cases", "population"), sep = ".")
```

```
&gt; Warning: Expected 2 pieces. Additional pieces discarded in 6 rows [1, 2, 3, 4,
&gt; 5, 6].
```

```
&gt; # A tibble: 6 √ó 4
&gt;   country      year cases population
&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     
&gt; 1 Afghanistan  1999 ""    ""        
&gt; 2 Afghanistan  2000 ""    ""        
&gt; 3 Brazil       1999 ""    ""        
&gt; 4 Brazil       2000 ""    ""        
&gt; 5 China        1999 ""    ""        
&gt; 6 China        2000 ""    ""
```

---

# Datos .orange[SUCIOS]: messy data

De la misma manera que podemos separar columnas tambi√©n podemos **.bg-purple_light[unir columnas]**. Para ello vamos a usar la tabla `table5` del ya mencionado paquete.


```r
table5
```

```
&gt; # A tibble: 6 √ó 4
&gt;   country     century year  rate             
&gt; * &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
&gt; 1 Afghanistan 19      99    745/19987071     
&gt; 2 Afghanistan 20      00    2666/20595360    
&gt; 3 Brazil      19      99    37737/172006362  
&gt; 4 Brazil      20      00    80488/174504898  
&gt; 5 China       19      99    212258/1272915272
&gt; 6 China       20      00    213766/1280428583
```

---

# Datos .orange[SUCIOS]: messy data

.pull-left[

Con la funci√≥n `unite()` vamos a **.bg-purple_light[unir]** el siglo (en `century`) y el a√±o (en `year`), y al inicio le indicaremos como se llamar√° la nueva variable `year_ok`


```r
table5 %&gt;%
  unite(col = year_ok,
        century, year, sep = "")
```

```
&gt; # A tibble: 6 √ó 3
&gt;   country     year_ok rate             
&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;            
&gt; 1 Afghanistan 1999    745/19987071     
&gt; 2 Afghanistan 2000    2666/20595360    
&gt; 3 Brazil      1999    37737/172006362  
&gt; 4 Brazil      2000    80488/174504898  
&gt; 5 China       1999    212258/1272915272
&gt; 6 China       2000    213766/1280428583
```

]

.pull-right[

&lt;img src="./img/unite.jpg" width="99%" style="display: block; margin: auto;" /&gt;

]


---

# Eliminando .orange[AUSENTES]

El paquete `{tidyr}` tambi√©n dispone de algunas herramientas √∫tiles para **.bg-purple_light[quitar ausentes]**


```r
datos &lt;- tibble(x = c(1, 2, NA), y = c("a", NA, "b"))
datos
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 &lt;NA&gt; 
&gt; 3    NA b
```

---

# Eliminando .orange[AUSENTES]


Con `drop_na()` podemos indicarle que nos **.bg-purple_light[elimine las filas con alg√∫n ausente]** en alguna de las variables (o especificarle la variable concreta).


.pull-left[


```r
datos %&gt;% drop_na()
```

```
&gt; # A tibble: 1 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a
```

]


.pull-right[


```r
datos %&gt;% drop_na(x)
```

```
&gt; # A tibble: 2 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 &lt;NA&gt;
```

]

---

# Eliminando .orange[AUSENTES]

A veces no querremos eliminarlos sino **.bg-purple_light[imputar por el valor previo/siguiente]**  con `fill()`

.pull-left[


```r
datos %&gt;% fill(x)
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 &lt;NA&gt; 
&gt; 3     2 b
```

```r
datos %&gt;% fill(x, .direction = c("up"))
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 &lt;NA&gt; 
&gt; 3    NA b
```

]

.pull-right[


```r
datos %&gt;% fill(y)
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 a    
&gt; 3    NA b
```

```r
datos %&gt;% fill(y, .direction = c("up"))
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 b    
&gt; 3    NA b
```

]


---

# Eliminando .orange[AUSENTES]

Los **.bg-purple_light[ausentes]** tambi√©n pueden ser **.bg-purple_light[eliminados al pivotar]** con `values_drop_na`.



```r
stocks &lt;-
  tibble(qtr = 1:4,
         "2015" = c(1.88, 0.59, 0.35, NA),
         "2016" = c(NA, 0.92, 0.17, 2.66))
stocks
```

```
&gt; # A tibble: 4 √ó 3
&gt;     qtr `2015` `2016`
&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1     1   1.88  NA   
&gt; 2     2   0.59   0.92
&gt; 3     3   0.35   0.17
&gt; 4     4  NA      2.66
```

---

# Eliminando .orange[AUSENTES]

Los **.bg-purple_light[ausentes]** tambi√©n pueden ser **.bg-purple_light[eliminados al pivotar]** con `values_drop_na`.


```r
stocks %&gt;%
  pivot_longer(cols = c("2015", "2016"), names_to = "year",
               values_to = "return", values_drop_na = TRUE)
```

```
&gt; # A tibble: 6 √ó 3
&gt;     qtr year  return
&gt;   &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
&gt; 1     1 2015    1.88
&gt; 2     2 2015    0.59
&gt; 3     2 2016    0.92
&gt; 4     3 2015    0.35
&gt; 5     3 2016    0.17
&gt; 6     4 2016    2.66
```

---

# Reemplazando .orange[AUSENTES]

Otras veces querremos **.bg-purple_light[imputar los ausentes por un valor fijo]**, algo que podemos hacer con `replace_na()`

.pull-left[


```r
datos
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y    
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 a    
&gt; 2     2 &lt;NA&gt; 
&gt; 3    NA b
```

]

.pull-right[


```r
datos %&gt;%
  replace_na(list(x = -1,
                  y = "unknown"))
```

```
&gt; # A tibble: 3 √ó 2
&gt;       x y      
&gt;   &lt;dbl&gt; &lt;chr&gt;  
&gt; 1     1 a      
&gt; 2     2 unknown
&gt; 3    -1 b
```

]

---


# Completando .orange[AUSENTES]

Por √∫ltimo, tambi√©n podemos **.bg-purple_light[crear todas las combinaciones posibles de variables]** (para completar datos ausentes que se hayan podido eliminar).



```r
stocks &lt;- tibble(year = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),
                 qtr = c(1, 2, 3, 4, 2, 3, 4),
                 return = c(1.88, 0.59, 0.35, NA, 0.92, 0.17, 2.66))
```

.pull-left[


```r
stocks
```

```
&gt; # A tibble: 7 √ó 3
&gt;    year   qtr return
&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1  2015     1   1.88
&gt; 2  2015     2   0.59
&gt; 3  2015     3   0.35
&gt; 4  2015     4  NA   
&gt; 5  2016     2   0.92
&gt; 6  2016     3   0.17
&gt; 7  2016     4   2.66
```

]

.pull-right[


```r
stocks %&gt;% complete(year, qtr)
```

```
&gt; # A tibble: 8 √ó 3
&gt;    year   qtr return
&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1  2015     1   1.88
&gt; 2  2015     2   0.59
&gt; 3  2015     3   0.35
&gt; 4  2015     4  NA   
&gt; 5  2016     1  NA   
&gt; 6  2016     2   0.92
&gt; 7  2016     3   0.17
&gt; 8  2016     4   2.66
```

]

---

name: entrega-I

# .orange[CASO PR√ÅCTICO 1]: datos de la OMS

Instala el paquete `{tidyr}` y usa el conjunto `who` contenido en √©l mismo (dataset sobre casos de tuberculosis). Deber√°s **.bg-purple_light[entregar completado]** el archivo `.Rmd` que tienes disponible en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/eval&gt; **.bg-purple_light[antes de las 23:59 del 1 de octubre]**, siguiendo las instrucciones contenidas en el mismo.


```r
install.packages("tidyr")
library(tidyr)
who
```

&amp;nbsp;

üîé Mira antes &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/scripts/segundo_rmarkdown.Rmd&gt; para ver algunas opciones extras que puedes usar para personalizar.


---


# .orange[CASO PR√ÅCTICO 1]: datos de la OMS

.panelset[
.panel[.panel-name[Paso 1]

]

.panel[.panel-name[Paso 2]

]

.panel[.panel-name[Paso 4]

]

.panel[.panel-name[Paso 5]

]
]

---

# .orange[CASO PR√ÅCTICO 2]: an√°lisis de Star Wars

Instala el paquete `{dplyr}` y usa el conjunto `starwars` contenido en √©l mismo (dataset con los personajes de las pel√≠culas de la saga Star Wars). Deber√°s **.bg-purple_light[entregar completado]** el archivo `.Rmd` que tienes disponible en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/eval&gt; **.bg-purple_light[antes de las 23:59 del 1 de octubre]**, siguiendo las instrucciones contenidas en el mismo.



```r
install.packages("dplyr")
library(dplyr)
starwars
```

&amp;nbsp;

üîé Mira antes &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/scripts/segundo_rmarkdown.Rmd&gt; para ver algunas opciones extras que puedes usar para personalizar.

---

# .orange[CASO PR√ÅCTICO 3]: an√°lisis de gapminder

Instala el paquete `{gapminder}` y usa el conjunto `gapminder` contenido en √©l mismo (dataset con datos econ√≥micos de distintos pa√≠ses). Deber√°s **.bg-purple_light[entregar completado]** el archivo `.Rmd` que tienes disponible en &lt;https://github.com/dadosdelaplace/teaching/tree/main/bioestad/eval&gt; **.bg-purple_light[antes de las 23:59 del 1 de octubre]**, siguiendo las instrucciones contenidas en el mismo.


```r
install.packages("gapminder")
library(gapminder)
gapminder
```


&amp;nbsp;


üîé Mira antes &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/scripts/segundo_rmarkdown.Rmd&gt; para ver algunas opciones extras que puedes usar para personalizar.

---


class: inverse center middle

# CLASES

&amp;nbsp;

#### [CLASE 7](#clase-7)

#### [CLASE 8](#clase-8)

#### [ENTREGA II (clase 9)](#clase-9)


---

class: inverse center middle
name: clase-7

# CLASE 7: funciones y listas

&amp;nbsp;

### [Listas](#listas)

### [Creando nuestras propias funciones](#funciones)

### [Ejercicios](#ejercicios-7)

---

name: listas

# √öltimo tipo de variable: .orange[LISTAS]

Veamos un peque√±o resumen de los datos que ya conocemos:

* **.bg-purple_light[vectores]**: colecci√≥n de elementos de igual tipo. Pueden ser n√∫meros, caracteres o valores l√≥gicos, entre otros.

* **.bg-purple_light[matrices]**: colecci√≥n BIDIMENSIONAL de elementos de igual tipo e igual longitud.

* **.bg-purple_light[data.frame / tibble]**: colecci√≥n BIDIMENSIONAL de elementos de igual longitud pero de cualquier tipo, lo m√°s parecido a lo que conocemos como una tabla en Excel.

&amp;nbsp;

--

Con todos estos ingredientes estamos preparados/as para ver el que probablemente sea el tipo de dato m√°s importante en R: las **.bg-purple_light[listas]**: **.bg-purple_light[colecciones de variables de diferente tipo]** (ya lo ten√≠amos con `data.frame` y `tibble`) pero adem√°s tambi√©n de **.bg-purple_light[diferente longitud]**, con estructuras totalmente heter√≥geneas (incluso una lista puede tener dentro a su vez otra lista).

---

# √öltimo tipo de variable: .orange[LISTAS]


Vamos a crear **.bg-purple_light[nuestra primera lista]** con `list()` con tres elementos: el nombre de nuestros padres/madres, nuestro lugar de nacimiento y edades de nuestros hermanos.


```r
variable_1 &lt;- c("Paloma", "Gregorio")
variable_2 &lt;- "Madrid"
variable_3 &lt;- c(25, 30, 26)

lista &lt;- list("progenitores" = variable_1, "lugar_nacimiento" = variable_2,
              "edades_hermanos" = variable_3)
lista
```

```
&gt; $progenitores
&gt; [1] "Paloma"   "Gregorio"
&gt; 
&gt; $lugar_nacimiento
&gt; [1] "Madrid"
&gt; 
&gt; $edades_hermanos
&gt; [1] 25 30 26
```

---

# √öltimo tipo de variable: .orange[LISTAS]


```r
length(lista)
```

```
&gt; [1] 3
```

Si observas el objeto que hemos definido como lista, su longitud del es de 3 ya que tenemos **.bg-purple_light[guardados tres elementos]**: vector de caracteres (de longitud 2), caracter (vector de longitud 1), vector de n√∫meros (de longitud 3)

--

Tenemos guardados elementos de **.bg-purple_light[distinto tipo]** (algo que ya pod√≠amos hacer) pero, adem√°s, de **.bg-purple_light[longitudes dispares]**.


```r
dim(lista) # devolver√° NULL al no tener dos dimensiones
```

```
&gt; NULL
```

```r
class(lista) # de tipo lista
```

```
&gt; [1] "list"
```

---

# √öltimo tipo de variable: .orange[LISTAS]

Si los junt√°semos con un `tibble()`, al tener distinta longitud, obtendr√≠amos un **.bg-red_light[error]**.


```r
library(tibble)
tibble("progenitores" = variable_1,
       "lugar_nacimiento" = variable_2,
       "edades_hermanos" = variable_3)
```

```
&gt; Error:
&gt; ! Tibble columns must have compatible sizes.
&gt; ‚Ä¢ Size 2: Existing data.
&gt; ‚Ä¢ Size 3: Column `edades_hermanos`.
&gt; ‚Ñπ Only values of size one are recycled.
```

---


# √öltimo tipo de variable: .orange[LISTAS]

.pull-left[

* **.bg-purple_light[Acceder por √≠ndice]**: con el operador `[[i]]` accedemos al **elemento i-√©simo** de la lista.


```r
lista[[1]]
```

```
&gt; [1] "Paloma"   "Gregorio"
```

]

.pull-right[
* **.bg-purple_light[Acceder por nombre]**: con el operador `$nombre_elemento` accedemos por su nombre.


```r
lista$progenitores
```

```
&gt; [1] "Paloma"   "Gregorio"
```

]

--

En contraposici√≥n, el **.bg-purple_light[corchete simple]** nos permite acceder a **.bg-purple_light[varios elementos]** a la vez


```r
# Varios elementos
lista[1:2]
```

```
&gt; $progenitores
&gt; [1] "Paloma"   "Gregorio"
&gt; 
&gt; $lugar_nacimiento
&gt; [1] "Madrid"
```

---

# √öltimo tipo de variable: .orange[LISTAS]

Las listas nos dan tanta flexibilidad que es el formato natural para guardar **.bg-purple_light[datos que no est√°n estructurados]**, como pueden ser los datos almacenados de una persona.



```r
library(lubridate)
nacimiento &lt;- as_date("1989-09-10")

notas &lt;- data.frame("biolog√≠a" = c(5, 7), "f√≠sica" = c(4, 5),
                    "matem√°ticas" = c(8, 9.5))
row.names(notas) &lt;- c("primer_parcial", "segundo_parcial")

tlf &lt;- c("914719567", "617920765", "716505013")

padres &lt;- c("Juan", "Julia")

# Guardamos TODO en una lista (con nombres de cada elemento)
datos &lt;- list("nacimiento" = nacimiento, "notas_insti" = notas,
              "tel√©fonos" = tlf, "nombre_padres" = padres)
datos
```

```
&gt; $nacimiento
&gt; [1] "1989-09-10"
&gt; 
&gt; $notas_insti
&gt;                 biolog√≠a f√≠sica matem√°ticas
&gt; primer_parcial         5      4         8.0
&gt; segundo_parcial        7      5         9.5
&gt; 
&gt; $tel√©fonos
&gt; [1] "914719567" "617920765" "716505013"
&gt; 
&gt; $nombre_padres
&gt; [1] "Juan"  "Julia"
```



---

# √öltimo tipo de variable: .orange[LISTAS]

Hemos creado una lista algo m√°s compleja de 4 elementos, a los cuales podemos acceder por √≠ndice o por nombre.


```r
datos[[1]]
```

```
&gt; [1] "1989-09-10"
```

```r
datos$nacimiento
```

```
&gt; [1] "1989-09-10"
```


```r
datos$notas_insti
```

```
&gt;                 biolog√≠a f√≠sica matem√°ticas
&gt; primer_parcial         5      4         8.0
&gt; segundo_parcial        7      5         9.5
```

---

# √öltimo tipo de variable: .orange[LISTAS]


Tambi√©n podemos hacer **.bg-purple_light[listas con otras listas dentro]**, de forma que para acceder a cada nivel deberemos usar el operador `[[]]`.


```r
lista_de_listas &lt;- list("lista_1" = datos[3:4], "lista_2" = datos[1:2])

names(lista_de_listas) # Nombres de los elementos del primer nivel
```

```
&gt; [1] "lista_1" "lista_2"
```

```r
names(lista_de_listas[[1]]) # Nombres de los elementos guardados en el primer elemento, que es a su vez una lista
```

```
&gt; [1] "tel√©fonos"     "nombre_padres"
```

```r
lista_de_listas[[1]][[1]] # Elemento 1 de la lista guardada como elemento 1 de la lista superior
```

```
&gt; [1] "914719567" "617920765" "716505013"
```

¬°Nos permiten guardar **.bg-purple_light[datos n-dimensionales]**!.

---

# .green[OPERACIONES] con .orange[LISTAS]

Una lista **.bg-purple_light[no se puede vectorizar]** de forma inmediata, por lo cualquier operaci√≥n aritm√©tica aplicada a una lista dar√° **.bg-red_light[error]**


```r
datos &lt;- list("a" = 1:5, "b" = 10:20)
datos / 2
```

```
&gt; Error in datos/2: argumento no-num√©rico para operador binario
```

--


Para ello una de las opciones es hacer uso de la familia `lapply()`


```r
lapply(datos, FUN = function(x) { x / 2})
```

```
&gt; $a
&gt; [1] 0.5 1.0 1.5 2.0 2.5
&gt; 
&gt; $b
&gt;  [1]  5.0  5.5  6.0  6.5  7.0  7.5  8.0  8.5  9.0  9.5 10.0
```

La salida de `lapply()` por defecto siempre es una **.bg-purple_light[lista de igual longitud]**.

---

# .green[OPERACIONES] con .orange[LISTAS]

.pull-left[

Una opci√≥n m√°s flexible y versatil es hacer uso del paquete `{purrr}` del entorno `{tidyverse}`.


```r
# install.packages("purrr")
library(purrr)
```

Dicho paquete pretende imitar la **.bg-purple_light[programaci√≥n funcional]** de otros lenguajes como Scala o la **estrategia map-reduce de Hadoop** (de Google).

]


.pull-right[

&lt;img src="./img/purrr.png" width="110%" style="display: block; margin: auto auto auto 0;" /&gt;

]

---

# .green[OPERACIONES] con .orange[LISTAS]

La funci√≥n m√°s simple del paquete `{purrr}` es la funci√≥n `map()`, que nos **.bg-purple_light[aplica una funci√≥n vectorizada]** a cada uno de los elementos de una lista. Veamos un primer ejemplo aplicada a vectores


```r
library(microbenchmark)
x &lt;- 1:700
y &lt;- sqrt(x) # vectorizado

# bucle
for (i in 1:700) { y[i] &lt;- sqrt(x[i]) }

microbenchmark(sqrt(x), for (i in 1:700) { y[i] &lt;- sqrt(x[i]) }, times = 1e3)
```

```
&gt; Unit: microseconds
&gt;                                         expr      min        lq        mean
&gt;                                      sqrt(x)    2.003    2.8995    4.851893
&gt;  for (i in 1:700) {     y[i] &lt;- sqrt(x[i]) } 2068.313 2437.2860 3615.642143
&gt;    median        uq       max neval cld
&gt;     3.871    4.9435   288.467  1000  a 
&gt;  2993.729 3767.0425 72997.009  1000   b
```



---


# .green[OPERACIONES] con .orange[LISTAS]

Con `map()` podemos **.bg-purple_light[¬´mapear¬ª cada lista]** y aplicar la funci√≥n elemento a elemento (si fuese el caso).

.pull-left[


```r
library(purrr)
x &lt;- rep(list(1:2), 3)
x
```

```
&gt; [[1]]
&gt; [1] 1 2
&gt; 
&gt; [[2]]
&gt; [1] 1 2
&gt; 
&gt; [[3]]
&gt; [1] 1 2
```

]

.pull-right[


```r
# purrr
map(x, sqrt) 
```

```
&gt; [[1]]
&gt; [1] 1.000000 1.414214
&gt; 
&gt; [[2]]
&gt; [1] 1.000000 1.414214
&gt; 
&gt; [[3]]
&gt; [1] 1.000000 1.414214
```

]

**.bg-green_light[IMPORTANTE]**: en vectores disponemos de una vectorizaci√≥n por defecto porque `R` realiza operaciones elemento a elemento.

---

# .green[OPERACIONES] con .orange[LISTAS]


```r
x &lt;- list(rnorm(n = 1e3, mean = 0, sd = 1), rnorm(n = 1e3, mean = 2, sd = 1))
map(x, mean)
```

```
&gt; [[1]]
&gt; [1] 0.01976477
&gt; 
&gt; [[2]]
&gt; [1] 1.991007
```


```r
x &lt;- rep(list(rnorm(n = 1e3, mean = 0, sd = 1)), 1000)
microbenchmark(map(x, .f = function(x) { mean(x^2) }), lapply(x, FUN = function(x) { mean(x^2) }), times = 1e3)
```

```
&gt; Unit: milliseconds
&gt;                                            expr      min       lq     mean
&gt;      map(x, .f = function(x) {     mean(x^2) }) 5.843842 7.766488 10.85233
&gt;  lapply(x, FUN = function(x) {     mean(x^2) }) 5.798943 7.478557 10.06550
&gt;    median       uq       max neval cld
&gt;  8.858908 10.43777 235.27660  1000   b
&gt;  8.578086 10.33457  55.69647  1000  a
```


---

# .green[OPERACIONES] con .orange[LISTAS]

Adem√°s de ser **.bg-purple_light[m√°s legible y eficiente]**, con `{purrr}` podemos **.bg-purple_light[decidir el formato de salida]** tras la operaci√≥n (por ejemplo, en formato de vector con `map_dbl()` para n√∫meros - en general - y  `map_int()` para enteros), sin necesidad de hacer uso de `unlist()` (deshace formato lista).


```r
x &lt;- list(rnorm(n = 1e3, mean = 0, sd = 1), rnorm(n = 1e3, mean = 2, sd = 1))
map_dbl(x, mean)
```

```
&gt; [1] 0.02348016 2.00226182
```

--

Adem√°s, si se le pasa un **.bg-purple_light[n√∫mero]** en lugar de una funci√≥n, nos devolver√° el elemento i-√©simo de cada lista de forma inmediata.

.pull-left[


```r
c(x[[1]][3], x[[2]][3])
```

```
&gt; [1] 0.170459 2.025621
```

]

.pull-right[

```r
map_dbl(x, 3)
```

```
&gt; [1] 0.170459 2.025621
```
]


---


# .green[OPERACIONES] con .orange[LISTAS]

Tenemos adem√°s de pasar m√°s de un argumento, realizando **.bg-purple_light[operaciones binarias]** con `map2()`


```r
x &lt;- list("a" = 1:3, "b" = 4:7)
y &lt;- list("c" = c(-1, 4, 0), "b" = c(5, -4, -1, 2))

map2(x, y, .f = function(x, y) { x^2 + y^2})
```

```
&gt; $a
&gt; [1]  2 20  9
&gt; 
&gt; $b
&gt; [1] 41 41 37 53
```

---

name: funciones

# Creando .orange[FUNCIONES]

No solo podemos usar **.bg-purple_light[funciones predeterminadas]** que vienen ya cargadas en paquetes, adem√°s podemos **.bg-purple_light[crear nuestras propias funciones]** para **automatizar tareas**.

¬øC√≥mo **.bg-purple_light[crear nuestra propia funci√≥n]**? Veamos su **.bg-orange[esquema b√°sico]**:

--

.pull-left[

* **.bg-purple_light[Nombre]**, por ejemplo `name_fun` (sin espacios ni caracteres extra√±os).

* Al nombre le **.bg-purple_light[asignamos la palabra reservada]** `function()`.

* Definir **.bg-purple_light[argumentos de entrada]** (dentro de `function()`).

* **.bg-purple_light[Cuerpo]** de la funci√≥n dentro de `{ }`.

* Finalizamos la funci√≥n con los **.bg-purple_light[argumentos de salida]** con `return()`.

]

.pull-right[


```r
# No ejecutar --&gt; esquema conceptual
name_fun &lt;- function(arg1, arg2, ...) {
  
  # C√≥digo que queramos ejecutar
  c√≥digo
  
  # Salida
  return(var_salida)
}
```

]


---

# Creando .orange[FUNCIONES]


.pull-left[

* `arg1, arg2, ...`: ser√°n los **.bg-purple_light[argumentos de entrada]**, los argumentos que toma la funci√≥n para ejecutar el c√≥digo que tiene dentro

* `c√≥digo`: l√≠neas de c√≥digo que queramos que **.bg-purple_light[ejecute la funci√≥n]**. 

* `return(var_salida)`: dentro del comando `return()` se introducir√°n los **.bg-purple_light[argumentos de salida]**.

]

.pull-right[


```r
# No ejecutar --&gt; esquema conceptual
name_fun &lt;- function(arg1, arg2, ...) {
  
  # C√≥digo que queramos ejecutar
  c√≥digo
  
  # Salida
  return(var_salida)
}
```

]

&amp;nbsp;

**.bg-red_light[IMPORTANTE]**: todas las variables que definamos dentro de la funci√≥n son **.bg-purple_light[variables locales: solo existir√°n dentro de la funci√≥n]** salvo que especifiquemos lo contrario.

---

# Creando .orange[FUNCIONES]

Veamos un ejemplo muy simple de funci√≥n para **.bg-purple_light[calcular el √°rea de un rect√°ngulo]**.

--

Dado que el √°rea de un rect√°ngulo se calcula como el **producto de sus lados**, necesitaremos precisamente eso, sus lados: esos ser√°n los **.bg-purple_light[argumentos de entrada]** y el **.bg-purple_light[valor a devolver]** ser√° justo su **.bg-purple_light[√°rea]**, calculada como `\(lado_1 * lado_2\)`.

--


```r
# Definici√≥n del nombre de funci√≥n y argumentos de entrada
calcular_area &lt;- function(lado_1, lado_2) {
  
  area &lt;- lado_1 * lado_2
  
  return(area)
  
}
```

---

# Creando .orange[FUNCIONES]


Tambi√©n podemos hacer una definici√≥n directa, sin almacenar variables por el camino


```r
# Definici√≥n del nombre de funci√≥n y argumentos de entrada
calcular_area &lt;- function(lado_1, lado_2) {
  
  return(lado_1 * lado_2)
  
}
```

--

**.bg-purple_light[¬øC√≥mo aplicar la funci√≥n?]**


```r
calcular_area(5, 3) # √°rea de un rect√°ngulo 5 x 3 
```

```
&gt; [1] 15
```

```r
calcular_area(1, 5) # √°rea de un rect√°ngulo 1 x 5
```

```
&gt; [1] 5
```

---

# Argumentos .orange[POR DEFECTO]

Imagina ahora que nos damos cuenta que el 90% de las veces usamos dicha funci√≥n para **.bg-purple_light[calcular el √°rea de un cuadrado]** (es decir, solo necesitamos un lado). Para ello, podemos definir **.bg-purple_light[argumentos por defecto]** en la funci√≥n: tomar√°n dicho valor salvo que le asignemos otro.

¬øPor qu√© no asignar `lado_2 = lado_1` por defecto, para ahorrar l√≠neas de c√≥digo y tiempo?

--


```r
# Definici√≥n del nombre de funci√≥n y
# argumentos de entrada por defecto lado_2 = lado_1
calcular_area &lt;- function(lado_1, lado_2 = lado_1) {
  
  # Cuerpo de la funci√≥n
  area &lt;- lado_1 * lado_2
  
  # Resultado que devolvemos
  return(area)
  
}
```

---

# Argumentos .orange[POR DEFECTO]



```r
calcular_area &lt;- function(lado_1, lado_2 = lado_1) {
  
  # Cuerpo de la funci√≥n
  area &lt;- lado_1 * lado_2
  
  # Resultado que devolvemos
  return(area)
  
}
```


Ahora **.bg-purple_light[por defecto]** el segundo lado ser√° igual al primero (si se lo a√±adimos usar√° ambos).



```r
calcular_area(lado_1 = 5) # cuadrado
```

```
&gt; [1] 25
```

```r
calcular_area(lado_1 = 5, lado_2 = 7) # rect√°ngulo
```

```
&gt; [1] 35
```

---
 
# .orange[SALIDA M√öLTIPLE]

Compliquemos un poco la funci√≥n y a√±adamos en la salida los valores de cada lado, etiquetados como `lado_1` y `lado_2`, **.bg-purple_light[empaquetando la salida en una lista]**.


```r
# Definici√≥n del nombre de funci√≥n y argumentos de entrada
calcular_area &lt;- function(lado_1, lado_2 = lado_1) {
  
  # Cuerpo de la funci√≥n
  area &lt;- lado_1 * lado_2
  
  # Resultado
  return(list("area" = area, "lado_1" = lado_1, "lado_2" = lado_2))
  
}
```

Veamos que nos devuelve ahora


---

# .orange[SALIDA M√öLTIPLE]



```r
salida &lt;- calcular_area(5, 3)
salida
```

```
&gt; $area
&gt; [1] 15
&gt; 
&gt; $lado_1
&gt; [1] 5
&gt; 
&gt; $lado_2
&gt; [1] 3
```

```r
salida["area"]
```

```
&gt; $area
&gt; [1] 15
```

```r
salida["lado_1"]
```

```
&gt; $lado_1
&gt; [1] 5
```

---

# .orange[SALIDA M√öLTIPLE]

Antes nos daba igual el orden de los argumentos pero ahora **.bg-purple_light[el orden de los argumentos de entrada importa]**, ya que en la salida incluimos `lado_1` y `lado_2`. 

--

&amp;nbsp;

**.bg-green_light[CONSEJO]**: es altamente recomendable hacer la llamada a la funci√≥n **.bg-purple_light[indicando expl√≠citamente los argumentos]** para mejorar la **legibilidad e interpretabilidad**.


```r
# Equivalente a calcular_area(5, 3)
calcular_area(lado_1 = 5, lado_2 = 3)
```

```
&gt; $area
&gt; [1] 15
&gt; 
&gt; $lado_1
&gt; [1] 5
&gt; 
&gt; $lado_2
&gt; [1] 3
```

---

# Creando .orange[FUNCIONES]

Parece una tonter√≠a lo que hemos hecho pero hemos cruzado una frontera importante: hemos pasado de **.bg-purple_light[consumir conocimiento]** (c√≥digo de otros paquetes, elaborado por otros/as), a **.bg-green_light[generar conocimiento]**, creando nuestras propias funciones.

&amp;nbsp;

En este caso no ganaremos el Nobel por nuestro aporte, pero en un futuro‚Ä¶ Si la Uni√≥n Europea lo gan√≥, hay opciones :)

---

# Variables .orange[LOCALES VS GLOBALES]

Un aspecto importante sobre el que reflexionar con las funciones: ¬øqu√© sucede si **.bg-purple_light[nombramos a una variable dentro]** de una funci√≥n a la que se nos ha **.bg-purple_light[olvidado asignar]** un valor dentro de la misma?

--

Debemos ser cautos al usar funciones en `R`, ya que debido a la **.bg-purple_light[¬´regla lexicogr√°fica¬ª]**, si una variable no se define dentro de la funci√≥n, `R` **.bg-purple_light[buscar√° dicha variable en el entorno]** de variables.


```r
x &lt;- 1
funcion_ejemplo &lt;- function() {
    
  print(x) # No devuelve nada, solo realiza la acci√≥n 
}
funcion_ejemplo()
```

```
&gt; [1] 1
```

---

# Variables .orange[LOCALES VS GLOBALES]

Si una variable  **.bg-purple_light[ya est√° definida fuera de la funci√≥n (entorno global)]**, y adem√°s es usada dentro de cambiando su valor, el valor **.bg-purple_light[solo cambia dentro]** pero no en el entorno global.


```r
x &lt;- 1
funcion_ejemplo &lt;- function() {
    
  x &lt;- 2
  print(x) # lo que vale dentro
}
```


```r
# lo que vale dentro
*funcion_ejemplo()
```

```
&gt; [1] 2
```

```r
# lo que vale fuera
*print(x)
```

```
&gt; [1] 1
```

---

# Variables .orange[LOCALES VS GLOBALES]


Si queremos que adem√°s de cambiar localmente lo haga **.bg-purple_light[globalmente]** deberemos usar la **.bg-purple_light[doble asignaci√≥n]** (`&lt;&lt;-`).

.pull-left[


```r
x &lt;- 1
y &lt;- 2
funcion_ejemplo &lt;- function() {
  
  # no cambia globalmente, solo localmente
  x &lt;- 3 
  
  # cambia globalmente
* y &lt;&lt;- 0
  
  print(x)
  print(y)
}
```

]

.pull-right[


```r
funcion_ejemplo() # lo que vale dentro
```

```
&gt; [1] 3
&gt; [1] 0
```

```r
x # lo que vale fuera
```

```
&gt; [1] 1
```

```r
y # lo que vale fuera
```

```
&gt; [1] 0
```

]

---

# Creando .orange[FUNCIONES]

Vamos a practicar un poco las funciones.

**.bg-purple_light[Ejercicio 1]**: crea una funci√≥n llamada `calculo_IMC` que, dados dos argumentos (peso y estatura en metros), devuelva el IMC de una persona.


--

&amp;nbsp;

**.bg-purple_light[Ejercicio 2]**: crea una funci√≥n llamada `calculo_IMC` que tenga dos argumentos de entrada (peso y estatura en metros), m√°s otro opcional que se llame `unidades` (por defecto, `unidades = "metros"`). Desarrolla la funci√≥n de forma que haga lo correcto si `unidades = "metros"` y si `unidades = "cent√≠metros"`.

--

&amp;nbsp;

**.bg-purple_light[Ejercicio 3]**: crea un `tibble` ficticio de 7 personas, con tres variables (nombre, peso, estatura), y aplica la funci√≥n definida de forma que obtengamos una cuarta colunna con su IMC.

---

name: ejercicios-7

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 1**: modifica el c√≥digo inferior para definir una funci√≥n llamada `funcion_suma`, de forma que dados dos elementos, devuelve su suma.



```r
# Definimos funci√≥n
nombre &lt;- function(x, y) {
  
  # Sumamos
  suma &lt;- # c√≥digo a ejecutar
  
  # ¬øQu√© devolvemos?
  return()
}
# Aplicamos la funci√≥n
suma(3, 7)
```
 
]

.panel[.panel-name[Soluci√≥n ej. 1]


```r
# Definimos funci√≥n
funcion_suma &lt;- function(x, y) {
  
  # Sumamos
  suma &lt;- x + y
  
  # Devolvemos la salida
  return(suma)
}

# Aplicamos la funci√≥n
funcion_suma(3, 7)
```

```
&gt; [1] 10
```

]

]

---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 2**: modifica el c√≥digo inferior para definir una funci√≥n llamada `funcion_producto`, de forma que dados dos elementos, devuelve su producto.
 

```r
# Definimos funci√≥n
nombre &lt;- function(x, y) {
  
  # Multiplicamos
  producto &lt;- # c√≥digo de la multiplicaci√≥n
  
  # ¬øQu√© devolvemos?
  return()
}

# Aplicamos la funci√≥n
producto(3, -7)
```

]

.panel[.panel-name[Soluci√≥n ej. 2]


```r
# Definimos funci√≥n
funcion_producto &lt;- function(x, y) {
  
  # Multiplicamos
  producto &lt;- x * y
  
  # Devolvemos la salida
  return(producto)
}

# Aplicamos la funci√≥n
funcion_producto(3, -7)
```

```
&gt; [1] -21
```

]

]


---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 3**: modifica el c√≥digo inferior para definir una funci√≥n llamada `funcion_producto`, de forma que dados dos elementos, devuelve su producto, pero que por defecto calcule el cuadrado (es decir, por defecto un solo argumento, y el resultado sea el n√∫mero por s√≠ mismo)
 

```r
# Definimos funci√≥n
nombre &lt;- function(x, y) {
  
  # Multiplicamos
  producto &lt;- # c√≥digo de la multiplicaci√≥n
  
  # ¬øQu√© devolvemos?
  return()
}

# Aplicamos la funci√≥n solo con un argumento
producto(3)

# Aplicamos la funci√≥n con dos argumentos
producto(3, -7)
```

]

.panel[.panel-name[Soluci√≥n ej. 3]


```r
funcion_producto &lt;- function(x, y = x) {
  
  producto &lt;- x * y
  return(producto)
}
```


```r
funcion_producto(3) # por defecto x = 3, y = 3
```

```
&gt; [1] 9
```

```r
funcion_producto(3, -7)
```

```
&gt; [1] -21
```

]

]


---

# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 4**:  define una funci√≥n llamada `igualdad_nombres` que, dados dos nombres, nos diga si son iguales o no. Hazlo considerando importantes las may√∫sculas, y sin que importen las may√∫sculas. Echa un vistazo al paquete `{stringr}`.
 

* üìù **Ejercicio 5**:  define una funci√≥n llamada `pares` que, dados dos n√∫meros, nos diga si la suma de ambos es par o no.
 

* üìù **Ejercicio 6**: define una funci√≥n llamada `pasar_a_celsius` que, dada una temperatura en Fahrenheit, la convierta a grados Celsius. Aplica la funci√≥n a la columna Temp del conjunto airquality, e incorp√≥rala al fichero en una nueva columna Temp_Celsius.

]

.panel[.panel-name[Soluci√≥n ej. 4a]



```r
# Distinguiendo may√∫sculas
igualdad_nombres &lt;- function(persona_1, persona_2) {
  
  return(persona_1 == persona_2)
}
```


```r
igualdad_nombres("Javi", "javi")
```

```
&gt; [1] FALSE
```

```r
igualdad_nombres("Javi", "Luc√≠a")
```

```
&gt; [1] FALSE
```

]

.panel[.panel-name[Soluci√≥n ej. 4b]


```r
# Sin importar may√∫sculas
igualdad_nombres &lt;- function(persona_1, persona_2) {
  
  return(toupper(persona_1) == toupper(persona_2))
}
```


```r
igualdad_nombres("Javi", "javi")
```

```
&gt; [1] TRUE
```

```r
igualdad_nombres("Javi", "Luc√≠a")
```

```
&gt; [1] FALSE
```

]

.panel[.panel-name[Soluci√≥n ej. 5]


```r
pares &lt;- function(x, y) {
  
  suma &lt;- x + y
  par &lt;- suma %% 2 == 0
  
  return(par)
}
```


```r
pares(1, 3) # suma 4 (par)
```

```
&gt; [1] TRUE
```

```r
pares(2, 7) # suma 9 (impar)
```

```
&gt; [1] FALSE
```

]

.panel[.panel-name[Soluci√≥n ej. 6]


```r
pasar_a_celsius &lt;- function(x) {
  x_celsius &lt;- (x - 32) * (5 / 9)
  return(x_celsius)
}
```


```r
pasar_a_celsius(80)
```

```
&gt; [1] 26.66667
```

```r
data.frame(airquality,
           "Temp_Celsius" = pasar_a_celsius(airquality$Temp))
```

```
&gt;     Ozone Solar.R Wind Temp Month Day Temp_Celsius
&gt; 1      41     190  7.4   67     5   1     19.44444
&gt; 2      36     118  8.0   72     5   2     22.22222
&gt; 3      12     149 12.6   74     5   3     23.33333
&gt; 4      18     313 11.5   62     5   4     16.66667
&gt; 5      NA      NA 14.3   56     5   5     13.33333
&gt; 6      28      NA 14.9   66     5   6     18.88889
&gt; 7      23     299  8.6   65     5   7     18.33333
&gt; 8      19      99 13.8   59     5   8     15.00000
&gt; 9       8      19 20.1   61     5   9     16.11111
&gt; 10     NA     194  8.6   69     5  10     20.55556
&gt; 11      7      NA  6.9   74     5  11     23.33333
&gt; 12     16     256  9.7   69     5  12     20.55556
&gt; 13     11     290  9.2   66     5  13     18.88889
&gt; 14     14     274 10.9   68     5  14     20.00000
&gt; 15     18      65 13.2   58     5  15     14.44444
&gt; 16     14     334 11.5   64     5  16     17.77778
&gt; 17     34     307 12.0   66     5  17     18.88889
&gt; 18      6      78 18.4   57     5  18     13.88889
&gt; 19     30     322 11.5   68     5  19     20.00000
&gt; 20     11      44  9.7   62     5  20     16.66667
&gt; 21      1       8  9.7   59     5  21     15.00000
&gt; 22     11     320 16.6   73     5  22     22.77778
&gt; 23      4      25  9.7   61     5  23     16.11111
&gt; 24     32      92 12.0   61     5  24     16.11111
&gt; 25     NA      66 16.6   57     5  25     13.88889
&gt; 26     NA     266 14.9   58     5  26     14.44444
&gt; 27     NA      NA  8.0   57     5  27     13.88889
&gt; 28     23      13 12.0   67     5  28     19.44444
&gt; 29     45     252 14.9   81     5  29     27.22222
&gt; 30    115     223  5.7   79     5  30     26.11111
&gt; 31     37     279  7.4   76     5  31     24.44444
&gt; 32     NA     286  8.6   78     6   1     25.55556
&gt; 33     NA     287  9.7   74     6   2     23.33333
&gt; 34     NA     242 16.1   67     6   3     19.44444
&gt; 35     NA     186  9.2   84     6   4     28.88889
&gt; 36     NA     220  8.6   85     6   5     29.44444
&gt; 37     NA     264 14.3   79     6   6     26.11111
&gt; 38     29     127  9.7   82     6   7     27.77778
&gt; 39     NA     273  6.9   87     6   8     30.55556
&gt; 40     71     291 13.8   90     6   9     32.22222
&gt; 41     39     323 11.5   87     6  10     30.55556
&gt; 42     NA     259 10.9   93     6  11     33.88889
&gt; 43     NA     250  9.2   92     6  12     33.33333
&gt; 44     23     148  8.0   82     6  13     27.77778
&gt; 45     NA     332 13.8   80     6  14     26.66667
&gt; 46     NA     322 11.5   79     6  15     26.11111
&gt; 47     21     191 14.9   77     6  16     25.00000
&gt; 48     37     284 20.7   72     6  17     22.22222
&gt; 49     20      37  9.2   65     6  18     18.33333
&gt; 50     12     120 11.5   73     6  19     22.77778
&gt; 51     13     137 10.3   76     6  20     24.44444
&gt; 52     NA     150  6.3   77     6  21     25.00000
&gt; 53     NA      59  1.7   76     6  22     24.44444
&gt; 54     NA      91  4.6   76     6  23     24.44444
&gt; 55     NA     250  6.3   76     6  24     24.44444
&gt; 56     NA     135  8.0   75     6  25     23.88889
&gt; 57     NA     127  8.0   78     6  26     25.55556
&gt; 58     NA      47 10.3   73     6  27     22.77778
&gt; 59     NA      98 11.5   80     6  28     26.66667
&gt; 60     NA      31 14.9   77     6  29     25.00000
&gt; 61     NA     138  8.0   83     6  30     28.33333
&gt; 62    135     269  4.1   84     7   1     28.88889
&gt; 63     49     248  9.2   85     7   2     29.44444
&gt; 64     32     236  9.2   81     7   3     27.22222
&gt; 65     NA     101 10.9   84     7   4     28.88889
&gt; 66     64     175  4.6   83     7   5     28.33333
&gt; 67     40     314 10.9   83     7   6     28.33333
&gt; 68     77     276  5.1   88     7   7     31.11111
&gt; 69     97     267  6.3   92     7   8     33.33333
&gt; 70     97     272  5.7   92     7   9     33.33333
&gt; 71     85     175  7.4   89     7  10     31.66667
&gt; 72     NA     139  8.6   82     7  11     27.77778
&gt; 73     10     264 14.3   73     7  12     22.77778
&gt; 74     27     175 14.9   81     7  13     27.22222
&gt; 75     NA     291 14.9   91     7  14     32.77778
&gt; 76      7      48 14.3   80     7  15     26.66667
&gt; 77     48     260  6.9   81     7  16     27.22222
&gt; 78     35     274 10.3   82     7  17     27.77778
&gt; 79     61     285  6.3   84     7  18     28.88889
&gt; 80     79     187  5.1   87     7  19     30.55556
&gt; 81     63     220 11.5   85     7  20     29.44444
&gt; 82     16       7  6.9   74     7  21     23.33333
&gt; 83     NA     258  9.7   81     7  22     27.22222
&gt; 84     NA     295 11.5   82     7  23     27.77778
&gt; 85     80     294  8.6   86     7  24     30.00000
&gt; 86    108     223  8.0   85     7  25     29.44444
&gt; 87     20      81  8.6   82     7  26     27.77778
&gt; 88     52      82 12.0   86     7  27     30.00000
&gt; 89     82     213  7.4   88     7  28     31.11111
&gt; 90     50     275  7.4   86     7  29     30.00000
&gt; 91     64     253  7.4   83     7  30     28.33333
&gt; 92     59     254  9.2   81     7  31     27.22222
&gt; 93     39      83  6.9   81     8   1     27.22222
&gt; 94      9      24 13.8   81     8   2     27.22222
&gt; 95     16      77  7.4   82     8   3     27.77778
&gt; 96     78      NA  6.9   86     8   4     30.00000
&gt; 97     35      NA  7.4   85     8   5     29.44444
&gt; 98     66      NA  4.6   87     8   6     30.55556
&gt; 99    122     255  4.0   89     8   7     31.66667
&gt; 100    89     229 10.3   90     8   8     32.22222
&gt; 101   110     207  8.0   90     8   9     32.22222
&gt; 102    NA     222  8.6   92     8  10     33.33333
&gt; 103    NA     137 11.5   86     8  11     30.00000
&gt; 104    44     192 11.5   86     8  12     30.00000
&gt; 105    28     273 11.5   82     8  13     27.77778
&gt; 106    65     157  9.7   80     8  14     26.66667
&gt; 107    NA      64 11.5   79     8  15     26.11111
&gt; 108    22      71 10.3   77     8  16     25.00000
&gt; 109    59      51  6.3   79     8  17     26.11111
&gt; 110    23     115  7.4   76     8  18     24.44444
&gt; 111    31     244 10.9   78     8  19     25.55556
&gt; 112    44     190 10.3   78     8  20     25.55556
&gt; 113    21     259 15.5   77     8  21     25.00000
&gt; 114     9      36 14.3   72     8  22     22.22222
&gt; 115    NA     255 12.6   75     8  23     23.88889
&gt; 116    45     212  9.7   79     8  24     26.11111
&gt; 117   168     238  3.4   81     8  25     27.22222
&gt; 118    73     215  8.0   86     8  26     30.00000
&gt; 119    NA     153  5.7   88     8  27     31.11111
&gt; 120    76     203  9.7   97     8  28     36.11111
&gt; 121   118     225  2.3   94     8  29     34.44444
&gt; 122    84     237  6.3   96     8  30     35.55556
&gt; 123    85     188  6.3   94     8  31     34.44444
&gt; 124    96     167  6.9   91     9   1     32.77778
&gt; 125    78     197  5.1   92     9   2     33.33333
&gt; 126    73     183  2.8   93     9   3     33.88889
&gt; 127    91     189  4.6   93     9   4     33.88889
&gt; 128    47      95  7.4   87     9   5     30.55556
&gt; 129    32      92 15.5   84     9   6     28.88889
&gt; 130    20     252 10.9   80     9   7     26.66667
&gt; 131    23     220 10.3   78     9   8     25.55556
&gt; 132    21     230 10.9   75     9   9     23.88889
&gt; 133    24     259  9.7   73     9  10     22.77778
&gt; 134    44     236 14.9   81     9  11     27.22222
&gt; 135    21     259 15.5   76     9  12     24.44444
&gt; 136    28     238  6.3   77     9  13     25.00000
&gt; 137     9      24 10.9   71     9  14     21.66667
&gt; 138    13     112 11.5   71     9  15     21.66667
&gt; 139    46     237  6.9   78     9  16     25.55556
&gt; 140    18     224 13.8   67     9  17     19.44444
&gt; 141    13      27 10.3   76     9  18     24.44444
&gt; 142    24     238 10.3   68     9  19     20.00000
&gt; 143    16     201  8.0   82     9  20     27.77778
&gt; 144    13     238 12.6   64     9  21     17.77778
&gt; 145    23      14  9.2   71     9  22     21.66667
&gt; 146    36     139 10.3   81     9  23     27.22222
&gt; 147     7      49 10.3   69     9  24     20.55556
&gt; 148    14      20 16.6   63     9  25     17.22222
&gt; 149    30     193  6.9   70     9  26     21.11111
&gt; 150    NA     145 13.2   77     9  27     25.00000
&gt; 151    14     191 14.3   75     9  28     23.88889
&gt; 152    18     131  8.0   76     9  29     24.44444
&gt; 153    20     223 11.5   68     9  30     20.00000
```


]
]

---


# Ejercicios

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 7**: define una lista de 4 elementos de tipos distintos y accede al segundo de ellos (yo incluir√© uno que sea un data.frame para que veas que en una lista cabe de todo).
 
* üìù **Ejercicio 8**: accede a los elementos que ocupan los lugares 1 y 4 de la lista definida anteriormente.
 
* üìù **Ejercicio 9**: define una lista de 4 elementos que contenga, en una sola variable, tu nombre, apellido, edad y si est√°s soltero/a.

* üìù **Ejercicio 10**: carga el dataset `starwars` del paquete `{dplyr}` y accede a la segunda pel√≠cula que aparece en `starwars$films` (para cada personaje). Determina cuales no no salen en m√°s de una pel√≠cula.

]

.panel[.panel-name[Soluci√≥n ej. 7]


```r
# Ejemplo: lista con texto, num√©rico, l√≥gico y un data.frame
lista_ejemplo &lt;- list("nombre" = "Javier", "cp" = 28019,
                      "soltero" = TRUE,
                      "notas" = data.frame("mates" = c(7.5, 8, 9),
                                           "lengua" = c(10, 5, 6)))
lista_ejemplo
```

```
&gt; $nombre
&gt; [1] "Javier"
&gt; 
&gt; $cp
&gt; [1] 28019
&gt; 
&gt; $soltero
&gt; [1] TRUE
&gt; 
&gt; $notas
&gt;   mates lengua
&gt; 1   7.5     10
&gt; 2   8.0      5
&gt; 3   9.0      6
```

]

.panel[.panel-name[Soluci√≥n ej. 8]


```r
# Accedemos al 1 y al 4
lista_ejemplo[c(1, 4)]
```

```
&gt; $nombre
&gt; [1] "Javier"
&gt; 
&gt; $notas
&gt;   mates lengua
&gt; 1   7.5     10
&gt; 2   8.0      5
&gt; 3   9.0      6
```

```r
# Accedemos por nombre
lista_ejemplo$nombre
```

```
&gt; [1] "Javier"
```

```r
lista_ejemplo$notas
```

```
&gt;   mates lengua
&gt; 1   7.5     10
&gt; 2   8.0      5
&gt; 3   9.0      6
```

```r
lista_ejemplo[c("nombre", "notas")]
```

```
&gt; $nombre
&gt; [1] "Javier"
&gt; 
&gt; $notas
&gt;   mates lengua
&gt; 1   7.5     10
&gt; 2   8.0      5
&gt; 3   9.0      6
```



]

.panel[.panel-name[Soluci√≥n ej. 9]


```r
# Creamos lista: con lubridate calculamos la diferencia de a√±os desde la fecha de nuestro nacimiento hasta hoy (sea cuando sea hoy)
lista_personal &lt;- list("nombre" = "Javier",
                       "apellidos" = "√Ålvarez Li√©bana",
                       "edad" = 32,
                       "soltero" = TRUE)
lista_personal
```

```
&gt; $nombre
&gt; [1] "Javier"
&gt; 
&gt; $apellidos
&gt; [1] "√Ålvarez Li√©bana"
&gt; 
&gt; $edad
&gt; [1] 32
&gt; 
&gt; $soltero
&gt; [1] TRUE
```

]

.panel[.panel-name[Soluci√≥n ej. 10]


```r
library(dplyr)

# accedemos a la segunda pel√≠cula que aparece
# en cada personaje
segunda_peli &lt;- map(starwars$films, 2)

# ¬øCu√°les no salen en m√°s de una pel√≠cula?
map_lgl(segunda_peli, is.null)
```

```
&gt;  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
&gt; [13] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE
&gt; [25]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE  TRUE
&gt; [37]  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE
&gt; [49] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE FALSE
&gt; [61] FALSE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
&gt; [73] FALSE  TRUE  TRUE FALSE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
&gt; [85]  TRUE  TRUE FALSE
```

]

]

---

class: inverse center middle
name: clase-8

# CLASE 8: introducci√≥n a tidyverse

&amp;nbsp;

### [Paquetes tidyverse](#intro-tidyverse)

### [Operaciones con filas](#filas)



---

name: intro-tidyverse

# Introducci√≥n a .orange[TIDYVERSE]


.pull-left[

&lt;img src="./img/tidyverrse_universe.jpg" width="89%" style="display: block; margin: auto;" /&gt;

Tambi√©n tenemos los paquetes `{purrr}` y `{lubridate}` para el manejo de **listas** y **fechas**, `{readxl}` para importar archivos **.xls y .xlsx**, `{haven}` para importar archivos **SPSS, Stata y SAS**, `{httr}` para importar **desde web** y `{rvest}` para **web scraping**.


]

.pull-right[

* `{tibble}`: **.bg-purple_light[optimizando data.frame]**.

* `{tidyr}`: **.bg-purple_light[limpiar datos]**.

* `{readr}`: **.bg-purple_light[carga r√°pida]** de datos rectangulares (formatos .csv, .tsv, etc). 

* `{dplyr}`: gram√°tica para **.bg-purple_light[depuraci√≥n de datos]** para facilitar su procesamiento.

* `{stringr}`: manejo de **.bg-purple_light[textos]**. 

* `{forcast}` manejo de **.bg-purple_light[cualitativas]**.

* `{ggplot2}`: una gram√°tica para la **.bg-purple_light[visualizaci√≥n de datos]**.

* `{tidymodels}`: una gram√°tica para la **.bg-purple_light[modelizaci√≥n y predicci√≥n]**.


]


Puedes ver su **documentaci√≥n completa** en &lt;https://www.tidyverse.org/&gt;.


---

# Introducci√≥n a .orange[TIDYVERSE]


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/tidy_flow.jpg" alt="Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de https://r4ds.had.co.nz/wrangle-intro.html" width="75%" /&gt;
&lt;p class="caption"&gt;Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de https://r4ds.had.co.nz/wrangle-intro.html&lt;/p&gt;
&lt;/div&gt;

&amp;nbsp;

El paquete vamos a usar para **.bg-purple_light[depurar los datos]** ser√° el paquete `{dplyr}`, una gram√°tica para la manipulaci√≥n de datos.

---

# Introducci√≥n a .orange[TIDYVERSE]


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/dplyr.png" alt="Cheet sheet de las opciones del paquete dplyr" width="60%" /&gt;
&lt;p class="caption"&gt;Cheet sheet de las opciones del paquete dplyr&lt;/p&gt;
&lt;/div&gt;

El paquete vamos a usar para **.bg-purple_light[depurar los datos]** ser√° el paquete `{dplyr}`, una gram√°tica para la manipulaci√≥n de datos.

---

name: filas

# .orange[FILTRAR] registros: filter()

.pull-left[


```r
datos %&gt;%
  filtro(condicion)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(condicion)
```

]

--

Una de las **operaciones m√°s comunes** es **.bg-purple_light[filtrar registros]** en base a alguna **.bg-purple_light[condici√≥n l√≥gica]**: con `filter()` se seleccionar√°n solo individuos que cumplan ciertas condiciones.

--

&amp;nbsp;

Comparadores habituales:

* `==, !=` igual/distinto que
* `&gt;, &lt;` mayor/menor que
* `&gt;=, &lt;=` mayor/menor o igual que
* `%in%` los valores pertenecen a un listado
* `!is.na()` los valores no son ausentes (mejor usar `drop_na()`)
* `between(variable, val1, val2)`: si los valores (normalmente continuos) est√°n dentro de un rango.

---

# .orange[FILTRAR] registros: filter()

.pull-left[


```r
datos %&gt;%
  filtro(condicion)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(condicion)
```

]

&amp;nbsp;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/tablas_verdad.jpg" alt="Tablas de verdad de operadores l√≥gicos" width="80%" /&gt;
&lt;p class="caption"&gt;Tablas de verdad de operadores l√≥gicos&lt;/p&gt;
&lt;/div&gt;

---

# .orange[FILTRAR] registros: filter()

.pull-left[


```r
datos %&gt;%
  filtro(condicion)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(condicion)
```

]


Por ejemplo, vamos a **filtrar** aquellos personajes con **.bg-purple_light[ojos marrones]**.


```r
starwars %&gt;%
* filter(eye_color == "brown")
```

```
&gt; # A tibble: 21 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  2 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  4 Yoda            66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  5 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt;  6 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt;  7 Arvel Cryn‚Ä¶     NA  NA   brown   fair    brown      NA   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  8 Wicket Sys‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt;  9 Quarsh Pan‚Ä¶    183  NA   black   dark    brown      62   &lt;NA&gt;  &lt;NA&gt;   Naboo  
&gt; 10 Shmi Skywa‚Ä¶    163  NA   black   fair    brown      72   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt; # ‚Ä¶ with 11 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[VISUALIZAR] operaciones con datos


En la web &lt;https://tidydatatutor.com/&gt; podemos visualizar el flujo de datos d las transformaciones que podemos hacer con `dplyr`

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/filter1.jpg" alt="Flujo de https://tidydatatutor.com/" width="90%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[FILTRAR] registros: filter()


De la misma manera podemos **filtrar** los personajes que **.bg-purple_light[no tienen ojos marrones]** (en realidad estamos eliminando filas de alguna manera).



```r
starwars %&gt;%
  filter(eye_color != "brown")
```

```
&gt; # A tibble: 66 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  6 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  7 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  8 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt;  9 Anakin Sky‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Wilhuff Ta‚Ä¶    180    NA auburn‚Ä¶ fair    blue       64   male  mascu‚Ä¶ Eriadu 
&gt; # ‚Ä¶ with 56 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros: filter()



Al ser una variable discreta, ser√≠a bastante l√≥gico comprobar si toma alg√∫n valor **.bg-purple_light[dentro de una lista permitida]**  (por ejemplo, personjes con ojos marrones o azules).



```r
starwars %&gt;%
  filter(eye_color %in% c("brown", "blue"))
```

```
&gt; # A tibble: 40 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  3 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  4 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  5 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  6 Anakin Sky‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Wilhuff Ta‚Ä¶    180    NA auburn‚Ä¶ fair    blue       64   male  mascu‚Ä¶ Eriadu 
&gt;  8 Chewbacca      228   112 brown   unknown blue      200   male  mascu‚Ä¶ Kashyy‚Ä¶
&gt;  9 Han Solo       180    80 brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt; 10 Jek Tono P‚Ä¶    180   110 brown   fair    blue       NA   male  mascu‚Ä¶ Bestin‚Ä¶
&gt; # ‚Ä¶ with 30 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros: filter()

Cuando es una variable continua el inter√©s podr√≠a estar en comprobar si la variable toma valores **.bg-purple_light[dentro de un intervalo continuo]**.


.pull-left[


```r
starwars %&gt;%
  filter(between(height, 120, 160))
```


```
&gt; # A tibble: 5 √ó 4
&gt;   name        height  mass eye_color
&gt;   &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;    
&gt; 1 Leia Organa    150    49 brown    
&gt; 2 Mon Mothma     150    NA blue     
&gt; 3 Nien Nunb      160    68 black    
&gt; 4 Watto          137    NA yellow   
&gt; 5 Gasgano        122    NA black
```

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/filter3.jpg" alt="Flujo de https://tidydatatutor.com/" width="150%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

]


---


# .orange[FILTRAR] registros: filter()


Las condiciones tambi√©n se pueden **.bg-purple_light[concatenar]**, pudiendo en pocas l√≠neas realizar un filtro complejo. Por ejemplo, podemos filtrar los personajes con **.bg-purple_light[ojos marrones Y ADEM√ÅS NO humanos]**, o **.bg-purple_light[con m√°s de 60 a√±os]**.

.pull-left[


```r
starwars %&gt;%
  filter((eye_color == "brown" &amp;
            species != "Human") |
           birth_year &gt; 60)
```

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/filter5.jpg" alt="Flujo de https://tidydatatutor.com/" width="100%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;


]

---

# .orange[FILTRAR] datos ausentes

Podemos tambi√©n **.bg-purple_light[filtrar los registros ausentes]** en alguna de sus variables con `drop_na()`. Si no especificamos, elimina todos los registros que tenga alguno de sus campos ausente.


```r
starwars %&gt;% drop_na()
```

--

Podemos indicarle que nos elimine filas con datos ausentes fij√°ndonos solo en **.bg-purple_light[alguna variable particular]**.


```r
starwars %&gt;% drop_na(mass, height, sex, gender)
```

```
&gt; # A tibble: 58 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 48 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---


# Ejercicios (filtro)

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: selecciona del conjunto de `starwars` solo los personajes que sean humanos (`species == "Human"`)

* üìù **Ejercicio 2**: selecciona del conjunto de `starwars` solo los personajes cuyo peso est√© entre 65 y 90 kg.

* üìù **Ejercicio 3**: selecciona del conjunto de `starwars` los personajes con ojos marrones o rojos.

* üìù **Ejercicio 4**: selecciona del conjunto de `starwars` los personajes no humanos, hombres y que midan m√°s de 170 cm, o los personajes con ojos marrones o rojos.

* üìù **Ejercicio 5**: selecciona aquellos personajes de `starwars` que hayan pilotado m√°s de 2 naves.

]

.panel[.panel-name[Sol. Ej. 1]


```r
starwars %&gt;%
  filter(species == "Human")
```

```
&gt; # A tibble: 35 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  4 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  6 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt;  8 Anakin Sky‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Wilhuff Ta‚Ä¶    180    NA auburn‚Ä¶ fair    blue       64   male  mascu‚Ä¶ Eriadu 
&gt; 10 Han Solo       180    80 brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt; # ‚Ä¶ with 25 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 2]


```r
starwars %&gt;%
  filter(between(mass, 65, 90))
```

```
&gt; # A tibble: 32 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  4 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt;  6 Anakin Sky‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Han Solo       180    80 brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  8 Greedo         173    74 &lt;NA&gt;    green   black      44   male  mascu‚Ä¶ Rodia  
&gt;  9 Wedge Anti‚Ä¶    170    77 brown   fair    hazel      21   male  mascu‚Ä¶ Corell‚Ä¶
&gt; 10 Palpatine      170    75 grey    pale    yellow     82   male  mascu‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 22 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 3]


```r
starwars %&gt;%
  filter(eye_color %in% c("brown", "red"))
```

```
&gt; # A tibble: 26 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 R2-D2           96  32   &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  2 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  3 R5-D4           97  32   &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  4 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  6 Yoda            66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  7 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt;  8 IG-88          200 140   none    metal   red        15   none  mascu‚Ä¶ &lt;NA&gt;   
&gt;  9 Bossk          190 113   none    green   red        53   male  mascu‚Ä¶ Trando‚Ä¶
&gt; 10 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt; # ‚Ä¶ with 16 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 4]


```r
starwars %&gt;%
  filter((species != "Human" &amp; sex == "Male" &amp; height &gt; 170) |
           eye_color %in% c("brown", "red"))
```

```
&gt; # A tibble: 26 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 R2-D2           96  32   &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  2 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  3 R5-D4           97  32   &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  4 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  6 Yoda            66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  7 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt;  8 IG-88          200 140   none    metal   red        15   none  mascu‚Ä¶ &lt;NA&gt;   
&gt;  9 Bossk          190 113   none    green   red        53   male  mascu‚Ä¶ Trando‚Ä¶
&gt; 10 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt; # ‚Ä¶ with 16 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 5]


```r
library(purrr) # ya est√° en tidyverse per por si
starwars$n_starships &lt;- starwars$starships %&gt;% map_int(length)
starwars %&gt;% filter(n_starships &gt; 2)
```

```
&gt; # A tibble: 3 √ó 15
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Obi-Wan Ken‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; 2 Anakin Skyw‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 3 Padm√© Amida‚Ä¶    165    45 brown   light   brown      46   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 5 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, n_starships &lt;int&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```



]

]

---

# Ejercicio extra


Veamos un ejercicio extra para comprobar la **potencia y flexibilidad** de `{tidyverse}`, pudiendo hacer muchas cosas en dos l√≠neas de c√≥digo.

&amp;nbsp;

* üìù **Ejercicio extra**: selecciona aquellos personajes de `starwars` que hayan salido en la pel√≠cula de la saga "El ataque de los clones" (en ingl√©s, "Attack of the Clones"). Busca informaci√≥n de la funci√≥n `str_detect()` del paquete `stringr`. Consejo: prueba antes las funciones que vayas a usar con alg√∫n vector de prueba para poder comprobar su funcionamiento.

---

# .orange[FILTRAR] registros:  slice()


.pull-left[


```r
datos %&gt;%
  rebanada(posicion)
```

]

.pull-right[


```r
starwars %&gt;%
  slice(posicion)
```

]

--

Normalmente filtraremos registros por alguna condici√≥n pero no siempre, a veces nos puede interesar, por ejemplo, sacar las primeras n filas. Para podemos crear **.bg-purple_light[rebanadas de los datos]**, seleccionando filas por su posici√≥n con `slice()`.


```r
*starwars %&gt;% slice(1)
```

```
&gt; # A tibble: 1 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Luke Skywal‚Ä¶    172    77 blond   fair    blue         19 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros:  slice()

.pull-left[


```r
datos %&gt;%
  rebanada(posicion)
```

]

.pull-right[


```r
starwars %&gt;%
  slice(posicion)
```

]


Recuerda que todo lo que podemos hacer con un n√∫mero (vector de longitud 1) podemos hacerlo con un vector de √≠ndices, as√≠ que podemos **.bg-purple_light[extraer varias rebanadas]**, a la vez.


```r
# filas de la 1 a la 5
starwars %&gt;% slice(1:5)
```

```
&gt; # A tibble: 5 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Luke Skywal‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 2 C-3PO           167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 3 R2-D2            96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt; 4 Darth Vader     202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 5 Leia Organa     150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros:  slice()

Tambi√©n podr√≠amos usar una **.bg-purple_light[secuencia de √≠ndices]** a extraer.


```r
# filas 1, 2, 10, 13, 27
starwars %&gt;% slice(c(1, 2, 10, 13, 27))
```

```
&gt; # A tibble: 5 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Luke Skywal‚Ä¶    172    77 blond   fair    blue         19 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 2 C-3PO           167    75 &lt;NA&gt;    gold    yellow      112 none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 3 Obi-Wan Ken‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶      57 male  mascu‚Ä¶ Stewjon
&gt; 4 Chewbacca       228   112 brown   unknown blue        200 male  mascu‚Ä¶ Kashyy‚Ä¶
&gt; 5 Mon Mothma      150    NA auburn  fair    blue         48 fema‚Ä¶ femin‚Ä¶ Chandr‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```


---

# .orange[FILTRAR] registros:  slice()


Disponemos adem√°s de opciones por defecto de operaciones habituales

* `slice_head(n = ...)`: extraer las n **.bg-purple_light[primeras filas]**.



```r
# las 2 primeras filas
starwars %&gt;% slice_head(n = 2)
```

```
&gt; # A tibble: 2 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Luke Skywal‚Ä¶    172    77 blond   fair    blue         19 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 2 C-3PO           167    75 &lt;NA&gt;    gold    yellow      112 none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---


# .orange[FILTRAR] registros:  slice()

* `slice_tail(n = ...)`: extraer las n **.bg-purple_light[√∫ltimas filas]**.


```r
# los 3 √∫ltimas filas
starwars %&gt;% slice_tail(n = 3) 
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 BB8              NA    NA none    none    black        NA none  mascu‚Ä¶ &lt;NA&gt;   
&gt; 2 Captain Pha‚Ä¶     NA    NA unknown unknown unknown      NA &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   
&gt; 3 Padm√© Amida‚Ä¶    165    45 brown   light   brown        46 fema‚Ä¶ femin‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros:  slice()

* `slice_sample(n = ...)`: extraer n **.bg-purple_light[registros aleatoriamente]** (a priori equiprobables). Podemos indicar el n√∫mero o la proporci√≥n




```r
# 3 registros aleatorios
starwars %&gt;% slice_sample(n = 3)
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Captain Pha‚Ä¶     NA    NA unknown unknown unknown      NA &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   
&gt; 2 Nute Gunray     191    90 none    mottle‚Ä¶ red          NA male  mascu‚Ä¶ Cato N‚Ä¶
&gt; 3 C-3PO           167    75 &lt;NA&gt;    gold    yellow      112 none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros:  slice()

* `slice_sample(n = ...)`: extraer n **.bg-purple_light[registros aleatoriamente]** (a priori equiprobables). Podemos indicar el n√∫mero o la proporci√≥n



```r
# 2.5% de los datos
starwars %&gt;% slice_sample(prop = 0.025)
```

```
&gt; # A tibble: 2 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Wedge Antil‚Ä¶    170  77   brown   fair    hazel        21 male  mascu‚Ä¶ Corell‚Ä¶
&gt; 2 Luminara Un‚Ä¶    170  56.2 black   yellow  blue         58 fema‚Ä¶ femin‚Ä¶ Mirial 
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

---

# .orange[FILTRAR] registros:  slice()

En `slice_sample(n = ...)` podemos incluso pasarlo un vector de probabilidades. Vamos a forzar que sea muy improbable sacar una fila que no sean las dos primeras


```r
starwars %&gt;% slice_sample(n = 2, weight_by = c(0.495, 0.495, rep(0.01/85, 85)))
```


```
&gt; # A tibble: 2 √ó 9
&gt;   name           height  mass hair_color skin_color eye_c‚Ä¶¬π birth‚Ä¶¬≤ sex   gender
&gt;   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
&gt; 1 Luke Skywalker    172    77 blond      fair       blue         19 male  mascu‚Ä¶
&gt; 2 C-3PO             167    75 &lt;NA&gt;       gold       yellow      112 none  mascu‚Ä¶
&gt; # ‚Ä¶ with abbreviated variable names ¬π‚Äãeye_color, ¬≤‚Äãbirth_year
```


```r
starwars %&gt;% slice_sample(n = 2, weight_by = c(0.495, 0.495, rep(0.01/85, 85)))
```


```
&gt; # A tibble: 2 √ó 9
&gt;   name           height  mass hair_color skin_color eye_c‚Ä¶¬π birth‚Ä¶¬≤ sex   gender
&gt;   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
&gt; 1 Luke Skywalker    172    77 blond      fair       blue         19 male  mascu‚Ä¶
&gt; 2 C-3PO             167    75 &lt;NA&gt;       gold       yellow      112 none  mascu‚Ä¶
&gt; # ‚Ä¶ with abbreviated variable names ¬π‚Äãeye_color, ¬≤‚Äãbirth_year
```

---


# .orange[FILTRAR] registros: slice()


* `slice_min(var, n = ...)` y `slice_max(var, n = ...)`: extrae las n filas con **.bg-purple_light[menor/mayor de una variable]** (si hay empate, mostrar√° todas salvo que `with_ties = FALSE`). 

.pull-left[


```r
# los 3 m√°s bajitos
starwars %&gt;% slice_min(height, n = 3) 
```


```
&gt; # A tibble: 3 √ó 4
&gt;   name                  height  mass hair_color
&gt;   &lt;chr&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     
&gt; 1 Yoda                      66    17 white     
&gt; 2 Ratts Tyerell             79    15 none      
&gt; 3 Wicket Systri Warrick     88    20 brown
```

]

.pull-right[


```r
# los 3 m√°s pesados
starwars %&gt;% slice_max(mass, n = 3) 
```


```
&gt; # A tibble: 3 √ó 4
&gt;   name                  height  mass hair_color
&gt;   &lt;chr&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     
&gt; 1 Jabba Desilijic Tiure    175  1358 &lt;NA&gt;      
&gt; 2 Grievous                 216   159 none      
&gt; 3 IG-88                    200   140 none
```

]

---

# .orange[REORDENAR] filas: rearrange()

.pull-left[


```r
datos %&gt;%
  ordeno(var1, desc(var2))
```

]

.pull-right[


```r
starwars %&gt;%
  arrange(var1, desc(var2))
```

]

--

Otra operaci√≥n ser√° **.bg-purple_light[ordenar filas]** con `arrange()`, pas√°ndole las variables que usaremos para la ordenaci√≥n (por defecto de menor a mayor, podemos invertirlo usando `desc()`. Por ejemplo, vamos a **ordenar** por altura, de bajitos a altos, y en caso de empate, por peso (pero al rev√©s, de pesados a ligeros).




```r
starwars %&gt;% arrange(height, desc(mass))
```

```
&gt; # A tibble: 87 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Yoda            66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  2 Ratts Tyer‚Ä¶     79    15 none    grey, ‚Ä¶ unknown      NA male  mascu‚Ä¶ Aleen ‚Ä¶
&gt;  3 Wicket Sys‚Ä¶     88    20 brown   brown   brown         8 male  mascu‚Ä¶ Endor  
&gt;  4 Dud Bolt        94    45 none    blue, ‚Ä¶ yellow       NA male  mascu‚Ä¶ Vulpter
&gt;  5 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red          33 none  mascu‚Ä¶ Naboo  
&gt;  6 R4-P17          96    NA none    silver‚Ä¶ red, b‚Ä¶      NA none  femin‚Ä¶ &lt;NA&gt;   
&gt;  7 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red          NA none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  8 Sebulba        112    40 none    grey, ‚Ä¶ orange       NA male  mascu‚Ä¶ Malast‚Ä¶
&gt;  9 Gasgano        122    NA none    white,‚Ä¶ black        NA male  mascu‚Ä¶ Troiken
&gt; 10 Watto          137    NA black   blue, ‚Ä¶ yellow       NA male  mascu‚Ä¶ Toydar‚Ä¶
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[ELIMINAR] duplicados: distinct()

Otra opci√≥n es **.bg-purple_light[eliminar filas duplicadas]** con `distinct()`, pas√°ndole como argumentos las variables. Por defecto, solo extrae las columnas en base a las cuales hemos eliminado duplicados. Si queremos que nos **mantenga todas** deberemos explicitarlo con `.keep_all = TRUE`.

.pull-left[


```r
# Elimina filas con igual (color_pelo, color_ojos)
starwars %&gt;% distinct(hair_color, eye_color)
```

```
&gt; # A tibble: 35 √ó 2
&gt;    hair_color    eye_color
&gt;    &lt;chr&gt;         &lt;chr&gt;    
&gt;  1 blond         blue     
&gt;  2 &lt;NA&gt;          yellow   
&gt;  3 &lt;NA&gt;          red      
&gt;  4 none          yellow   
&gt;  5 brown         brown    
&gt;  6 brown, grey   blue     
&gt;  7 brown         blue     
&gt;  8 black         brown    
&gt;  9 auburn, white blue-gray
&gt; 10 auburn, grey  blue     
&gt; # ‚Ä¶ with 25 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.pull-left[


```r
# Elimina filas con igual (color_pelo, color_ojos)
starwars %&gt;% distinct(hair_color, eye_color, .keep_all = TRUE)
```

```
&gt; # A tibble: 35 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; 10 Wilhuff Ta‚Ä¶    180    NA auburn‚Ä¶ fair    blue       64   male  mascu‚Ä¶ Eriadu 
&gt; # ‚Ä¶ with 25 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]
  
---

# .orange[A√ëADIR] filas: bind_rows()

Si quisi√©ramos **.bg-purple_light[a√±adir un nuevo registro]** manualmente, podremos hacerlo con `bind_rows()`, asegur√°ndonos que las **variables en el nuevo registro son las mismas** que en el original. Por ejemplo, vamos a a√±adir al fichero original los 3 primeros registros (al final).


```r
starwars_nuevo &lt;- bind_rows(starwars, starwars %&gt;% slice(1:3))
dim(starwars)
```

```
&gt; [1] 87 14
```

```r
dim(starwars_nuevo)
```

```
&gt; [1] 90 14
```

---

# .orange[OPERACIONES] por filas

Con **.bg-purple_light[pocas l√≠neas de c√≥digo]** podemos manipular √°gilmente los registros de nuestros datos, de una manera **.bg-purple_light[muy literal]**

.pull-left[


```r
datos %&gt;%
* filtro(peso &lt; 200 y ojos marrones)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(mass &lt; 200 &amp;
*          eye_color == "brown")
```

```
&gt; # A tibble: 13 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  2 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  4 Yoda            66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  5 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt;  6 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt;  7 Wicket Sys‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt;  8 Mace Windu     188  84   none    dark    brown      72   male  mascu‚Ä¶ Haruun‚Ä¶
&gt;  9 Gregar Typ‚Ä¶    185  85   black   dark    brown      NA   male  mascu‚Ä¶ Naboo  
&gt; 10 Dooku          193  80   white   fair    brown     102   male  mascu‚Ä¶ Serenno
&gt; 11 Jango Fett     183  79   black   tan     brown      66   male  mascu‚Ä¶ Concor‚Ä¶
&gt; 12 Raymus Ant‚Ä¶    188  79   brown   light   brown      NA   male  mascu‚Ä¶ Aldera‚Ä¶
&gt; 13 Padm√© Amid‚Ä¶    165  45   brown   light   brown      46   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]

---

# .orange[OPERACIONES] por filas

Con **.bg-purple_light[pocas l√≠neas de c√≥digo]** podemos manipular √°gilmente los registros de nuestros datos, de una manera **.bg-purple_light[muy literal]**

.pull-left[


```r
datos %&gt;%
  filtro(peso &lt; 200 y ojos marrones) %&gt;% 
* quito_na(estatura y peso)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(mass &lt; 200 &amp;
           eye_color == "brown") %&gt;% 
* drop_na(mass, height)
```

```
&gt; # A tibble: 13 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  2 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  4 Yoda            66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  5 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt;  6 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt;  7 Wicket Sys‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt;  8 Mace Windu     188  84   none    dark    brown      72   male  mascu‚Ä¶ Haruun‚Ä¶
&gt;  9 Gregar Typ‚Ä¶    185  85   black   dark    brown      NA   male  mascu‚Ä¶ Naboo  
&gt; 10 Dooku          193  80   white   fair    brown     102   male  mascu‚Ä¶ Serenno
&gt; 11 Jango Fett     183  79   black   tan     brown      66   male  mascu‚Ä¶ Concor‚Ä¶
&gt; 12 Raymus Ant‚Ä¶    188  79   brown   light   brown      NA   male  mascu‚Ä¶ Aldera‚Ä¶
&gt; 13 Padm√© Amid‚Ä¶    165  45   brown   light   brown      46   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]

---

# .orange[OPERACIONES] por filas

Con **.bg-purple_light[pocas l√≠neas de c√≥digo]** podemos manipular √°gilmente los registros de nuestros datos, de una manera **.bg-purple_light[muy literal]**

.pull-left[


```r
datos %&gt;%
  filtro(peso &lt; 200 y ojos marrones) %&gt;% 
  quito_na(estatura y peso) %&gt;%
* rebanada(7 primeras filas)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(mass &lt; 200 &amp;
           eye_color == "brown") %&gt;% 
  drop_na(mass, height) %&gt;%
* slice(1:7)
```

```
&gt; # A tibble: 7 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Leia Organa     150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt; 2 Biggs Darkl‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 3 Han Solo        180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt; 4 Yoda             66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 5 Boba Fett       183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt; 6 Lando Calri‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt; 7 Wicket Syst‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]


---

# .orange[OPERACIONES] por filas

Con **.bg-purple_light[pocas l√≠neas de c√≥digo]** podemos manipular √°gilmente los registros de nuestros datos, de una manera **.bg-purple_light[muy literal]**

.pull-left[


```r
datos %&gt;%
  filtro(peso &lt; 200 y ojos marrones) %&gt;% 
  quito_na(estatura y peso) %&gt;%
  rebanada(7 primeras filas) %&gt;%
* ordeno(peso, si empate pesados 1¬∫)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(mass &lt; 200 &amp;
           eye_color == "brown") %&gt;% 
  drop_na(mass, height) %&gt;%
  slice(1:7) %&gt;%
* arrange(height, desc(mass))
```

```
&gt; # A tibble: 7 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Yoda             66  17   white   green   brown     896   male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 2 Wicket Syst‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt; 3 Leia Organa     150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt; 4 Lando Calri‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt; 5 Han Solo        180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt; 6 Biggs Darkl‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 7 Boba Fett       183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]


---

# .orange[OPERACIONES] por filas

Con **.bg-purple_light[pocas l√≠neas de c√≥digo]** podemos manipular √°gilmente los registros de nuestros datos, de una manera **.bg-purple_light[muy literal]**

.pull-left[


```r
datos %&gt;%
  filtro(peso &lt; 200 y ojos marrones) %&gt;% 
  quito_na(estatura y peso) %&gt;%
  rebanada(7 primeras filas) %&gt;%
  ordeno(peso, si empate pesados 1¬∫) %&gt;%
* quito_duplicados(color de piel)
```

]

.pull-right[


```r
starwars %&gt;%
  filter(mass &lt; 200 &amp;
           eye_color == "brown") %&gt;% 
  drop_na(mass, height) %&gt;%
  slice(1:7) %&gt;%
  arrange(height, desc(mass)) %&gt;%
  distinct(skin_color,
*          .keep_all = TRUE)
```

```
&gt; # A tibble: 5 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Yoda             66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 2 Wicket Syst‚Ä¶     88    20 brown   brown   brown         8 male  mascu‚Ä¶ Endor  
&gt; 3 Leia Organa     150    49 brown   light   brown        19 fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt; 4 Lando Calri‚Ä¶    177    79 black   dark    brown        31 male  mascu‚Ä¶ Socorro
&gt; 5 Han Solo        180    80 brown   fair    brown        29 male  mascu‚Ä¶ Corell‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]

---



# Ejercicios (filas)

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: selecciona solo los personajes que sean humanos y de ojos marrones, para despu√©s ordernarlos en altura descendente y peso ascendente.

* üìù **Ejercicio 2**:  extrae 3 registros aleatoriamente. Vuelve a hacerlo para comprobar que salen diferentes.

* üìù **Ejercicio 3**:  extrae el 10% de los registros aleatoriamente.

* üìù **Ejercicio 4**: selecciona los 3 personajes m√°s mayores y los 3 personajes m√°s bajitos.

* üìù **Ejercicio 5**: para saber que valores √∫nicos hay en el color de pelo, elimina duplicados por dicha variable `hair_color`, eliminando antes los ausentes de dicha variable.


]

.panel[.panel-name[Sol. Ej. 1]


```r
# Podemos combinar varias acciones en pocas l√≠neas
starwars %&gt;%
  filter(eye_color == "brown",
         species == "Human") %&gt;%
  arrange(height, desc(mass))
```

```
&gt; # A tibble: 17 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  2 Cord√©          157  NA   brown   light   brown      NA   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt;  3 Shmi Skywa‚Ä¶    163  NA   black   fair    brown      72   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  4 Padm√© Amid‚Ä¶    165  45   brown   light   brown      46   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt;  5 Dorm√©          165  NA   brown   light   brown      NA   fema‚Ä¶ femin‚Ä¶ Naboo  
&gt;  6 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt;  7 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  8 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Jango Fett     183  79   black   tan     brown      66   male  mascu‚Ä¶ Concor‚Ä¶
&gt; 10 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt; 11 Gregar Typ‚Ä¶    185  85   black   dark    brown      NA   male  mascu‚Ä¶ Naboo  
&gt; 12 Mace Windu     188  84   none    dark    brown      72   male  mascu‚Ä¶ Haruun‚Ä¶
&gt; 13 Raymus Ant‚Ä¶    188  79   brown   light   brown      NA   male  mascu‚Ä¶ Aldera‚Ä¶
&gt; 14 Bail Prest‚Ä¶    191  NA   black   tan     brown      67   male  mascu‚Ä¶ Aldera‚Ä¶
&gt; 15 Dooku          193  80   white   fair    brown     102   male  mascu‚Ä¶ Serenno
&gt; 16 Arvel Cryn‚Ä¶     NA  NA   brown   fair    brown      NA   male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 17 Poe Dameron     NA  NA   brown   light   brown      NA   male  mascu‚Ä¶ &lt;NA&gt;   
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 2]


```r
starwars %&gt;%
  slice_sample(n = 3)
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name       height  mass hair_co‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Tarfful       234   136 brown     brown   blue         NA male  mascu‚Ä¶ Kashyy‚Ä¶
&gt; 2 Kit Fisto     196    87 none      green   black        NA male  mascu‚Ä¶ Glee A‚Ä¶
&gt; 3 Rugor Nass    206    NA none      green   orange       NA male  mascu‚Ä¶ Naboo  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```


```r
starwars %&gt;%
  slice_sample(n = 3)
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Luke Skywal‚Ä¶    172    77 blond   fair    blue         19 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 2 Taun We         213    NA none    grey    black        NA fema‚Ä¶ femin‚Ä¶ Kamino 
&gt; 3 Beru Whites‚Ä¶    165    75 brown   light   blue         47 fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```


]

.panel[.panel-name[Sol. Ej. 3]


```r
starwars %&gt;%
  slice_sample(prop = 0.1)
```

```
&gt; # A tibble: 8 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Greedo          173    74 &lt;NA&gt;    green   black        44 male  mascu‚Ä¶ Rodia  
&gt; 2 Jango Fett      183    79 black   tan     brown        66 male  mascu‚Ä¶ Concor‚Ä¶
&gt; 3 Tarfful         234   136 brown   brown   blue         NA male  mascu‚Ä¶ Kashyy‚Ä¶
&gt; 4 Wicket Syst‚Ä¶     88    20 brown   brown   brown         8 male  mascu‚Ä¶ Endor  
&gt; 5 R5-D4            97    32 &lt;NA&gt;    white,‚Ä¶ red          NA none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 6 Captain Pha‚Ä¶     NA    NA unknown unknown unknown      NA &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   
&gt; 7 Han Solo        180    80 brown   fair    brown        29 male  mascu‚Ä¶ Corell‚Ä¶
&gt; 8 Wilhuff Tar‚Ä¶    180    NA auburn‚Ä¶ fair    blue         64 male  mascu‚Ä¶ Eriadu 
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 4]



```r
starwars %&gt;%
  slice_max(birth_year, n = 3)
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Yoda             66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 2 Jabba Desil‚Ä¶    175  1358 &lt;NA&gt;    green-‚Ä¶ orange      600 herm‚Ä¶ mascu‚Ä¶ Nal Hu‚Ä¶
&gt; 3 Chewbacca       228   112 brown   unknown blue        200 male  mascu‚Ä¶ Kashyy‚Ä¶
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```


```r
starwars %&gt;%
  slice_min(height, n = 3)
```

```
&gt; # A tibble: 3 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Yoda             66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 2 Ratts Tyere‚Ä¶     79    15 none    grey, ‚Ä¶ unknown      NA male  mascu‚Ä¶ Aleen ‚Ä¶
&gt; 3 Wicket Syst‚Ä¶     88    20 brown   brown   brown         8 male  mascu‚Ä¶ Endor  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```
]

.panel[.panel-name[Sol. Ej. 5]



```r
starwars %&gt;%
  drop_na(hair_color) %&gt;%
  distinct(hair_color)
```

```
&gt; # A tibble: 12 √ó 1
&gt;    hair_color   
&gt;    &lt;chr&gt;        
&gt;  1 blond        
&gt;  2 none         
&gt;  3 brown        
&gt;  4 brown, grey  
&gt;  5 black        
&gt;  6 auburn, white
&gt;  7 auburn, grey 
&gt;  8 white        
&gt;  9 grey         
&gt; 10 auburn       
&gt; 11 blonde       
&gt; 12 unknown
```

]

]

---

# Ejercicio extra


Veamos un ejercicio extra para comprobar la **potencia y flexibilidad** de `{tidyverse}`, pudiendo hacer muchas cosas en dos l√≠neas de c√≥digo.

&amp;nbsp;

* üìù **Ejercicio extra**: de los personajes que son humanos y miden m√°s de 160 cm, elimina duplicados en color de ojos, elimina ausentes en peso, selecciona los 5 m√°s altos, y orden de mayor a menor peso. Devuelve la tabla.


---


class: inverse center middle
name: clase-9

# CLASE 9: operaciones con columnas y res√∫menes estad√≠sticos (tidyverse)

&amp;nbsp;

### [Operaciones con columnas](#columnas)

### [Modificar columnas](#mutate)

### [Agrupar + contar](#count)

### [Res√∫menes estad√≠sticos](#summarise)


---

name: columnas

# .orange[SELECCIONAR] columnas:  select()

.pull-left[


```r
datos %&gt;%
  selecciono(col1, col2, ...)
```

]

.pull-right[


```r
starwars %&gt;%
  select(col1, col2, ...)
```

]

--

La opci√≥n m√°s sencilla para **.bg-purple_light[seleccionar variables]** es `select()`, dando como argumentos los nombres de columnas. Por ejemplo, vamos a seleccionar las variables `names` y `hair_color`


```r
starwars %&gt;%
* select(name, hair_color)
```

```
&gt; # A tibble: 87 √ó 2
&gt;    name               hair_color   
&gt;    &lt;chr&gt;              &lt;chr&gt;        
&gt;  1 Luke Skywalker     blond        
&gt;  2 C-3PO              &lt;NA&gt;         
&gt;  3 R2-D2              &lt;NA&gt;         
&gt;  4 Darth Vader        none         
&gt;  5 Leia Organa        brown        
&gt;  6 Owen Lars          brown, grey  
&gt;  7 Beru Whitesun lars brown        
&gt;  8 R5-D4              &lt;NA&gt;         
&gt;  9 Biggs Darklighter  black        
&gt; 10 Obi-Wan Kenobi     auburn, white
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```


---

# .orange[SELECCIONAR] columnas:  select()

.pull-left[


```r
starwars %&gt;% select(name, hair_color)
```

```
&gt; # A tibble: 87 √ó 2
&gt;    name               hair_color   
&gt;    &lt;chr&gt;              &lt;chr&gt;        
&gt;  1 Luke Skywalker     blond        
&gt;  2 C-3PO              &lt;NA&gt;         
&gt;  3 R2-D2              &lt;NA&gt;         
&gt;  4 Darth Vader        none         
&gt;  5 Leia Organa        brown        
&gt;  6 Owen Lars          brown, grey  
&gt;  7 Beru Whitesun lars brown        
&gt;  8 R5-D4              &lt;NA&gt;         
&gt;  9 Biggs Darklighter  black        
&gt; 10 Obi-Wan Kenobi     auburn, white
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/select1.jpg" alt="Flujo de https://tidydatatutor.com/" width="140%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[SELECCIONAR] columnas:  select()


Como suced√≠a al filtrar, la funci√≥n `select()` es bastante versatil y nos permite:

* Seleccionar **.bg-purple_light[varias variables a la vez]** (concatenando sus nombres).


```r
starwars %&gt;% select(name:skin_color)
```

```
&gt; # A tibble: 87 √ó 5
&gt;    name               height  mass hair_color    skin_color 
&gt;    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      
&gt;  1 Luke Skywalker        172    77 blond         fair       
&gt;  2 C-3PO                 167    75 &lt;NA&gt;          gold       
&gt;  3 R2-D2                  96    32 &lt;NA&gt;          white, blue
&gt;  4 Darth Vader           202   136 none          white      
&gt;  5 Leia Organa           150    49 brown         light      
&gt;  6 Owen Lars             178   120 brown, grey   light      
&gt;  7 Beru Whitesun lars    165    75 brown         light      
&gt;  8 R5-D4                  97    32 &lt;NA&gt;          white, red 
&gt;  9 Biggs Darklighter     183    84 black         light      
&gt; 10 Obi-Wan Kenobi        182    77 auburn, white fair       
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# .orange[SELECCIONAR] columnas:  select()

* **.bg-purple_light[Deseleccionar]** columnas con `-`


```r
starwars %&gt;% select(-c(mass:eye_color), -species, -c(films:starships))
```

```
&gt; # A tibble: 87 √ó 6
&gt;    name               height birth_year sex    gender    homeworld
&gt;    &lt;chr&gt;               &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;    
&gt;  1 Luke Skywalker        172       19   male   masculine Tatooine 
&gt;  2 C-3PO                 167      112   none   masculine Tatooine 
&gt;  3 R2-D2                  96       33   none   masculine Naboo    
&gt;  4 Darth Vader           202       41.9 male   masculine Tatooine 
&gt;  5 Leia Organa           150       19   female feminine  Alderaan 
&gt;  6 Owen Lars             178       52   male   masculine Tatooine 
&gt;  7 Beru Whitesun lars    165       47   female feminine  Tatooine 
&gt;  8 R5-D4                  97       NA   none   masculine Tatooine 
&gt;  9 Biggs Darklighter     183       24   male   masculine Tatooine 
&gt; 10 Obi-Wan Kenobi        182       57   male   masculine Stewjon  
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# .orange[SELECCIONAR] columnas:  select()


* Seleccionar columnas que **.bg-purple_light[comiencen por un prefijo]** (`starts_with()`), **.bg-purple_light[terminen]** con un sufijo (`ends_with()`), **.bg-purple_light[contengan]** un texto (`contains()`) o cumplan una **.bg-purple_light[expresi√≥n regular]** (`matches()`)



```r
# nombre acaba en "color"
starwars %&gt;% select(ends_with("color"))
```

```
&gt; # A tibble: 87 √ó 3
&gt;    hair_color    skin_color  eye_color
&gt;    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
&gt;  1 blond         fair        blue     
&gt;  2 &lt;NA&gt;          gold        yellow   
&gt;  3 &lt;NA&gt;          white, blue red      
&gt;  4 none          white       yellow   
&gt;  5 brown         light       brown    
&gt;  6 brown, grey   light       blue     
&gt;  7 brown         light       blue     
&gt;  8 &lt;NA&gt;          white, red  red      
&gt;  9 black         light       brown    
&gt; 10 auburn, white fair        blue-gray
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# .orange[SELECCIONAR] columnas:  select()


* Seleccionar columnas que **.bg-purple_light[comiencen por un prefijo]** (`starts_with()`), **.bg-purple_light[terminen]** con un sufijo (`ends_with()`), **.bg-purple_light[contengan]** un texto (`contains()`) o cumplan una **.bg-purple_light[expresi√≥n regular]** (`matches()`)


```r
# empiezan por new_sp
who %&gt;% select(country, year, starts_with("new_sp"))
```

```
&gt; # A tibble: 7,240 √ó 16
&gt;    country  year new_s‚Ä¶¬π new_s‚Ä¶¬≤ new_s‚Ä¶¬≥ new_s‚Ä¶‚Å¥ new_s‚Ä¶‚Åµ new_s‚Ä¶‚Å∂ new_s‚Ä¶‚Å∑ new_s‚Ä¶‚Å∏
&gt;    &lt;chr&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
&gt;  1 Afghan‚Ä¶  1980      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  2 Afghan‚Ä¶  1981      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  3 Afghan‚Ä¶  1982      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  4 Afghan‚Ä¶  1983      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  5 Afghan‚Ä¶  1984      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  6 Afghan‚Ä¶  1985      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  7 Afghan‚Ä¶  1986      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  8 Afghan‚Ä¶  1987      NA      NA      NA      NA      NA      NA      NA      NA
&gt;  9 Afghan‚Ä¶  1988      NA      NA      NA      NA      NA      NA      NA      NA
&gt; 10 Afghan‚Ä¶  1989      NA      NA      NA      NA      NA      NA      NA      NA
&gt; # ‚Ä¶ with 7,230 more rows, 6 more variables: new_sp_f1524 &lt;int&gt;,
&gt; #   new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;,
&gt; #   new_sp_f5564 &lt;int&gt;, new_sp_f65 &lt;int&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãnew_sp_m014, ¬≤‚Äãnew_sp_m1524, ¬≥‚Äãnew_sp_m2534, ‚Å¥‚Äãnew_sp_m3544, ‚Åµ‚Äãnew_sp_m4554,
&gt; #   ‚Å∂‚Äãnew_sp_m5564, ‚Å∑‚Äãnew_sp_m65, ‚Å∏‚Äãnew_sp_f014
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[SELECCIONAR] columnas:  select()


* Seleccionar columnas que **.bg-purple_light[comiencen por un prefijo]** (`starts_with()`), **.bg-purple_light[terminen]** con un sufijo (`ends_with()`), **.bg-purple_light[contengan]** un texto (`contains()`) o cumplan una **.bg-purple_light[expresi√≥n regular]** (`matches()`)


```r
tb &lt;- tibble("edad" = c(30, 35, 40),
             "color_ojos" = c("azul", "amarillo", "negro"),
             "pelo_color" = c("negro", "marr√≥n", "rubio"))
tb %&gt;% select(contains("color"))
```

```
&gt; # A tibble: 3 √ó 2
&gt;   color_ojos pelo_color
&gt;   &lt;chr&gt;      &lt;chr&gt;     
&gt; 1 azul       negro     
&gt; 2 amarillo   marr√≥n    
&gt; 3 negro      rubio
```


---

# .orange[SELECCIONAR] columnas:  select()

Incluso podemos seleccionar por rango num√©rico si tenemos variables conun prefijo y n√∫meros.


```r
billboard %&gt;% select(num_range("wk", 10:15))
```

```
&gt; # A tibble: 317 √ó 6
&gt;     wk10  wk11  wk12  wk13  wk14  wk15
&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
&gt;  1    NA    NA    NA    NA    NA    NA
&gt;  2    NA    NA    NA    NA    NA    NA
&gt;  3    51    51    51    47    44    38
&gt;  4    61    61    59    61    66    72
&gt;  5    57    64    70    75    76    78
&gt;  6     6     7    22    29    36    47
&gt;  7    NA    NA    NA    NA    NA    NA
&gt;  8    36    37    37    38    49    61
&gt;  9    10     9     8     6     1     2
&gt; 10    59    66    68    61    67    59
&gt; # ‚Ä¶ with 307 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# .orange[SELECCIONAR] columnas:  select()

* Seleccionar columnas de un **.bg-purple_light[tipo]** haciendo uso de `where()`.



```r
# Solo columnas num√©ricas o de trexto
starwars %&gt;% select(where(is.numeric) | where(is.character))
```

```
&gt; # A tibble: 87 √ó 11
&gt;    height  mass birth_year name     hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ sex   gender homew‚Ä¶‚Å¥
&gt;     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1    172    77       19   Luke Sk‚Ä¶ blond   fair    blue    male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2    167    75      112   C-3PO    &lt;NA&gt;    gold    yellow  none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3     96    32       33   R2-D2    &lt;NA&gt;    white,‚Ä¶ red     none  mascu‚Ä¶ Naboo  
&gt;  4    202   136       41.9 Darth V‚Ä¶ none    white   yellow  male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5    150    49       19   Leia Or‚Ä¶ brown   light   brown   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6    178   120       52   Owen La‚Ä¶ brown,‚Ä¶ light   blue    male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7    165    75       47   Beru Wh‚Ä¶ brown   light   blue    fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8     97    32       NA   R5-D4    &lt;NA&gt;    white,‚Ä¶ red     none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9    183    84       24   Biggs D‚Ä¶ black   light   brown   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10    182    77       57   Obi-Wan‚Ä¶ auburn‚Ä¶ fair    blue-g‚Ä¶ male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 1 more variable: species &lt;chr&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[RECOLOCAR] columnas: relocate()

F√≠jate que con `select()` podr√≠as adem√°s **.bg-purple_light[recolocar columnas]**, ind√≠candole el orden, ayud√°ndote tambi√©n de `everything()`


```r
starwars %&gt;%  select(c(species, name, birth_year, everything()))
```

```
&gt; # A tibble: 87 √ó 14
&gt;    species name        birth‚Ä¶¬π height  mass hair_‚Ä¶¬≤ skin_‚Ä¶¬≥ eye_c‚Ä¶‚Å¥ sex   gender
&gt;    &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; 
&gt;  1 Human   Luke Skywa‚Ä¶    19      172    77 blond   fair    blue    male  mascu‚Ä¶
&gt;  2 Droid   C-3PO         112      167    75 &lt;NA&gt;    gold    yellow  none  mascu‚Ä¶
&gt;  3 Droid   R2-D2          33       96    32 &lt;NA&gt;    white,‚Ä¶ red     none  mascu‚Ä¶
&gt;  4 Human   Darth Vader    41.9    202   136 none    white   yellow  male  mascu‚Ä¶
&gt;  5 Human   Leia Organa    19      150    49 brown   light   brown   fema‚Ä¶ femin‚Ä¶
&gt;  6 Human   Owen Lars      52      178   120 brown,‚Ä¶ light   blue    male  mascu‚Ä¶
&gt;  7 Human   Beru White‚Ä¶    47      165    75 brown   light   blue    fema‚Ä¶ femin‚Ä¶
&gt;  8 Droid   R5-D4          NA       97    32 &lt;NA&gt;    white,‚Ä¶ red     none  mascu‚Ä¶
&gt;  9 Human   Biggs Dark‚Ä¶    24      183    84 black   light   brown   male  mascu‚Ä¶
&gt; 10 Human   Obi-Wan Ke‚Ä¶    57      182    77 auburn‚Ä¶ fair    blue-g‚Ä¶ male  mascu‚Ä¶
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: homeworld &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãbirth_year, ¬≤‚Äãhair_color, ¬≥‚Äãskin_color, ‚Å¥‚Äãeye_color
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[RECOLOCAR] columnas: relocate()


.pull-left[


```r
datos %&gt;% 
  recolocar(col1, col2, .after = ...)
```

]

.pull-right[


```r
starwars %&gt;% 
  relocate(col1, col2, .after = ...)
```

]

--

Para facilitar la **.bg-purple_light[recolocaci√≥n]** tenemos una funci√≥n para ello, `relocate()`,  indic√°ndole en `.after` o `.before` detr√°s o delante de qu√© columnas queremos moverlas.


```r
starwars %&gt;% relocate(species, .before = name)
```

```
&gt; # A tibble: 87 √ó 14
&gt;    species name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender
&gt;    &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
&gt;  1 Human   Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶
&gt;  2 Droid   C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶
&gt;  3 Droid   R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶
&gt;  4 Human   Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶
&gt;  5 Human   Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶
&gt;  6 Human   Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶
&gt;  7 Human   Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶
&gt;  8 Droid   R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶
&gt;  9 Human   Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶
&gt; 10 Human   Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: homeworld &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[EXTRAER] columnas: pull()


.pull-left[


```r
datos %&gt;% 
  retirar(variable)
```

]

.pull-right[


```r
starwars %&gt;% 
  pull(variable)
```

]

--

.pull-left[

Si observas la salida de los `select()`, sigue siendo una tabla `tibble`, nos preserva la naturaleza de nuestros datos.


```r
starwars %&gt;% select(name)
```

```
&gt; # A tibble: 87 √ó 1
&gt;    name              
&gt;    &lt;chr&gt;             
&gt;  1 Luke Skywalker    
&gt;  2 C-3PO             
&gt;  3 R2-D2             
&gt;  4 Darth Vader       
&gt;  5 Leia Organa       
&gt;  6 Owen Lars         
&gt;  7 Beru Whitesun lars
&gt;  8 R5-D4             
&gt;  9 Biggs Darklighter 
&gt; 10 Obi-Wan Kenobi    
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.pull-right[

A veces no querremos dicha estructura sino **.bg-purple_light[extraer literalmente la columna]**, algo que podemos hacer con `pull()`


```r
starwars %&gt;% pull(name)
```

```
&gt;  [1] "Luke Skywalker"        "C-3PO"                 "R2-D2"                
&gt;  [4] "Darth Vader"           "Leia Organa"           "Owen Lars"            
&gt;  [7] "Beru Whitesun lars"    "R5-D4"                 "Biggs Darklighter"    
&gt; [10] "Obi-Wan Kenobi"        "Anakin Skywalker"      "Wilhuff Tarkin"       
&gt; [13] "Chewbacca"             "Han Solo"              "Greedo"               
&gt; [16] "Jabba Desilijic Tiure" "Wedge Antilles"        "Jek Tono Porkins"     
&gt; [19] "Yoda"                  "Palpatine"             "Boba Fett"            
&gt; [22] "IG-88"                 "Bossk"                 "Lando Calrissian"     
&gt; [25] "Lobot"                 "Ackbar"                "Mon Mothma"           
&gt; [28] "Arvel Crynyd"          "Wicket Systri Warrick" "Nien Nunb"            
&gt; [31] "Qui-Gon Jinn"          "Nute Gunray"           "Finis Valorum"        
&gt; [34] "Jar Jar Binks"         "Roos Tarpals"          "Rugor Nass"           
&gt; [37] "Ric Oli√©"              "Watto"                 "Sebulba"              
&gt; [40] "Quarsh Panaka"         "Shmi Skywalker"        "Darth Maul"           
&gt; [43] "Bib Fortuna"           "Ayla Secura"           "Dud Bolt"             
&gt; [46] "Gasgano"               "Ben Quadinaros"        "Mace Windu"           
&gt; [49] "Ki-Adi-Mundi"          "Kit Fisto"             "Eeth Koth"            
&gt; [52] "Adi Gallia"            "Saesee Tiin"           "Yarael Poof"          
&gt; [55] "Plo Koon"              "Mas Amedda"            "Gregar Typho"         
&gt; [58] "Cord√©"                 "Cliegg Lars"           "Poggle the Lesser"    
&gt; [61] "Luminara Unduli"       "Barriss Offee"         "Dorm√©"                
&gt; [64] "Dooku"                 "Bail Prestor Organa"   "Jango Fett"           
&gt; [67] "Zam Wesell"            "Dexter Jettster"       "Lama Su"              
&gt; [70] "Taun We"               "Jocasta Nu"            "Ratts Tyerell"        
&gt; [73] "R4-P17"                "Wat Tambor"            "San Hill"             
&gt; [76] "Shaak Ti"              "Grievous"              "Tarfful"              
&gt; [79] "Raymus Antilles"       "Sly Moore"             "Tion Medon"           
&gt; [82] "Finn"                  "Rey"                   "Poe Dameron"          
&gt; [85] "BB8"                   "Captain Phasma"        "Padm√© Amidala"
```

]

---

# .orange[RENOMBRAR] columnas: rename()


.pull-left[


```r
datos %&gt;% 
  renombrar(col1, col2)
```

]

.pull-right[


```r
starwars %&gt;% 
  rename(col1, col2)
```

]

--

A veces tambi√©n podemos querer **modificar la ¬´metainformaci√≥n¬ª** de los datos, **.bg-purple_light[renombrando columnas]**. Para ello usaremos la funci√≥n `rename()` poniendo primero el nombre nuevo y luego el antiguo.


```r
starwars %&gt;% 
  rename(nombre = name, altura = height,  peso = mass)
```

```
&gt; # A tibble: 87 √ó 14
&gt;    nombre      altura  peso hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```


---

# Ejercicios (columnas)

.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: filtra el conjunto de personajes y qu√©date solo con aquellos que en la variable `height` no tengan un dato ausente.

* üìù **Ejercicio 2**: con los datos obtenidos del filtro anterior, selecciona solo las variables `name`, `height`, as√≠ como todas aquellas variables que CONTENGAN la palabra `color` en su nombre.

* üìù **Ejercicio 3**: con los datos obtenidos del ejercicio anterior, traduce el nombre de las columnas a castellano

* üìù **Ejercicio 4**: con los datos obtenidos del ejercicio anterior, coloca la variable de color de pelo justo detr√°s de la variable de nombres.

* üìù **Ejercicio 5**: con los datos obtenidos del ejercicio, comprueba cu√°ntas modalidades √∫nicas hay en la variable de color de pelo.

]

.panel[.panel-name[Sol. Ej. 1]

**IMPORTANTE**: todo lo que hagas en la tabla original, si el resultado final no se lo asignas `&lt;-` a otra variable, lo ver√°s en consola pero no se guardar√° en ning√∫n sitio. Lo que no guardes, no existe.



```r
starwars_NA &lt;- starwars %&gt;% drop_na(height)
starwars_NA 
```

```
&gt; # A tibble: 81 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 71 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 2]


```r
starwars %&gt;%
  drop_na(height) %&gt;%
  select(c(name, height, contains("color")))
```

```
&gt; # A tibble: 81 √ó 5
&gt;    name               height hair_color    skin_color  eye_color
&gt;    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
&gt;  1 Luke Skywalker        172 blond         fair        blue     
&gt;  2 C-3PO                 167 &lt;NA&gt;          gold        yellow   
&gt;  3 R2-D2                  96 &lt;NA&gt;          white, blue red      
&gt;  4 Darth Vader           202 none          white       yellow   
&gt;  5 Leia Organa           150 brown         light       brown    
&gt;  6 Owen Lars             178 brown, grey   light       blue     
&gt;  7 Beru Whitesun lars    165 brown         light       blue     
&gt;  8 R5-D4                  97 &lt;NA&gt;          white, red  red      
&gt;  9 Biggs Darklighter     183 black         light       brown    
&gt; 10 Obi-Wan Kenobi        182 auburn, white fair        blue-gray
&gt; # ‚Ä¶ with 71 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Sol. Ej. 3]



```r
starwars %&gt;%
  drop_na(height) %&gt;%
  select(c(name, height, contains("color"))) %&gt;%
  rename(nombre = name, altura = height,
         color_pelo = hair_color,
         color_piel = skin_color,
         color_ojos = eye_color)
```

```
&gt; # A tibble: 81 √ó 5
&gt;    nombre             altura color_pelo    color_piel  color_ojos
&gt;    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;     
&gt;  1 Luke Skywalker        172 blond         fair        blue      
&gt;  2 C-3PO                 167 &lt;NA&gt;          gold        yellow    
&gt;  3 R2-D2                  96 &lt;NA&gt;          white, blue red       
&gt;  4 Darth Vader           202 none          white       yellow    
&gt;  5 Leia Organa           150 brown         light       brown     
&gt;  6 Owen Lars             178 brown, grey   light       blue      
&gt;  7 Beru Whitesun lars    165 brown         light       blue      
&gt;  8 R5-D4                  97 &lt;NA&gt;          white, red  red       
&gt;  9 Biggs Darklighter     183 black         light       brown     
&gt; 10 Obi-Wan Kenobi        182 auburn, white fair        blue-gray 
&gt; # ‚Ä¶ with 71 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Sol. Ej. 4]



```r
starwars %&gt;%
  drop_na(height) %&gt;%
  select(c(name, height, contains("color"))) %&gt;%
  rename(nombre = name, altura = height,
         color_pelo = hair_color,
         color_piel = skin_color,
         color_ojos = eye_color) %&gt;%
  relocate(color_pelo, .after = nombre)
```

```
&gt; # A tibble: 81 √ó 5
&gt;    nombre             color_pelo    altura color_piel  color_ojos
&gt;    &lt;chr&gt;              &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;     
&gt;  1 Luke Skywalker     blond            172 fair        blue      
&gt;  2 C-3PO              &lt;NA&gt;             167 gold        yellow    
&gt;  3 R2-D2              &lt;NA&gt;              96 white, blue red       
&gt;  4 Darth Vader        none             202 white       yellow    
&gt;  5 Leia Organa        brown            150 light       brown     
&gt;  6 Owen Lars          brown, grey      178 light       blue      
&gt;  7 Beru Whitesun lars brown            165 light       blue      
&gt;  8 R5-D4              &lt;NA&gt;              97 white, red  red       
&gt;  9 Biggs Darklighter  black            183 light       brown     
&gt; 10 Obi-Wan Kenobi     auburn, white    182 fair        blue-gray 
&gt; # ‚Ä¶ with 71 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Sol. Ej. 5]


```r
starwars %&gt;%
  drop_na(height) %&gt;%
  select(c(name, height, contains("color"))) %&gt;%
  rename(nombre = name, altura = height, color_pelo = hair_color,
         color_piel = skin_color, color_ojos = eye_color) %&gt;%
  relocate(color_pelo, .after = nombre) %&gt;%
  distinct(color_pelo)
```

```
&gt; # A tibble: 12 √ó 1
&gt;    color_pelo   
&gt;    &lt;chr&gt;        
&gt;  1 blond        
&gt;  2 &lt;NA&gt;         
&gt;  3 none         
&gt;  4 brown        
&gt;  5 brown, grey  
&gt;  6 black        
&gt;  7 auburn, white
&gt;  8 auburn, grey 
&gt;  9 white        
&gt; 10 grey         
&gt; 11 auburn       
&gt; 12 blonde
```

**IMPORTANTE**: recuerda que `distinct()` de mantener todas las columnas a√±adiendo `.keep_all = TRUE`.

]

]


---

# Ejercicio extra


Veamos un ejercicio extra para comprobar la **potencia y flexibilidad** de `{tidyverse}`, pudiendo hacer muchas cosas en dos l√≠neas de c√≥digo.

&amp;nbsp;

* üìù **Ejercicio extra**: selecciona solo las variables `name` y aquellas que sean de tipo num√©rico y la variable `homeworld`, y selecciona solo los personajes que no sean humanos y que pesen entre 70 y 90 kg.  Tras ello elimina datos ausentes, y elimina duplicados con el mismo valor en `homeworld`. Tras ello, recoloca las variables para que el orden la primera columna sea `name` y la segunda `birth_year`. Para acabar, cambia el nombre  a castellano de las variables.


---

name: mutate


# .orange[MODIFICAR] columnas: mutate()


.pull-left[


```r
datos %&gt;%
  modificar(nueva_var = ...)
```

]

.pull-right[


```r
starwars %&gt;%
  mutate(nueva_var = ...)
```

]

--

En muchas ocasiones querremos **.bg-purple_light[modificar o crear  variables]**. Para ello tenemos la funci√≥n `mutate()`. Vamos a crear una **nueva variable** `height_m` con la altura en cent√≠metros.


```r
# altura en metros
starwars %&gt;%
* mutate(height_m = height / 100)
```

```
&gt; # A tibble: 87 √ó 15
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 5 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, height_m &lt;dbl&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[MODIFICAR] columnas: mutate()



```r
starwars %&gt;% mutate(height_m = height / 100)
```

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/mutate1.jpg" alt="Flujo de https://tidydatatutor.com/" width="90%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

---

# .orange[MODIFICAR] columnas: mutate()

Otra opci√≥n es **.bg-purple_light[quedarnos solo con las modificadas]** (por ejemplo, para ver si hace lo que debe) con `transmute()`


```r
starwars %&gt;%
* transmute(height_m = height / 100)
```

```
&gt; # A tibble: 87 √ó 1
&gt;    height_m
&gt;       &lt;dbl&gt;
&gt;  1     1.72
&gt;  2     1.67
&gt;  3     0.96
&gt;  4     2.02
&gt;  5     1.5 
&gt;  6     1.78
&gt;  7     1.65
&gt;  8     0.97
&gt;  9     1.83
&gt; 10     1.82
&gt; # ‚Ä¶ with 77 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---


# .orange[MODIFICAR] columnas: mutate()

Tambi√©n se pueden aplicar **.bg-purple_light[funciones m√°s complejas]** o incluso **.bg-purple_light[funciones propias]** creadas por nosotros mismos (y varias a la vez).


```r
calculo_IMC &lt;- function(peso, estatura, unidades = "metros") {
  
  estatura &lt;- ifelse(unidades == "metros", estatura, estatura / 100)
  IMC &lt;- peso / (estatura^2)
  
  return(IMC)
}
```

---

# .orange[MODIFICAR] columnas: mutate()

Tambi√©n se pueden aplicar **.bg-purple_light[funciones m√°s complejas]** o incluso **.bg-purple_light[funciones propias]** creadas por nosotros mismos (y varias a la vez).


```r
starwars %&gt;%
  mutate(IMC = calculo_IMC(mass, height, unidades = "cent√≠metros"),
         height_m = height / 100) %&gt;%
  relocate(IMC, height_m, .after = mass)
```

```
&gt; # A tibble: 87 √ó 16
&gt;    name  height  mass   IMC heigh‚Ä¶¬π hair_‚Ä¶¬≤ skin_‚Ä¶¬≥ eye_c‚Ä¶‚Å¥ birth‚Ä¶‚Åµ sex   gender
&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
&gt;  1 Luke‚Ä¶    172    77  26.0    1.72 blond   fair    blue       19   male  mascu‚Ä¶
&gt;  2 C-3PO    167    75  25.4    1.67 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶
&gt;  3 R2-D2     96    32  10.8    0.96 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶
&gt;  4 Dart‚Ä¶    202   136  46.0    2.02 none    white   yellow     41.9 male  mascu‚Ä¶
&gt;  5 Leia‚Ä¶    150    49  16.6    1.5  brown   light   brown      19   fema‚Ä¶ femin‚Ä¶
&gt;  6 Owen‚Ä¶    178   120  40.6    1.78 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶
&gt;  7 Beru‚Ä¶    165    75  25.4    1.65 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶
&gt;  8 R5-D4     97    32  10.8    0.97 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶
&gt;  9 Bigg‚Ä¶    183    84  28.4    1.83 black   light   brown      24   male  mascu‚Ä¶
&gt; 10 Obi-‚Ä¶    182    77  26.0    1.82 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶
&gt; # ‚Ä¶ with 77 more rows, 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
&gt; #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãheight_m, ¬≤‚Äãhair_color, ¬≥‚Äãskin_color, ‚Å¥‚Äãeye_color, ‚Åµ‚Äãbirth_year
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[MODIFICAR] columnas: mutate()

Tambi√©n podemos combinarlo con la funci√≥n `if_else()`, una modificaci√≥n dentro de `{tidyverse}` para hacer un `if-else` vectorizado, que nos puede ayudar a **.bg-purple_light[recategorizaciones sencillas]**.


```r
starwars %&gt;%
  mutate(human = if_else(species == "Human", "Human", "Not Human")) %&gt;% 
  relocate(human, .after = name)
```

```
&gt; # A tibble: 87 √ó 15
&gt;    name  human height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke‚Ä¶ Human    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO Not ‚Ä¶    167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2 Not ‚Ä¶     96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Dart‚Ä¶ Human    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia‚Ä¶ Human    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen‚Ä¶ Human    178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru‚Ä¶ Human    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4 Not ‚Ä¶     97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Bigg‚Ä¶ Human    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-‚Ä¶ Human    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```


---

# .orange[RECATEGORIZAR]: case_when()

Para **.bg-purple_light[recategorizaciones m√°s complejas]** tenemos a nuestra disposici√≥n `case_when()`. Supongamos por ejemplo que queremos crear una **categor√≠a en funci√≥n de su altura**.

* Si `height &gt; 180` ‚Äì&gt; ser√°n `"alto"`.
* Si `height &lt;= 180` y `height &gt; 120` ‚Äì&gt; ser√°n `"bajo"`
* Si `height &lt;= 120` y `height &gt; 0` ‚Äì&gt; ser√°n `"enano"`
* Si no se cumple lo anterior ‚Äì&gt; ser√°n `"ausente"`

--


```r
starwars %&gt;% mutate(height = case_when(height &gt; 180 ~ "alto",
                                       height &gt; 120 ~ "bajo",
                                       height &gt; 0 ~ "enano",
                                       TRUE ~ "ausente"))
```

```
&gt; # A tibble: 87 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶ bajo      77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO       bajo      75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2       enano     32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader alto     136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa bajo      49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars   bajo     120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶ bajo      75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4       enano     32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶ alto      84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶ alto      77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# .orange[RECATEGORIZAR]: case_when()

Las condiciones de `case_when()` pueden combinar varias variables, c√≥mo por ejemplo:

* Si pesan mucho o miden mucho --&gt; `"large"`
* Si `species == "Droid"` --&gt; `"robot"`
* En caso contrario --&gt; `"other"`


```r
starwars %&gt;%
  mutate(type =
           case_when(height &gt; 200 | mass &gt; 200 ~ "large",
                     species == "Droid" ~ "robot",
                     TRUE ~ "other"))
```

```
&gt; # A tibble: 87 √ó 15
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 5 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, type &lt;chr&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Ejercicios (mutate)


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: crea tres nuevas columnas que nos digan el n√∫mero de pel√≠culas en las que han salido, el n√∫mero de veh√≠culos y el n√∫mero d naves (pero haciendo uso de mutate()). 

* üìù **Ejercicio 2**: con las 3 columnas creadas, crea una nueva columna llamada `frequency` que nos ponga `almost_all` en personajes que salen en 5 o m√°s pel√≠culas, `many` en personajes que salen en m√°s de 2 pel√≠culas pero en menos de 5 y `some` en personajes que salen 1 o 2 pel√≠culas.

* üìù **Ejercicio 3**: elimina registros con datos ausentes en la variable `birth_year` y filtra solo los 20 personajes m√°s j√≥venes.

* üìù **Ejercicio 4**: selecciona solo las variables num√©ricas y de tipo texto. Define una nueva variable llamada `under_18` que nos recategorice la variable `birth_year`: `TRUE` si es menor de edad y `FALSE` en caso contrario

]

.panel[.panel-name[Sol. Ej. 1]


```r
starwars_nueva &lt;- 
  starwars %&gt;%
  mutate(n_films = films %&gt;% map_int(length),
         n_vehicles = vehicles %&gt;% map_int(length),
         n_starships = starships %&gt;% map_int(length))
starwars_nueva
```

```
&gt; # A tibble: 87 √ó 17
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 7 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;, n_vehicles &lt;int&gt;,
&gt; #   n_starships &lt;int&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 2]


```r
starwars_nueva &lt;-
  starwars_nueva %&gt;%
  mutate(frequency =
           case_when(n_films &gt;= 5 ~ "almost_all",
                     n_films &gt; 2 ~ "many",
                     TRUE ~ "some"))
starwars_nueva
```

```
&gt; # A tibble: 87 √ó 18
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 8 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;, n_vehicles &lt;int&gt;,
&gt; #   n_starships &lt;int&gt;, frequency &lt;chr&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 3]


```r
starwars_nueva &lt;-
  starwars_nueva %&gt;%
  drop_na(birth_year) %&gt;%
  slice_min(n = 20, birth_year)
starwars_nueva
```

```
&gt; # A tibble: 21 √ó 18
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Wicket Sys‚Ä¶     88  20   brown   brown   brown       8   male  mascu‚Ä¶ Endor  
&gt;  2 IG-88          200 140   none    metal   red        15   none  mascu‚Ä¶ &lt;NA&gt;   
&gt;  3 Luke Skywa‚Ä¶    172  77   blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  4 Leia Organa    150  49   brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  5 Wedge Anti‚Ä¶    170  77   brown   fair    hazel      21   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  6 Plo Koon       188  80   none    orange  black      22   male  mascu‚Ä¶ Dorin  
&gt;  7 Biggs Dark‚Ä¶    183  84   black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  8 Han Solo       180  80   brown   fair    brown      29   male  mascu‚Ä¶ Corell‚Ä¶
&gt;  9 Lando Calr‚Ä¶    177  79   black   dark    brown      31   male  mascu‚Ä¶ Socorro
&gt; 10 Boba Fett      183  78.2 black   fair    brown      31.5 male  mascu‚Ä¶ Kamino 
&gt; # ‚Ä¶ with 11 more rows, 8 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;, n_vehicles &lt;int&gt;,
&gt; #   n_starships &lt;int&gt;, frequency &lt;chr&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 4]


```r
starwars_nueva &lt;-
  starwars_nueva %&gt;%
  select(where(is.numeric) | where(is.character)) %&gt;%
  mutate(under_18 = birth_year &lt; 18)
starwars_nueva
```

```
&gt; # A tibble: 21 √ó 16
&gt;    height  mass birth_year n_films n_veh‚Ä¶¬π n_sta‚Ä¶¬≤ name  hair_‚Ä¶¬≥ skin_‚Ä¶‚Å¥ eye_c‚Ä¶‚Åµ
&gt;     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
&gt;  1     88  20          8         1       0       0 Wick‚Ä¶ brown   brown   brown  
&gt;  2    200 140         15         1       0       0 IG-88 none    metal   red    
&gt;  3    172  77         19         5       2       2 Luke‚Ä¶ blond   fair    blue   
&gt;  4    150  49         19         5       1       0 Leia‚Ä¶ brown   light   brown  
&gt;  5    170  77         21         3       1       1 Wedg‚Ä¶ brown   fair    hazel  
&gt;  6    188  80         22         3       0       1 Plo ‚Ä¶ none    orange  black  
&gt;  7    183  84         24         1       0       1 Bigg‚Ä¶ black   light   brown  
&gt;  8    180  80         29         4       0       2 Han ‚Ä¶ brown   fair    brown  
&gt;  9    177  79         31         2       0       1 Land‚Ä¶ black   dark    brown  
&gt; 10    183  78.2       31.5       3       0       1 Boba‚Ä¶ black   fair    brown  
&gt; # ‚Ä¶ with 11 more rows, 6 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;,
&gt; #   homeworld &lt;chr&gt;, species &lt;chr&gt;, frequency &lt;chr&gt;, under_18 &lt;lgl&gt;, and
&gt; #   abbreviated variable names ¬π‚Äãn_vehicles, ¬≤‚Äãn_starships, ¬≥‚Äãhair_color,
&gt; #   ‚Å¥‚Äãskin_color, ‚Åµ‚Äãeye_color
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```


]

]


---


# Ejercicios (mutate)


.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 5**: de la base de datos original, determina el n√∫mero de modalidades que toma la variable `species` (elimina antes registros con ausente en dicha variable). Despu√©s elimina duplicados por dicha variable, dejando el representante m√°s bajito.

* üìù **Ejercicio 6**: sobre la base de datos original, crea una nueva columna llamada `auburn` (cobrizo/caoba) que nos diga `TRUE` si el color de pelo contiene dicha palabra y `FALSE` en caso contrario.

* üìù **Ejercicio 7**: sobre la base de datos original, filtra solo aquellos personajes de la familia `"Skywalker"` o `"Antilles"`, selecciona solo las columnas de `name` y `specie`, y renombra a castellano.


]

.panel[.panel-name[Sol. Ej. 5]


```r
starwars %&gt;%
  drop_na(species) %&gt;%
  distinct(species)
```

```
&gt; # A tibble: 37 √ó 1
&gt;    species       
&gt;    &lt;chr&gt;         
&gt;  1 Human         
&gt;  2 Droid         
&gt;  3 Wookiee       
&gt;  4 Rodian        
&gt;  5 Hutt          
&gt;  6 Yoda's species
&gt;  7 Trandoshan    
&gt;  8 Mon Calamari  
&gt;  9 Ewok          
&gt; 10 Sullustan     
&gt; # ‚Ä¶ with 27 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

```r
starwars %&gt;%
  drop_na(species) %&gt;%
  arrange(height) %&gt;%
  distinct(species, .keep_all = TRUE)
```

```
&gt; # A tibble: 37 √ó 14
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Yoda            66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt;  2 Ratts Tyer‚Ä¶     79    15 none    grey, ‚Ä¶ unknown      NA male  mascu‚Ä¶ Aleen ‚Ä¶
&gt;  3 Wicket Sys‚Ä¶     88    20 brown   brown   brown         8 male  mascu‚Ä¶ Endor  
&gt;  4 Dud Bolt        94    45 none    blue, ‚Ä¶ yellow       NA male  mascu‚Ä¶ Vulpter
&gt;  5 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red          33 none  mascu‚Ä¶ Naboo  
&gt;  6 Sebulba        112    40 none    grey, ‚Ä¶ orange       NA male  mascu‚Ä¶ Malast‚Ä¶
&gt;  7 Gasgano        122    NA none    white,‚Ä¶ black        NA male  mascu‚Ä¶ Troiken
&gt;  8 Watto          137    NA black   blue, ‚Ä¶ yellow       NA male  mascu‚Ä¶ Toydar‚Ä¶
&gt;  9 Leia Organa    150    49 brown   light   brown        19 fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt; 10 Nien Nunb      160    68 none    grey    black        NA male  mascu‚Ä¶ Sullust
&gt; # ‚Ä¶ with 27 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 6]


```r
starwars %&gt;%
  drop_na(hair_color) %&gt;%
  mutate(auburn = str_detect(hair_color, "auburn"))
```

```
&gt; # A tibble: 82 √ó 15
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  4 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  6 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt;  8 Anakin Sky‚Ä¶    188    84 blond   fair    blue       41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Wilhuff Ta‚Ä¶    180    NA auburn‚Ä¶ fair    blue       64   male  mascu‚Ä¶ Eriadu 
&gt; 10 Chewbacca      228   112 brown   unknown blue      200   male  mascu‚Ä¶ Kashyy‚Ä¶
&gt; # ‚Ä¶ with 72 more rows, 5 more variables: species &lt;chr&gt;, films &lt;list&gt;,
&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;, auburn &lt;lgl&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 6]


```r
starwars %&gt;%
  filter(str_detect(name, "Skywalker") |
           str_detect(name, "Antilles")) %&gt;%
  select(name, species) %&gt;%
  rename(nombre = name, especie = species)
```

```
&gt; # A tibble: 5 √ó 2
&gt;   nombre           especie
&gt;   &lt;chr&gt;            &lt;chr&gt;  
&gt; 1 Luke Skywalker   Human  
&gt; 2 Anakin Skywalker Human  
&gt; 3 Wedge Antilles   Human  
&gt; 4 Shmi Skywalker   Human  
&gt; 5 Raymus Antilles  Human
```

]
]




---

name: count

# .orange[CONTAR]: group_by() + count()

Hasta ahora solo hemos transformado o consultado nuestra tabla pero no hemos aprendido a **.bg-purple_light[generar res√∫menes estad√≠sticos]**. Empecemos por lo sencillo: contar (frecuencias)

.pull-left[


```r
datos %&gt;%
  contar(var1, var2)
```

]

.pull-right[


```r
starwars %&gt;%
  count(var1, var2)
```

]

--

Cuando lo usamos en solitario, `count()` nos devolver√° simplemente el **.bg-purple_light[n√∫mero de registros]**


```r
starwars %&gt;% count()
```

```
&gt; # A tibble: 1 √ó 1
&gt;       n
&gt;   &lt;int&gt;
&gt; 1    87
```

---

# .orange[CONTAR]: group_by() + count()

Sin embargo, cuando lo usamos pas√°ndole como **.bg-purple_light[argumento una o varias variables]**, `count()` nos cuenta lo que se conoce en estad√≠stica como **.bg-purple_light[frecuencias absolutas]**: el n√∫mero de elementos pertenecientes a cada una de las **modalidades**. En nuestro caso, la variable `sex` tiene 4 modalidades: `female, hermaphroditic, male, none`.


```r
*starwars %&gt;% count(sex)
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex                n
&gt;   &lt;chr&gt;          &lt;int&gt;
&gt; 1 female            16
&gt; 2 hermaphroditic     1
&gt; 3 male              60
&gt; 4 none               6
&gt; 5 &lt;NA&gt;               4
```

---

# .orange[CONTAR]: group_by() + count()


Adem√°s si pasamos **.bg-purple_light[varias variables]** nos calcula una **.bg-purple_light[tabla de contigencia]** con las frecuencias absolutas n-dimensionales


```r
starwars %&gt;% count(sex, gender)
```

```
&gt; # A tibble: 6 √ó 3
&gt;   sex            gender        n
&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
&gt; 1 female         feminine     16
&gt; 2 hermaphroditic masculine     1
&gt; 3 male           masculine    60
&gt; 4 none           feminine      1
&gt; 5 none           masculine     5
&gt; 6 &lt;NA&gt;           &lt;NA&gt;          4
```

---


# .orange[CONTAR]: group_by() + count()

Lo anterior podemos combinarlo con lo que ya sabemos para **.bg-purple_light[a√±adir variables]** a una tabla, de forma que podremos obtener no solo las frecuencias absolutas sino tambi√©n las acumuladas o las relativas. Vamos a a√±adir por ejemplo una columna `f` que nos devuelve el conteo pero en % respecto al total de datos.

--


```r
starwars %&gt;%
  count(sex) %&gt;% 
  mutate(f = 100 * n/sum(n))
```

```
&gt; # A tibble: 5 √ó 3
&gt;   sex                n     f
&gt;   &lt;chr&gt;          &lt;int&gt; &lt;dbl&gt;
&gt; 1 female            16 18.4 
&gt; 2 hermaphroditic     1  1.15
&gt; 3 male              60 69.0 
&gt; 4 none               6  6.90
&gt; 5 &lt;NA&gt;               4  4.60
```

---

# .orange[CONTAR]: group_by() + count()

Adem√°s dentro del `count()` podemos a√±adir `sort = TRUE`, que nos devolver√° el conteo de frecuencias con los **.bg-purple_light[elementos m√°s frecuentes primero]** (sin necesidad de a√±adir un `arrange()` a la tabla de conteo generada).


```r
starwars %&gt;%
  count(sex, sort = TRUE) %&gt;% 
  mutate(f = 100 * n/sum(n))
```

```
&gt; # A tibble: 5 √ó 3
&gt;   sex                n     f
&gt;   &lt;chr&gt;          &lt;int&gt; &lt;dbl&gt;
&gt; 1 male              60 69.0 
&gt; 2 female            16 18.4 
&gt; 3 none               6  6.90
&gt; 4 &lt;NA&gt;               4  4.60
&gt; 5 hermaphroditic     1  1.15
```

---


# .orange[CONTAR]: group_by() + count()


Una de las funciones m√°s potentes a combinar con `count()` es `group_by()`  que nos permitir√° **.bg-purple_light[agrupar nuestros registros]**


.pull-left[


```r
datos %&gt;%
  agrupar(var_grupo1, var_grupo2) %&gt;% 
  contar() %&gt;% 
  desagrupar()
```

]

.pull-right[


```r
starwars %&gt;%
  group_by(var_grupo1, var_grupo2) %&gt;%
  count() %&gt;% 
  ungroup()
```

]

--

Cuando apliquemos `group_by()` es importante entender que **.bg-purple_light[NO MODIFICA los datos]**: nos crea una variable de grupo que **.bg-purple_light[modificar√° las acciones futuras]** que apliquemos, generando una especie de generar **m√∫ltiples subtablas**, y las operaciones aplicadas despu√©s se **.bg-purple_light[aplicar√°n a cada una por separado]**.

---


# .orange[CONTAR]: group_by() + count()

.pull-left[

Por ejemplo, imagina que queremos saber el **.bg-purple_light[n√∫mero de registros por sexo]**: primero **.bg-purple_light[agruparemos]** por la variable `sex`, y despu√©s aplicaremos el **.bg-purple_light[conteo]** con `count()` (realiza la acci√≥n pedida en cada subtabla).


```r
starwars %&gt;%
* group_by(sex) %&gt;%
  count() %&gt;%
* ungroup()
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex                n
&gt;   &lt;chr&gt;          &lt;int&gt;
&gt; 1 female            16
&gt; 2 hermaphroditic     1
&gt; 3 male              60
&gt; 4 none               6
&gt; 5 &lt;NA&gt;               4
```

**IMPORTANTE**: siempre que agrupes, acu√©rdate de desagrupar con `ungroup()`.

]


.pull-right[

&lt;img src="./img/count_group_1.jpg" width="45%" style="display: block; margin: auto;" /&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/count_group_2.jpg" alt="Flujo de https://tidydatatutor.com/" width="95%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;


]

---


# .orange[CONTAR]: group_by() + count()

.pull-left[

Podemos **.bg-purple_light[agrupar por variables]**, por ejemplo vamos a agrupar por `sex` y `gender`, y despu√©s aplicaremos `count()` (realiza la acci√≥n en cada subtabla).


```r
starwars %&gt;%
* group_by(sex, gender) %&gt;%
  count() %&gt;%
* ungroup()
```

```
&gt; # A tibble: 6 √ó 3
&gt;   sex            gender        n
&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
&gt; 1 female         feminine     16
&gt; 2 hermaphroditic masculine     1
&gt; 3 male           masculine    60
&gt; 4 none           feminine      1
&gt; 5 none           masculine     5
&gt; 6 &lt;NA&gt;           &lt;NA&gt;          4
```

**IMPORTANTE**: siempre que agrupes, acu√©rdate de desagrupar con `ungroup()`.

]

.pull-right[

&lt;img src="./img/group_1.jpg" width="150%" style="display: block; margin: auto;" /&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/group_count.jpg" alt="Flujo de https://tidydatatutor.com/" width="150%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

]

---

name: summarise

# .orange[RESUMIR]: summarise()

La agrupaci√≥n `group_by()` es una idea superpotente porque permite **.bg-purple_light[desagregar cualquier acci√≥n posterior]**, entre otras, la funci√≥n `summarise()`, que nos permite **.bg-purple_light[resumir]**.

.pull-left[


```r
datos %&gt;%
  agrupar(var_grupo1, var_grupo2) %&gt;% 
  resumir() %&gt;% 
  desagrupar()
```

]

.pull-right[


```r
starwars %&gt;%
  group_by(var_grupo1, var_grupo2) %&gt;%
  summarise() %&gt;% 
  ungroup()
```

]

--

Un ejemplo: vamos a calcular la **.bg-purple_light[media de las alturas]**. Si lo hacemos sin `group_by()` se har√° de todos los personajes.


```r
starwars %&gt;% drop_na(height) %&gt;%
  summarise(media_altura = mean(height))
```

```
&gt; # A tibble: 1 √ó 1
&gt;   media_altura
&gt;          &lt;dbl&gt;
&gt; 1         174.
```

Dentro de `summarise()` podr√°s definir cada estad√≠stico como el `nombre = ` seguido de la funci√≥n a aplicar (que exista o tuya propia definida anteriormente).

---

# .orange[RESUMIR]: summarise()


Si la misma acci√≥n la realizamos con un `group_by()` previo, la media de las alturas se **.bg-purple_light[calcular√° de manera desagregada]** (por sexos por ejemplo), de forma independiente en cada subtabla por grupo creada.

.pull-left[


```r
starwars %&gt;% 
  drop_na(height) %&gt;%
  group_by(sex) %&gt;% 
  summarise(media = mean(height)) %&gt;%
  ungroup()
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex            media
&gt;   &lt;chr&gt;          &lt;dbl&gt;
&gt; 1 female          169.
&gt; 2 hermaphroditic  175 
&gt; 3 male            179.
&gt; 4 none            131.
&gt; 5 &lt;NA&gt;            181.
```

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/group_summarise.jpg" alt="Flujo de https://tidydatatutor.com/" width="140%" /&gt;
&lt;p class="caption"&gt;Flujo de https://tidydatatutor.com/&lt;/p&gt;
&lt;/div&gt;

]


---

# .orange[RESUMIR]: summarise()

Podemos **.bg-purple_light[resumir varias variables]** a la vez combin√°ndolo con la funci√≥n `across()`: primero indicamos las **.bg-purple_light[variables a recorrer]** (por ejemplo, `height:mass`), despu√©s la funci√≥n a aplicar (en este caso, la media `mean()`), y por √∫ltimo argumentos extras si fuesen necesarios (por ejemplo, `na.rm = TRUE`)


```r
starwars %&gt;%
* group_by(sex) %&gt;%
* summarise(medias = across(height:mass, mean, na.rm = TRUE)) %&gt;%
  ungroup()
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex            medias$height  $mass
&gt;   &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1 female                  169.   54.7
&gt; 2 hermaphroditic          175  1358  
&gt; 3 male                    179.   81.0
&gt; 4 none                    131.   69.8
&gt; 5 &lt;NA&gt;                    181.   48
```

---

# .orange[RESUMIR]: summarise()

Adem√°s la funci√≥n `across()` podemos combinarla con un viejo conocido, `where()`, para que **.bg-purple_light[resuma las variables de un tipo]**, por ejemplo `where(is.numeric)` selecciona solo las num√©ricas.


```r
starwars %&gt;%
  drop_na(height, mass) %&gt;%
  group_by(sex, gender) %&gt;%
  summarise(across(where(is.numeric), mean, na.rm = TRUE)) %&gt;%
  ungroup()
```

```
&gt; # A tibble: 5 √ó 5
&gt;   sex            gender    height   mass birth_year
&gt;   &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
&gt; 1 female         feminine    169.   54.7       43  
&gt; 2 hermaphroditic masculine   175  1358        600  
&gt; 3 male           masculine   178.   81.0       87.0
&gt; 4 none           masculine   140    69.8       53.3
&gt; 5 &lt;NA&gt;           &lt;NA&gt;        178    48        NaN
```

---

# .orange[RESUMIR]: summarise()

Algunas de las funciones m√°s √∫tiles dentro de `summarise()`:

* `sum()`, `mean()`, `median()`
* `min()`, `which.min()`, `max()`, `which.max()`
* `n()` (n√∫mero de registros), `n_distinct()` (n√∫mero de registros √∫nicos).


```r
starwars %&gt;%
  summarise(valores_unicos = n_distinct(eye_color))
```

```
&gt; # A tibble: 1 √ó 1
&gt;   valores_unicos
&gt;            &lt;int&gt;
&gt; 1             15
```

---

# Operaciones por filas: rowwise()

Una opci√≥n muy √∫til usada antes de una operaci√≥n tambi√©n es `rowwise()`: toda operaci√≥n que venga despu√©s se aplicar√° **.bg-purple_light[en cada fila por separado]**. Por ejemplo, vamos a definir un conjunto dummy de notas.


```r
notas &lt;- tibble("mates" = sample(0:10, size = 4, replace = TRUE),
                "lengua" = sample(0:10, size = 4, replace = TRUE))
```




---

# Operaciones por filas: rowwise()


Si aplicamos la media directamente, en cada fila el valor `media_curso` es **.bg-purple_light[id√©ntico]** ya que nos ha hecho la media global: nos gustar√≠a sacar una **.bg-purple_light[media por registro]** (por alumno). Para eso usaremos `rowwise()` antes del c√°lculo.


```r
# Aplicado por fila
notas %&gt;% 
* rowwise() %&gt;%
  mutate(media_curso = mean(c(mates, lengua)))
```

```
&gt; # A tibble: 4 √ó 3
&gt; # Rowwise: 
&gt;   mates lengua media_curso
&gt;   &lt;int&gt;  &lt;int&gt;       &lt;dbl&gt;
&gt; 1     5      9         7  
&gt; 2     2      5         3.5
&gt; 3     0      2         1  
&gt; 4     0     10         5
```

---

# Ejercicios (count y summarise)


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: calcula cu√°ntos personajes hay de cada especie de `starwars` haciendo uso de `group_by()` y `count()`

* üìù **Ejercicio 2**: determina el n√∫mero de especies distintas.

* üìù **Ejercicio 3**: tras eliminar ausentes en las variables `mass` y `height`, a√±ade una nueva variable que nos calcule el IMC de cada personaje, y determina el IMC medio de nuestros personajes desagregada por sexo (`sex`).

* üìù **Ejercicio 4**: obt√©n la edad m√≠nima y m√°xima de cada sexo.

]

.panel[.panel-name[Sol Ej. 1]


```r
starwars %&gt;% 
  group_by(species) %&gt;% 
  count() %&gt;% 
  ungroup()
```

```
&gt; # A tibble: 38 √ó 2
&gt;    species       n
&gt;    &lt;chr&gt;     &lt;int&gt;
&gt;  1 Aleena        1
&gt;  2 Besalisk      1
&gt;  3 Cerean        1
&gt;  4 Chagrian      1
&gt;  5 Clawdite      1
&gt;  6 Droid         6
&gt;  7 Dug           1
&gt;  8 Ewok          1
&gt;  9 Geonosian     1
&gt; 10 Gungan        3
&gt; # ‚Ä¶ with 28 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

```r
# sin group
starwars %&gt;%
  count(species)
```

```
&gt; # A tibble: 38 √ó 2
&gt;    species       n
&gt;    &lt;chr&gt;     &lt;int&gt;
&gt;  1 Aleena        1
&gt;  2 Besalisk      1
&gt;  3 Cerean        1
&gt;  4 Chagrian      1
&gt;  5 Clawdite      1
&gt;  6 Droid         6
&gt;  7 Dug           1
&gt;  8 Ewok          1
&gt;  9 Geonosian     1
&gt; 10 Gungan        3
&gt; # ‚Ä¶ with 28 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Sol Ej. 2]


```r
starwars %&gt;%
  summarise(unique_species = n_distinct(species))
```

```
&gt; # A tibble: 1 √ó 1
&gt;   unique_species
&gt;            &lt;int&gt;
&gt; 1             38
```


]


.panel[.panel-name[Sol Ej. 3]


```r
starwars %&gt;%
  drop_na(mass, height) %&gt;% 
  mutate(IMC = mass / (height/100)^2) %&gt;%
  group_by(sex) %&gt;% 
  summarise(mean_IMC = mean(IMC)) %&gt;% 
  ungroup()
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex            mean_IMC
&gt;   &lt;chr&gt;             &lt;dbl&gt;
&gt; 1 female             19.2
&gt; 2 hermaphroditic    443. 
&gt; 3 male               25.7
&gt; 4 none               32.7
&gt; 5 &lt;NA&gt;               15.1
```

]

.panel[.panel-name[Sol Ej. 4]


```r
starwars %&gt;% 
  drop_na(birth_year) %&gt;% 
  group_by(sex) %&gt;% 
  summarise(min_age = min(birth_year),
            max_age = max(birth_year)) %&gt;% 
  ungroup()
```

```
&gt; # A tibble: 5 √ó 3
&gt;   sex            min_age max_age
&gt;   &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;
&gt; 1 female              19      72
&gt; 2 hermaphroditic     600     600
&gt; 3 male                 8     896
&gt; 4 none                15     112
&gt; 5 &lt;NA&gt;                62      62
```

]

]

---

# Ejercicios (count y summarise)


.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 5**: obt√©n el personaje m√°s viejo por cada sexo.

* üìù **Ejercicio 6**: obt√©n las frecuencias (absolutas) desagregadas por `sex` y `gender` y ordenados de mayor a menor aparici√≥n (investiga `? count`)

* üìù **Ejercicio 7**: determina la cantidad de personajes en cada d√©cada (echa un vistazo a `? round()`: ¬øqu√© sucede si hacemos `round(n√∫mero, -1)`?), primero sin desagregar y luego desagregado por sexo.

* üìù **Ejercicio 8**: calcula para las variables de tipo texto la longitud media de cada una de ellas (echa un vistazo a `nchar()`)

]

.panel[.panel-name[Sol Ej. 5]


```r
starwars %&gt;%
  group_by(sex) %&gt;% 
  slice_max(n = 1, birth_year) %&gt;% 
  ungroup()
```

```
&gt; # A tibble: 5 √ó 14
&gt;   name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt; 1 Shmi Skywal‚Ä¶    163    NA black   fair    brown        72 fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt; 2 Jabba Desil‚Ä¶    175  1358 &lt;NA&gt;    green-‚Ä¶ orange      600 herm‚Ä¶ mascu‚Ä¶ Nal Hu‚Ä¶
&gt; 3 Yoda             66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
&gt; 4 C-3PO           167    75 &lt;NA&gt;    gold    yellow      112 none  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 5 Quarsh Pana‚Ä¶    183    NA black   dark    brown        62 &lt;NA&gt;  &lt;NA&gt;   Naboo  
&gt; # ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
&gt; #   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
&gt; #   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `colnames()` to see all variable names
```
  
]

.panel[.panel-name[Sol Ej. 6a]


```r
# Con group
starwars %&gt;%
  group_by(sex, gender) %&gt;% 
  count(sort = TRUE) %&gt;% 
  ungroup()
```

```
&gt; # A tibble: 6 √ó 3
&gt;   sex            gender        n
&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
&gt; 1 male           masculine    60
&gt; 2 female         feminine     16
&gt; 3 none           masculine     5
&gt; 4 &lt;NA&gt;           &lt;NA&gt;          4
&gt; 5 hermaphroditic masculine     1
&gt; 6 none           feminine      1
```

]

.panel[.panel-name[Sol Ej. 6b]


```r
# Sin group
starwars %&gt;%
  count(sex, gender, sort = TRUE)
```

```
&gt; # A tibble: 6 √ó 3
&gt;   sex            gender        n
&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
&gt; 1 male           masculine    60
&gt; 2 female         feminine     16
&gt; 3 none           masculine     5
&gt; 4 &lt;NA&gt;           &lt;NA&gt;          4
&gt; 5 hermaphroditic masculine     1
&gt; 6 none           feminine      1
```

]

.panel[.panel-name[Sol Ej. 7]


```r
starwars %&gt;%
  count(birth_decade = round(birth_year, -1))
```

```
&gt; # A tibble: 15 √ó 2
&gt;    birth_decade     n
&gt;           &lt;dbl&gt; &lt;int&gt;
&gt;  1           10     1
&gt;  2           20     6
&gt;  3           30     4
&gt;  4           40     6
&gt;  5           50     8
&gt;  6           60     4
&gt;  7           70     4
&gt;  8           80     2
&gt;  9           90     3
&gt; 10          100     1
&gt; 11          110     1
&gt; 12          200     1
&gt; 13          600     1
&gt; 14          900     1
&gt; 15           NA    44
```

```r
starwars %&gt;%
  group_by(sex) %&gt;%
  count(birth_decade = round(birth_year, -1)) %&gt;%
  ungroup()
```

```
&gt; # A tibble: 26 √ó 3
&gt;    sex            birth_decade     n
&gt;    &lt;chr&gt;                 &lt;dbl&gt; &lt;int&gt;
&gt;  1 female                   20     1
&gt;  2 female                   40     1
&gt;  3 female                   50     4
&gt;  4 female                   60     1
&gt;  5 female                   70     1
&gt;  6 female                   NA     8
&gt;  7 hermaphroditic          600     1
&gt;  8 male                     10     1
&gt;  9 male                     20     4
&gt; 10 male                     30     3
&gt; # ‚Ä¶ with 16 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]

.panel[.panel-name[Sol Ej. 8]


```r
starwars %&gt;%
  summarise(across(where(is.character),
                   function(x) { mean(nchar(x), na.rm = TRUE)}))
```

```
&gt; # A tibble: 1 √ó 8
&gt;    name hair_color skin_color eye_color   sex gender homeworld species
&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
&gt; 1  10.3       4.84       5.97      5.10  4.51   8.80      7.14    6.17
```

]

]

---

class: inverse center middle
name: clase-10

# CLASE 10: repaso y factores

&amp;nbsp;

### [Repaso](#repaso)

### [Caso pr√°ctico I](#caso-practico-I)

### [Caso pr√°ctico II](#caso-practico-II)


---

name: repaso

# .orange[REPASO] tidyverse

Vamos a hacer un repaso de lo aprendido hasta ahora en tidyverse

&amp;nbsp;

üìù **Ejercicio**: selecciona aquellos personajes de las familia `"Skywalker"` o `"Antilles"`.

---

# .orange[REPASO] tidyverse

Vamos a hacer un repaso de lo aprendido hasta ahora en tidyverse


&amp;nbsp;

üìù **Ejercicio**: filtra los personajes humanos, limpia los ausentes en estatura y peso, selecciona aquellos personajes cuyo IMC est√© entre 23 y 26. ¬øSale alguno en la pel√≠cula `"Attack of the Clones"`? ¬øCu√°ntos?

---

# .orange[REPASO] tidyverse

Vamos a hacer un repaso de lo aprendido hasta ahora en tidyverse


&amp;nbsp;

üìù **Ejercicio**: selecciona aleatoriamente el 50% de los datos, manteniendo el reparto (en proporciones) original entre humanos y no humanos (limpia antes de ausentes). Tras ello quedate solo con las variables nombre, la estatura, las que representen alguna caracter√≠stica de color y la variable films. Calcula la media de estaturas en humanos y no humanos. Por √∫ltimo calcula las frecuencias del color de ojos y humanos/no humanos.

---

name: caso-practico-I

# CASO PR√ÅCTICO I: billboard

* Carga la tabla `billboard` del paquete `{tidyr}`.

--

* Selecciona solo las primeras 52 semanas haciendo uso de `num_range()`

--

* Convierte el dataset a tidydata, ausentes incluidos (deber√≠as obtener 16 484 filas y 5 columnas).

--

* Convierte el dataset a tidydata pero eliminando ausentes (deber√≠as obtener 5280 filas y 5 columnas).

--

* La variable `week` proc√©sala para que sea num√©rica

---

# CASO PR√ÅCTICO I: billboard

* Asumiendo que cada cuatrimestre tiene 13 semanas, crea una nueva variable llamada `quarter` que nos codifique el cuatrimestre de cada registro. Crea otra variable con el mes en `month`

--

* Extrae la lista de artistas distintos que aparecen en la tabla (y cu√°ntas veces aparece cada uno)

--

* Determina las canciones que m√°s semanas aparecen en la lista de √©xitos. Extrae las 10 que m√°s semanas aparecen

--

* Extrae los 10 artistas cuya canci√≥n aparece m√°s semanas (cuidado: un artista tiene varias canciones)

--

* Determina el artista con m√°s canciones en la lista

---

# CASO PR√ÅCTICO I: billboard

* Calcula el n√∫mero de canciones distintas que aparecen en la lista

--

* Calcula la posici√≥n m√°s alta en la que ha estado cada canci√≥n
--

* Calcula la posici√≥n m√°s alta en la que ha estado un artista

--

* Calcula la primera semana que una canci√≥n entr√≥ en el top 100

--

* Obt√©n una tabla con el ranking medio de cada artista (contando solo el ranking m√°s alto alcanzado por sus canciones), as√≠ como el n√∫mero de canciones (distintas) que ha colocado en el top 100


---

# CASO PR√ÅCTICO I: billboard

*  Realiza un muestreo extrayendo solo los registros de Enrique Iglesias y The Backstreet Boys.

--

* Obt√©n una tabla con el n√∫mero de registros por quatrimestre (y su proporci√≥n respecto al total). Realiza un muestreo aleatorio estratificado, extrayendo el 50% de los datos pero manteniendo la proporci√≥n de datos entre los distintos cuatrimestres.

  
---

name: caso-practico-II

# CASO PR√ÅCTICO II: deberes


* üìù **Ejercicio extra**: en el paquete `{survival}`, la tabla `heart` contiene los mismos datos de la tabla `jasa` pero ya preprocesados. Haz uso de lo aprendido para pasar de `jasa` a `heart`



```r
survival::heart
```

```
&gt;     start   stop event          age        year surgery transplant  id
&gt; 1     0.0   50.0     1 -17.15537303  0.12320329       0          0   1
&gt; 2     0.0    6.0     1   3.83572895  0.25462012       0          0   2
&gt; 3     0.0    1.0     0   6.29705681  0.26557153       0          0   3
&gt; 4     1.0   16.0     1   6.29705681  0.26557153       0          1   3
&gt; 5     0.0   36.0     0  -7.73716632  0.49007529       0          0   4
&gt; 6    36.0   39.0     1  -7.73716632  0.49007529       0          1   4
&gt; 7     0.0   18.0     1 -27.21423682  0.60780287       0          0   5
&gt; 8     0.0    3.0     1   6.59548255  0.70088980       0          0   6
&gt; 9     0.0   51.0     0   2.86926762  0.78028747       0          0   7
&gt; 10   51.0  675.0     1   2.86926762  0.78028747       0          1   7
&gt; 11    0.0   40.0     1  -2.65023956  0.83504449       0          0   8
&gt; 12    0.0   85.0     1  -0.83778234  0.85694730       0          0   9
&gt; 13    0.0   12.0     0  -5.49760438  0.86242300       0          0  10
&gt; 14   12.0   58.0     1  -5.49760438  0.86242300       0          1  10
&gt; 15    0.0   26.0     0  -0.01916496  0.87337440       0          0  11
&gt; 16   26.0  153.0     1  -0.01916496  0.87337440       0          1  11
&gt; 17    0.0    8.0     1   5.19370294  0.96372348       0          0  12
&gt; 18    0.0   17.0     0   6.57357974  0.96919918       0          0  13
&gt; 19   17.0   81.0     1   6.57357974  0.96919918       0          1  13
&gt; 20    0.0   37.0     0   6.01232033  0.97193703       0          0  14
&gt; 21   37.0 1387.0     1   6.01232033  0.97193703       0          1  14
&gt; 22    0.0    1.0     1   5.81519507  0.99110198       1          0  15
&gt; 23    0.0   28.0     0   1.44832307  1.07049966       0          0  16
&gt; 24   28.0  308.0     1   1.44832307  1.07049966       0          1  16
&gt; 25    0.0   36.0     1 -27.66872005  1.07597536       0          0  17
&gt; 26    0.0   20.0     0   8.84873374  1.08692676       0          0  18
&gt; 27   20.0   43.0     1   8.84873374  1.08692676       0          1  18
&gt; 28    0.0   37.0     1  11.12388775  1.13347023       0          0  19
&gt; 29    0.0   18.0     0   7.27994524  1.33059548       0          0  20
&gt; 30   18.0   28.0     1   7.27994524  1.33059548       0          1  20
&gt; 31    0.0    8.0     0  -4.65708419  1.33880903       0          0  21
&gt; 32    8.0 1032.0     1  -4.65708419  1.33880903       0          1  21
&gt; 33    0.0   12.0     0  -5.21560575  1.46201232       0          0  22
&gt; 34   12.0   51.0     1  -5.21560575  1.46201232       0          1  22
&gt; 35    0.0    3.0     0  10.35728953  1.52772074       0          0  23
&gt; 36    3.0  733.0     1  10.35728953  1.52772074       0          1  23
&gt; 37    0.0   83.0     0   3.80013689  1.56605065       0          0  24
&gt; 38   83.0  219.0     1   3.80013689  1.56605065       0          1  24
&gt; 39    0.0   25.0     0 -14.77618070  1.57426420       0          0  25
&gt; 40   25.0 1800.0     0 -14.77618070  1.57426420       0          1  25
&gt; 41    0.0 1401.0     0 -17.46475017  1.58247775       0          0  26
&gt; 42    0.0  263.0     1 -39.21423682  1.59069131       0          0  27
&gt; 43    0.0   71.0     0   6.02327173  1.68377823       0          0  28
&gt; 44   71.0   72.0     1   6.02327173  1.68377823       0          1  28
&gt; 45    0.0   35.0     1   2.43394935  1.78507871       0          0  29
&gt; 46    0.0   16.0     0  -3.08829569  1.88364134       0          0  30
&gt; 47   16.0  852.0     1  -3.08829569  1.88364134       0          1  30
&gt; 48    0.0   16.0     1   6.88569473  1.89459274       0          0  31
&gt; 49    0.0   17.0     0  16.40793977  1.91101985       0          0  32
&gt; 50   17.0   77.0     1  16.40793977  1.91101985       0          1  32
&gt; 51    0.0   51.0     0   0.90349076  2.15742642       0          0  33
&gt; 52   51.0 1587.0     0   0.90349076  2.15742642       0          1  33
&gt; 53    0.0   23.0     0  -7.44695414  2.19849418       0          0  34
&gt; 54   23.0 1572.0     0  -7.44695414  2.19849418       0          1  34
&gt; 55    0.0   12.0     1  -4.53388090  2.30800821       0          0  35
&gt; 56    0.0   46.0     0   0.92539357  2.50787132       0          0  36
&gt; 57   46.0  100.0     1   0.92539357  2.50787132       0          1  36
&gt; 58    0.0   19.0     0  13.50034223  2.56536619       0          0  37
&gt; 59   19.0   66.0     1  13.50034223  2.56536619       0          1  37
&gt; 60    0.0    4.5     0  -6.52977413  2.59274470       0          0  38
&gt; 61    4.5    5.0     1  -6.52977413  2.59274470       0          1  38
&gt; 62    0.0    2.0     0   2.51882272  2.63381246       0          0  39
&gt; 63    2.0   53.0     1   2.51882272  2.63381246       0          1  39
&gt; 64    0.0   41.0     0   0.48186174  2.64750171       1          0  40
&gt; 65   41.0 1408.0     0   0.48186174  2.64750171       1          1  40
&gt; 66    0.0   58.0     0  -2.69678303  2.88295688       1          0  41
&gt; 67   58.0 1322.0     0  -2.69678303  2.88295688       1          1  41
&gt; 68    0.0    3.0     1 -11.55920602  2.88843258       0          0  42
&gt; 69    0.0    2.0     1  -4.60780287  3.05817933       1          0  43
&gt; 70    0.0   40.0     1  -5.42094456  3.16495551       1          0  44
&gt; 71    0.0    1.0     0 -11.81656400  3.26351814       0          0  45
&gt; 72    1.0   45.0     1 -11.81656400  3.26351814       0          1  45
&gt; 73    0.0    2.0     0   0.61054073  3.27720739       1          0  46
&gt; 74    2.0  996.0     1   0.61054073  3.27720739       1          1  46
&gt; 75    0.0   21.0     0  -0.90075291  3.34017796       0          0  47
&gt; 76   21.0   72.0     1  -0.90075291  3.34017796       0          1  47
&gt; 77    0.0    9.0     1   8.03559206  3.34839151       0          0  48
&gt; 78    0.0   36.0     0 -11.34565366  3.37577002       1          0  49
&gt; 79   36.0 1142.0     0 -11.34565366  3.37577002       1          1  49
&gt; 80    0.0   83.0     0  -2.11362081  3.37577002       1          0  50
&gt; 81   83.0  980.0     1  -2.11362081  3.37577002       1          1  50
&gt; 82    0.0   32.0     0   0.73374401  3.47707050       0          0  51
&gt; 83   32.0  285.0     1   0.73374401  3.47707050       0          1  51
&gt; 84    0.0  102.0     1  -6.75154004  3.56468172       0          0  52
&gt; 85    0.0   41.0     0  -0.65708419  3.75085558       0          0  53
&gt; 86   41.0  188.0     1  -0.65708419  3.75085558       0          1  53
&gt; 87    0.0    3.0     1  -0.20807666  3.75085558       0          0  54
&gt; 88    0.0   10.0     0   4.45448323  3.85489391       0          0  55
&gt; 89   10.0   61.0     1   4.45448323  3.85489391       0          1  55
&gt; 90    0.0   67.0     0  -9.25667351  3.92334018       0          0  56
&gt; 91   67.0  942.0     0  -9.25667351  3.92334018       0          1  56
&gt; 92    0.0  149.0     1  -6.73511294  3.95071869       0          0  57
&gt; 93    0.0   21.0     0   0.01642710  3.97809719       1          0  58
&gt; 94   21.0  343.0     1   0.01642710  3.97809719       1          1  58
&gt; 95    0.0   78.0     0  -6.61738535  3.99452430       1          0  59
&gt; 96   78.0  916.0     0  -6.61738535  3.99452430       1          1  59
&gt; 97    0.0    3.0     0   1.05407255  4.13141684       0          0  60
&gt; 98    3.0   68.0     1   1.05407255  4.13141684       0          1  60
&gt; 99    0.0    2.0     1   4.56399726  4.17522245       0          0  61
&gt; 100   0.0   69.0     1  -8.64613279  4.18891170       0          0  62
&gt; 101   0.0   27.0     0 -15.34017796  4.19712526       0          0  63
&gt; 102  27.0  842.0     0 -15.34017796  4.19712526       0          1  63
&gt; 103   0.0   33.0     0   0.81587953  4.33675565       1          0  64
&gt; 104  33.0  584.0     1   0.81587953  4.33675565       1          1  64
&gt; 105   0.0   12.0     0   3.29363450  4.42984257       0          0  65
&gt; 106  12.0   78.0     1   3.29363450  4.42984257       0          1  65
&gt; 107   0.0   32.0     1   5.21286790  4.46817248       0          0  66
&gt; 108   0.0   57.0     0 -28.44900753  4.47638604       0          0  67
&gt; 109  57.0  285.0     1 -28.44900753  4.47638604       0          1  67
&gt; 110   0.0    3.0     0  -2.75975359  4.51745380       0          0  68
&gt; 111   3.0   68.0     1  -2.75975359  4.51745380       0          1  68
&gt; 112   0.0   10.0     0  -0.01095140  4.66803559       0          0  69
&gt; 113  10.0  670.0     0  -0.01095140  4.66803559       0          1  69
&gt; 114   0.0    5.0     0   5.00205339  4.71184120       0          0  70
&gt; 115   5.0   30.0     1   5.00205339  4.71184120       0          1  70
&gt; 116   0.0   31.0     0  -0.59137577  4.80492813       0          0  71
&gt; 117  31.0  620.0     0  -0.59137577  4.80492813       0          1  71
&gt; 118   0.0    4.0     0 -21.27310062  4.87063655       0          0  72
&gt; 119   4.0  596.0     0 -21.27310062  4.87063655       0          1  72
&gt; 120   0.0   27.0     0   8.33127995  4.94729637       0          0  73
&gt; 121  27.0   90.0     1   8.33127995  4.94729637       0          1  73
&gt; 122   0.0    5.0     0 -18.83367556  4.96646133       0          0  74
&gt; 123   5.0   17.0     1 -18.83367556  4.96646133       0          1  74
&gt; 124   0.0    2.0     1   4.18069815  4.99657769       0          0  75
&gt; 125   0.0   46.0     0   4.08487337  5.01026694       1          0  76
&gt; 126  46.0  545.0     0   4.08487337  5.01026694       1          1  76
&gt; 127   0.0   21.0     1  -6.88843258  5.01574264       0          0  77
&gt; 128   0.0  210.0     0   0.70362765  5.09240246       0          0  78
&gt; 129 210.0  515.0     0   0.70362765  5.09240246       0          1  78
&gt; 130   0.0   67.0     0   5.78234086  5.16632444       0          0  79
&gt; 131  67.0   96.0     1   5.78234086  5.16632444       0          1  79
&gt; 132   0.0   26.0     0  -1.55509925  5.18275154       1          0  80
&gt; 133  26.0  482.0     0  -1.55509925  5.18275154       1          1  80
&gt; 134   0.0    6.0     0   4.89253936  5.28405202       0          0  81
&gt; 135   6.0  445.0     0   4.89253936  5.28405202       0          1  81
&gt; 136   0.0  428.0     0 -18.79808350  4.08487337       0          0  82
&gt; 137   0.0   32.0     0   5.30869268  5.31690623       0          0  83
&gt; 138  32.0   80.0     1   5.30869268  5.31690623       0          1  83
&gt; 139   0.0   37.0     0  -5.28131417  5.33333333       0          0  84
&gt; 140  37.0  334.0     1  -5.28131417  5.33333333       0          1  84
&gt; 141   0.0    5.0     1  -0.01916496  5.35249829       0          0  85
&gt; 142   0.0    8.0     0   0.91991786  5.41546886       0          0  86
&gt; 143   8.0  397.0     0   0.91991786  5.41546886       0          1  86
&gt; 144   0.0   60.0     0  -1.74674880  5.47022587       0          0  87
&gt; 145  60.0  110.0     1  -1.74674880  5.47022587       0          1  87
&gt; 146   0.0   31.0     0   6.36276523  5.48939083       0          0  88
&gt; 147  31.0  370.0     0   6.36276523  5.48939083       0          1  88
&gt; 148   0.0  139.0     0   3.04722793  5.51129363       0          0  89
&gt; 149 139.0  207.0     1   3.04722793  5.51129363       0          1  89
&gt; 150   0.0  160.0     0   4.03285421  5.51403149       1          0  90
&gt; 151 160.0  186.0     1   4.03285421  5.51403149       1          1  90
&gt; 152   0.0  340.0     1  -0.40520192  5.53319644       0          0  91
&gt; 153   0.0  310.0     0  -3.01711157  5.57152635       0          0  92
&gt; 154 310.0  340.0     0  -3.01711157  5.57152635       0          1  92
&gt; 155   0.0   28.0     0  -0.24914442  5.77686516       0          0  93
&gt; 156  28.0  265.0     0  -0.24914442  5.77686516       0          1  93
&gt; 157   0.0    4.0     0  -4.15879535  5.95482546       1          0  94
&gt; 158   4.0  165.0     1  -4.15879535  5.95482546       1          1  94
&gt; 159   0.0    2.0     0  -7.71800137  5.97672827       0          0  95
&gt; 160   2.0   16.0     1  -7.71800137  5.97672827       0          1  95
&gt; 161   0.0   13.0     0 -21.34976044  6.00958248       0          0  96
&gt; 162  13.0  180.0     0 -21.34976044  6.00958248       0          1  96
&gt; 163   0.0   21.0     0 -24.38329911  6.14373717       0          0  97
&gt; 164  21.0  131.0     0 -24.38329911  6.14373717       0          1  97
&gt; 165   0.0   96.0     0 -19.37029432  6.20396988       0          0  98
&gt; 166  96.0  109.0     0 -19.37029432  6.20396988       0          1  98
&gt; 167   0.0   21.0     1   1.83436003  6.23408624       0          0  99
&gt; 168   0.0   38.0     0 -12.93908282  6.39561944       1          0 100
&gt; 169  38.0   39.0     0 -12.93908282  6.39561944       1          1 100
&gt; 170   0.0   31.0     0   1.51676934  6.41752225       0          0 101
&gt; 171   0.0   11.0     0  -7.60848734  6.47227926       0          0 102
&gt; 172   0.0    6.0     1  -8.68446270 -0.04928131       0          0 103
```


---


class: inverse center middle
name: clase-11

# CLASE 11: factores e importar/exportar


&amp;nbsp;

### [Factores](#factores)

### [RData](#rdata)

### [Datos rectangulares](#rectangular-data)

### [Datos en Excel](#excel-data)

### [Datos desde Google Drive](#google-data)

### [Datos SAS, STATA y SPSS](#sas-data)

### [Datos desde API](#api-data)

---

name: factores

# Variables cuali: .orange[FACTORES]


En el caso de las **.bg-purple_light[variables cualitativas]**, llamaremos  **niveles o modalidades** a los **diferentes valores** que pueden tomar estos datos. Por ejemplo, en el caso de la variable `sex` del conjunto `starwars`, tenemos 4 niveles permitidos: `female`, `hermaphroditic`, `male` y `none` (am√©n de datos ausentes).


```r
starwars %&gt;% count(sex)
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex                n
&gt;   &lt;chr&gt;          &lt;int&gt;
&gt; 1 female            16
&gt; 2 hermaphroditic     1
&gt; 3 male              60
&gt; 4 none               6
&gt; 5 &lt;NA&gt;               4
```



---

# Variables cuali: .orange[FACTORES]

.pull-left[

Como ya hemos comentado, este tipo de variables se conocen en `R` como **.bg-purple_light[factores]**. Y el paquete fundamental para tratarlos es `{forcats}` (del entorno `{tidyverse}`). 

]

.pull-right[

&lt;img src="./img/factors.jpg" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;

]

---

# Variables cuali: .orange[FACTORES]


Este paquete nos permite fijar los **.bg-purple_light[niveles]** (guardados internamente como `levels`) que toma una determinada variable categ√≥rica para que no puedan generarse equivocaciones, errores en la recolecci√≥n y generaci√≥n de datos. Adem√°s hace que su an√°lisis sea menos costoso computacionalmente a la hora de hacer b√∫squedas y comparativas, d√°ndoles un **.bg-purple_light[tratamiento diferente a las cadena de texto normales]**.

--

Veamos un ejempo sencillo definiendo una variable `estado` que tome los valores `"sano"`, `"leve"` y `"grave"` de la siguiente manera.


```r
estado &lt;-
  c("leve", "grave", "sano", "sano", "leve", "sano", "sano", "grave",
    "grave", "leve", "grave", "sano", "sano")
estado
```

```
&gt;  [1] "leve"  "grave" "sano"  "sano"  "leve"  "sano"  "sano"  "grave" "grave"
&gt; [10] "leve"  "grave" "sano"  "sano"
```

La variable `estado` actualmente es de **.bg-purple_light[tipo texto]**, de tipo `chr`, algo que podemos comprobar con `class(estado)`.


```r
class(estado)
```

```
&gt; [1] "character"
```

---

# Variables cuali: .orange[FACTORES]


Desde un punto de vista estad√≠stico y computacional, para `R` esta variable ahora mismo ser√≠a equivalente una variable de nombres. Pero estad√≠sticamente **.bg-purple_light[no es lo mismo una variable con nombres]** (que identifican muchas veces el registro) que una variable categ√≥rica como estado que **.bg-purple_light[solo puede tomar esos 3 niveles]**. ¬øC√≥mo **.bg-purple_light[convertir a factor]**? Haciendo uso de la funci√≥n `as_factor()` del paquete `{forcats}`.

--


```r
library(tidyverse)
estado_fct &lt;- tibble(paciente = 1:length(estado),
                     estado = as_factor(estado))
estado_fct
```

```
&gt; # A tibble: 13 √ó 2
&gt;    paciente estado
&gt;       &lt;int&gt; &lt;fct&gt; 
&gt;  1        1 leve  
&gt;  2        2 grave 
&gt;  3        3 sano  
&gt;  4        4 sano  
&gt;  5        5 leve  
&gt;  6        6 sano  
&gt;  7        7 sano  
&gt;  8        8 grave 
&gt;  9        9 grave 
&gt; 10       10 leve  
&gt; 11       11 grave 
&gt; 12       12 sano  
&gt; 13       13 sano
```

---

# Variables cuali: .orange[FACTORES]


No solo ha cambiado la clase de la variable sino que ahora, debajo del valor guardado, nos aparece la frase `Levels: grave leve sano`: son las **.bg-purple_light[modalidades o niveles]** de nuestra cualitativa. Imagina que ese d√≠a en el hospital no tuvi√©semos a **nadie en estado grave**: aunque ese d√≠a nuestra variable no tome dicho valor, el estado `grave` es un **.bg-purple_light[nivel permitido en la base de datos]**, as√≠ que aunque lo eliminemos, por ser un factor, el nivel permanece (no lo tenemos ahora pero es un nivel permitido).



```r
estado_fct %&gt;% 
  filter(estado %in% c("sano", "leve")) %&gt;% 
  pull(estado)
```

```
&gt; [1] leve sano sano leve sano sano leve sano sano
&gt; Levels: leve grave sano
```

---

# Variables cuali: .orange[FACTORES]


Con `factor()` podemos **.bg-purple_light[especificar expl√≠citamente]** los nombres de las modalidades, incluso si son nominales u **.bg-purple_light[ordinales]**


```r
estado_fct &lt;-
  tibble(paciente = 1:length(estado),
         estado = factor(estado, ordered = TRUE))
estado_fct %&gt;% pull(estado)
```

```
&gt;  [1] leve  grave sano  sano  leve  sano  sano  grave grave leve  grave sano 
&gt; [13] sano 
&gt; Levels: grave &lt; leve &lt; sano
```

---

# Variables cuali: .orange[FACTORES]


Con  `levels = ...` podemos indicarle expl√≠citamente el **.bg-purple_light[orden de las modalidades]**


```r
estado_fct &lt;-
  tibble(paciente = 1:length(estado),
         estado = factor(estado,
                         levels = c("sano", "leve", "grave"),
                         ordered = TRUE))
estado_fct %&gt;% pull(estado)
```

```
&gt;  [1] leve  grave sano  sano  leve  sano  sano  grave grave leve  grave sano 
&gt; [13] sano 
&gt; Levels: sano &lt; leve &lt; grave
```



---

# Variables cuali: .orange[FACTORES]


.pull-left[

Si queremos indicarle que **.bg-purple_light[elimine un nivel no usado]** en ese momento (y que queremos excluir de la definici√≥n) podemos hacerlo con `fct_drop()`

]


.pull-right[

&lt;img src="./img/drop_factor.jpg" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;

]


```r
estado_fct %&gt;% 
  filter(estado %in% c("sano", "leve")) %&gt;% 
  mutate(estado = fct_drop(estado)) %&gt;% 
  pull(estado)
```

```
&gt; [1] leve sano sano leve sano sano leve sano sano
&gt; Levels: sano &lt; leve
```

---

# Variables cuali: .orange[FACTORES]

.pull-left[

Al igual que podemos eliminar niveles podemos **.bg-purple_light[ampliar los niveles existentes]** (aunque no existan datos de ese nivel en ese momento) con `fct_expand()`


]


.pull-right[

&lt;img src="./img/factor_expand.jpg" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;

]


```r
estado_fct %&gt;% 
  mutate(estado = fct_expand(estado, c("UCI", "fallecido"))) %&gt;% 
  pull(estado)
```

```
&gt;  [1] leve  grave sano  sano  leve  sano  sano  grave grave leve  grave sano 
&gt; [13] sano 
&gt; Levels: sano &lt; leve &lt; grave &lt; UCI &lt; fallecido
```

---

# Variables cuali: .orange[FACTORES]

.pull-left[

Adem√°s con `fct_explicit_na()` podemos **.bg-purple_light[asignar un nivel a los valores]** para que sea incluido dicho nivel en los an√°lisis y visualizaciones.


]


.pull-right[

&lt;img src="./img/factor_explicit.jpg" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;

]


```r
fct_explicit_na(factor(c("a", "b", NA)))
```

```
&gt; [1] a         b         (Missing)
&gt; Levels: a b (Missing)
```

---

# Variables cuali: .orange[FACTORES]


Incluso una vez definidos podemos **.bg-purple_light[reordenar los n√≠veles]** con `fct_relevel()`



```r
estado_fct_expand &lt;- 
  estado_fct %&gt;% 
  mutate(estado = fct_expand(estado, c("UCI", "fallecido"))) %&gt;% 
  pull(estado)

estado_fct_expand %&gt;%
  fct_relevel(c("fallecido", "leve", "sano",
                "grave", "UCI"))
```

```
&gt;  [1] leve  grave sano  sano  leve  sano  sano  grave grave leve  grave sano 
&gt; [13] sano 
&gt; Levels: fallecido &lt; leve &lt; sano &lt; grave &lt; UCI
```


---

# Variables cuali: .orange[FACTORES]

.pull-left[

Esta forma de trabajar con variables cualitativas nos permite dar una **.bg-purple_light[definici√≥n te√≥rica]** de nuestra base de datos, pudiendo incluso contar valores que a√∫n no existen (pero que podr√≠an), haciendo uso de `fct_count()`

]


.pull-right[

&lt;img src="./img/fct_count.jpg" width="70%" style="display: block; margin: auto auto auto 0;" /&gt;

]


```r
estado_fct %&gt;% 
  mutate(estado = fct_expand(estado, c("UCI", "fallecido"))) %&gt;% 
  pull(estado) %&gt;% 
  fct_count()
```

```
&gt; # A tibble: 5 √ó 2
&gt;   f             n
&gt;   &lt;fct&gt;     &lt;int&gt;
&gt; 1 sano          6
&gt; 2 leve          3
&gt; 3 grave         4
&gt; 4 UCI           0
&gt; 5 fallecido     0
```


---

# Variables cuali: .orange[FACTORES]


Los n√≠veles tambi√©n podemos **.bg-purple_light[ordenarlos por frecuencia]** con `fct_infreq()`


```r
estado_fct %&gt;% 
  mutate(estado = fct_infreq(estado)) %&gt;% 
  pull(estado) %&gt;% 
  fct_count()
```

```
&gt; # A tibble: 3 √ó 2
&gt;   f         n
&gt;   &lt;fct&gt; &lt;int&gt;
&gt; 1 sano      6
&gt; 2 grave     4
&gt; 3 leve      3
```

---

# Variables cuali: .orange[FACTORES]


A veces querremos **.bg-purple_light[agrupar niveles]**, por ejemplo, no permitiendo niveles que **.bg-purple_light[no sucedan un m√≠nimo de veces]** con `fct_lump_min(.., min = ..)` (las observaciones que no lo cumplan ir√°n a un **nivel gen√©rico** llamado `Other`, aunque se puede cambiar con el argumento `other_level`). 

.pull-left[



```r
estado_fct %&gt;% 
  pull(estado) %&gt;% 
  fct_lump_min(min = 4)
```

```
&gt;  [1] Other grave sano  sano  Other sano  sano  grave grave Other grave sano 
&gt; [13] sano 
&gt; Levels: sano &lt; grave &lt; Other
```

]

.pull-right[


```r
estado_fct %&gt;% 
  pull(estado) %&gt;% 
  fct_lump_min(min = 4,
               other_level = "otros")
```

```
&gt;  [1] otros grave sano  sano  otros sano  sano  grave grave otros grave sano 
&gt; [13] sano 
&gt; Levels: sano &lt; grave &lt; otros
```

]

---

# Variables cuali: .orange[FACTORES]


Podemos hacer algo equivalente pero en funci√≥n de su **.bg-purple_light[frecuencia relativa]** con `fct_lump_prop()`.



```r
estado_fct %&gt;% 
  pull(estado) %&gt;% 
  fct_lump_prop(prop = 0.4,
                other_level = "otros")
```

```
&gt;  [1] otros otros sano  sano  otros sano  sano  otros otros otros otros sano 
&gt; [13] sano 
&gt; Levels: sano &lt; otros
```

---


# Variables cuali: .orange[FACTORES]

Esto lo podemos aplicar a nuestros conjuntos de datos para **.bg-purple_light[recategorizar variables]** de forma muy r√°pida.


```r
starwars %&gt;% 
  drop_na(species) %&gt;% 
  mutate(species =
           fct_lump_min(species, min = 3,
                        other_level = "Otras")) %&gt;% 
  count(species)
```

```
&gt; # A tibble: 4 √ó 2
&gt;   species     n
&gt;   &lt;fct&gt;   &lt;int&gt;
&gt; 1 Droid       6
&gt; 2 Gungan      3
&gt; 3 Human      35
&gt; 4 Otras      39
```

---

# Variables cuali: .orange[FACTORES]

Con `fct_reorder()` podemos tambi√©n indicar que queremos **.bg-purple_light[ordenar los factores]** en funci√≥n de una funci√≥n aplicada a otra variable.



```r
starwars_factor &lt;- 
  starwars %&gt;% 
  drop_na(height, species) %&gt;% 
  mutate(species =
           fct_lump_min(species, min = 3,
                        other_level = "Otras"))
```

.pull-left[


```r
starwars_factor %&gt;% pull(species)
```

```
&gt;  [1] Human  Droid  Droid  Human  Human  Human  Human  Droid  Human  Human 
&gt; [11] Human  Human  Otras  Human  Otras  Otras  Human  Human  Otras  Human 
&gt; [21] Human  Droid  Otras  Human  Human  Otras  Human  Otras  Otras  Human 
&gt; [31] Otras  Human  Gungan Gungan Gungan Otras  Otras  Human  Otras  Otras 
&gt; [41] Otras  Otras  Otras  Otras  Human  Otras  Otras  Otras  Otras  Otras 
&gt; [51] Otras  Otras  Otras  Human  Human  Human  Otras  Otras  Otras  Human 
&gt; [61] Human  Human  Human  Otras  Otras  Otras  Otras  Human  Otras  Droid 
&gt; [71] Otras  Otras  Otras  Otras  Otras  Human  Otras  Human 
&gt; Levels: Droid Gungan Human Otras
```

]

.pull-right[


```r
starwars_factor %&gt;%
  mutate(species = fct_reorder(species, height, mean)) %&gt;% 
  pull(species)
```

```
&gt;  [1] Human  Droid  Droid  Human  Human  Human  Human  Droid  Human  Human 
&gt; [11] Human  Human  Otras  Human  Otras  Otras  Human  Human  Otras  Human 
&gt; [21] Human  Droid  Otras  Human  Human  Otras  Human  Otras  Otras  Human 
&gt; [31] Otras  Human  Gungan Gungan Gungan Otras  Otras  Human  Otras  Otras 
&gt; [41] Otras  Otras  Otras  Otras  Human  Otras  Otras  Otras  Otras  Otras 
&gt; [51] Otras  Otras  Otras  Human  Human  Human  Otras  Otras  Otras  Human 
&gt; [61] Human  Human  Human  Otras  Otras  Otras  Otras  Human  Otras  Droid 
&gt; [71] Otras  Otras  Otras  Otras  Otras  Human  Otras  Human 
&gt; Levels: Droid Otras Human Gungan
```

]


---

# Ejercicios (factores)


.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 1**: dada la variable `meses` definida debajo (definida como un vector de caracteres), convierte dicha variable a factor (solo eso)


```r
meses &lt;- c("Ene", "Feb", "Mar", "Abr")
```
  
* üìù **Ejercicio 2**:  dada la variable `meses` definida debajo convierte dicha variable a factor pero indicando los niveles de forma correcta.


```r
meses &lt;- c(NA, "Abr", "Ene", "Oct", "Jul", "Ene", "Sep", NA, "Feb", "Dic",
           "Jul", "Mar", "Ene", "Mar", "Feb", "Abr", "May", "Oct", "Sep",  NA,
           "Dic", "Jul", "Nov", "Feb", "Oct", "Jun", "Sep", "Oct", "Oct", "Sep")
```

  
* üìù **Ejercicio 3**: cuenta cuantos valores hay de cada mes pero teniendo en cuenta que son factores (quiz√°s haya niveles sin ser usados y de los que deber√≠a obtener un 0).

]

.panel[.panel-name[Sol. ej. 1]


```r
meses &lt;- c("Ene", "Feb", "Mar", "Abr")
meses_fct &lt;- as_factor(meses)
meses_fct
```

```
&gt; [1] Ene Feb Mar Abr
&gt; Levels: Ene Feb Mar Abr
```



]

.panel[.panel-name[Sol. ej. 2]


```r
meses &lt;- c(NA, "Abr", "Ene", "Oct", "Jul", "Ene", "Sep", NA, "Feb", "Dic",
           "Jul", "Mar", "Ene", "Mar", "Feb", "Abr", "May", "Oct", "Sep",  NA,
           "Dic", "Jul", "Nov", "Feb", "Oct", "Jun", "Sep", "Oct", "Oct", "Sep")

# Orden de niveles correcto e incluimos agosto aunque no haya
meses_fct &lt;-
  factor(meses,
         levels = c("Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"))
meses_fct
```

```
&gt;  [1] &lt;NA&gt; Abr  Ene  Oct  Jul  Ene  Sep  &lt;NA&gt; Feb  Dic  Jul  Mar  Ene  Mar  Feb 
&gt; [16] Abr  May  Oct  Sep  &lt;NA&gt; Dic  Jul  Nov  Feb  Oct  Jun  Sep  Oct  Oct  Sep 
&gt; Levels: Ene Feb Mar Abr May Jun Jul Ago Sep Oct Nov Dic
```

]

.panel[.panel-name[Sol. ej. 3]


```r
meses_fct %&gt;% fct_count()
```

```
&gt; # A tibble: 13 √ó 2
&gt;    f         n
&gt;    &lt;fct&gt; &lt;int&gt;
&gt;  1 Ene       3
&gt;  2 Feb       3
&gt;  3 Mar       2
&gt;  4 Abr       2
&gt;  5 May       1
&gt;  6 Jun       1
&gt;  7 Jul       3
&gt;  8 Ago       0
&gt;  9 Sep       4
&gt; 10 Oct       5
&gt; 11 Nov       1
&gt; 12 Dic       2
&gt; 13 &lt;NA&gt;      3
```

]

]

---

# Ejercicios (factores)


.panelset[
.panel[.panel-name[Ejercicios]

* üìù **Ejercicio 4**: dado que hay ausentes, indica que los ausentes sea un decimotercer nivel etiquetado como "ausente".

* üìù **Ejercicio 5**: elimina los niveles no usados.

* üìù **Ejercicio 6**: ordena los niveles por frecuencia de aparici√≥n.
  
* üìù **Ejercicio 7**:  agrupa niveles de forma que todo nivel que no aparezca al menos el 7% de las veces se agrupe en un nivel llamado "otros meses"
]

.panel[.panel-name[Sol. ej. 4]


```r
meses_fct &lt;- 
  meses_fct %&gt;%
  fct_explicit_na(na_level = "ausente")
meses_fct
```

```
&gt;  [1] ausente Abr     Ene     Oct     Jul     Ene     Sep     ausente Feb    
&gt; [10] Dic     Jul     Mar     Ene     Mar     Feb     Abr     May     Oct    
&gt; [19] Sep     ausente Dic     Jul     Nov     Feb     Oct     Jun     Sep    
&gt; [28] Oct     Oct     Sep    
&gt; Levels: Ene Feb Mar Abr May Jun Jul Ago Sep Oct Nov Dic ausente
```

]

.panel[.panel-name[Sol. ej. 4]


```r
meses_fct &lt;- 
  meses_fct %&gt;%
  fct_drop()
meses_fct
```

```
&gt;  [1] ausente Abr     Ene     Oct     Jul     Ene     Sep     ausente Feb    
&gt; [10] Dic     Jul     Mar     Ene     Mar     Feb     Abr     May     Oct    
&gt; [19] Sep     ausente Dic     Jul     Nov     Feb     Oct     Jun     Sep    
&gt; [28] Oct     Oct     Sep    
&gt; Levels: Ene Feb Mar Abr May Jun Jul Sep Oct Nov Dic ausente
```

]

.panel[.panel-name[Sol. ej. 6]


```r
meses_fct %&gt;% 
  fct_infreq()
```

```
&gt;  [1] ausente Abr     Ene     Oct     Jul     Ene     Sep     ausente Feb    
&gt; [10] Dic     Jul     Mar     Ene     Mar     Feb     Abr     May     Oct    
&gt; [19] Sep     ausente Dic     Jul     Nov     Feb     Oct     Jun     Sep    
&gt; [28] Oct     Oct     Sep    
&gt; Levels: Oct Sep Ene Feb Jul ausente Mar Abr Dic May Jun Nov
```

]

.panel[.panel-name[Sol. ej. 7]


```r
meses_fct &lt;-
  meses_fct %&gt;% 
  fct_lump_prop(prop = 0.07, other_level = "otros")
meses_fct
```

```
&gt;  [1] ausente otros   Ene     Oct     Jul     Ene     Sep     ausente Feb    
&gt; [10] otros   Jul     otros   Ene     otros   Feb     otros   otros   Oct    
&gt; [19] Sep     ausente otros   Jul     otros   Feb     Oct     otros   Sep    
&gt; [28] Oct     Oct     Sep    
&gt; Levels: Ene Feb Jul Sep Oct ausente otros
```

]
]

---

name: rdata

# Importando datos: .orange[.RData/.rda]

Hasta ahora solo hemos usado datos cargados ya en paquetes pero muchas veces necesitaremos **.bg-purple_light[importarlos desde fuera]**. El fichero m√°s simple para importar en `R` (y que suele ocupar menos espacio en disco) son los archivos `.RData` y `.rda`: son **.bg-purple_light[extensiones nativas]** de R.

--

Para cargarlo simplemente necesitamos usar la funci√≥n `load()` indic√°ndole la **.bg-purple_light[ruta del archivo]** (sin espacios, ni caracteres extra√±os, ni tildes, ni etc)


```r
*load("./datos/titanic.RData")
as_tibble(titanic)
```

```
&gt; # A tibble: 891 √ó 12
&gt;    PassengerId Survived Pclass Name   Sex     Age SibSp Parch Ticket  Fare Cabin
&gt;          &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;
&gt;  1           1        0      3 Braun‚Ä¶ male     22     1     0 A/5 2‚Ä¶  7.25 ""   
&gt;  2           2        1      1 Cumin‚Ä¶ fema‚Ä¶    38     1     0 PC 17‚Ä¶ 71.3  "C85"
&gt;  3           3        1      3 Heikk‚Ä¶ fema‚Ä¶    26     0     0 STON/‚Ä¶  7.92 ""   
&gt;  4           4        1      1 Futre‚Ä¶ fema‚Ä¶    35     1     0 113803 53.1  "C12‚Ä¶
&gt;  5           5        0      3 Allen‚Ä¶ male     35     0     0 373450  8.05 ""   
&gt;  6           6        0      3 Moran‚Ä¶ male     NA     0     0 330877  8.46 ""   
&gt;  7           7        0      1 McCar‚Ä¶ male     54     0     0 17463  51.9  "E46"
&gt;  8           8        0      3 Palss‚Ä¶ male      2     3     1 349909 21.1  ""   
&gt;  9           9        1      3 Johns‚Ä¶ fema‚Ä¶    27     0     2 347742 11.1  ""   
&gt; 10          10        1      2 Nasse‚Ä¶ fema‚Ä¶    14     1     0 237736 30.1  ""   
&gt; # ‚Ä¶ with 881 more rows, and 1 more variable: Embarked &lt;fct&gt;
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Importando datos: .orange[.RData/.rda]

F√≠jate que esta carga **.bg-purple_light[no se asigna a ninguna variable]** ya que en `.RData` ya tenemos dicha variable. No tenemos guardado un archivo en un formato concreto, tenemos guardada la variable en s√≠ (en este caso es un `data.frame` que se llama `titanic`, pero podr√≠a ser un vector, una lista, una matriz, etc)


```r
*load("./datos/titanic.RData")
as_tibble(titanic)
```

```
&gt; # A tibble: 891 √ó 12
&gt;    PassengerId Survived Pclass Name   Sex     Age SibSp Parch Ticket  Fare Cabin
&gt;          &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;
&gt;  1           1        0      3 Braun‚Ä¶ male     22     1     0 A/5 2‚Ä¶  7.25 ""   
&gt;  2           2        1      1 Cumin‚Ä¶ fema‚Ä¶    38     1     0 PC 17‚Ä¶ 71.3  "C85"
&gt;  3           3        1      3 Heikk‚Ä¶ fema‚Ä¶    26     0     0 STON/‚Ä¶  7.92 ""   
&gt;  4           4        1      1 Futre‚Ä¶ fema‚Ä¶    35     1     0 113803 53.1  "C12‚Ä¶
&gt;  5           5        0      3 Allen‚Ä¶ male     35     0     0 373450  8.05 ""   
&gt;  6           6        0      3 Moran‚Ä¶ male     NA     0     0 330877  8.46 ""   
&gt;  7           7        0      1 McCar‚Ä¶ male     54     0     0 17463  51.9  "E46"
&gt;  8           8        0      3 Palss‚Ä¶ male      2     3     1 349909 21.1  ""   
&gt;  9           9        1      3 Johns‚Ä¶ fema‚Ä¶    27     0     2 347742 11.1  ""   
&gt; 10          10        1      2 Nasse‚Ä¶ fema‚Ä¶    14     1     0 237736 30.1  ""   
&gt; # ‚Ä¶ with 881 more rows, and 1 more variable: Embarked &lt;fct&gt;
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Exportando datos: .orange[.RData/.rda]

De la misma manera que podemos importar, podemos **.bg-purple_light[exportar]** en `.RData`. Esta opci√≥n es la m√°s recomendada si las variables guardadas van a ser √∫nicamente usadas en `R`: recuerda que esta extensi√≥n es nativa de `R` por lo que **.bg-purple_light[solo se podr√° usar en `R`]**. Para ello nos basta con usar `save(objeto, file = ruta con extensi√≥n)`

.pull-left[


```r
tabla &lt;- tibble("a" = 1:4, "b" = 1:4)
save(tabla,
     file = "./datos/tabla_prueba.RData")
```

]

.pull-right[


```r
load("./datos/tabla_prueba.RData")
tabla
```

```
&gt; # A tibble: 4 √ó 2
&gt;       a     b
&gt;   &lt;int&gt; &lt;int&gt;
&gt; 1     1     1
&gt; 2     2     2
&gt; 3     3     3
&gt; 4     4     4
```

]

---

name: rectangular-data

# Importando datos .orange[RECTANGULARES]

El paquete `{readr}` dentro del entorno `{tidyverse}` contiene distintas funciones √∫tiles para la carga de **.bg-purple_light[datos rectangulares]** (sin formatear).

.pull-left[

* `read_csv()`: archivos `.csv` cuyo separador sea la **.bg-purple_light[coma]** `,`
* `read_csv2()`: archivos `.csv` cuyo separador sea el **.bg-purple_light[punto y coma]** `;`
* `read_tsv()`: archivos cuyos valores est√©n separados por un **.bg-purple_light[tabulador]**.
* `read_table()`: archivos cuyos valores est√©n separados por un **.bg-purple_light[espacio]**.
* `read_delim()`: **funci√≥n general** para leer archivos delimitados por caracteres.

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://github.com/rstudio/cheatsheets/raw/main/pngs/thumbnails/data-import-cheatsheet-thumbs.png" alt="Ver m√°s en https://readr.tidyverse.org/" width="110%" /&gt;
&lt;p class="caption"&gt;Ver m√°s en https://readr.tidyverse.org/&lt;/p&gt;
&lt;/div&gt;

]

Todos necesitan como argumento la **.bg-purple_light[ruta del archivo]** (que podemos simplificar teniendo una carpeta de datos en nuestro proyecto), am√©n de otros argumentos opcionales (saltar o no cabecera, decimales son con punto o coma, etc)


---

# Importando datos .orange[RECTANGULARES]

La principal ventaja de `{readr}` es que **.bg-purple_light[automatiza el formateo]** necesario para pasar de un archivo plano (sin formato) a un `tibble` (en filas y columnas, con formato).

--

En `read_csv()` necesitaremos pasar como argumento la ruta del archivo en `file`


```r
library(readr)
chickens &lt;- read_csv(file = "./datos/chickens.csv")
chickens
```

```
&gt; # A tibble: 5 √ó 4
&gt;   chicken                 sex     eggs_laid motto                               
&gt;   &lt;chr&gt;                   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                               
&gt; 1 Foghorn Leghorn         rooster         0 That's a joke, ah say, that's a jok‚Ä¶
&gt; 2 Chicken Little          hen             3 The sky is falling!                 
&gt; 3 Ginger                  hen            12 Listen. We'll either die free chick‚Ä¶
&gt; 4 Camilla the Chicken     hen             7 Bawk, buck, ba-gawk.                
&gt; 5 Ernie The Giant Chicken rooster         0 Put Captain Solo in the cargo hold.
```

---

# Importando datos .orange[RECTANGULARES]

El formato de las columnas normalmente lo har√° `read_csv()` de forma autom√°tica, y podemos consultarlo con `spec()`


```r
spec(chickens)
```

```
&gt; cols(
&gt;   chicken = col_character(),
&gt;   sex = col_character(),
&gt;   eggs_laid = col_double(),
&gt;   motto = col_character()
&gt; )
```

---


# Importando datos .orange[RECTANGULARES]

Aunque lo haga normalmente bien de forma autom√°tica podemos **.bg-purple_light[especificar el formato expl√≠citamente]** en `col_types = list()` (en formato lista, con `col_xxx()` para el formateo de cada tipo de variable, por ejemplo una la pondremos como factor).


```r
chickens &lt;-
  read_csv(file = "./datos/chickens.csv",
           col_types = list(col_character(), col_factor(),
                            col_double(), col_character()))
chickens
```

```
&gt; # A tibble: 5 √ó 4
&gt;   chicken                 sex     eggs_laid motto                               
&gt;   &lt;chr&gt;                   &lt;fct&gt;       &lt;dbl&gt; &lt;chr&gt;                               
&gt; 1 Foghorn Leghorn         rooster         0 That's a joke, ah say, that's a jok‚Ä¶
&gt; 2 Chicken Little          hen             3 The sky is falling!                 
&gt; 3 Ginger                  hen            12 Listen. We'll either die free chick‚Ä¶
&gt; 4 Camilla the Chicken     hen             7 Bawk, buck, ba-gawk.                
&gt; 5 Ernie The Giant Chicken rooster         0 Put Captain Solo in the cargo hold.
```

---

# Importando datos .orange[RECTANGULARES]

Incluso podemos **.bg-purple_light[indicar que columnas que queremos]** (imagina que no quieres cargar todas, y quieres seleccionar ya en la carga para que no te ocupe en memoria), indic√°ndoselo en `col_select = ...`.


```r
chickens &lt;-
  read_csv(file = "./datos/chickens.csv",
           col_select = c(chicken, eggs_laid))
chickens
```

```
&gt; # A tibble: 5 √ó 2
&gt;   chicken                 eggs_laid
&gt;   &lt;chr&gt;                       &lt;dbl&gt;
&gt; 1 Foghorn Leghorn                 0
&gt; 2 Chicken Little                  3
&gt; 3 Ginger                         12
&gt; 4 Camilla the Chicken             7
&gt; 5 Ernie The Giant Chicken         0
```

---

# Importando datos .orange[RECTANGULARES]

Dentro de `col_select = ...` podemos **.bg-purple_light[usar sentencias tidyverse]** como `starts_with(...)`


```r
chickens &lt;-
  read_csv(file = "./datos/chickens.csv",
           col_select = c(starts_with("c"), last_col()))
chickens
```

```
&gt; # A tibble: 5 √ó 2
&gt;   chicken                 motto                                                 
&gt;   &lt;chr&gt;                   &lt;chr&gt;                                                 
&gt; 1 Foghorn Leghorn         That's a joke, ah say, that's a joke, son.            
&gt; 2 Chicken Little          The sky is falling!                                   
&gt; 3 Ginger                  Listen. We'll either die free chickens or we die tryi‚Ä¶
&gt; 4 Camilla the Chicken     Bawk, buck, ba-gawk.                                  
&gt; 5 Ernie The Giant Chicken Put Captain Solo in the cargo hold.
```

---

# Importando datos .orange[RECTANGULARES]

Tambi√©n podemos **.bg-purple_light[decidir nosotros los nombres]** de las variables indic√°ndoselo en `col_names = ...` (incluso si los decimales est√°n codificados con punto o coma)


```r
chickens &lt;-
  read_csv(file = "./datos/chickens.csv",
           col_names = c("var1", "var2", "var3", "var4"))
chickens
```

```
&gt; # A tibble: 6 √ó 4
&gt;   var1                    var2    var3      var4                                
&gt;   &lt;chr&gt;                   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;                               
&gt; 1 chicken                 sex     eggs_laid motto                               
&gt; 2 Foghorn Leghorn         rooster 0         That's a joke, ah say, that's a jok‚Ä¶
&gt; 3 Chicken Little          hen     3         The sky is falling!                 
&gt; 4 Ginger                  hen     12        Listen. We'll either die free chick‚Ä¶
&gt; 5 Camilla the Chicken     hen     7         Bawk, buck, ba-gawk.                
&gt; 6 Ernie The Giant Chicken rooster 0         Put Captain Solo in the cargo hold.
```


---

# Importando datos .orange[RECTANGULARES]

¬øQu√© sucede cuando el separador no el correcto? Como puedes ver en la carga del siguiente `.txt`, nos interpreta todo como una sola columna, ya que no le hemos indicado donde separar


```r
datos_txt &lt;- read_csv(file = "./datos/massey-rating.txt")
as_tibble(datos_txt)
```

```
&gt; # A tibble: 10 √ó 1
&gt;    `UCC PAY LAZ KPK  RT   COF BIH DII ENG ACU Rank Team            Conf`
&gt;    &lt;chr&gt;                                                                
&gt;  1 1   1   1   1   1     1   1   1   1   1    1 Ohio St          B10    
&gt;  2 2   2   2   2   2     2   2   2   4   2    2 Oregon           P12    
&gt;  3 3   4   3   4   3     4   3   4   2   3    3 Alabama          SEC    
&gt;  4 4   3   4   3   4     3   5   3   3   4    4 TCU              B12    
&gt;  5 6   6   6   5   5     7   6   5   6  11    5 Michigan St      B10    
&gt;  6 7   7   7   6   7     6  11   8   7   8    6 Georgia          SEC    
&gt;  7 5   5   5   7   6     8   4   6   5   5    7 Florida St       ACC    
&gt;  8 8   8   9   9  10     5   7   7  10   7    8 Baylor           B12    
&gt;  9 9  11   8  13  11    11  12   9  14   9    9 Georgia Tech     ACC    
&gt; 10 13  10  13  11   8     9  10  11   9  10   10 Mississippi      SEC
```

---

# Importando datos .orange[RECTANGULARES]

Para ello tenemos `read_csv2()` cuando el separador sea el **.bg-purple_light[punto y coma]**, `read_tsv()` cuando el separador sea un **.bg-purple_light[tabulador]**, `read_table()` cuando el separador sea un **.bg-purple_light[espacio]** y  `read_delim()` en general


```r
datos_txt &lt;- read_table(file = "./datos/massey-rating.txt")
as_tibble(datos_txt)
```

```
&gt; # A tibble: 10 √ó 13
&gt;      UCC   PAY   LAZ   KPK    RT   COF   BIH   DII   ENG   ACU  Rank Team  Conf 
&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt;  1     1     1     1     1     1     1     1     1     1     1     1 Ohio  St   
&gt;  2     2     2     2     2     2     2     2     2     4     2     2 Oreg‚Ä¶ P12  
&gt;  3     3     4     3     4     3     4     3     4     2     3     3 Alab‚Ä¶ SEC  
&gt;  4     4     3     4     3     4     3     5     3     3     4     4 TCU   B12  
&gt;  5     6     6     6     5     5     7     6     5     6    11     5 Mich‚Ä¶ St   
&gt;  6     7     7     7     6     7     6    11     8     7     8     6 Geor‚Ä¶ SEC  
&gt;  7     5     5     5     7     6     8     4     6     5     5     7 Flor‚Ä¶ St   
&gt;  8     8     8     9     9    10     5     7     7    10     7     8 Bayl‚Ä¶ B12  
&gt;  9     9    11     8    13    11    11    12     9    14     9     9 Geor‚Ä¶ Tech 
&gt; 10    13    10    13    11     8     9    10    11     9    10    10 Miss‚Ä¶ SEC
```

---

# Exportando datos .orange[RECTANGULARES]

Para **.bg-purple_light[exportar datos]** rectangulares las funciones ser√°n similares pero con el prefijo `write_xxx()` y el formato adecuado.

Por ejemplo, vamos a **.bg-purple_light[exportar a un .csv]** el dataset de starwars (seleccionando solo las columnas que no son lista)


```r
write_csv(starwars %&gt;% select(name:species),
          file = "./datos/starwars.csv")
read_csv(file = "./datos/starwars.csv")
```

```
&gt; # A tibble: 87 √ó 11
&gt;    name        height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
&gt;    &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
&gt;  1 Luke Skywa‚Ä¶    172    77 blond   fair    blue       19   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  2 C-3PO          167    75 &lt;NA&gt;    gold    yellow    112   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  3 R2-D2           96    32 &lt;NA&gt;    white,‚Ä¶ red        33   none  mascu‚Ä¶ Naboo  
&gt;  4 Darth Vader    202   136 none    white   yellow     41.9 male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  5 Leia Organa    150    49 brown   light   brown      19   fema‚Ä¶ femin‚Ä¶ Aldera‚Ä¶
&gt;  6 Owen Lars      178   120 brown,‚Ä¶ light   blue       52   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  7 Beru White‚Ä¶    165    75 brown   light   blue       47   fema‚Ä¶ femin‚Ä¶ Tatooi‚Ä¶
&gt;  8 R5-D4           97    32 &lt;NA&gt;    white,‚Ä¶ red        NA   none  mascu‚Ä¶ Tatooi‚Ä¶
&gt;  9 Biggs Dark‚Ä¶    183    84 black   light   brown      24   male  mascu‚Ä¶ Tatooi‚Ä¶
&gt; 10 Obi-Wan Ke‚Ä¶    182    77 auburn‚Ä¶ fair    blue-g‚Ä¶    57   male  mascu‚Ä¶ Stewjon
&gt; # ‚Ä¶ with 77 more rows, 1 more variable: species &lt;chr&gt;, and abbreviated variable
&gt; #   names ¬π‚Äãhair_color, ¬≤‚Äãskin_color, ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Importando datos .orange[DESDE WEB]


Una de las principales ventajas de `R` es que podemos **.bg-purple_light[importar datos desde una web]**, sin necesidad de realizar la descarga manual del archivo. Y lo mejor es que se har√° igual que hemos importado todo: en lugar de pasarle la ruta local de nuestro PC, le **.bg-purple_light[indicaremos el enlace (permalink)]**.



```r
momo_datos &lt;-
  read_csv(file = "https://momo.isciii.es/public/momo/data",
           n_max = 500000)
momo_datos
```

```
&gt; # A tibble: 500,000 √ó 15
&gt;    ambito   cod_amb‚Ä¶¬π cod_i‚Ä¶¬≤ nombr‚Ä¶¬≥ cod_s‚Ä¶‚Å¥ nombr‚Ä¶‚Åµ cod_g‚Ä¶‚Å∂ nombr‚Ä¶‚Å∑ fecha_de‚Ä¶‚Å∏
&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;date&gt;    
&gt;  1 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   all     todos   2022-11-26
&gt;  2 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   +85     edad &gt;‚Ä¶ 2022-11-26
&gt;  3 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   0-14    edad 0‚Ä¶ 2022-11-26
&gt;  4 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   15-44   edad 1‚Ä¶ 2022-11-26
&gt;  5 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   45-64   edad 4‚Ä¶ 2022-11-26
&gt;  6 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   65-74   edad 6‚Ä¶ 2022-11-26
&gt;  7 nacional &lt;NA&gt;           NA &lt;NA&gt;    all     todos   75-84   edad 7‚Ä¶ 2022-11-26
&gt;  8 nacional &lt;NA&gt;           NA &lt;NA&gt;    1       hombres all     todos   2022-11-26
&gt;  9 nacional &lt;NA&gt;           NA &lt;NA&gt;    1       hombres +85     edad &gt;‚Ä¶ 2022-11-26
&gt; 10 nacional &lt;NA&gt;           NA &lt;NA&gt;    1       hombres 0-14    edad 0‚Ä¶ 2022-11-26
&gt; # ‚Ä¶ with 499,990 more rows, 6 more variables: defunciones_observadas &lt;dbl&gt;,
&gt; #   defunciones_estimadas_base &lt;dbl&gt;, defunciones_estimadas_base_q01 &lt;dbl&gt;,
&gt; #   defunciones_estimadas_base_q99 &lt;dbl&gt;, defunciones_atrib_exc_temp &lt;dbl&gt;,
&gt; #   defunciones_atrib_def_temp &lt;dbl&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãcod_ambito, ¬≤‚Äãcod_ine_ambito, ¬≥‚Äãnombre_ambito, ‚Å¥‚Äãcod_sexo, ‚Åµ‚Äãnombre_sexo,
&gt; #   ‚Å∂‚Äãcod_gedad, ‚Å∑‚Äãnombre_gedad, ‚Å∏‚Äãfecha_defuncion
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Importando datos .orange[DESDE WEB]


Una de las principales ventajas de `R` es que podemos **.bg-purple_light[importar datos desde una web]**, sin necesidad de realizar la descarga manual del archivo. Y lo mejor es que se har√° igual que hemos importado todo: en lugar de pasarle la ruta local de nuestro PC, le **.bg-purple_light[indicaremos el enlace (permalink)]**.



```r
discurso_2021 &lt;-
  read_delim(file = "https://raw.githubusercontent.com/lirondos/discursos-de-navidad/master/data/speeches/2021.txt", delim = "\t")
discurso_2021
```

```
&gt; # A tibble: 26 √ó 1
&gt;    `Buenas noches,`                                                             
&gt;    &lt;chr&gt;                                                                        
&gt;  1 Mis primeras palabras en esta Nochebuena quiero dedicarlas a quienes viv√≠s e‚Ä¶
&gt;  2 Hoy nuestro coraz√≥n y nuestro pensamiento siguen con vosotros. Nos sentimos ‚Ä¶
&gt;  3 El a√±o pasado, en mi mensaje de Navidad, compart√≠ con vosotros la necesidad ‚Ä¶
&gt;  4 Un a√±o despu√©s ‚Äîy siempre con toda la prudencia necesaria‚Äî la situaci√≥n es d‚Ä¶
&gt;  5 Aun as√≠, estamos viendo que el virus todav√≠a tiene la capacidad de hacernos ‚Ä¶
&gt;  6 Tambi√©n en este √∫ltimo a√±o muchos ciudadanos contin√∫an padeciendo las consec‚Ä¶
&gt;  7 Y junto a todo ello, es verdad que en el mundo es un hecho que los pa√≠ses de‚Ä¶
&gt;  8 Tambi√©n, las nuevas tecnolog√≠as est√°n cambiando los tradicionales modos de p‚Ä¶
&gt;  9 Estos son algunos ejemplos de los retos que tenemos por delante y que muestr‚Ä¶
&gt; 10 Ante esta situaci√≥n ¬øqu√© hacer?, ¬øtenemos que dejarnos llevar por el pesimis‚Ä¶
&gt; # ‚Ä¶ with 16 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

name: excel-data

# Importando datos: datos .orange[EXCEL]

Otro de los paquetes fundamentales de importaci√≥n ser√° el paquete `{readxl}` para **.bg-purple_light[importar datos desde una Excel]** (y `{openxlsx}` para exportar, aunque se recomienda `.csv`)

Tres funciones ser√°n claves: `read_xls()` (especifica para extensi√≥n `.xls`), `read_xlsx()` (especifica para extensi√≥n `.xlsx`) y `read_excel()` (para ambas).



```r
library(readxl)
deaths &lt;-
  read_xls(path = "./datos/deaths.xls",
           skip = 4)
deaths
```

```
&gt; # A tibble: 14 √ó 6
&gt;    Name               Profession       Age   Has k‚Ä¶¬π `Date of birth`     Date ‚Ä¶¬≤
&gt;    &lt;chr&gt;              &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;  
&gt;  1 David Bowie        musician         69    TRUE    1947-01-08 00:00:00 42379  
&gt;  2 Carrie Fisher      actor            60    TRUE    1956-10-21 00:00:00 42731  
&gt;  3 Chuck Berry        musician         90    TRUE    1926-10-18 00:00:00 42812  
&gt;  4 Bill Paxton        actor            61    TRUE    1955-05-17 00:00:00 42791  
&gt;  5 Prince             musician         57    TRUE    1958-06-07 00:00:00 42481  
&gt;  6 Alan Rickman       actor            69    FALSE   1946-02-21 00:00:00 42383  
&gt;  7 Florence Henderson actor            82    TRUE    1934-02-14 00:00:00 42698  
&gt;  8 Harper Lee         author           89    FALSE   1926-04-28 00:00:00 42419  
&gt;  9 Zsa Zsa G√°bor      actor            99    TRUE    1917-02-06 00:00:00 42722  
&gt; 10 George Michael     musician         53    FALSE   1963-06-25 00:00:00 42729  
&gt; 11 Some               &lt;NA&gt;             &lt;NA&gt;  &lt;NA&gt;    NA                  &lt;NA&gt;   
&gt; 12 &lt;NA&gt;               also like to wr‚Ä¶ &lt;NA&gt;  &lt;NA&gt;    NA                  &lt;NA&gt;   
&gt; 13 &lt;NA&gt;               &lt;NA&gt;             at t‚Ä¶ bottom, NA                  &lt;NA&gt;   
&gt; 14 &lt;NA&gt;               &lt;NA&gt;             &lt;NA&gt;  &lt;NA&gt;    NA                  too!   
&gt; # ‚Ä¶ with abbreviated variable names ¬π‚Äã`Has kids`, ¬≤‚Äã`Date of death`
```

---

# Importando datos: datos .orange[EXCEL]

Otro de los paquetes fundamentales de importaci√≥n ser√° el paquete `{readxl}` para **.bg-purple_light[importar datos desde una Excel]** (y `{openxlsx}` para exportar, aunque se recomienda `.csv`)

Tres funciones ser√°n claves: `read_xls()` (especifica para extensi√≥n `.xls`), `read_xlsx()` (especifica para extensi√≥n `.xlsx`) y `read_excel()` (para ambas).




```r
deaths &lt;-
  read_xlsx(path = "./datos/deaths.xlsx",
            skip = 5,
            col_names =
              c("name", "profession",
                "age", "kids",
                "birth", "death"))
deaths
```

```
&gt; # A tibble: 14 √ó 6
&gt;    name               profession           age   kids  birth               death
&gt;    &lt;chr&gt;              &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;
&gt;  1 David Bowie        musician             69    TRUE  1947-01-08 00:00:00 42379
&gt;  2 Carrie Fisher      actor                60    TRUE  1956-10-21 00:00:00 42731
&gt;  3 Chuck Berry        musician             90    TRUE  1926-10-18 00:00:00 42812
&gt;  4 Bill Paxton        actor                61    TRUE  1955-05-17 00:00:00 42791
&gt;  5 Prince             musician             57    TRUE  1958-06-07 00:00:00 42481
&gt;  6 Alan Rickman       actor                69    FALSE 1946-02-21 00:00:00 42383
&gt;  7 Florence Henderson actor                82    TRUE  1934-02-14 00:00:00 42698
&gt;  8 Harper Lee         author               89    FALSE 1926-04-28 00:00:00 42419
&gt;  9 Zsa Zsa G√°bor      actor                99    TRUE  1917-02-06 00:00:00 42722
&gt; 10 George Michael     musician             53    FALSE 1963-06-25 00:00:00 42729
&gt; 11 Some               &lt;NA&gt;                 &lt;NA&gt;  &lt;NA&gt;  NA                  &lt;NA&gt; 
&gt; 12 &lt;NA&gt;               also like to write ‚Ä¶ &lt;NA&gt;  &lt;NA&gt;  NA                  &lt;NA&gt; 
&gt; 13 &lt;NA&gt;               &lt;NA&gt;                 at t‚Ä¶ bott‚Ä¶ NA                  &lt;NA&gt; 
&gt; 14 &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;  &lt;NA&gt;  NA                  too!
```


---

# Importando datos .orange[EXCEL]

Si te fijas las **.bg-purple_light[fechas de Excel est√°n mal formateadas]** (sorpresa) as√≠ que podemos hacer uso de `convertToDate()` del paquete `{openxlsx}` para convertirlo



```r
library(openxlsx)
library(lubridate)
deaths %&gt;% mutate(birth = as_date(birth),
                  death = convertToDate(death))
```

```
&gt; # A tibble: 14 √ó 6
&gt;    name               profession               age   kids  birth      death     
&gt;    &lt;chr&gt;              &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;date&gt;    
&gt;  1 David Bowie        musician                 69    TRUE  1947-01-08 2016-01-10
&gt;  2 Carrie Fisher      actor                    60    TRUE  1956-10-21 2016-12-27
&gt;  3 Chuck Berry        musician                 90    TRUE  1926-10-18 2017-03-18
&gt;  4 Bill Paxton        actor                    61    TRUE  1955-05-17 2017-02-25
&gt;  5 Prince             musician                 57    TRUE  1958-06-07 2016-04-21
&gt;  6 Alan Rickman       actor                    69    FALSE 1946-02-21 2016-01-14
&gt;  7 Florence Henderson actor                    82    TRUE  1934-02-14 2016-11-24
&gt;  8 Harper Lee         author                   89    FALSE 1926-04-28 2016-02-19
&gt;  9 Zsa Zsa G√°bor      actor                    99    TRUE  1917-02-06 2016-12-18
&gt; 10 George Michael     musician                 53    FALSE 1963-06-25 2016-12-25
&gt; 11 Some               &lt;NA&gt;                     &lt;NA&gt;  &lt;NA&gt;  NA         NA        
&gt; 12 &lt;NA&gt;               also like to write stuff &lt;NA&gt;  &lt;NA&gt;  NA         NA        
&gt; 13 &lt;NA&gt;               &lt;NA&gt;                     at t‚Ä¶ bott‚Ä¶ NA         NA        
&gt; 14 &lt;NA&gt;               &lt;NA&gt;                     &lt;NA&gt;  &lt;NA&gt;  NA         NA
```

---

# Importando datos: datos .orange[EXCEL]

Tambi√©n podemos **.bg-purple_light[cargar un Excel con varias hojas]**, pero por defecto nos carga solo la primera hoja. Para indicarle la hoja (bien por su nombre bien por su n√∫mero) usaremos el argumento `sheet = ...`



```r
mtcars &lt;- read_xlsx(path = "./datos/datasets.xlsx",
                      sheet = "mtcars")
mtcars
```

```
&gt; # A tibble: 32 √ó 11
&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
&gt; # ‚Ä¶ with 22 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# Importando datos: datos .orange[EXCEL]

Incluso podemos **.bg-purple_light[indicarle el rango de celdas]** del Excel que queremos caergar, haciendo uso del argumento `range = ...`



```r
iris &lt;- read_xlsx(path = "./datos/datasets.xlsx",
                  sheet = "iris",
                  range = "C1:E4")
iris
```

```
&gt; # A tibble: 3 √ó 3
&gt;   Petal.Length Petal.Width Species
&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
&gt; 1          1.4         0.2 setosa 
&gt; 2          1.4         0.2 setosa 
&gt; 3          1.3         0.2 setosa
```

---

name: google-data

# Importando datos .orange[googlesheet]

Otra opci√≥n disponible (sobre todo si trabajamos con otras personas que trabajan en Google Drive) es **.bg-purple_light[importar desde una hoja de c√°lculo Google Drive]**, haciendo uso de `read_sheet()` del paquete `{googlesheets4}` (os pedir√° un permiso de tidyverse para interactuar con vuestro drive)


```r
library(googlesheets4)
google_sheet &lt;- read_sheet("https://docs.google.com/spreadsheets/d/1AxHm5qndAQXT77HUjbB7h4rbUVe48Doe1iNIxwk05L4/edit?usp=sharing")
google_sheet
```

```
&gt; # A tibble: 3 √ó 3
&gt;       x     y     z
&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
&gt; 1     1    NA     4
&gt; 2     2     1    NA
&gt; 3   -10     3    -6
```


---

name: sas-data

# Importando .orange[SAS/SPSS/STATA]

El paquete `{haven}` dentro de la √≥rbita tidyverse nos permitir√° importar archivos de los 3 software de pago de gesti√≥n y an√°lisis de datos m√°s importantes y usados: nos permite **.bg-purple_light[importar desde SAS, SPSS y Stata]**


```r
library(haven)
# SAS
iris_sas &lt;- read_sas(data_file = "./datos/iris.sas7bdat")
write_sas(iris_sas, path = "./datos/iris_exportado.sas7bdat")
iris_sas
```

```
&gt; # A tibble: 150 √ó 5
&gt;    Sepal_Length Sepal_Width Petal_Length Petal_Width Species
&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
&gt;  1          5.1         3.5          1.4         0.2 setosa 
&gt;  2          4.9         3            1.4         0.2 setosa 
&gt;  3          4.7         3.2          1.3         0.2 setosa 
&gt;  4          4.6         3.1          1.5         0.2 setosa 
&gt;  5          5           3.6          1.4         0.2 setosa 
&gt;  6          5.4         3.9          1.7         0.4 setosa 
&gt;  7          4.6         3.4          1.4         0.3 setosa 
&gt;  8          5           3.4          1.5         0.2 setosa 
&gt;  9          4.4         2.9          1.4         0.2 setosa 
&gt; 10          4.9         3.1          1.5         0.1 setosa 
&gt; # ‚Ä¶ with 140 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# Importando .orange[SAS/SPSS/STATA]

El paquete `{haven}` dentro de la √≥rbita tidyverse nos permitir√° importar archivos de los 3 software de pago de gesti√≥n y an√°lisis de datos m√°s importantes y usados: nos permite **.bg-purple_light[importar desde SAS, SPSS y Stata]**


```r
# SPSS
iris_spss &lt;- read_sav(file = "./datos/iris.sav")
write_sav(iris_spss, path = "./datos/iris_exportado.sav")
iris_spss
```

```
&gt; # A tibble: 150 √ó 5
&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl+lbl&gt;
&gt;  1          5.1         3.5          1.4         0.2 1 [setosa]
&gt;  2          4.9         3            1.4         0.2 1 [setosa]
&gt;  3          4.7         3.2          1.3         0.2 1 [setosa]
&gt;  4          4.6         3.1          1.5         0.2 1 [setosa]
&gt;  5          5           3.6          1.4         0.2 1 [setosa]
&gt;  6          5.4         3.9          1.7         0.4 1 [setosa]
&gt;  7          4.6         3.4          1.4         0.3 1 [setosa]
&gt;  8          5           3.4          1.5         0.2 1 [setosa]
&gt;  9          4.4         2.9          1.4         0.2 1 [setosa]
&gt; 10          4.9         3.1          1.5         0.1 1 [setosa]
&gt; # ‚Ä¶ with 140 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---


# Importando .orange[SAS/SPSS/STATA]

El paquete `{haven}` dentro de la √≥rbita tidyverse nos permitir√° importar archivos de los 3 software de pago de gesti√≥n y an√°lisis de datos m√°s importantes y usados: nos permite **.bg-purple_light[importar desde SAS, SPSS y Stata]**


```r
# Stata
iris_stata &lt;- read_dta(file = "./datos/iris.dta")
write_dta(iris_stata, path = "./datos/iris_exportado.dta")
iris_stata
```

```
&gt; # A tibble: 150 √ó 5
&gt;    sepallength sepalwidth petallength petalwidth species
&gt;          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  
&gt;  1        5.10       3.5         1.40      0.200 setosa 
&gt;  2        4.90       3           1.40      0.200 setosa 
&gt;  3        4.70       3.20        1.30      0.200 setosa 
&gt;  4        4.60       3.10        1.5       0.200 setosa 
&gt;  5        5          3.60        1.40      0.200 setosa 
&gt;  6        5.40       3.90        1.70      0.400 setosa 
&gt;  7        4.60       3.40        1.40      0.300 setosa 
&gt;  8        5          3.40        1.5       0.200 setosa 
&gt;  9        4.40       2.90        1.40      0.200 setosa 
&gt; 10        4.90       3.10        1.5       0.100 setosa 
&gt; # ‚Ä¶ with 140 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```


---

# Importando datos: desde .orange[API]

Por √∫ltimo, una opci√≥n muy interesante es la **.bg-purple_light[carga desde una API]**: un intermediario entre una app o proveedor datos y nuestro `R`. Por ejemplo, vamos a cargar la librer√≠a `{owidR}`, que nos permite la descarga de datos de uno de los mayores referentes durante la pandemia, la web &lt;https://ourworldindata.org/&gt;


```r
# install.packages("owidR")
library(owidR)
owid_covid()
```

```
&gt; # A tibble: 236,386 √ó 67
&gt;    iso_code continent locat‚Ä¶¬π date       total‚Ä¶¬≤ new_c‚Ä¶¬≥ new_c‚Ä¶‚Å¥ total‚Ä¶‚Åµ new_d‚Ä¶‚Å∂
&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
&gt;  1 AFG      Asia      Afghan‚Ä¶ 2020-02-24       5       5  NA          NA      NA
&gt;  2 AFG      Asia      Afghan‚Ä¶ 2020-02-25       5       0  NA          NA      NA
&gt;  3 AFG      Asia      Afghan‚Ä¶ 2020-02-26       5       0  NA          NA      NA
&gt;  4 AFG      Asia      Afghan‚Ä¶ 2020-02-27       5       0  NA          NA      NA
&gt;  5 AFG      Asia      Afghan‚Ä¶ 2020-02-28       5       0  NA          NA      NA
&gt;  6 AFG      Asia      Afghan‚Ä¶ 2020-02-29       5       0   0.714      NA      NA
&gt;  7 AFG      Asia      Afghan‚Ä¶ 2020-03-01       5       0   0.714      NA      NA
&gt;  8 AFG      Asia      Afghan‚Ä¶ 2020-03-02       5       0   0          NA      NA
&gt;  9 AFG      Asia      Afghan‚Ä¶ 2020-03-03       5       0   0          NA      NA
&gt; 10 AFG      Asia      Afghan‚Ä¶ 2020-03-04       5       0   0          NA      NA
&gt; # ‚Ä¶ with 236,376 more rows, 58 more variables: new_deaths_smoothed &lt;dbl&gt;,
&gt; #   total_cases_per_million &lt;dbl&gt;, new_cases_per_million &lt;dbl&gt;,
&gt; #   new_cases_smoothed_per_million &lt;dbl&gt;, total_deaths_per_million &lt;dbl&gt;,
&gt; #   new_deaths_per_million &lt;dbl&gt;, new_deaths_smoothed_per_million &lt;dbl&gt;,
&gt; #   reproduction_rate &lt;dbl&gt;, icu_patients &lt;dbl&gt;,
&gt; #   icu_patients_per_million &lt;dbl&gt;, hosp_patients &lt;dbl&gt;,
&gt; #   hosp_patients_per_million &lt;dbl&gt;, weekly_icu_admissions &lt;dbl&gt;, ‚Ä¶
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

---

# Importando datos: desde .orange[API]


```r
# install.packages("owidR")
library(owidR)
owid_covid()
```

La funci√≥n `owid_covid()` nos ha cargado sin darnos cuenta **.bg-purple_light[m√°s de 200 000 registros]** con m√°s de 50 variables  de 238 pa√≠ses diferentes, desde casos, hospitalizados, pacientes en UCI, fallecidos, etc.

---

# Importando datos: desde .orange[API]

Este paquete tiene la funci√≥n `owid_search()` para **.bg-purple_light[buscar datasets por palabras clave]**, por ejemplo, por `emissions`, d√°ndonos un dataset con el t√≠tulo de la base de datos y su id para luego usarla.


```r
as_tibble(owid_search("emissions"))
```

---

# Importando datos: desde .orange[API]

Vamos a pedirle por ejemplo las emisiones per c√°pita de gases de efecto invernadero


```r
emissions &lt;- owid("per-capita-ghg-emissions")
emissions
```

---

# Importando datos: desde .orange[API]

En muchas ocasiones para **.bg-purple_light[conectar con la API tendremos antes que registrarnos y obtener una clave]**, es el caso del paquete `{climaemet}` para acceder a datos meteorol√≥gicos (ver documentaci√≥n en &lt;https://ropenspain.github.io/climaemet/). Dicha clave se puede obtener de manera inmediata en &lt;https://opendata.aemet.es/centrodedescargas/altaUsuario&gt;

--

&amp;nbsp;

Una vez que tenemos la clave la registramos en nuestro RStudio para poder usarla a futuro




```r
# install.packages("climaemet")
library(climaemet)

# Definir la clave
apikey &lt;- "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJqYXZhbHYwOUB1Y20uZXMiLCJqdGkiOiI4YTU1ODUxMS01MTE3LTQ4MTYtYmM4OS1hYmVkNDhiODBkYzkiLCJpc3MiOiJBRU1FVCIsImlhdCI6MTY2NjQ2OTcxNSwidXNlcklkIjoiOGE1NTg1MTEtNTExNy00ODE2LWJjODktYWJlZDQ4YjgwZGM5Iiwicm9sZSI6IiJ9.HEMR77lZy2ASjmOxJa8ppx2J8Za1IViurMX3p1reVBU"
aemet_api_key(apikey, install = TRUE)
```

---

# Importando datos: desde .orange[API]

Con dicho paquete podemos hacer una **.bg-purple_light[b√∫squeda de las estaciones meteorol√≥gicas]** para conocer tanto su c√≥digo postal como su c√≥digo identificador dentro de la red AEMET (por ejemplo, para acceder a la estaci√≥n de el aeropuerto de El Prat, Barcelona, es el c√≥digo 0076)



```r
library(climaemet)
stations &lt;- aemet_stations()
stations
```

```
&gt; # A tibble: 291 √ó 7
&gt;    indicativo indsinop nombre                 provincia altitud longitud latitud
&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;                  &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
&gt;  1 0252D      "08186"  ARENYS DE MAR          BARCELONA      74     2.54    41.6
&gt;  2 0076       "08181"  BARCELONA AEROPUERTO   BARCELONA       4     2.07    41.3
&gt;  3 0200E      ""       BARCELONA, FABRA       BARCELONA     408     2.12    41.4
&gt;  4 0201D      "08180"  BARCELONA              BARCELONA       6     2.2     41.4
&gt;  5 0149X      "08174"  MANRESA                BARCELONA     291     1.84    41.7
&gt;  6 0229I      "08192"  SABADELL AEROPUERTO    BARCELONA     146     2.10    41.5
&gt;  7 0255B      "08188"  SANTA SUSANNA          BARCELONA      40     2.70    41.7
&gt;  8 0367       "08184"  GIRONA AEROPUERTO      GIRONA        143     2.76    41.9
&gt;  9 0370B      ""       GIRONA, ANTIC INSTITUT GIRONA         95     2.83    42.0
&gt; 10 0372C      "08120"  PORQUERES              GIRONA        157     2.76    42.1
&gt; # ‚Ä¶ with 281 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# Importando datos: desde .orange[API]

Una vez que tenemos el identificador podemos obtener los **.bg-purple_light[datos horarios de las √∫ltimas 24 horas]**, incluyendo no solo temperatura sino estad√≠sticas del viento, la presi√≥n, etc


```r
aemet_last_obs("0076")
```


|idema |      lon|fint                | prec| alt| vmax|  vv|  dv|      lat| dmax|ubi                  |   pres| hr| stdvv|   ts| pres_nmar| tamin|   ta| tamax|  tpr|  vis| stddv| inso|
|:-----|--------:|:-------------------|----:|---:|----:|---:|---:|--------:|----:|:--------------------|------:|--:|-----:|----:|---------:|-----:|----:|-----:|----:|----:|-----:|----:|
|0076  | 2.069995|2022-11-20 21:00:00 |  0.0|   4|  3.6| 0.3|  10| 41.29278|   20|BARCELONA/AEROPUERTO | 1017.8| 68|   0.3|  9.8|    1018.4|  11.5| 11.7|  12.5|  5.9| 29.9|   175|    0|
|0076  | 2.069995|2022-11-20 22:00:00 |  0.0|   4|  4.6| 2.5|  10| 41.29278|   20|BARCELONA/AEROPUERTO | 1018.2| 73|   0.3|  9.7|    1018.8|  10.6| 10.9|  11.5|  6.2| 29.9|   111|    0|
|0076  | 2.069995|2022-11-20 23:00:00 |  0.0|   4|  4.6| 3.4|  10| 41.29278|   10|BARCELONA/AEROPUERTO | 1018.0| 73|   0.3| 10.5|    1018.6|  10.9| 11.1|  11.2|  6.4| 29.0|   108|    0|
|0076  | 2.069995|2022-11-21 00:00:00 |  0.0|   4|  4.1| 3.0| 350| 41.29278|  360|BARCELONA/AEROPUERTO | 1018.2| 72|   0.6| 10.3|    1018.8|  11.1| 11.1|  11.9|  6.2| 30.0|   109|    0|
|0076  | 2.069995|2022-11-21 01:00:00 |  0.0|   4|  4.1| 1.8| 350| 41.29278|   50|BARCELONA/AEROPUERTO | 1018.0| 69|   0.2| 10.8|    1018.6|  11.1| 11.6|  11.7|  6.1| 30.0|   140|    0|
|0076  | 2.069995|2022-11-21 02:00:00 |  0.0|   4|  5.7| 3.0| 360| 41.29278|  360|BARCELONA/AEROPUERTO | 1016.8| 67|   0.7| 11.1|    1017.4|  11.4| 11.6|  11.7|  5.6| 30.0|   148|    0|
|0076  | 2.069995|2022-11-21 03:00:00 |  0.0|   4|  5.1| 1.9|  10| 41.29278|  350|BARCELONA/AEROPUERTO | 1016.4| 69|   0.7| 11.1|    1017.0|  11.3| 11.3|  11.7|  5.8| 28.7|     5|    0|
|0076  | 2.069995|2022-11-21 04:00:00 |  0.0|   4|  7.2| 4.3|  10| 41.29278|  360|BARCELONA/AEROPUERTO | 1015.6| 66|   0.3| 11.3|    1016.2|  11.3| 11.5|  11.5|  5.3| 29.9|     4|    0|
|0076  | 2.069995|2022-11-21 05:00:00 |  0.0|   4|  6.2| 3.9| 360| 41.29278|  360|BARCELONA/AEROPUERTO | 1014.8| 63|   0.5| 11.2|    1015.4|  11.4| 11.6|  11.8|  4.8| 30.0|   113|    0|
|0076  | 2.069995|2022-11-21 06:00:00 |  0.0|   4|  6.7| 3.6|  10| 41.29278|   10|BARCELONA/AEROPUERTO | 1013.5| 66|   0.7| 11.0|    1014.1|  11.0| 11.2|  11.4|  5.1| 30.0|     3|    0|
|0076  | 2.069995|2022-11-21 07:00:00 |  0.0|   4|  6.7| 4.0| 350| 41.29278|  360|BARCELONA/AEROPUERTO | 1013.5| 66|   0.2| 11.5|    1014.1|  11.2| 11.4|  11.5|  5.3| 30.0|     4|    0|
|0076  | 2.069995|2022-11-21 08:00:00 |  0.0|   4|  4.6| 3.9|  10| 41.29278|  360|BARCELONA/AEROPUERTO | 1012.7| 64|   0.3| 12.5|    1013.3|  11.5| 11.9|  12.0|  5.3| 29.8|     3|    0|
|0076  | 2.069995|2022-11-21 09:00:00 |  0.0|   4|  5.1| 4.2|  10| 41.29278|   20|BARCELONA/AEROPUERTO | 1012.0| 63|   0.4| 13.0|    1012.6|  12.0| 12.6|  12.6|  5.8| 27.1|     5|    0|
|0076  | 2.069995|2022-11-21 10:00:00 |  0.0|   4|  4.6| 3.3|  20| 41.29278|   30|BARCELONA/AEROPUERTO | 1010.7| 62|   0.2| 14.9|    1011.3|  12.6| 13.7|  13.8|  6.5| 28.3|     6|    0|
|0076  | 2.069995|2022-11-21 11:00:00 |  0.0|   4|  5.7| 3.5| 360| 41.29278|  360|BARCELONA/AEROPUERTO | 1009.4| 64|   0.7| 15.2|    1010.0|  13.9| 14.3|  14.5|  7.6| 28.8|   182|    0|
|0076  | 2.069995|2022-11-21 12:00:00 |  0.0|   4|  5.7| 2.9| 350| 41.29278|  360|BARCELONA/AEROPUERTO | 1007.5| 62|   0.3| 16.1|    1008.1|  14.5| 15.0|  15.1|  7.8| 29.0|     6|    0|
|0076  | 2.069995|2022-11-21 13:00:00 |  0.0|   4|  3.6| 1.1| 320| 41.29278|   10|BARCELONA/AEROPUERTO | 1006.1| 62|   0.3| 16.3|    1006.7|  15.1| 15.4|  15.5|  8.1| 26.3|    17|    0|
|0076  | 2.069995|2022-11-21 14:00:00 |  0.0|   4|  2.6| 1.4| 360| 41.29278|  260|BARCELONA/AEROPUERTO | 1005.1| 64|   0.2| 16.6|    1005.7|  15.5| 15.9|  16.1|  9.0| 26.7|   182|    0|
|0076  | 2.069995|2022-11-21 15:00:00 |  0.0|   4|  2.1| 0.8|  20| 41.29278|  350|BARCELONA/AEROPUERTO | 1004.2| 65|   0.3| 15.7|    1004.8|  15.6| 15.6|  15.9|  9.0| 29.9|   109|    0|
|0076  | 2.069995|2022-11-21 16:00:00 |  0.0|   4|  4.6| 3.3| 350| 41.29278|  340|BARCELONA/AEROPUERTO | 1004.4| 69|   0.4| 14.6|    1005.0|  15.0| 15.0|  15.6|  9.3| 24.8|   163|    0|
|0076  | 2.069995|2022-11-21 17:00:00 |  0.2|   4|  3.6| 1.6| 260| 41.29278|  260|BARCELONA/AEROPUERTO | 1002.4| 78|   1.0| 13.3|    1003.0|  14.5| 14.5|  15.0| 10.8| 26.7|    20|    0|
|0076  | 2.069995|2022-11-21 18:00:00 |  0.0|   4|  6.2| 2.8| 240| 41.29278|  260|BARCELONA/AEROPUERTO | 1002.3| 81|   0.4| 14.1|    1002.9|  14.4| 15.3|  15.3| 12.1| 15.8|     8|    0|
|0076  | 2.069995|2022-11-21 19:00:00 |  0.0|   4| 12.4| 8.0| 280| 41.29278|  290|BARCELONA/AEROPUERTO | 1002.1| 72|   2.3| 14.6|    1002.7|  15.1| 15.8|  16.5| 10.8| 28.9|     5|    0|
|0076  | 2.069995|2022-11-21 20:00:00 |  0.0|   4| 13.9| 4.8| 320| 41.29278|  300|BARCELONA/AEROPUERTO | 1001.9| 57|   0.7| 13.9|    1002.5|  14.9| 15.0|  16.6|  6.5| 30.0|     7|    0|

---

# Importando datos: desde .orange[API]

Tambi√©n podemos extraer los **.bg-purple_light[datos diarios en un intervalo de fechas]** que le proporciones con `aemet_daily_clim()`


```r
aemet_daily_clim("0076", start = "2022-01-01", end = "2022-09-30")
```




|fecha      |indicativo |nombre               |provincia | altitud| tmed|prec | tmin|horatmin | tmax|horatmax |dir | velmedia| racha|horaracha |  sol| presMax|horaPresMax | presMin|horaPresMin |
|:----------|:----------|:--------------------|:---------|-------:|----:|:----|----:|:--------|----:|:--------|:---|--------:|-----:|:---------|----:|-------:|:-----------|-------:|:-----------|
|2022-01-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.9|0,0  |  7.5|07:13    | 16.3|13:34    |99  |      2.5|   8.9|Varias    |  4.2|  1027.4|00          |  1024.7|14          |
|2022-01-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.4|0,0  |  7.8|08:15    | 15.0|13:06    |99  |      3.3|   6.7|Varias    |  0.4|  1028.3|Varias      |  1025.9|14          |
|2022-01-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.7|0,0  |  8.7|07:57    | 14.7|14:03    |24  |      6.1|  12.5|Varias    |  2.5|  1027.6|00          |  1016.8|24          |
|2022-01-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.0|13,9 |  9.5|07:10    | 18.5|14:00    |23  |      2.8|  11.4|00:10     |  4.9|  1016.8|00          |  1003.2|24          |
|2022-01-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.0|0,2  |  5.8|23:11    | 14.2|14:48    |10  |      2.8|  16.1|01:30     |  0.1|  1013.4|Varias      |  1003.2|00          |
|2022-01-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.3|0,0  |  2.2|07:15    | 12.4|14:27    |99  |      5.8|  10.3|Varias    |  5.6|  1020.5|Varias      |  1013.2|01          |
|2022-01-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.8|0,0  |  2.7|06:34    | 12.8|13:04    |03  |      2.5|  10.3|00:54     |  5.6|  1024.1|Varias      |  1020.5|00          |
|2022-01-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  9.4|0,0  |  5.4|00:22    | 13.4|14:24    |99  |      3.1|   9.2|Varias    |  0.4|  1023.6|Varias      |  1014.7|24          |
|2022-01-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.8|0,0  |  8.9|03:20    | 16.6|14:40    |33  |      6.1|  13.9|06:40     |  4.2|  1014.7|00          |  1010.2|24          |
|2022-01-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.3|0,1  |  9.8|01:30    | 12.8|03:40    |99  |      3.9|   8.9|Varias    |  0.0|  1020.2|Varias      |  1009.4|03          |
|2022-01-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.0|0,0  |  6.9|07:25    | 15.0|13:32    |26  |      5.6|  11.4|13:03     |  5.6|  1025.9|Varias      |  1020.1|00          |
|2022-01-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  9.2|0,0  |  5.3|23:18    | 13.1|12:39    |99  |      3.1|   6.1|Varias    |  2.5|  1032.7|Varias      |  1025.9|00          |
|2022-01-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.6|0,0  |  2.5|07:32    | 12.8|14:58    |01  |      2.8|   8.9|04:56     |  5.8|  1034.9|Varias      |  1032.6|00          |
|2022-01-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.0|0,0  |  2.0|07:02    | 14.1|13:24    |36  |      3.3|   9.2|Varias    |  4.4|  1034.5|Varias      |  1029.5|24          |
|2022-01-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.5|0,0  |  1.3|07:25    | 13.7|14:14    |99  |      4.2|   8.9|07:17     |  5.9|  1029.5|00          |  1024.6|14          |
|2022-01-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.0|0,0  |  1.7|07:20    | 14.3|13:20    |36  |      3.6|  10.3|06:40     |  5.9|  1031.2|24          |  1025.4|01          |
|2022-01-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.9|0,0  |  2.4|07:05    | 15.4|13:27    |01  |      4.2|  11.7|00:45     |  6.0|  1033.6|10          |  1029.6|24          |
|2022-01-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.1|0,0  |  3.0|07:19    | 13.2|12:03    |04  |      4.2|   8.9|10:07     |  5.8|  1032.5|Varias      |  1028.7|05          |
|2022-01-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.3|0,0  |  3.2|07:05    | 13.4|13:37    |99  |      2.8|   9.2|Varias    |  2.3|  1032.5|Varias      |  1028.6|24          |
|2022-01-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.4|0,0  |  3.1|07:29    | 13.7|13:19    |36  |      4.4|  11.4|07:01     |  5.6|  1028.6|00          |  1023.8|Varias      |
|2022-01-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.4|0,0  |  3.4|05:58    | 11.4|14:09    |99  |      4.2|   9.2|Varias    |  0.8|  1029.2|Varias      |  1022.9|04          |
|2022-01-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.3|0,0  |  2.1|07:30    | 12.5|13:31    |99  |      2.8|   9.7|Varias    |  5.5|  1031.1|Varias      |  1027.7|15          |
|2022-01-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.4|0,0  |  1.6|Varias   | 13.2|14:50    |01  |      3.3|   8.9|07:20     |  6.2|  1029.9|10          |  1026.9|15          |
|2022-01-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.6|0,0  |  2.3|07:13    | 15.0|13:11    |03  |      2.5|   9.2|00:44     |  5.9|  1031.9|Varias      |  1027.9|03          |
|2022-01-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.6|0,0  |  2.7|06:12    | 14.6|12:01    |01  |      3.3|   8.9|07:38     |  6.4|  1033.4|Varias      |  1031.2|14          |
|2022-01-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.8|0,0  |  3.4|06:27    | 14.3|14:38    |02  |      4.4|   9.2|00:42     |  6.7|  1031.8|00          |  1028.1|24          |
|2022-01-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.0|0,0  |  4.3|07:10    | 15.7|12:01    |36  |      3.6|  10.8|07:50     |  6.8|  1029.5|Varias      |  1027.4|03          |
|2022-01-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.4|0,0  |  3.8|07:10    | 17.0|14:10    |05  |      3.9|  11.4|00:40     |  6.9|  1030.7|24          |  1027.7|15          |
|2022-01-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.2|0,0  |  5.4|06:33    | 16.9|12:07    |99  |      4.2|  11.7|Varias    |  7.0|  1033.0|Varias      |  1030.0|01          |
|2022-01-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.8|0,0  |  4.8|06:22    | 16.7|14:34    |24  |      4.7|   9.2|14:52     |  7.1|  1030.2|00          |  1021.9|24          |
|2022-01-31 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.8|0,0  |  6.6|05:50    | 16.9|13:42    |99  |      3.6|  10.8|Varias    |  7.0|  1022.0|Varias      |  1018.2|19          |
|2022-02-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.4|0,0  |  5.1|07:04    | 15.6|11:34    |35  |      2.8|   8.9|Varias    |  7.4|  1024.5|Varias      |  1019.8|00          |
|2022-02-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.6|0,0  |  8.4|20:59    | 18.7|12:27    |99  |      3.3|  11.4|Varias    |  7.2|  1024.7|Varias      |  1021.6|14          |
|2022-02-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.2|0,0  |  6.0|06:39    | 16.3|11:13    |99  |      5.0|  10.8|Varias    |  7.8|  1022.0|00          |  1016.8|17          |
|2022-02-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.3|0,0  |  7.3|06:50    | 15.3|12:50    |02  |      3.6|   7.2|00:50     |  0.8|  1022.2|24          |  1018.7|13          |
|2022-02-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.9|0,0  |  9.5|07:30    | 16.3|13:53    |35  |      2.8|   6.7|08:55     |  0.2|  1026.7|Varias      |  1021.9|01          |
|2022-02-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.7|0,0  |  7.4|23:33    | 16.0|12:37    |99  |      4.2|  11.7|08:15     |  4.6|  1028.5|Varias      |  1025.5|15          |
|2022-02-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.8|0,0  |  5.6|04:41    | 16.1|12:16    |01  |      3.9|   9.2|08:24     |  8.1|  1029.1|Varias      |  1024.2|14          |
|2022-02-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.4|0,0  |  6.8|04:30    | 16.0|12:01    |99  |      4.2|   7.2|Varias    |  5.1|  1033.0|11          |  1029.1|00          |
|2022-02-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.0|0,0  |  7.0|Varias   | 15.0|Varias   |99  |      5.0|   9.7|Varias    |  8.0|  1032.7|Varias      |  1029.7|Varias      |
|2022-02-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.0|0,0  |  4.9|06:51    | 15.1|11:24    |22  |      4.2|   7.8|14:28     |  8.0|  1029.7|00          |  1025.4|24          |
|2022-02-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.0|0,0  |  6.6|06:10    | 17.3|12:00    |99  |      2.8|   7.8|Varias    |  5.7|  1026.7|09          |  1024.6|Varias      |
|2022-02-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.2|4,4  |  8.9|05:05    | 13.4|09:49    |13  |      3.1|   7.8|10:53     |  0.0|  1026.7|Varias      |  1024.3|16          |
|2022-02-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,1  |  9.8|05:04    | 16.1|13:11    |23  |      4.7|  12.5|13:17     |  3.0|  1024.9|00          |  1015.2|24          |
|2022-02-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.4|0,0  |  8.8|22:51    | 18.1|14:39    |99  |      3.9|  12.8|15:32     |  6.5|  1017.2|Varias      |  1011.4|05          |
|2022-02-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,0  |  7.6|06:00    | 18.5|15:15    |36  |      3.3|   8.3|09:22     |  7.8|  1023.5|Varias      |  1017.2|00          |
|2022-02-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.0|0,0  |  8.2|01:27    | 15.9|14:39    |24  |      4.2|   9.7|15:42     |  1.5|  1023.4|00          |  1019.6|16          |
|2022-02-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.3|0,0  |  8.7|05:03    | 19.9|15:33    |24  |      5.3|  10.8|13:43     |  8.9|  1023.7|Varias      |  1020.1|02          |
|2022-02-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.8|0,0  |  8.6|05:20    | 17.1|15:40    |24  |      6.1|  12.5|12:20     |  9.0|  1021.3|00          |  1013.1|17          |
|2022-02-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.4|0,1  |  7.1|23:59    | 13.6|09:55    |35  |      2.2|  10.8|13:30     |  0.0|  1024.9|Varias      |  1016.7|03          |
|2022-02-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.2|0,0  |  6.8|Varias   | 15.5|15:28    |99  |      5.0|  10.3|Varias    |  9.9|  1028.1|Varias      |  1024.4|16          |
|2022-02-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.0|0,0  |  7.2|05:04    | 20.8|16:50    |08  |      4.2|  12.5|18:48     | 10.0|  1024.9|00          |  1017.7|16          |
|2022-02-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,0  |  8.4|06:52    | 17.5|11:36    |99  |      5.3|   9.2|Varias    |  9.6|  1027.2|Varias      |  1024.6|17          |
|2022-02-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.8|0,0  |  7.0|06:50    | 16.6|11:00    |25  |      4.7|  10.3|16:00     |  8.9|  1027.2|Varias      |  1022.4|24          |
|2022-02-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,0  |  9.3|06:54    | 16.7|11:58    |24  |      3.3|   8.3|13:36     |  5.9|  1023.6|Varias      |  1019.9|15          |
|2022-02-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.6|0,1  |  9.3|02:49    | 15.9|11:47    |15  |      3.6|   7.2|14:34     |  0.4|  1025.9|Varias      |  1023.0|03          |
|2022-02-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.8|0,0  |  8.3|23:58    | 13.2|00:01    |10  |      4.4|  10.3|12:29     |  0.5|  1026.5|Varias      |  1023.9|17          |
|2022-02-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.4|0,0  |  5.7|05:01    | 15.0|13:26    |21  |      3.6|   7.8|14:41     |  8.9|  1025.8|Varias      |  1022.4|15          |
|2022-02-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.5|0,0  |  9.7|03:16    | 15.3|13:55    |23  |      3.9|   8.3|15:38     |  4.5|  1028.1|11          |  1025.0|24          |
|2022-03-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.2|0,0  |  7.0|06:39    | 17.4|10:53    |99  |      5.3|   9.2|Varias    |  9.7|  1026.8|Varias      |  1024.3|03          |
|2022-03-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.0|0,0  |  8.0|03:20    | 15.9|14:10    |23  |      3.9|   8.3|16:50     |  0.3|  1025.1|00          |  1018.2|Varias      |
|2022-03-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,0  |  8.8|06:38    | 17.2|10:34    |23  |      5.0|  10.3|11:58     |  9.9|  1018.4|00          |  1012.9|16          |
|2022-03-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.9|0,0  |  8.5|05:54    | 17.3|11:32    |99  |      4.2|   7.8|Varias    |  1.2|  1015.1|Varias      |  1012.5|03          |
|2022-03-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.6|12,2 | 10.3|06:40    | 16.8|10:47    |99  |      4.2|   7.8|Varias    |  5.9|  1016.1|Varias      |  1014.1|16          |
|2022-03-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.3|0,2  |  9.3|21:59    | 13.3|13:17    |01  |      2.8|   7.2|Varias    |  0.2|  1016.6|Varias      |  1014.4|04          |
|2022-03-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.0|0,0  |  7.9|23:54    | 14.0|15:55    |99  |      3.6|   8.9|Varias    |  3.0|  1017.8|Varias      |  1015.6|05          |
|2022-03-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  9.6|4,7  |  6.4|03:30    | 12.7|14:08    |99  |      2.8|   6.7|Varias    |  0.0|  1020.4|Varias      |  1016.7|05          |
|2022-03-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.8|0,5  |  8.3|Varias   | 15.4|14:50    |04  |      3.3|   9.2|11:30     |  6.8|  1023.7|22          |  1020.3|03          |
|2022-03-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.2|0,0  |  8.7|02:05    | 15.7|12:49    |22  |      4.7|   9.7|12:10     |  2.9|  1023.4|00          |  1018.9|24          |
|2022-03-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.7|19,7 |  9.9|05:21    | 15.5|10:16    |20  |      2.2|   6.1|11:04     |  0.4|  1019.1|00          |  1014.4|24          |
|2022-03-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|9,3  | 10.3|23:53    | 15.6|15:31    |35  |      4.2|  13.9|15:41     |  1.2|  1014.4|00          |  1010.8|14          |
|2022-03-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.4|0,4  |  8.4|06:40    | 16.5|13:08    |99  |      2.5|  11.7|Varias    |  2.4|  1020.0|Varias      |  1011.7|05          |
|2022-03-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.4|0,1  | 11.8|06:11    | 15.0|12:16    |07  |     12.8|  21.1|16:58     |  0.0|  1022.6|Varias      |  1018.9|03          |
|2022-03-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.6|0,0  | 13.7|06:11    | 15.6|11:02    |07  |     12.5|  18.6|02:43     |  0.0|  1025.0|Varias      |  1021.6|03          |
|2022-03-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.8|0,0  | 13.7|05:55    | 16.0|Varias   |08  |     11.4|  18.6|14:40     |  0.3|  1022.0|00          |  1015.8|16          |
|2022-03-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.3|Ip   | 13.6|05:10    | 17.0|13:50    |08  |      9.7|  16.4|13:18     |  0.0|  1022.2|Varias      |  1017.4|03          |
|2022-03-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.0|1,3  | 13.1|23:10    | 16.9|09:04    |99  |     10.3|  17.5|Varias    |  0.0|  1026.4|23          |  1021.1|05          |
|2022-03-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.0|Ip   | 10.0|23:57    | 14.0|00:02    |06  |      9.2|  16.4|10:31     |  0.0|  1026.8|Varias      |  1024.9|04          |
|2022-03-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.8|0,2  |  9.7|Varias   | 15.8|14:49    |99  |      5.0|  11.4|Varias    |  1.6|  1027.5|Varias      |  1025.0|04          |
|2022-03-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.2|1,6  | 12.0|23:44    | 16.5|12:39    |10  |      8.6|  15.3|09:57     |  3.2|  1028.7|Varias      |  1026.2|04          |
|2022-03-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.7|Ip   | 10.2|23:58    | 15.2|12:14    |99  |      8.3|  13.3|Varias    |  5.6|  1029.4|Varias      |  1027.1|04          |
|2022-03-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.6|3,7  |  8.4|04:33    | 14.8|14:48    |08  |      6.7|  14.4|09:22     |  2.4|  1028.4|00          |  1025.4|16          |
|2022-03-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.0|0,0  |  9.7|02:02    | 14.3|12:12    |07  |      6.7|  13.9|12:28     |  0.0|  1025.9|Varias      |  1023.9|24          |
|2022-03-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.4|0,0  | 11.8|04:51    | 17.1|12:43    |09  |      8.9|  16.4|13:30     |  4.8|  1023.9|00          |  1019.9|16          |
|2022-03-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 12.8|2,3  | 11.4|23:30    | 14.1|15:30    |99  |      6.7|  13.9|Varias    |  0.0|  1022.2|Varias      |  1019.5|03          |
|2022-03-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.6|0,0  | 10.8|23:35    | 20.3|12:36    |02  |      6.1|  11.7|06:44     |  6.0|  1026.1|Varias      |  1021.4|04          |
|2022-03-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.0|0,0  |  8.9|05:53    | 19.1|11:15    |36  |      3.3|  11.4|05:20     |  6.9|  1025.9|00          |  1017.2|24          |
|2022-03-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|0,9  | 10.4|05:21    | 15.7|14:37    |07  |      7.2|  13.3|Varias    |  0.0|  1017.2|00          |  1003.4|24          |
|2022-03-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.0|5,3  | 10.8|06:30    | 15.2|14:13    |05  |      3.1|  12.5|00:38     |  1.9|  1003.4|00          |   999.7|16          |
|2022-03-31 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.2|0,0  |  9.6|23:49    | 16.8|11:07    |08  |      5.0|  11.7|17:11     |  6.1|  1001.5|Varias      |   997.8|16          |
|2022-04-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.9|0,0  |  6.0|23:59    | 15.8|14:06    |31  |      7.2|  17.5|13:35     | 11.6|  1010.9|Varias      |  1000.2|06          |
|2022-04-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 11.0|0,0  |  4.7|05:30    | 17.2|14:40    |99  |      7.8|  15.0|Varias    | 11.1|  1014.9|24          |  1008.8|04          |
|2022-04-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  7.3|0,7  |  5.6|06:11    |  9.0|Varias   |35  |      3.6|   8.3|07:19     |  0.6|  1019.2|Varias      |  1014.4|03          |
|2022-04-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|  8.2|0,0  |  3.6|04:06    | 12.7|16:25    |10  |      5.6|  10.8|Varias    |  9.6|  1019.1|Varias      |  1015.9|16          |
|2022-04-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 10.1|0,0  |  5.1|05:43    | 15.1|Varias   |03  |      4.7|  11.7|06:11     |  9.4|  1017.2|00          |  1012.1|24          |
|2022-04-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |      5.6|    NA|NA        |  6.0|      NA|NA          |      NA|NA          |
|2022-04-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |       NA|    NA|NA        |   NA|      NA|NA          |      NA|NA          |
|2022-04-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |       NA|    NA|NA        |   NA|      NA|NA          |      NA|NA          |
|2022-04-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 16.6|0,0  | 13.2|23:34    | 19.9|00:00    |16  |      5.6|  11.7|12:38     |  9.1|  1020.3|Varias      |  1010.0|02          |
|2022-04-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.0|0,0  | 10.8|03:33    | 17.2|13:27    |22  |      3.9|   9.2|15:07     |  5.2|  1021.0|Varias      |  1016.7|24          |
|2022-04-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.4|0,0  |  9.4|05:10    | 17.5|12:47    |08  |      7.8|  14.4|Varias    |  6.9|  1016.7|00          |  1013.2|19          |
|2022-04-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.1|0,2  | 13.8|09:30    | 16.4|11:33    |07  |     10.0|  17.5|Varias    |  0.2|  1013.3|00          |  1010.3|15          |
|2022-04-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 13.7|5,1  | 12.8|23:48    | 14.6|16:30    |07  |     10.0|  15.8|10:33     |  0.0|  1015.7|Varias      |  1010.1|05          |
|2022-04-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 16.6|0,0  | 11.2|03:30    | 21.9|09:21    |08  |      6.9|  16.9|Varias    |  8.6|  1019.2|Varias      |  1014.4|04          |
|2022-04-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 19.6|0,0  | 14.1|Varias   | 25.2|10:13    |35  |      4.7|   8.3|06:19     | 10.5|  1019.7|Varias      |  1017.8|15          |
|2022-04-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.1|0,0  | 14.9|04:21    | 25.3|09:38    |25  |      6.1|  12.8|16:44     | 11.3|  1019.0|00          |  1013.4|16          |
|2022-04-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 17.8|0,0  | 13.4|23:56    | 22.2|10:19    |10  |      5.6|  12.8|13:07     | 11.9|  1017.5|Varias      |  1015.2|02          |
|2022-04-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.5|0,0  | 11.8|04:17    | 19.2|10:48    |15  |      3.1|   9.7|15:21     |  9.7|  1016.6|00          |  1013.3|16          |
|2022-04-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.6|0,5  | 11.5|04:16    | 19.7|14:00    |99  |      2.5|   6.7|Varias    |  0.8|  1013.6|00          |  1006.8|24          |
|2022-04-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|6,8  |   NA|NA       |   NA|NA       |NA  |     11.9|    NA|NA        |  0.6|      NA|NA          |      NA|NA          |
|2022-04-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|12,7 |   NA|NA       |   NA|NA       |NA  |      1.9|    NA|NA        |  0.0|  1004.1|Varias      |  1001.6|13          |
|2022-04-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.2|0,0  | 10.2|04:18    | 18.1|10:21    |23  |      4.7|  10.8|09:58     |  8.1|  1002.5|00          |   998.8|24          |
|2022-04-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 14.7|0,6  | 11.4|22:56    | 18.0|12:05    |25  |      5.0|  17.5|12:36     |  4.0|  1003.6|Varias      |   995.8|07          |
|2022-04-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 17.4|0,0  | 12.2|00:05    | 22.6|13:27    |25  |      5.3|  16.4|15:23     | 11.8|  1012.4|Varias      |  1003.2|01          |
|2022-04-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.6|0,0  | 11.6|04:30    | 19.7|13:46    |99  |      4.2|   9.7|Varias    | 12.4|  1014.2|Varias      |  1011.5|04          |
|2022-04-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 15.4|0,0  | 10.3|04:50    | 20.4|14:08    |99  |      3.3|   8.3|Varias    | 12.1|  1015.2|Varias      |  1012.9|03          |
|2022-04-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |      2.5|    NA|NA        |  3.0|      NA|NA          |      NA|NA          |
|2022-04-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |       NA|    NA|NA        |   NA|      NA|NA          |      NA|NA          |
|2022-04-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.8|0,0  | 14.1|04:30    | 23.5|12:25    |35  |      4.7|   8.3|Varias    | 11.0|  1023.6|Varias      |  1021.2|19          |
|2022-04-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.0|Ip   | 15.1|04:14    | 20.9|Varias   |22  |      3.6|   7.8|Varias    |  8.1|  1021.7|00          |  1018.6|14          |
|2022-05-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.2|0,0  | 14.6|05:38    | 21.7|13:00    |99  |      3.6|   6.7|Varias    |  9.9|  1019.2|00          |  1015.5|24          |
|2022-05-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.2|0,0  | 15.8|23:55    | 20.7|12:03    |10  |      3.3|   8.9|15:51     |  0.6|  1015.5|00          |  1012.0|16          |
|2022-05-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,2  |   NA|NA       |   NA|NA       |NA  |      6.1|    NA|NA        |  4.0|      NA|NA          |      NA|NA          |
|2022-05-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|0,0  |   NA|NA       |   NA|NA       |NA  |       NA|    NA|NA        |   NA|      NA|NA          |      NA|NA          |
|2022-05-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4|   NA|1,8  |   NA|NA       |   NA|NA       |NA  |       NA|    NA|NA        |  4.0|      NA|NA          |      NA|NA          |
|2022-05-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 17.2|0,0  | 12.4|04:22    | 21.9|14:25    |99  |      4.2|   8.3|Varias    | 12.7|  1019.9|Varias      |  1016.7|15          |
|2022-05-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.6|0,0  | 13.8|02:30    | 23.3|09:19    |01  |      4.2|  10.3|05:18     | 10.0|  1019.5|00          |  1017.1|15          |
|2022-05-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.5|0,0  | 13.9|04:41    | 23.1|12:39    |24  |      2.5|   7.2|11:43     |  8.4|  1021.2|Varias      |  1017.6|04          |
|2022-05-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 19.4|0,0  | 14.8|00:00    | 23.9|08:49    |13  |      3.3|   7.8|10:25     |  9.6|  1023.2|Varias      |  1020.1|03          |
|2022-05-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.6|0,0  | 14.5|04:41    | 22.7|14:02    |99  |      5.0|  12.5|Varias    | 11.7|  1022.8|Varias      |  1020.7|17          |
|2022-05-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.3|0,0  | 14.7|03:43    | 21.9|11:41    |22  |      5.8|  11.7|11:44     | 12.0|  1021.7|Varias      |  1019.9|03          |
|2022-05-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.8|0,0  | 14.6|Varias   | 23.1|14:08    |20  |      3.1|   8.3|10:43     | 11.8|  1022.6|Varias      |  1020.4|17          |
|2022-05-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.3|0,0  | 14.2|04:45    | 22.4|16:10    |99  |      3.3|   7.8|Varias    | 11.6|  1021.9|Varias      |  1019.9|16          |
|2022-05-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.2|0,0  | 15.9|02:49    | 24.4|09:01    |99  |      3.6|   7.2|Varias    | 12.1|  1020.0|00          |  1016.9|17          |
|2022-05-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.0|0,0  | 16.9|03:29    | 25.1|08:03    |22  |      3.9|   8.3|Varias    |  9.8|  1017.7|Varias      |  1015.5|18          |
|2022-05-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.0|0,0  | 17.3|02:19    | 24.6|15:15    |21  |      2.5|   7.2|10:10     | 10.5|  1019.8|Varias      |  1016.4|04          |
|2022-05-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.7|0,0  | 16.9|04:03    | 24.5|11:36    |22  |      3.9|   8.3|18:03     | 12.4|  1019.2|00          |  1016.4|18          |
|2022-05-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.2|0,0  | 18.6|03:31    | 27.8|11:20    |99  |      3.6|   7.2|Varias    | 12.0|  1019.5|Varias      |  1017.3|17          |
|2022-05-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.4|0,0  | 20.0|23:56    | 24.9|11:17    |11  |      4.4|   8.9|10:08     | 11.0|  1023.8|Varias      |  1019.3|02          |
|2022-05-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.3|0,0  | 18.6|04:32    | 26.0|12:53    |99  |      3.3|   7.2|Varias    | 11.6|  1025.0|Varias      |  1022.2|24          |
|2022-05-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.5|0,0  | 18.8|04:37    | 28.2|15:12    |24  |      5.8|  12.5|12:21     | 11.8|  1022.2|00          |  1015.1|24          |
|2022-05-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.1|0,0  | 18.8|04:08    | 27.4|10:43    |99  |      4.7|  10.3|Varias    | 11.2|  1015.1|00          |  1007.2|24          |
|2022-05-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.2|0,0  | 19.2|04:07    | 25.1|14:11    |99  |      5.3|  11.4|Varias    | 10.9|  1009.3|Varias      |  1005.4|04          |
|2022-05-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 19.4|24,2 | 15.9|23:46    | 22.9|08:16    |10  |      3.9|  11.4|19:05     |  0.1|  1012.6|Varias      |  1008.4|15          |
|2022-05-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.6|0,0  | 14.4|04:15    | 22.8|14:24    |99  |      3.3|   9.7|Varias    |  0.3|  1019.4|Varias      |  1011.7|00          |
|2022-05-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.4|0,0  | 17.8|05:44    | 24.9|09:43    |36  |      5.0|   9.2|07:15     | 12.2|  1021.0|Varias      |  1018.6|01          |
|2022-05-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.6|0,0  | 18.2|04:17    | 25.0|09:32    |22  |      5.8|  10.3|14:50     |  7.5|  1018.8|00          |  1015.6|Varias      |
|2022-05-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.5|0,0  | 19.7|04:30    | 29.3|09:18    |99  |      5.8|  14.4|Varias    | 12.5|  1015.6|00          |  1007.9|Varias      |
|2022-05-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.2|0,0  | 19.3|Varias   | 25.1|08:44    |99  |      3.9|   8.9|Varias    | 11.6|  1008.0|Varias      |  1005.4|24          |
|2022-05-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.0|0,0  | 18.4|Varias   | 23.5|08:29    |10  |      4.4|  10.3|08:15     | 10.3|  1011.6|Varias      |  1004.4|03          |
|2022-05-31 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.1|0,0  | 17.8|04:08    | 24.4|10:21    |04  |      2.5|   8.9|23:41     | 12.6|  1015.4|Varias      |  1010.3|03          |
|2022-06-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.3|0,0  | 18.2|03:58    | 24.4|Varias   |22  |      3.9|   9.2|12:58     | 12.1|  1015.1|00          |  1012.5|18          |
|2022-06-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.6|0,0  | 18.7|03:47    | 24.5|Varias   |08  |      5.0|   9.7|11:50     |  9.8|  1015.0|Varias      |  1011.5|05          |
|2022-06-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.3|0,0  | 20.0|02:43    | 26.6|08:52    |08  |      4.4|  11.4|07:31     |  7.1|  1014.2|Varias      |  1011.1|05          |
|2022-06-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.7|0,0  | 20.0|03:44    | 27.4|12:05    |15  |      3.9|   9.7|Varias    | 10.6|  1014.8|Varias      |  1012.2|00          |
|2022-06-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 20.1|04:20    | 27.5|10:05    |05  |      3.3|  10.3|07:34     | 11.8|  1019.9|Varias      |  1014.1|03          |
|2022-06-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 20.9|04:31    | 26.6|10:24    |22  |      4.4|   9.7|13:25     | 10.7|  1019.5|Varias      |  1015.4|19          |
|2022-06-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 20.4|02:33    | 27.1|09:41    |22  |      3.1|   9.2|14:41     | 11.5|  1017.7|Varias      |  1014.8|24          |
|2022-06-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 21.1|Varias   | 26.5|15:02    |08  |      4.4|  10.3|15:33     |  5.4|  1015.5|Varias      |  1011.2|12          |
|2022-06-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.0|0,0  | 20.1|Varias   | 26.0|08:10    |11  |      4.7|  10.8|09:40     | 11.7|  1019.3|Varias      |  1014.7|04          |
|2022-06-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.6|0,0  | 19.1|04:27    | 26.1|14:31    |24  |      6.1|  12.5|Varias    | 12.4|  1019.9|Varias      |  1017.2|17          |
|2022-06-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.4|0,0  | 20.6|04:30    | 28.3|15:36    |99  |      4.4|   8.9|16:31     | 11.8|  1021.4|Varias      |  1018.7|01          |
|2022-06-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.4|0,0  | 21.9|00:52    | 28.9|09:51    |99  |      5.0|  10.8|Varias    | 10.0|  1020.4|Varias      |  1016.8|18          |
|2022-06-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.0|0,0  | 21.1|04:33    | 31.0|Varias   |22  |      3.9|  10.3|Varias    | 11.5|  1019.0|Varias      |  1015.6|19          |
|2022-06-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.3|0,5  | 21.6|02:41    | 29.0|11:52    |27  |      4.2|  11.4|23:04     |  7.0|  1016.7|Varias      |  1014.1|19          |
|2022-06-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.8|0,0  | 23.4|23:56    | 30.1|12:44    |25  |      4.2|  12.5|05:01     |  8.1|  1017.8|23          |  1013.3|05          |
|2022-06-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.0|0,0  | 21.3|02:30    | 30.6|12:30    |22  |      3.1|   7.8|09:30     | 10.4|  1018.1|21          |  1016.9|04          |
|2022-06-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.4|0,0  | 24.0|02:02    | 32.9|11:42    |36  |      2.5|   7.8|04:31     | 11.0|  1019.0|Varias      |  1016.8|04          |
|2022-06-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.6|0,0  | 24.2|21:26    | 31.0|09:30    |05  |      4.7|  10.8|06:20     | 11.0|  1017.2|Varias      |  1013.1|24          |
|2022-06-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.4|0,0  | 24.0|01:44    | 28.8|Varias   |06  |      6.9|  12.8|18:23     | 11.2|  1013.1|00          |  1009.5|19          |
|2022-06-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.3|0,0  | 23.6|03:10    | 29.0|13:40    |11  |      2.8|   8.9|06:47     |  8.0|  1012.3|Varias      |  1009.5|03          |
|2022-06-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.4|3,8  | 22.1|23:59    | 30.6|12:50    |32  |      3.3|  10.3|22:50     |  2.1|  1013.7|23          |  1008.6|Varias      |
|2022-06-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.8|0,2  | 21.5|04:30    | 28.2|14:31    |99  |      4.7|  10.3|Varias    |  8.2|  1011.1|Varias      |  1007.4|03          |
|2022-06-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.0|0,0  | 22.2|02:42    | 27.8|16:00    |25  |      5.3|  11.7|16:24     | 11.5|  1011.7|Varias      |  1009.3|03          |
|2022-06-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.6|0,0  | 21.0|04:47    | 30.1|13:10    |99  |      7.8|  12.8|Varias    | 12.1|  1013.9|Varias      |  1010.8|01          |
|2022-06-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.5|0,0  | 21.3|03:47    | 27.7|13:38    |13  |      2.8|   7.8|11:35     | 12.1|  1013.2|01          |  1009.2|18          |
|2022-06-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.7|0,0  | 22.4|03:52    | 27.0|Varias   |11  |      5.6|  12.5|09:17     | 10.0|  1011.5|Varias      |  1008.5|18          |
|2022-06-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.6|Ip   | 22.9|23:56    | 28.3|14:49    |35  |      3.9|  10.8|23:30     |  4.9|  1017.3|Varias      |  1010.8|04          |
|2022-06-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.6|0,0  | 21.4|04:08    | 27.7|14:37    |25  |      7.8|  14.4|17:29     | 12.6|  1016.5|Varias      |  1012.8|17          |
|2022-06-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 19.7|04:12    | 28.0|12:34    |23  |      4.2|   9.2|Varias    | 12.1|  1015.9|00          |  1010.7|20          |
|2022-06-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.8|0,0  | 21.3|04:41    | 28.3|15:09    |99  |      3.9|  10.8|Varias    |  9.3|  1015.5|24          |  1010.5|17          |
|2022-07-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.7|0,0  | 21.2|23:58    | 26.2|10:36    |12  |      4.7|  10.3|10:34     | 11.0|  1019.7|Varias      |  1014.5|03          |
|2022-07-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 20.0|04:02    | 27.6|08:10    |12  |      3.3|   8.9|12:24     | 11.2|  1019.5|10          |  1017.4|19          |
|2022-07-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.9|0,0  | 21.7|02:39    | 30.1|16:09    |99  |      4.7|   8.9|Varias    |  8.8|  1018.4|Varias      |  1012.4|18          |
|2022-07-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.2|0,0  | 22.5|01:39    | 31.9|08:14    |10  |      3.6|   8.3|11:43     | 11.6|  1017.1|Varias      |  1014.8|18          |
|2022-07-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|2,1  | 23.2|03:50    | 30.8|09:50    |15  |      4.2|   9.7|19:00     |  9.6|  1021.4|20          |  1016.1|22          |
|2022-07-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.9|0,5  | 22.8|05:49    | 29.0|10:30    |26  |      4.4|  12.5|17:06     |  2.0|  1021.2|Varias      |  1017.3|02          |
|2022-07-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.8|0,0  | 22.5|05:26    | 29.2|14:03    |99  |      6.9|   9.7|Varias    | 11.5|  1020.5|Varias      |  1018.7|16          |
|2022-07-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.5|0,0  | 22.2|04:33    | 28.8|13:04    |99  |      5.0|   8.9|Varias    | 11.6|  1022.1|Varias      |  1019.5|02          |
|2022-07-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.0|0,0  | 22.3|04:20    | 29.8|08:35    |22  |      3.3|   8.3|12:47     | 12.5|  1021.5|Varias      |  1018.6|24          |
|2022-07-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.8|0,0  | 23.0|03:16    | 30.5|08:08    |24  |      4.2|   9.4|Varias    | 12.4|  1018.6|00          |  1015.4|18          |
|2022-07-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.4|0,0  | 23.0|04:24    | 29.9|09:54    |36  |      3.3|  10.3|06:19     | 12.2|  1017.4|Varias      |  1014.0|04          |
|2022-07-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,0  | 22.6|01:57    | 30.7|14:03    |99  |      2.5|   7.2|Varias    | 12.7|  1019.6|Varias      |  1016.7|02          |
|2022-07-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.2|0,0  | 23.6|03:41    | 30.7|07:39    |21  |      3.1|   7.2|15:40     | 12.8|  1020.5|Varias      |  1018.2|04          |
|2022-07-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,0  | 22.9|04:14    | 30.4|14:57    |23  |      4.2|   8.3|14:20     | 12.4|  1020.2|00          |  1016.4|24          |
|2022-07-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.4|0,0  | 23.6|03:51    | 33.3|12:01    |99  |      3.9|   8.9|Varias    | 12.2|  1016.4|00          |  1014.3|17          |
|2022-07-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.8|0,0  | 25.1|23:44    | 32.4|10:29    |13  |      3.6|   8.9|14:01     | 11.9|  1016.8|Varias      |  1014.4|03          |
|2022-07-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.1|0,0  | 24.3|23:17    | 31.9|10:59    |99  |      3.6|   8.3|Varias    | 11.1|  1018.4|Varias      |  1015.7|03          |
|2022-07-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,0  | 23.3|04:30    | 30.0|14:04    |06  |      3.9|   8.3|07:06     | 11.8|  1018.7|Varias      |  1016.2|18          |
|2022-07-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|0,0  | 23.4|04:32    | 30.7|13:37    |15  |      2.5|   6.7|14:48     | 11.3|  1016.9|Varias      |  1014.5|17          |
|2022-07-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.5|0,0  | 24.0|04:48    | 31.0|08:08    |11  |      4.7|  11.4|14:21     | 11.1|  1019.6|Varias      |  1015.5|03          |
|2022-07-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.9|0,0  | 24.2|04:29    | 31.6|13:58    |24  |      5.0|  11.7|14:48     | 12.1|  1019.6|Varias      |  1016.3|18          |
|2022-07-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.8|0,0  | 23.6|04:30    | 31.9|14:20    |24  |      5.3|  23.3|07:26     | 11.5|  1016.8|Varias      |  1014.2|16          |
|2022-07-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.4|0,0  | 24.3|03:51    | 30.6|15:19    |11  |      3.9|   9.2|10:16     |  9.4|  1018.4|Varias      |  1016.1|17          |
|2022-07-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.2|0,0  | 24.8|04:47    | 31.6|15:26    |25  |      5.0|   9.7|16:51     | 12.0|  1017.7|00          |  1013.9|18          |
|2022-07-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.8|0,0  | 24.5|03:29    | 31.1|07:55    |08  |      6.4|  10.8|10:20     |  6.5|  1015.9|Varias      |  1013.7|03          |
|2022-07-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.0|0,7  | 25.0|02:45    | 31.0|10:28    |17  |      5.8|  10.3|13:03     |  9.8|  1015.3|Varias      |  1012.3|19          |
|2022-07-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,4  | 23.2|05:57    | 30.1|16:02    |10  |      3.9|  11.4|05:39     |  4.5|  1014.5|Varias      |  1010.6|18          |
|2022-07-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.8|0,0  | 24.4|07:49    | 31.3|11:24    |28  |      2.8|   8.3|07:17     |  6.7|  1013.9|Varias      |  1011.1|04          |
|2022-07-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.8|0,0  | 24.5|04:35    | 31.0|10:11    |11  |      5.6|  12.5|15:12     |  4.9|  1017.6|Varias      |  1012.6|04          |
|2022-07-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.8|0,0  | 24.6|01:51    | 31.0|13:30    |99  |      4.2|   8.9|Varias    |  8.3|  1019.7|Varias      |  1016.8|03          |
|2022-07-31 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.3|0,0  | 24.4|03:41    | 32.2|12:58    |22  |      4.4|   9.2|14:29     | 11.8|  1019.1|00          |  1015.4|17          |
|2022-08-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 29.0|0,0  | 24.8|05:10    | 33.3|11:50    |24  |      5.3|   8.9|15:25     | 11.4|  1016.4|Varias      |  1014.3|16          |
|2022-08-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 29.6|0,0  | 26.7|04:36    | 32.5|10:45    |23  |      4.4|  10.3|14:48     | 11.6|  1015.5|Varias      |  1013.3|16          |
|2022-08-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.8|0,0  | 25.2|04:48    | 32.3|14:46    |99  |      4.2|   9.2|Varias    | 12.4|  1014.6|Varias      |  1012.6|04          |
|2022-08-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.8|0,0  | 25.6|04:37    | 31.9|12:15    |99  |      4.4|   8.9|Varias    | 12.0|  1014.7|Varias      |  1012.9|16          |
|2022-08-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.2|13,5 | 22.2|17:28    | 32.3|13:33    |07  |      4.2|  18.1|15:47     |  8.9|  1017.9|Varias      |  1013.6|01          |
|2022-08-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.2|0,0  | 22.7|04:01    | 33.6|09:40    |24  |      4.7|  10.3|21:28     | 10.2|  1016.5|Varias      |  1014.2|17          |
|2022-08-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.0|0,0  | 24.4|04:52    | 31.7|11:53    |36  |      2.8|   9.2|19:25     |  8.8|  1015.7|Varias      |  1013.2|19          |
|2022-08-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.2|0,0  | 22.5|04:49    | 31.8|12:02    |01  |      3.6|   9.2|05:11     | 12.3|  1016.2|Varias      |  1013.9|02          |
|2022-08-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.2|0,0  | 24.2|05:05    | 32.1|14:16    |01  |      3.1|   9.2|12:33     | 11.3|  1017.5|Varias      |  1015.7|03          |
|2022-08-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.2|0,0  | 24.0|05:10    | 32.5|13:50    |99  |      4.2|   9.7|Varias    | 12.3|  1016.5|00          |  1013.7|17          |
|2022-08-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.0|0,0  | 23.9|04:30    | 32.2|16:05    |99  |      3.9|   8.3|Varias    | 11.6|  1015.4|Varias      |  1013.6|18          |
|2022-08-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.6|0,0  | 24.5|05:09    | 32.6|14:13    |24  |      6.1|  15.0|Varias    | 11.6|  1014.3|00          |  1009.9|16          |
|2022-08-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 29.5|0,0  | 25.3|03:02    | 33.7|08:51    |08  |      4.7|  11.4|18:20     |  7.1|  1011.1|Varias      |  1008.8|05          |
|2022-08-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 30.2|2,7  | 25.9|03:37    | 34.6|13:11    |99  |      6.7|  12.8|Varias    |  7.6|  1009.4|00          |  1005.3|15          |
|2022-08-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.3|0,0  | 24.2|04:30    | 30.4|11:30    |36  |      4.7|  10.8|06:40     | 11.7|  1008.7|23          |  1006.5|05          |
|2022-08-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.5|0,0  | 23.8|04:08    | 31.2|13:49    |16  |      3.1|   7.8|14:17     |  7.4|  1008.7|00          |  1005.8|16          |
|2022-08-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.8|45,9 | 18.3|19:45    | 31.2|12:09    |36  |      5.6|  14.4|18:58     |  5.8|  1011.9|Varias      |  1006.1|11          |
|2022-08-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.4|2,8  | 19.4|23:18    | 27.5|13:30    |31  |      3.9|  10.3|15:44     |  4.9|  1016.0|Varias      |  1008.6|02          |
|2022-08-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.8|0,0  | 18.2|05:16    | 29.5|11:26    |99  |      3.9|   8.3|Varias    | 12.8|  1018.6|Varias      |  1015.5|01          |
|2022-08-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.4|0,0  | 20.6|04:54    | 30.1|13:13    |23  |      6.7|  12.5|15:36     | 12.6|  1018.3|Varias      |  1015.0|18          |
|2022-08-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|3,4  | 23.2|03:28    | 30.7|13:35    |07  |      3.3|  12.8|17:11     |  7.3|  1015.9|00          |  1011.4|15          |
|2022-08-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.4|0,0  | 23.5|00:10    | 29.2|14:20    |04  |      3.9|   9.2|08:40     |  8.0|  1013.4|10          |  1011.8|Varias      |
|2022-08-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,0  | 23.0|05:12    | 30.3|12:33    |99  |      4.7|   9.7|Varias    | 12.0|  1014.4|Varias      |  1011.9|17          |
|2022-08-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.6|0,0  | 24.3|05:12    | 31.0|11:24    |24  |      4.4|  10.3|12:43     | 10.5|  1015.4|Varias      |  1012.5|17          |
|2022-08-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.5|0,6  | 22.2|21:45    | 30.8|13:31    |35  |      3.1|  12.8|21:01     |  8.6|  1015.4|Varias      |  1012.3|00          |
|2022-08-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.6|0,0  | 22.0|04:03    | 31.3|10:26    |99  |      5.3|   9.2|Varias    |  7.4|  1014.4|Varias      |  1010.7|17          |
|2022-08-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.4|0,0  | 23.6|04:59    | 31.3|13:47    |99  |      4.4|   9.7|Varias    |  9.8|  1012.2|Varias      |  1010.3|17          |
|2022-08-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.8|0,0  | 22.6|04:53    | 31.1|14:29    |99  |      5.8|  10.8|Varias    | 12.1|  1014.9|Varias      |  1011.8|00          |
|2022-08-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.8|Ip   | 22.9|05:00    | 30.7|15:33    |25  |      4.4|  11.4|10:44     |  7.9|  1016.9|Varias      |  1013.6|22          |
|2022-08-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.3|1,8  | 23.4|05:10    | 31.2|13:43    |99  |      6.7|  11.7|Varias    | 10.3|  1016.7|Varias      |  1012.9|17          |
|2022-08-31 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.6|11,6 | 18.8|16:50    | 30.5|13:43    |99  |      3.9|  16.9|16:37     |  3.3|  1017.1|Varias      |  1013.2|05          |
|2022-09-01 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.8|0,0  | 19.4|Varias   | 30.2|13:37    |36  |      4.2|  10.3|01:48     | 11.5|  1014.8|00          |  1011.8|18          |
|2022-09-02 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|0,0  | 23.1|23:14    | 30.9|15:11    |10  |      5.3|  11.7|17:57     |  8.7|  1012.4|00          |  1008.5|17          |
|2022-09-03 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.0|0,0  | 22.7|05:16    | 29.3|12:20    |08  |      5.6|  12.5|01:30     |  5.6|  1013.4|Varias      |  1010.5|03          |
|2022-09-04 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.3|0,0  | 23.1|05:15    | 29.5|12:40    |99  |      4.2|   8.3|Varias    | 10.3|  1017.9|Varias      |  1013.4|00          |
|2022-09-05 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.1|0,0  | 23.8|05:58    | 30.4|10:41    |12  |      4.4|   9.7|10:24     |  6.2|  1018.7|Varias      |  1015.7|18          |
|2022-09-06 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|0,0  | 23.1|23:31    | 30.8|13:52    |23  |      5.6|  10.6|16:15     | 11.4|  1016.3|00          |  1012.9|17          |
|2022-09-07 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.2|0,0  | 21.8|05:48    | 30.5|11:16    |99  |      3.1|   8.3|Varias    |  7.6|  1014.3|Varias      |  1010.7|18          |
|2022-09-08 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.4|0,0  | 23.6|03:21    | 29.3|12:31    |99  |      4.4|   8.3|Varias    |  4.2|  1015.4|Varias      |  1011.4|00          |
|2022-09-09 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.0|0,0  | 22.2|05:30    | 29.7|11:03    |11  |      6.9|  11.7|12:06     |  4.4|  1019.0|Varias      |  1014.3|03          |
|2022-09-10 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.2|0,0  | 21.0|03:28    | 29.4|15:08    |22  |      3.9|   8.3|Varias    |  9.8|  1019.7|10          |  1016.1|18          |
|2022-09-11 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 26.8|0,0  | 24.4|23:33    | 29.1|Varias   |10  |      4.2|   8.9|10:12     |  6.5|  1016.8|00          |  1013.4|18          |
|2022-09-12 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 27.0|0,0  | 23.2|05:00    | 30.8|12:00    |01  |      3.3|   9.2|23:40     |  8.2|  1014.0|00          |  1010.4|18          |
|2022-09-13 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 28.9|0,7  | 25.0|23:32    | 32.8|11:46    |06  |      4.7|  14.4|17:47     |  0.4|  1011.5|Varias      |  1008.4|Varias      |
|2022-09-14 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 24.4|0,1  | 20.8|02:25    | 28.1|16:26    |33  |      5.0|  16.1|02:08     |  0.7|  1010.2|02          |  1006.2|01          |
|2022-09-15 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.4|0,0  | 20.8|06:05    | 29.9|13:31    |36  |      3.6|   8.3|04:39     | 11.4|  1012.0|Varias      |  1008.9|03          |
|2022-09-16 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 25.1|0,0  | 21.7|05:22    | 28.5|14:49    |06  |      4.2|  13.3|21:40     |  5.2|  1012.7|Varias      |  1009.2|17          |
|2022-09-17 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.2|0,0  | 20.1|04:58    | 26.4|10:37    |36  |      4.7|  11.4|06:00     |  8.2|  1015.8|Varias      |  1010.8|01          |
|2022-09-18 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.0|0,0  | 18.6|05:07    | 25.5|13:42    |22  |      3.3|   9.2|13:52     | 10.4|  1017.2|Varias      |  1014.9|03          |
|2022-09-19 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.7|0,0  | 18.8|05:20    | 26.6|14:00    |11  |      2.8|   7.2|09:40     | 10.3|  1016.1|Varias      |  1014.2|05          |
|2022-09-20 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.4|0,0  | 20.7|23:47    | 26.2|12:09    |17  |      3.3|   7.8|12:17     |  3.9|  1018.1|Varias      |  1016.0|00          |
|2022-09-21 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.8|0,0  | 19.5|Varias   | 26.0|13:27    |99  |      4.4|   8.9|Varias    |  7.6|  1018.0|Varias      |  1016.0|16          |
|2022-09-22 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 23.0|0,0  | 20.1|Varias   | 25.8|13:04    |99  |      4.7|  11.4|Varias    |  8.4|  1018.9|Varias      |  1016.7|03          |
|2022-09-23 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 22.0|13,7 | 17.0|23:59    | 27.0|13:14    |36  |      4.2|  14.4|23:46     |  6.2|  1018.5|Varias      |  1012.6|23          |
|2022-09-24 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.0|0,6  | 16.7|00:20    | 23.3|13:10    |01  |      6.7|  13.3|07:50     |  0.4|  1013.7|10          |  1010.6|17          |
|2022-09-25 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.0|0,0  | 16.4|07:02    | 23.7|13:55    |01  |      4.2|   8.9|08:22     |  5.9|  1013.3|Varias      |  1011.5|02          |
|2022-09-26 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.3|0,0  | 15.0|05:59    | 25.6|13:36    |25  |      5.6|  13.3|14:31     |  9.7|  1012.7|00          |  1009.7|15          |
|2022-09-27 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.0|0,0  | 15.3|03:01    | 24.7|12:26    |35  |      3.3|   8.9|10:27     |  8.2|  1011.5|Varias      |  1008.8|05          |
|2022-09-28 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 21.9|0,0  | 16.8|04:28    | 27.0|12:57    |30  |      5.0|  12.5|17:13     |  3.5|  1010.8|00          |  1003.6|17          |
|2022-09-29 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 20.4|0,0  | 16.3|23:55    | 24.6|16:23    |08  |      4.2|  16.1|19:40     |  3.8|  1005.0|Varias      |  1000.4|16          |
|2022-09-30 |0076       |BARCELONA AEROPUERTO |BARCELONA |       4| 18.8|0,0  | 14.5|04:52    | 23.2|11:07    |21  |      4.7|  11.7|20:17     |  7.6|  1018.3|24          |  1004.8|00          |

---

# Importando datos: desde .orange[API]

Tambi√©n se pueden importar datos desde las API de spotify (ver &lt;https://www.rcharlie.com/spotifyr/&gt;) como de Twitter (ver &lt;https://github.com/ropensci/rtweet&gt;)


```r
# install.packages("rtweet")
library(rtweet)
# install.packages("spotifyr")
library(spotifyr)
```



```r
# install.packages("rtweet")
library(rtweet)
auth_setup_default()
rt &lt;- search_tweets("#pedrosanchez", n = 100, include_rts = FALSE)
rt
```

---

class: inverse center middle
name: clase-12

# CLASE 12: cruzar tablas y funciones


&amp;nbsp;

### [Left/right join](#left-join)

### [Sufijos y claves](#sufijos-claves)

### [Inner, full y anti join](#inner-full-anti)

### [Ejercicios](#ejercicios-join)

### [Practicando funciones](#extra-funciones)

---

names: left-join

# .orange[RELACIONANDO] datos

Al trabajar con datos **.bg-purple_light[no siempre tendremos la informaci√≥n en una sola tabla]** y a veces nos interesar√° cruzar la informaci√≥n de distintas fuentes.

--

Para ello usaremos un cl√°sico de todo lenguaje que maneja datos: los famosos **.bg-purple_light[join]**, una herramienta que nos va a permitir **.bg-purple_light[cruzar una o variables tablas]**, haciendo uso de una **.bg-purple_light[columna identificadora]** de cada una de ellas (por ejemplo, imagina que cruzamos datos de hacienda y de antecedentes penales, haciendo _join_ por la columna `DNI`).

---

# .orange[RELACIONANDO] datos


.pull-left[


```r
tabla_1 %&gt;% xxx_join(tabla_2, by = id)
```

* `inner_join()`: solo sobreviven los **.bg-purple_light[registros con id en ambas]** tablas.

* `full_join()`: mantiene **.bg-purple_light[todos los registros de ambas]** tablas.

* `left_join()`: mantiene **.bg-purple_light[todos los registros de la primera tabla]**, y busca cuales tienen id tambi√©n en la segunda (en caso de **.bg-purple_light[no tenerlo se rellena con NA]** los campos de la 2¬™ tabla).

* `right_join()`: mantiene **.bg-purple_light[todos los registros de la segunda tabla]**, y busca cuales tienen id tambi√©n en la primera.

]


.pull-right[

&lt;img src="./img/sql-joins.jpg" width="120%" style="display: block; margin: auto;" /&gt;


]


---

# .orange[RELACIONANDO] datos

Vamos a probar los distintos joins con un ejemplo sencillo


```r
tb_1 &lt;- tibble("key" = 1:3, "val_x" = c("x1", "x2", "x3"))
tb_2 &lt;- tibble("key" = c(1, 2, 4), "val_y" = c("y1", "y2", "y3"))
```

.pull-left[


```r
tb_1
```

```
&gt; # A tibble: 3 √ó 2
&gt;     key val_x
&gt;   &lt;int&gt; &lt;chr&gt;
&gt; 1     1 x1   
&gt; 2     2 x2   
&gt; 3     3 x3
```

]

.pull-right[


```r
tb_2
```

```
&gt; # A tibble: 3 √ó 2
&gt;     key val_y
&gt;   &lt;dbl&gt; &lt;chr&gt;
&gt; 1     1 y1   
&gt; 2     2 y2   
&gt; 3     4 y3
```

]

---


# .orange[LEFT] join

Imagina que queremos **.bg-purple_light[incorporar]** a `tb_1` la **.bg-purple_light[informaci√≥n de la tabla_2]**, identificando los registros por la columna key (indicando con `by = "key"` la columna por la que tiene que cruzar): queremos mantener todos los registros de la primera tabla y buscar cuales tienen id (mismo valor en `key`) tambi√©n en la segunda tabla.

.pull-left[



```r
tb_1 %&gt;%
  left_join(tb_2, by = "key")
```

```
&gt; # A tibble: 3 √ó 3
&gt;     key val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     3 x3    &lt;NA&gt;
```

]


.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/left_join.jpg" alt="Esquema del left join" width="100%" /&gt;
&lt;p class="caption"&gt;Esquema del left join&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[LEFT] join



```r
tb_1 %&gt;% left_join(tb_2, by = "key")
```

```
&gt; # A tibble: 3 √ó 3
&gt;     key val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     3 x3    &lt;NA&gt;
```

F√≠jate que los **.bg-purple_light[registros de la primera cuya key no ha encontrado en la segunda]** les ha dado el valor de **.bg-purple_light[ausente]**.

---

# .orange[RIGHT] join

El `right_join()` realizar√° la operaci√≥n contraria: vamos ahora a **.bg-purple_light[incorporar]** a `tb_2` la **.bg-purple_light[informaci√≥n de la tabla_2]**, identificando los registros por la columna key (indicando con `by = "key"` la columna por la que tiene que cruzar): queremos mantener todos los registros de la segunda y buscar cuales tienen id (mismo valor en `key`) tambi√©n en la primera tabla.

.pull-left[



```r
tb_1 %&gt;%
  right_join(tb_2, by = "key")
```

```
&gt; # A tibble: 3 √ó 3
&gt;     key val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     4 &lt;NA&gt;  y3
```

]


.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/right_join.jpg" alt="Esquema del right join" width="100%" /&gt;
&lt;p class="caption"&gt;Esquema del right join&lt;/p&gt;
&lt;/div&gt;

]


---

# .orange[RIGHT] join



```r
tb_1 %&gt;% right_join(tb_2, by = "key")
```

```
&gt; # A tibble: 3 √ó 3
&gt;     key val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     4 &lt;NA&gt;  y3
```

F√≠jate que ahora los **.bg-purple_light[registros de la segunda cuya key no ha encontrado en la primera]** son los que les ha dado el valor de **.bg-purple_light[ausente]**.

---


name: sufijos-claves

# .orange[CLAVES] y .green[SUFIJOS] 

Las columnas clave que usaremos para el cruce **.bg-purple_light[no siempre se llamar√°n igual]**.


```r
tb_1 &lt;- tibble("key_1" = 1:3, "val_x" = c("x1", "x2", "x3"))
tb_2 &lt;- tibble("key_2" = c(1, 2, 4), "val_y" = c("y1", "y2", "y3"))
```

--

* `by = c("key_2" = "key_2")`: le indicaremos en qu√© columna de cada tabla est√°n las claves por las que vamos a cruzar.

.pull-left[


```r
# Left
tb_1 %&gt;%
  left_join(tb_2, by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 3 √ó 3
&gt;   key_1 val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     3 x3    &lt;NA&gt;
```

]

.pull-right[


```r
# Right
tb_1 %&gt;%
  right_join(tb_2, by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 3 √ó 3
&gt;   key_1 val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     4 &lt;NA&gt;  y3
```
]


---

# .orange[CLAVES] y .green[SUFIJOS] 

Adem√°s podemos **.bg-purple_light[cruzar por varias columnas a la vez]** (interpretar√° como igual registro aquel que tenga el conjunto de claves igual), con `by = c("var1_t1" = "var1_t2", "var2_t1" = "var2_t2", ...)`. Modifiquemos el ejemplo anterior


```r
tb_1 &lt;- tibble("k_11" = 1:3, "k_12" = c("a", "b", "c"),  "val_x" = c("x1", "x2", "x3"))
tb_2 &lt;- tibble("k_21" = c(1, 2, 4), "k_22" = c("a", "b", "e"), "val_y" = c("y1", "y2", "y3"))
```

--

.pull-left[


```r
# Left
tb_1 %&gt;%
  left_join(tb_2,
            by = c("k_11" = "k_21",
                   "k_12" = "k_22"))
```

```
&gt; # A tibble: 3 √ó 4
&gt;    k_11 k_12  val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 a     x1    y1   
&gt; 2     2 b     x2    y2   
&gt; 3     3 c     x3    &lt;NA&gt;
```
]

.pull-right[


```r
# Right
tb_1 %&gt;%
  right_join(tb_2,
             by = c("k_11" = "k_21",
                    "k_12" = "k_22"))
```

```
&gt; # A tibble: 3 √ó 4
&gt;    k_11 k_12  val_x val_y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 a     x1    y1   
&gt; 2     2 b     x2    y2   
&gt; 3     4 e     &lt;NA&gt;  y3
```
]

---

# .orange[CLAVES] y .green[SUFIJOS] 

Tambi√©n podr√≠a suceder que al cruzar dos tablas, haya **.bg-purple_light[columnas de valores que se llamen igual]**



```r
tb_1 &lt;- tibble("key_1" = 1:3, "val" = c("x1", "x2", "x3"))
tb_2 &lt;- tibble("key_2" = c(1, 2, 4), "val" = c("y1", "y2", "y3"))
```

--


```r
# Left
tb_1 %&gt;% left_join(tb_2, by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 3 √ó 3
&gt;   key_1 val.x val.y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     3 x3    &lt;NA&gt;
```

F√≠jate que **.bg-purple_light[por defecto nos a√±ade los sufijos]** `.x` y `.y` para indicarnos de que tabla vienen.

---

# .orange[CLAVES] y .green[SUFIJOS] 


Dicho **.bg-purple_light[sufijo podemos especific√°rselo]** en el argumento opcional `suffix = ...`, que nos permita **.bg-purple_light[distinguir las variables]** de una tabla y de otra.



```r
# Left
tb_1 %&gt;% left_join(tb_2, by = c("key_1" = "key_2"), suffix = c("_tabla1", "_tabla2"))
```

```
&gt; # A tibble: 3 √ó 3
&gt;   key_1 val_tabla1 val_tabla2
&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     
&gt; 1     1 x1         y1        
&gt; 2     2 x2         y2        
&gt; 3     3 x3         &lt;NA&gt;
```

---

name: inner-full-anti

# .orange[FULL] join

Los dos anteriores casos forman lo que se conoce como **.bg-purple_light[outer joins]**: cruces donde se mantienen observaciones que salgan en al menos una tabla. El tercer outer join es el conocido como `full_join()` que nos **.bg-purple_light[mantendr√° las observaciones de ambas]** tablas, **.bg-purple_light[a√±adiendo las filas]** que no casen con la otra tabla.

.pull-left[



```r
tb_1 %&gt;%
  full_join(tb_2,
            by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 4 √ó 3
&gt;   key_1 val.x val.y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2   
&gt; 3     3 x3    &lt;NA&gt; 
&gt; 4     4 &lt;NA&gt;  y3
```

]


.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/full_join.jpg" alt="Esquema del full join" width="100%" /&gt;
&lt;p class="caption"&gt;Esquema del full join&lt;/p&gt;
&lt;/div&gt;

]


---

# .orange[INNER] join

Frente a los outer join est√° lo que se conoce como **.bg-purple_light[inner join]**, con `inner_join()`: un cruce en el que solo se mantienen las **.bg-purple_light[observaciones que salgan en ambas tablas]**, solo mantiene aquellos registros matcheados.

.pull-left[



```r
tb_1 %&gt;%
  inner_join(tb_2,
             by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 2 √ó 3
&gt;   key_1 val.x val.y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2
```

]


.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/inner_join.png" alt="Esquema del inner join" width="100%" /&gt;
&lt;p class="caption"&gt;Esquema del inner join&lt;/p&gt;
&lt;/div&gt;

]

---

# .orange[INNER] join

F√≠jate que en t√©rminos de registros, `inner_join` si es conmutativa, **nos da igual el orden de las tablas**: lo √∫nico que cambia es el orden de las columnas que a√±ade.

.pull-left[



```r
tb_1 %&gt;%
  inner_join(tb_2,
             by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 2 √ó 3
&gt;   key_1 val.x val.y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 x1    y1   
&gt; 2     2 x2    y2
```

]

.pull-right[



```r
tb_2 %&gt;% inner_join(tb_1,
                    by = c("key_2" = "key_1"))
```

```
&gt; # A tibble: 2 √ó 3
&gt;   key_2 val.x val.y
&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
&gt; 1     1 y1    x1   
&gt; 2     2 y2    x2
```

]

---

# .orange[ANTI/SEMI] join

Por √∫ltimo tenemos dos herramientas interesantes para **.bg-purple_light[filtrar (no cruzar) registros]**: `semi_join()` y `anti_join()`. El **.bg-purple_light[semi join]** nos deja en la **.bg-purple_light[primera tabla los registros que cuya clave est√° tambi√©n en la segunda]** (como un inner join pero sin a√±adir la info de la segunda tabla). Y el segundo, los anti join, hace justo lo contrario (aquellos que no est√°n).


.pull-left[


```r
# semijoin
tb_1 %&gt;%
  semi_join(tb_2,
            by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 2 √ó 2
&gt;   key_1 val  
&gt;   &lt;int&gt; &lt;chr&gt;
&gt; 1     1 x1   
&gt; 2     2 x2
```

]

.pull-right[


```r
# antijoin
tb_1 %&gt;%
  anti_join(tb_2,
            by = c("key_1" = "key_2"))
```

```
&gt; # A tibble: 1 √ó 2
&gt;   key_1 val  
&gt;   &lt;int&gt; &lt;chr&gt;
&gt; 1     3 x3
```

]


---

name: ejercicios-join

# Ejercicios

Para los ejercicios usaremos las tablas disponibles en el paquete `{nycflights13}` (echa un vistazo antes)


```r
library(nycflights13)
```

* **.bg-purple_light[airlines]**: nombre de aerol√≠neas (con su abreviatura).
* **.bg-purple_light[airports]**: datos de aeropuertos (nombres, longitud, latitud, altitud, etc).
* **.bg-purple_light[flights]**: datos de vuelos.
* **.bg-purple_light[planes]**: datos de los aviones.
* **.bg-purple_light[weather]**: datos meteorol√≥gicos horarios de las estaciones LGA, JFK y EWR.

---

# Ejercicios

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/relational-nycflights.png" alt="Relaci√≥n de las tablas" width="60%" /&gt;
&lt;p class="caption"&gt;Relaci√≥n de las tablas&lt;/p&gt;
&lt;/div&gt;

---

# Ejercicios


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 1**: del paquete `{nycflights13}` cruza la tabla `flights` con `airlines`. Queremos mantener todos los registros de vuelos, a√±adiendo la informaci√≥n de las aerol√≠neas a la tabla de aviones.

* üìù **Ejercicio 2**: a la tabla obtenida del cruce del apartado anterior, cruza despu√©s con los datos de los aviones en `planes`, pero incluyendo solo aquellos vuelos de los que tengamos informaci√≥n de sus aviones (y viceversa). 

* üìù **Ejercicio 3**: repite el ejercicio anterior pero conservando ambas variables `year` (en una es el a√±o del vuelo, en la otra es el a√±o de construcci√≥n del avi√≥n), y distingui√©ndolas entre s√≠


]

.panel[.panel-name[Sol. Ej. 1]



```r
flights_airlines &lt;-
  flights %&gt;% 
  left_join(airlines, by = "carrier")
flights_airlines
```

```
&gt; # A tibble: 336,776 √ó 20
&gt;     year month   day dep_time sched_de‚Ä¶¬π dep_d‚Ä¶¬≤ arr_t‚Ä¶¬≥ sched‚Ä¶‚Å¥ arr_d‚Ä¶‚Åµ carrier
&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
&gt;  1  2013     1     1      517        515       2     830     819      11 UA     
&gt;  2  2013     1     1      533        529       4     850     830      20 UA     
&gt;  3  2013     1     1      542        540       2     923     850      33 AA     
&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     
&gt;  5  2013     1     1      554        600      -6     812     837     -25 DL     
&gt;  6  2013     1     1      554        558      -4     740     728      12 UA     
&gt;  7  2013     1     1      555        600      -5     913     854      19 B6     
&gt;  8  2013     1     1      557        600      -3     709     723     -14 EV     
&gt;  9  2013     1     1      557        600      -3     838     846      -8 B6     
&gt; 10  2013     1     1      558        600      -2     753     745       8 AA     
&gt; # ‚Ä¶ with 336,766 more rows, 10 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãsched_dep_time, ¬≤‚Äãdep_delay, ¬≥‚Äãarr_time, ‚Å¥‚Äãsched_arr_time, ‚Åµ‚Äãarr_delay
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```
 
]

.panel[.panel-name[Sol. Ej. 2]



```r
flights_airlines_planes &lt;- 
  flights_airlines %&gt;% 
  inner_join(planes, by = "tailnum")
flights_airlines_planes
```

```
&gt; # A tibble: 284,170 √ó 28
&gt;    year.x month   day dep_time sched_d‚Ä¶¬π dep_d‚Ä¶¬≤ arr_t‚Ä¶¬≥ sched‚Ä¶‚Å¥ arr_d‚Ä¶‚Åµ carrier
&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
&gt;  1   2013     1     1      517       515       2     830     819      11 UA     
&gt;  2   2013     1     1      533       529       4     850     830      20 UA     
&gt;  3   2013     1     1      542       540       2     923     850      33 AA     
&gt;  4   2013     1     1      544       545      -1    1004    1022     -18 B6     
&gt;  5   2013     1     1      554       600      -6     812     837     -25 DL     
&gt;  6   2013     1     1      554       558      -4     740     728      12 UA     
&gt;  7   2013     1     1      555       600      -5     913     854      19 B6     
&gt;  8   2013     1     1      557       600      -3     709     723     -14 EV     
&gt;  9   2013     1     1      557       600      -3     838     846      -8 B6     
&gt; 10   2013     1     1      558       600      -2     849     851      -2 B6     
&gt; # ‚Ä¶ with 284,160 more rows, 18 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, year.y &lt;int&gt;, type &lt;chr&gt;,
&gt; #   manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;,
&gt; #   engine &lt;chr&gt;, and abbreviated variable names ¬π‚Äãsched_dep_time, ¬≤‚Äãdep_delay,
&gt; #   ¬≥‚Äãarr_time, ‚Å¥‚Äãsched_arr_time, ‚Åµ‚Äãarr_delay
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 3]



```r
flights_airlines_planes &lt;- 
  flights_airlines %&gt;% 
  inner_join(planes, by = "tailnum",
             suffix = c("_flight", "_build_aircraft"))
flights_airlines_planes
```

```
&gt; # A tibble: 284,170 √ó 28
&gt;    year_fl‚Ä¶¬π month   day dep_t‚Ä¶¬≤ sched‚Ä¶¬≥ dep_d‚Ä¶‚Å¥ arr_t‚Ä¶‚Åµ sched‚Ä¶‚Å∂ arr_d‚Ä¶‚Å∑ carrier
&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
&gt;  1      2013     1     1     517     515       2     830     819      11 UA     
&gt;  2      2013     1     1     533     529       4     850     830      20 UA     
&gt;  3      2013     1     1     542     540       2     923     850      33 AA     
&gt;  4      2013     1     1     544     545      -1    1004    1022     -18 B6     
&gt;  5      2013     1     1     554     600      -6     812     837     -25 DL     
&gt;  6      2013     1     1     554     558      -4     740     728      12 UA     
&gt;  7      2013     1     1     555     600      -5     913     854      19 B6     
&gt;  8      2013     1     1     557     600      -3     709     723     -14 EV     
&gt;  9      2013     1     1     557     600      -3     838     846      -8 B6     
&gt; 10      2013     1     1     558     600      -2     849     851      -2 B6     
&gt; # ‚Ä¶ with 284,160 more rows, 18 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, year_build_aircraft &lt;int&gt;,
&gt; #   type &lt;chr&gt;, manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;,
&gt; #   speed &lt;int&gt;, engine &lt;chr&gt;, and abbreviated variable names ¬π‚Äãyear_flight,
&gt; #   ¬≤‚Äãdep_time, ¬≥‚Äãsched_dep_time, ‚Å¥‚Äãdep_delay, ‚Åµ‚Äãarr_time, ‚Å∂‚Äãsched_arr_time,
&gt; #   ‚Å∑‚Äãarr_delay
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]
]

---

# Ejercicios


.panelset[
.panel[.panel-name[Ejercicios]


* üìù **Ejercicio 4**: al cruce obtenido del ejercicio anterior incluye la longitud y latitud de los aeropuertos en `airports`, distinguiendo entre la latitud/longitud del aeropuerto en destino y en origen.

* üìù **Ejercicio 5**: filtra de `airports` solo aquellos aeropuertos de los que salgan vuelos. Repite el proceso filtrado solo aquellos a los que lleguen vuelos

* üìù **Ejercicio 6**: ¬øde cu√°ntos vuelos no disponemos informaci√≥n del avi√≥n? Elimina antes los vuelos que no tengan identificar (diferente a NA) del avi√≥n

]

.panel[.panel-name[Sol. Ej. 4]

* üìù **Ejercicio 4**: al cruce obtenido del ejercicio anterior incluye la longitud y latitud de los aeropuertos en `airports`, distinguiendo entre la latitud/longitud del aeropuerto en destino y en origen.



```r
flights_airlines_planes %&gt;%
  left_join(airports %&gt;% select(faa, lat, lon),
            by = c("origin" = "faa")) %&gt;%
  rename(lat_origin = lat, lon_origin = lon) %&gt;% 
  left_join(airports %&gt;% select(faa, lat, lon),
            by = c("dest" = "faa")) %&gt;%
  rename(lat_dest = lat, lon_dest = lon)
```

```
&gt; # A tibble: 284,170 √ó 32
&gt;    year_fl‚Ä¶¬π month   day dep_t‚Ä¶¬≤ sched‚Ä¶¬≥ dep_d‚Ä¶‚Å¥ arr_t‚Ä¶‚Åµ sched‚Ä¶‚Å∂ arr_d‚Ä¶‚Å∑ carrier
&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
&gt;  1      2013     1     1     517     515       2     830     819      11 UA     
&gt;  2      2013     1     1     533     529       4     850     830      20 UA     
&gt;  3      2013     1     1     542     540       2     923     850      33 AA     
&gt;  4      2013     1     1     544     545      -1    1004    1022     -18 B6     
&gt;  5      2013     1     1     554     600      -6     812     837     -25 DL     
&gt;  6      2013     1     1     554     558      -4     740     728      12 UA     
&gt;  7      2013     1     1     555     600      -5     913     854      19 B6     
&gt;  8      2013     1     1     557     600      -3     709     723     -14 EV     
&gt;  9      2013     1     1     557     600      -3     838     846      -8 B6     
&gt; 10      2013     1     1     558     600      -2     849     851      -2 B6     
&gt; # ‚Ä¶ with 284,160 more rows, 22 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, year_build_aircraft &lt;int&gt;,
&gt; #   type &lt;chr&gt;, manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;,
&gt; #   speed &lt;int&gt;, engine &lt;chr&gt;, lat_origin &lt;dbl&gt;, lon_origin &lt;dbl&gt;,
&gt; #   lat_dest &lt;dbl&gt;, lon_dest &lt;dbl&gt;, and abbreviated variable names
&gt; #   ¬π‚Äãyear_flight, ¬≤‚Äãdep_time, ¬≥‚Äãsched_dep_time, ‚Å¥‚Äãdep_delay, ‚Åµ‚Äãarr_time, ‚Ä¶
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names
```

]

.panel[.panel-name[Sol. Ej. 5]


* üìù **Ejercicio 5**: filtra de `airports` solo aquellos aeropuertos de los que salgan vuelos. Repite el proceso filtrado solo aquellos a los que lleguen vuelos


```r
airports %&gt;% 
  semi_join(flights, by = c("faa" = "origin"))
airports %&gt;% 
  semi_join(flights, by = c("faa" = "dest"))
```

]

.panel[.panel-name[Sol. Ej. 6]



```r
flights %&gt;% 
  drop_na(tailnum) %&gt;% 
  anti_join(planes, by = "tailnum") %&gt;%
  count(tailnum, sort = TRUE) # de mayor a menor ya de paso
```

```
&gt; # A tibble: 721 √ó 2
&gt;    tailnum     n
&gt;    &lt;chr&gt;   &lt;int&gt;
&gt;  1 N725MQ    575
&gt;  2 N722MQ    513
&gt;  3 N723MQ    507
&gt;  4 N713MQ    483
&gt;  5 N735MQ    396
&gt;  6 N0EGMQ    371
&gt;  7 N534MQ    364
&gt;  8 N542MQ    363
&gt;  9 N531MQ    349
&gt; 10 N6EAMQ    348
&gt; # ‚Ä¶ with 711 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

]
]

---

name: extra-funciones

# Practicando .orange[FUNCIONES]

Vamos a profundizar un poco en la **.bg-purple_light[definici√≥n de funciones]** en R.


* üìù **Ejercicio 1**: sabiendo que la temperatura en grados es igual a la temperatura en Fahrenheit menos 32, y todo ello dividido entre 1.8, construye una funci√≥n que convierta de ¬∫F a ¬∫C.

--

* üìù **Ejercicio 2**: construye una funci√≥n a√∫n m√°s gen√©rica que incluya un argumento `celsius_to_fahr`, de forma que si vale `TRUE`, haga la conversi√≥n de ¬∫C a ¬∫F, y si vale `FALSE` de ¬∫F a ¬∫C

--

* üìù **Ejercicio 3**: sabiendo que para pasar de ¬∫C a Kelvin basta con sumar 273.15 a la temperatura en ¬∫C, construye una funci√≥n que parmita pasar de celsius a kelvin y viceversa, con un argumento `celsius_to_kelvin` que pueda ser `TRUE` o `FALSE`

--

* üìù **Ejercicio 4**: haciendo uso de las funciones anteriores, construye una funci√≥n de ¬∫F a Kelvin y viceversa, con un argumento `fahr_to_kelvin` que pueda ser `TRUE` o `FALSE`

--

* üìù **Ejercicio 5**: modifica las funciones anteriores para que, adem√°s de devolver el valor num√©rico, nos devuelva las unidades de salida.

---

class: inverse center middle
name: clase-13

# CLASE 13: entrega II

---

class: inverse center middle
name: clase-14

# CLASE 14: introducci√≥n al dataviz

&amp;nbsp;

### [Dataviz: introducci√≥n hist√≥rica.](#intro-historica)

### [Introducci√≥n a ggplot2](#intro-ggplot2)

---

name: intro-historica

# Dataviz: .orange[HISTORIA]


La aparici√≥n de gr√°ficos estad√≠sticos es **.bg-purple_light[relativamente reciente en la ciencia]** ya que hasta la Edad Media la √∫nica visualizaci√≥n de datos estaba en los **.bg-purple_light[mapas]** (representaci√≥n de nuestra realidad en superficies bidimensionales).

De hecho las propias palabras _chart_ y _cartography_ derivan del mismo origen latino, _charta_, aunque el primer uso datado de coordenadas parece venir de los egipcios. &lt;sup&gt;2,3&lt;/sup&gt;


.footnote[[1] [¬´Gram√°tica de las gr√°ficas: pistas para mejorar las representaciones de datos¬ª de Joaqu√≠n Sevilla](http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)

[2] [¬´Presentation Graphics¬ª de Leland Wilkinson. International Encyclopedia of the Social &amp; Behavioral Sciences](https://www.cs.uic.edu/~wilkinson/Publications/iesbs.pdf)

[3] [¬´Quantitative Graphics in Statistics: A Brief History¬ª de James R. Beniger y Dorothy L. Robyn. The American Statistician (1978)](https://www.jstor.org/stable/2683467)]

---


# .orange[NAVEGACI√ìN] y .green[ASTRONOM√çA]

.pull-left[

No es hasta la Edad Media, cuando la **.bg-purple_light[navegaci√≥n y la astronom√≠a]** empezaban a tomar relevancia cient√≠fica, cuando aparece la que se considera la primera gr√°fica (aunque no propiamente estad√≠stica) &lt;sup&gt;3&lt;/sup&gt;, representando el **movimiento c√≠clico de los planetas** (entre los siglos X y XI)

]

.pull-right[


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/dataviz_historico_1.png" alt="Gr√°fica extra√≠da de Beniger y Robyn (1978)" width="110%" /&gt;
&lt;p class="caption"&gt;Gr√°fica extra√≠da de Beniger y Robyn (1978)&lt;/p&gt;
&lt;/div&gt;

]

[3] [¬´Quantitative Graphics in Statistics: A Brief History¬ª de James R. Beniger y Dorothy L. Robyn. The American Statistician (1978)](https://www.jstor.org/stable/2683467)

 
---

# .orange[NAVEGACI√ìN] y .green[ASTRONOM√çA]

.pull-left[

Con una motivaci√≥n similar, en torno a 1360 el matem√°tico **Nicole Oresme** dise√±√≥ el **.bg-purple_light[primer gr√°fico de barras]** (pero no estad√≠stico), con la idea de visualizar a la vez dos **magnitudes f√≠sicas te√≥ricas**.

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/dataviz_historico_2.jpeg" alt="Gr√°fica extra√≠da de Friendly y Valero-Mora (2010)" width="55%" /&gt;
&lt;p class="caption"&gt;Gr√°fica extra√≠da de Friendly y Valero-Mora (2010)&lt;/p&gt;
&lt;/div&gt;

]

[5] [¬´The First (Known) Statistical Graph: Michael Florent van Langren and the 'Secret' of Longitude¬ª de M. Friendly y P. M. Valero-Mora. The American Statistician (2010)](https://www.researchgate.net/publication/227369016_The_First_Known_Statistical_Graph_Michael_Florent_van_Langren_and_the_Secret_of_Longitude)

 
---

# .orange[PRIMER] gr√°fico estad√≠stico

La mayor√≠a de expertos, como Tufte &lt;sup&gt;6,7&lt;/sup&gt;, consideran este gr√°fico casi longitudinal como la **.bg-purple_light[primera visualizaci√≥n de datos]** de la historia, hecha por **Van Langren** en 1644, representando la **.bg-purple_light[distancia entre Toledo y Roma]** (un poco mal medida ya que la distancia real es de 16.5¬∫).

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/longitud_dataviz.jpg" alt="Extra√≠da de Friendly y Valero-Mora (2010)" width="100%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de Friendly y Valero-Mora (2010)&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/dataviz_historico_3.jpeg" alt="Extra√≠da de Friendly y Valero-Mora (2010)" width="100%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de Friendly y Valero-Mora (2010)&lt;/p&gt;
&lt;/div&gt;

]

[6] [¬´Visual explanations: images and quantities, evidence and narrative¬ª de E. Tufte](https://archive.org/details/visualexplanatio00tuft)

[7] [¬´PowerPoint is evil¬ª de E. Tufte](https://www.wired.com/2003/09/ppt2/)

---

# ¬øQu√© es una .orange[GR√ÅFICA] estad√≠stica?

¬øPor qu√© ese gr√°fico se considera la primera visualizaci√≥n estad√≠stica de la historia? ¬øQu√© es lo que hace que una visualizaci√≥n sea una gr√°fica estad√≠stica y no las anteriores? ¬øCu√°l es la **.bg-purple_light[frontera entre una ilustraci√≥n y una gr√°fica]** (de datos)?


.pull-left[

¬øEs una gr√°fica estad√≠stica? ¬øPor qu√© s√≠ o por qu√© no?

]

.pull-right[


&lt;img src="./img/cuadro_dataviz.jpg" width="45%" style="display: block; margin: auto;" /&gt;

]

--

No hay  **.bg-purple_light[ninguna INFORMACI√ìN]** representada


---

# ¬øQu√© es una .orange[GR√ÅFICA] estad√≠stica?

¬øPor qu√© ese gr√°fico se considera la primera visualizaci√≥n estad√≠stica de la historia? ¬øQu√© es lo que hace que una visualizaci√≥n sea una gr√°fica estad√≠stica y no las anteriores? ¬øCu√°l es la **.bg-purple_light[frontera entre una ilustraci√≥n y una gr√°fica]** (de datos)?

.pull-left[

¬øEs una gr√°fica estad√≠stica? ¬øPor qu√© s√≠ o por qu√© no?

]

.pull-right[


&lt;img src="./img/horoscopo_dataviz.jpg" width="65%" style="display: block; margin: auto;" /&gt;

]

--

No hay **.bg-purple_light[ning√∫n PROCESO DE MEDIDA]** representado, no cuantifica nada (real).


---

# ¬øQu√© es una .orange[GR√ÅFICA] estad√≠stica?

¬øPor qu√© ese gr√°fico se considera la primera visualizaci√≥n estad√≠stica de la historia? ¬øQu√© es lo que hace que una visualizaci√≥n sea una gr√°fica estad√≠stica y no las anteriores? ¬øCu√°l es la **.bg-purple_light[frontera entre una ilustraci√≥n y una gr√°fica]** (de datos)?


.pull-left[

¬øEs una gr√°fica estad√≠stica? ¬øPor qu√© s√≠ o por qu√© no?

]

.pull-right[


&lt;img src="./img/celsius_dataviz.jpg" width="110%" style="display: block; margin: auto;" /&gt;

]

--

No hay **.bg-purple_light[ning√∫n DATO]** representado en √©l, es una magnitud f√≠sica te√≥rica, no un dato (medido emp√≠ricamente o simulado).


---

# ¬øQu√© es una .orange[GR√ÅFICA] estad√≠stica?

¬øPor qu√© ese gr√°fico se considera la primera visualizaci√≥n estad√≠stica de la historia? ¬øQu√© es lo que hace que una visualizaci√≥n sea una gr√°fica estad√≠stica y no las anteriores? ¬øCu√°l es la **.bg-purple_light[frontera entre una ilustraci√≥n y una gr√°fica]** (de datos)?


.pull-left[

¬øEs una gr√°fica estad√≠stica? ¬øPor qu√© s√≠ o por qu√© no?

]

.pull-right[


&lt;img src="./img/mapa_infografia_dataviz.jpg" width="60%" style="display: block; margin: auto;" /&gt;

]

--

El proceso de representaci√≥n **.bg-purple_light[no es REVERSIBLE]** ni comparable (al menos no f√°cilmente): es una infograf√≠a, no un gr√°fico estad√≠stico.



---

# ¬øQu√© es una .orange[GR√ÅFICA] estad√≠stica?

Esas mismas preguntas se hizo **Joaqu√≠n Sevilla** &lt;sup&gt;1&lt;/sup&gt;, proporcionando **.bg-purple_light[3 requisitos]**:

.pull-left[

1. Que se base en el esquema de composici√≥n de **.bg-purple_light[eje m√©trico]** (proceso de medida): debe **.bg-orange[medir algo]**.

2. Debe incluir **.bg-purple_light[informaci√≥n (datos)]**

3. La **.bg-purple_light[relaci√≥n de representatividad]** debe ser **.bg-purple_light[reversible]**: los datos deber√≠an poder ¬´recuperarse¬ª a partir de la gr√°fica (es un tipo particular de **.bg-orange[¬´aplicaci√≥n¬ª matem√°tica]**).

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/grafica_dinero_sevilla.jpg" alt="Ejemplo de met√°fora visual bien ejecutada (extra√≠da del manual de J. Sevilla)" width="70%" /&gt;
&lt;p class="caption"&gt;Ejemplo de met√°fora visual bien ejecutada (extra√≠da del manual de J. Sevilla)&lt;/p&gt;
&lt;/div&gt;

]

[1] [¬´Gram√°tica de las gr√°ficas: pistas para mejorar las representaciones de datos¬ª de Joaqu√≠n Sevilla](http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)


---

# Abolici√≥n de .orange[DIAGRAMAS DE TARTAS]

Hay muchas formas de hacer una gr√°fica estad√≠stica, y no suele pasar por hacer un **.bg-purple_light[gr√°fico de tartas o sectores]** ya que tienen un grave **.bg-purple_light[problema de reversibilidad]**:

.pull-left[

* Si hay **muchas variables**: salvo que conozcas el montante total y tengas un transportador de √°ngulos a mano, es **.bg-purple_light[imposible que tus ojos midan √°ngulos]**

* Si hay **pocas variables**: ¬øaporta algo distinto (y/o mejor) que una tabla?

]

.pull-right[

&lt;img src="./img/sectores_muchas_categoriÃÅas.png" width="99%" style="display: block; margin: auto;" /&gt;

]

---

# Abolici√≥n de .orange[DIAGRAMAS DE TARTAS]


El principal problema de un diagrama de sectores es que la posible informaci√≥n est√° **.bg-purple_light[contenida en los √°ngulos]**, pero nuestra interpretaci√≥n la realizamos a trav√©s de la **.bg-purple_light[comparaci√≥n de √°reas]** (nuestros ojos no miden bien √°ngulos), las cuales dependen no solo del √°ngulo sino del radio.

.pull-left[


Algo similar sucede con los mal llamados **.bg-purple_light[gr√°ficos tridimensionales]** (son bidimensionales con perspectiva en realidad): los valores m√°s cercanos aparecen sobredimensionados, siendo pr√°cticamente imposible la reversibilidad por la **.bg-purple_light[distorsi√≥n]**.

]

.pull-right[

&lt;img src="./img/sectores_3D.jpg" width="99%" style="display: block; margin: auto;" /&gt;

]

---

# .orange[VIZFAILS]: ejempos mal


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/persona_dataviz.jpg" alt="Ejemplo de met√°fora visual mal ejecutada" width="99%" /&gt;
&lt;p class="caption"&gt;Ejemplo de met√°fora visual mal ejecutada&lt;/p&gt;
&lt;/div&gt;

---

# .orange[VIZFAILS]: ejempos mal

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/persona_dataviz.jpg" alt="Ejemplo de met√°fora visual mal ejecutada" width="99%" /&gt;
&lt;p class="caption"&gt;Ejemplo de met√°fora visual mal ejecutada&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

* La figura elegida (persona caminando) sin relaci√≥n con lo visualizado: **.bg-purple_light[mala met√°fora visual]**.

* Los **.bg-purple_light[sectores se√±alados sin relaci√≥n con el √≠tem]** a representar, lo que dificulta su interpretaci√≥n.

* Los **.bg-purple_light[colores sin codificar]**: no dan informaci√≥n de ning√∫n tipo.

* Las **.bg-purple_light[formas irregulares impiden la comparaci√≥n]** de las √°reas (am√©n de que la suma total supera el 100%).

* **.bg-purple_light[Sin fuente]** de la procedencia de los datos.

]


---

# .orange[VIZFAILS]: ejempos mal


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/viz_fail_covid.jpg" alt="Ejemplo de una buena idea mal ejecutada (de un vicerrector de tecnolog√≠a...)" width="100%" /&gt;
&lt;p class="caption"&gt;Ejemplo de una buena idea mal ejecutada (de un vicerrector de tecnolog√≠a...)&lt;/p&gt;
&lt;/div&gt;

---

# .orange[VIZFAILS]: ejempos mal

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/viz_fail_covid.jpg" alt="Ejemplo de una buena idea mal ejecutada (de un vicerrector de tecnolog√≠a...)" width="100%" /&gt;
&lt;p class="caption"&gt;Ejemplo de una buena idea mal ejecutada (de un vicerrector de tecnolog√≠a...)&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

* **.bg-purple_light[Uso de dos ejes]** (a izquierda para mortalidad, a derecha para letalidad) **.bg-purple_light[sin indicarlo]** adecuadamente. Cuidado con los dos ejes: puede ser confuso.

* **.bg-purple_light[Leyenda mal referenciada]** y muy peque√±a.

* **.bg-purple_light[Tama√±o de la l√≠nea desproporcionado]** que impide la reversibilidad y la comparaci√≥n.

* **.bg-purple_light[Compara celdas geogr√°ficas incomparables]** por tama√±o y contexto: ¬øGalicia vs Alemania?

]



---

# .orange[VIZFAILS]: ejempos mal


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/viz_fail_uk.jpg" alt="Ejemplo de una mala codificaci√≥n" width="100%" /&gt;
&lt;p class="caption"&gt;Ejemplo de una mala codificaci√≥n&lt;/p&gt;
&lt;/div&gt;


---

# .orange[VIZFAILS]: ejempos mal

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/viz_fail_uk.jpg" alt="Ejemplo de una mala codificaci√≥n" width="60%" /&gt;
&lt;p class="caption"&gt;Ejemplo de una mala codificaci√≥n&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

* **.bg-purple_light[Desagregaci√≥n incorrecta]**: distritos geogr√°ficos muy grandes que se podr√≠an representar en una tabla de 9 filas.

* **.bg-purple_light[Leyenda desproporcionada]** que atrae la atenci√≥n m√°s que el propio gr√°fico.

* Ejemplo de los **.bg-purple_light[colores no son algo meramente est√©tico]**: hay que codificarlos adecuadamente. El gradiente de una paleta de colores puede convertir una buena idea en una p√©sima visualizaci√≥n.

]

---

# .orange[VIZFAILS]: ejempos mal


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/espiral_nyt.jpg" alt="Fuente: https://www.nytimes.com/2022/01/06/opinion/omicron-covid-us.html" width="30%" /&gt;
&lt;p class="caption"&gt;Fuente: https://www.nytimes.com/2022/01/06/opinion/omicron-covid-us.html&lt;/p&gt;
&lt;/div&gt;

---

# .orange[VIZFAILS]: ejempos mal


.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/espiral_nyt.jpg" alt="Fuente: https://www.nytimes.com/2022/01/06/opinion/omicron-covid-us.html" width="70%" /&gt;
&lt;p class="caption"&gt;Fuente: https://www.nytimes.com/2022/01/06/opinion/omicron-covid-us.html&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

* Se dijo que era novedosa: no es novedad (la **.bg-purple_light[novedad tampoco deber√≠a algo bueno]** per se)

* **.bg-purple_light[No respeta la reversibilidad]**: es una ilustraci√≥n, no una gr√°fica estad√≠stica. La forma de llevarlo a cabo infraestima los datos actuales y, por su **.bg-purple_light[distorsi√≥n de la realidad]**,  **.bg-purple_light[impide medir la estacionalidad]** que se propone visualizar con coordenadas polares

* El **.bg-purple_light[eje que recorre la espiral no aporta]**, distrae de los datos a representar, aumenta la distorsi√≥n por la no linealidad de la espiral y duplica informaci√≥n.


]


---

# .orange[VIZFAILS]: ejempos mal


El **.bg-purple_light[uso de colores]** no es solo algo est√©tico: es una variable m√°s: la inclusi√≥n de una **.bg-purple_light[gradiente de colores]** permite centrarnos en los oscuros, y comparar entre tonalidades, as√≠ como la **.bg-purple_light[escala de la geometr√≠a]** elegida.


&lt;img src="./img/espiral_covid_bien.jpg_large" width="75%" style="display: block; margin: auto;" /&gt;


---

# .orange[VIZFAILS]: ejempos mal


El **.bg-purple_light[uso de colores]** no es solo algo est√©tico: es una variable m√°s: la inclusi√≥n de una **.bg-purple_light[gradiente de colores]** permite centrarnos en los oscuros, y comparar entre tonalidades, as√≠ como la **.bg-purple_light[escala de la geometr√≠a]** elegida.


.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/espirales_colores.png" alt="Fuente: @dataisbeautiful (Reddit)" width="95%" /&gt;
&lt;p class="caption"&gt;Fuente: @dataisbeautiful (Reddit)&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/espirales_covid_2.jpg" alt="Fuente: https://twitter.com/victimofmaths/status/1480550926066847749" width="80%" /&gt;
&lt;p class="caption"&gt;Fuente: https://twitter.com/victimofmaths/status/1480550926066847749&lt;/p&gt;
&lt;/div&gt;

]

---

# La importancia del .orange[CONTEXTO]

Una **buena idea** puede estar mal ejecutada: la forma de llevarla a cabo es importante

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/semaforos.jpg" alt="Ejemplo de buena idea mal ejecutada" width="30%" /&gt;
&lt;p class="caption"&gt;Ejemplo de buena idea mal ejecutada&lt;/p&gt;
&lt;/div&gt;

---

# Dataviz: .orange[HISTORIA]

En el siglo XVII hubo un boom de la estad√≠stica al empezar a aplicarse en **.bg-purple_light[demograf√≠a]**. Uno de los autores m√°s importantes fue **.bg-purple_light[J. Graunt]**, autor de ¬´Natural and Political Observations Made upon the Bills of Mortality¬ª (1662), estimando la poblaci√≥n de Londres con las **.bg-purple_light[primeras tablas de natalidad y mortalidad]**.

.pull-left[

Son precisamente las tablas de Graunt las que us√≥ **.bg-purple_light[Christiaan Huygens]** para generar la **.bg-purple_light[primera gr√°fica de densidad]** de una distribuci√≥n continua (esperanza de vida vs edad).

]

.pull-right[


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/primera_densidad.jpg" alt="Primera funci√≥n de densidad, extra√≠da de https://omeka.lehigh.edu/exhibits/show/data_visualization/vital_statistics/huygen" width="100%" /&gt;
&lt;p class="caption"&gt;Primera funci√≥n de densidad, extra√≠da de https://omeka.lehigh.edu/exhibits/show/data_visualization/vital_statistics/huygen&lt;/p&gt;
&lt;/div&gt;

]

---

# Los gr√°ficos de .orange[Playfair]

La figura que cambi√≥ el dataviz fue, sin lugar a dudas, el economista y pol√≠tico **.bg-purple_light[William Playfair (1759-1823)]**, publicando en 1786 el **¬´Atlas pol√≠tico y comercial¬ª** con 44 gr√°ficas (43 series temporales y el diagrama de barras m√°s famoso de la historia).

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_1.jpg" alt="Extra√≠das de Funkhouser y Walker (1935)" width="70%" /&gt;
&lt;p class="caption"&gt;Extra√≠das de Funkhouser y Walker (1935)&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_2.jpg" alt="Extra√≠das de Funkhouser y Walker (1935)" width="25%" /&gt;
&lt;p class="caption"&gt;Extra√≠das de Funkhouser y Walker (1935)&lt;/p&gt;
&lt;/div&gt;

]

[10] [¬´Atlas pol√≠tico y comercial¬ª de William Playfair (1786)](https://www.amazon.es/Playfairs-Commercial-Political-Statistical-Breviary/dp/0521855543)

[11] [¬´Playfair and his charts¬ª de H. Gray Funkhouser and  Helen M. Walker (1935)](https://www.jstor.org/stable/45366440)

---


# Los gr√°ficos de .orange[Playfair]

Playfair no solo fue el primero en usar el dataviz para entender (y no solo describir): fue el primero en usar **.bg-purple_light[conceptos modernos]** como _grid_, tema o color

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_3.jpg" alt="Extra√≠da de https://friendly.github.io/HistDataVis" width="90%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de https://friendly.github.io/HistDataVis&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_4.png" alt="Extra√≠da de la wikipedia." width="90%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de la wikipedia.&lt;/p&gt;
&lt;/div&gt;

]

---

# Los gr√°ficos de .orange[Playfair]

Playfair es adem√°s el autor del **.bg-purple_light[gr√°fico de barras m√°s famoso]** (no fue el primero pero s√≠ quien lo hizo _mainstream_).

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_5.jpg" alt="Gr√°ficas de Playfair de importaciones (barras grises) y exportaciones (negras) de Escocia en 1781, extra√≠das de la wikipedia." width="90%" /&gt;
&lt;p class="caption"&gt;Gr√°ficas de Playfair de importaciones (barras grises) y exportaciones (negras) de Escocia en 1781, extra√≠das de la wikipedia.&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_6.jpg" alt="Primer diagrama de barras (P. Buache y G. de L‚ÄôIsle), visualizando los niveles del Sena (1732 - 1766), extra√≠da de https://friendly.github.io/HistDataVis" width="90%" /&gt;
&lt;p class="caption"&gt;Primer diagrama de barras (P. Buache y G. de L‚ÄôIsle), visualizando los niveles del Sena (1732 - 1766), extra√≠da de https://friendly.github.io/HistDataVis&lt;/p&gt;
&lt;/div&gt;

]

---

# Los gr√°ficos de .orange[Playfair]


Playfair adem√°s fue el primero en **.bg-purple_light[combinar gr√°ficos en la misma visualizaci√≥n]**

.pull-left[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_7.jpg" alt="Visualiza 3 series temporales: precios (barras) del trigo, salarios (l√≠nea) y time-line con reinados, extra√≠da de https://friendly.github.io/HistDataVis." width="85%" /&gt;
&lt;p class="caption"&gt;Visualiza 3 series temporales: precios (barras) del trigo, salarios (l√≠nea) y time-line con reinados, extra√≠da de https://friendly.github.io/HistDataVis.&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/playfair_8.png" alt="Time-line hist√≥rico, extra√≠da de https://friendly.github.io/HistDataVis." width="85%" /&gt;
&lt;p class="caption"&gt;Time-line hist√≥rico, extra√≠da de https://friendly.github.io/HistDataVis.&lt;/p&gt;
&lt;/div&gt;

]

[12] [¬´A Letter on Our Agricultural Distresses, Their Causes and Remedies¬ª de W. Playfair (1821)](http://onlinebooks.library.upenn.edu/webbin/book/lookupid?key=ha009726110)

[13] [¬´An Inquiry Into the Permanent Causes of the Decline and Fall of Powerful and Wealthy Nations¬ª de William Playfair (1821)](https://www.amazon.com/Permanent-Powerful-Nations-Prosperity-Prolonged/dp/140691830X)

---

# Mapas de .orange[Minard]

Otro pionero en **.bg-purple_light[combinar visualizaciones]** fue Minard, autor del famoso ¬´Carte figurative des pertes successives en hommes de l'Arm√©e Fran√ßaise dans la campagne de Russie 1812-1813¬ª, seg√∫n Tufte **.bg-purple_light[¬´el mejor gr√°fico estad√≠stico jam√°s dibujado¬ª]**, publicado en 1869 sobre la desastrosa campa√±a rusa de Napole√≥n en 1812 (3 variables en un gr√°fico bidimensional)

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/minard_2.png" alt="Extra√≠da de https://friendly.github.io/HistDataVis." width="60%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de https://friendly.github.io/HistDataVis.&lt;/p&gt;
&lt;/div&gt;

---

# Primer .orange[SCATTER PLOT]

Seg√∫n Sevilla &lt;sup&gt;1&lt;/sup&gt;, se considera al astr√≥nomo brit√°nico **John Frederick William Herschel** el autor del **.bg-purple_light[primer diagrama de dispersi√≥n o scatterplot]** en 1833, visualizando el movimiento de la estrella doble Virginis (tiempo en el eje horizontal, posici√≥n angular en el eje vertical)


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/herschel.jpg" alt="Extra√≠do de https://friendly.github.io/HistDataVis." width="35%" /&gt;
&lt;p class="caption"&gt;Extra√≠do de https://friendly.github.io/HistDataVis.&lt;/p&gt;
&lt;/div&gt;

---

# Primera .orange[PIR√ÅMIDE POBLACIONAL]

La **.bg-purple_light[primera pir√°mide de poblaci√≥n]** (doble histograma de poblaci√≥n), fue publicada por **Francis Amasa Walker**, superintendente del censo de EE.UU., en 1874.

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/walker_piramide.jpg" alt="Extra√≠da de https://www.depauw.edu/learn/dew/wpaper/workingpapers/DePauw2016-02-Barreto-DemographyEconomics.pdf" width="45%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de https://www.depauw.edu/learn/dew/wpaper/workingpapers/DePauw2016-02-Barreto-DemographyEconomics.pdf&lt;/p&gt;
&lt;/div&gt;

---

# .orange[FLORENCE NIGTHINGALE]: una revoluci√≥n

.pull-left[


* El 21 de octubre de 1854 **.bg-purple_light[Florence Nigthingale]** fue enviada para mejorar las **condiciones sanitarias** de los soldados brit√°nicos en la guerra de Crimea. 

* A su regreso se dedic√≥ a demostrar que los **.bg-purple_light[soldados fallec√≠an por las condiciones sanitarias]**: eran **muertes evitables**. Nigthingale es la creadora del famoso y pionero **.bg-purple_light[diagrama de rosa]**, permitiendo pintar tres variables a la vez y su estacionalidad.

* El 8 de febrero de 1955, The Times la describi√≥ como la **¬´√°ngel guardi√°n¬ª de los hospitales**, y al finalizar la contienda, fue recibida como una hero√≠na, conocida como **.bg-purple_light[¬´The Lady with the Lamp¬ª]** tras un poema de H. W. Longfellow publicado en 1857.

* A√±os despu√©s se convirti√≥ en la **.bg-purple_light[primera mujer en la Royal Statistical Society]** y renunci√≥ a su puesto para crear las primeras escuelas de enfermer√≠a.

]

.pull-right[

&lt;img src="./img/the_lady_with_the_lamp.png" width="90%" style="display: block; margin: auto;" /&gt;

]

---

# .orange[DIAGRAMA DE ROSA]

Florence Nigthingale es la creadora del famoso **.bg-purple_light[diagrama de rosa]**, permitiendo pintar **.bg-purple_light[tres variables a la vez y su estacionalidad]**: **tiempo** (cada **gajo** es un mes), **n¬∫ de muertes** (**√°rea** del gajo) y **causa** de la muerte (**color** del gajo: azules enfermedades infecciosas, rojas por heridas, negras otras causas).


&lt;img src="./img/rosa_nightingale.jpg" width="75%" style="display: block; margin: auto;" /&gt;

---


# .orange[RECURSOS] de dataviz


üìö [¬´The Functional Art: an introduction to information graphics and visualization¬ª de Alberto Cairo](https://www.amazon.es/Functional-Art-Voices-That-Matter/dp/0321834739)


üìö [¬´Gram√°tica de las gr√°ficas: pistas para mejorar las representaciones de datos¬ª de Joaqu√≠n Sevilla](https://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf)


üìö [¬´A Brief History of Visualization¬ª de Friendly et al. (2008)](https://www.researchgate.net/publication/226400313_A_Brief_History_of_Data_Visualization)

üìö [¬´Quantitative Graphics in Statistics: A Brief History¬ª de James R. Beniger y Dorothy L. Robyn. The American Statistician (1978)](https://www.jstor.org/stable/2683467)]

üìö [¬´Presentation Graphics¬ª de Leland Wilkinson. International Encyclopedia of the Social &amp; Behavioral Sciences](https://www.cs.uic.edu/~wilkinson/Publications/iesbs.pdf)

üìö [¬´The Grammar of Graphics¬ª de Leland Wilkinson](https://www.amazon.es/Grammar-Graphics-Statistics-Computing/dp/0387245448)


üìö [¬´The Minard System: The Graphical Works of Charles-Joseph Minard¬ª de Sandra Rendgen](https://www.amazon.es/gp/product/1616896337/ref=sw_img_1?smid=A1AT7YVPFBWXBL&amp;psc=1)

üìö [¬´The Visual Display of Quantitative Information¬ª de E. W. Tufte](https://www.amazon.es/Visual-Display-Quantitative-Information/dp/0961392142)

---

name: intro-ggplot2

# Dataviz en R: .orange[ggplot2]

.pull-left[

El paquete `{ggplot2}` se basa en la idea propuesta por Wilkinson en **.bg-purple_light[¬´Grammar of graphics¬ª]**: dotar a los gr√°ficos de una gram√°tica propia. Una de las principales fortalezas de `R` no solo es la flexibilidad y rapidez de `{tidyverse}`, tambi√©n la **.bg-purple_light[visualizaci√≥n]** con el paquete `{ggplot2}`.


```r
library(ggplot2)
```


La **.bg-purple_light[visualizaci√≥n de datos]** deber√≠a ser una parte fundamental de todo an√°lisis de datos. No es solo una cuesti√≥n est√©tica, es fundamental para **.bg-purple_light[convertir el dato en informaci√≥n]**.

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/telling_dataviz.jpg" alt="Imagen extra√≠da de Reddit" width="71%" /&gt;
&lt;p class="caption"&gt;Imagen extra√≠da de Reddit&lt;/p&gt;
&lt;/div&gt;

]


---

# Dataviz en R: .orange[ggplot2]


.pull-left[

La filosof√≠a detr√°s de `{ggplot2}` es entender los **.bg-purple_light[gr√°ficos como parte del flujo]** de trabajo, dot√°ndoles de una **.bg-purple_light[gram√°tica]**, bas√°ndose en la idea de Wilkinson.

El objetivo es empezar con un lienzo en blanco e ir **.bg-purple_light[a√±adiendo capas a tu gr√°fico]**. La ventaja de `{ggplot2}` es poder **.bg-purple_light[mapear atributos est√©ticos]** (color, forma, tama√±o) de objetos geom√©tricos (puntos, barras, l√≠neas) en funci√≥n de los datos.

&amp;nbsp;


La **documentaci√≥n** del paquete puedes consultarla en &lt;https://ggplot2-book.org/introduction.html&gt; 

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/grammar_ggplot2.jpg" alt="Idea detr√°s de la ¬´Grammar of graphics¬ª de Wilkinson" width="100%" /&gt;
&lt;p class="caption"&gt;Idea detr√°s de la ¬´Grammar of graphics¬ª de Wilkinson&lt;/p&gt;
&lt;/div&gt;

]

---

# Dataviz en R: .orange[ggplot2]

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/tarta_ggplot2.png" alt="Extra√≠da de https://twitter.com/tanya_shapiro" width="75%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de https://twitter.com/tanya_shapiro&lt;/p&gt;
&lt;/div&gt;

---

# Dataviz en R: .orange[ggplot2]

.pull-left[


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/tarta_recortada_ggplot2.jpg" alt="Extra√≠da de https://twitter.com/tanya_shapiro" width="80%" /&gt;
&lt;p class="caption"&gt;Extra√≠da de https://twitter.com/tanya_shapiro&lt;/p&gt;
&lt;/div&gt;

]

.pull-right[

Un gr√°fico se podr√° componer de las siguientes **.bg-purple_light[capas]**

* **.bg-purple_light[Datos (data)]**
* **.bg-purple_light[Mapeado (aesthetics)]** de elementos est√©ticos: ejes, color, forma, tama√±o, etc (en funci√≥n de los datos)
* **.bg-purple_light[Geometr√≠a (geom)]**: puntos, l√≠neas, barras, pol√≠gonos, etc.
* **.bg-purple_light[Componer gr√°ficas (facet)]**: visualizar varias gr√°ficas a la vez.
* **.bg-purple_light[Transformaciones (stat)]**: ordenar, resumir, agrupar, etc.
* **.bg-purple_light[Coordenadas (coord)]**: coordenadas cartesianas, polares, grids, etc.
* **.bg-purple_light[Temas (theme)]**: fuente, tama√±o de letra, subt√≠tulos, captions, leyenda, ejes, etc.

]


---

# Primer intento: .orange[SCATTER PLOT]

Veamos un **primer intento** para entender la filosof√≠a ggplot. Imagina que queremos dibujar un **.bg-purple_light[scatter plot]** (diagrama de dispersi√≥n de puntos). Para ello vamos a usar el conjunto de datos `gapminder`, del paquete hom√≥nimo: un fichero con **datos de esperanzas de vida, poblaciones y renta per c√°pita** de distintos pa√≠ses en distintos momentos temporales.


```r
library(gapminder)
gapminder
```

```
&gt; # A tibble: 1,704 √ó 6
&gt;    country     continent  year lifeExp      pop gdpPercap
&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.
&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.
&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.
&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.
&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.
&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.
&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.
&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.
&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.
&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.
&gt; # ‚Ä¶ with 1,694 more rows
&gt; # ‚Ñπ Use `print(n = ...)` to see more rows
```

---

# Primer intento: .orange[SCATTER PLOT]

El fichero consta de 1704 registros y 6 variables: `country`, `continent`, `year`, `lifeExp` (esperanza de vida), `pop` (poblaci√≥n)  y `gdpPercap` (renta per c√°pita).


```r
glimpse(gapminder)
```

```
&gt; Rows: 1,704
&gt; Columns: 6
&gt; $ country   &lt;fct&gt; "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", ‚Ä¶
&gt; $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, ‚Ä¶
&gt; $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ‚Ä¶
&gt; $ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8‚Ä¶
&gt; $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12‚Ä¶
&gt; $ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, ‚Ä¶
```

Para empezar con algo sencillo **.bg-purple_light[filtraremos solo los datos de 1997]**

--


```r
gapminder_1997 &lt;- gapminder %&gt;% filter(year == 1997)
```

---

# .orange[INGREDIENTES]: .green[(x, y)]


¬øQu√© **.bg-purple_light[elementos necesitamos]** para realizar un diagrama de puntos? Para iniciar el lienzo necesitamos una base de datos y dos variables a representar.

--

.pull-left[

* **.bg-purple_light[Datos (data)]**: conjunto `gapminder_1997`.

* **.bg-purple_light[Mapeado (aes)]**: indicarle dentro de `aes()` (aesthetics) las variables en cada coordenada. Todo lo que est√© **.bg-purple_light[dentro de aes() ser√°n mapeados de los datos]**


```r
ggplot(data = gapminder_1997,
*      aes(x = gdpPercap, y = pop))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-722-1.png" width="80%" /&gt;
]

---


# .orange[PRIMERA GEOMETR√çA]: .green[geom_point()]


.pull-left[

* **.bg-purple_light[Geometr√≠a (geom)]**: optaremos por **.bg-orange[puntos]** usando `geom_point()`.


```r
ggplot(gapminder_1997,
       aes(x = gdpPercap, y = pop)) +
* geom_point()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-724-1.png" width="93%" /&gt;

]

---

# .orange[ROL DE LOS EJES]: .green[(x, y)]



.pull-left[

Vamos a profundizar en ese mapeado: ¬øc√≥mo **.bg-purple_light[cambiar el rol]** de los ejes (poblaci√≥n en el eje X y renta per c√°pita en el eje Y)? 

* **Eje X**: poblaci√≥n (variable `pop`)
* **Eje Y**: renta per c√°pita (variable `gdpPercap`)



```r
ggplot(gapminder_1997,
*      aes(y = gdpPercap, x = pop)) +
  geom_point() 
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-726-1.png" width="93%" /&gt;

]

---

# .orange[ROL DE LOS EJES]: .green[(x, y)]



.pull-left[

¬øY un scatter plot con **esperanza de vida** en eje X frente a **renta per c√°pita**?


* **Eje X**: esperanza de vida (variable `lifeExp`)
* **Eje Y**: renta per c√°pita (variable `gdpPercap`)



```r
ggplot(gapminder_1997,
*      aes(y = gdpPercap, x = lifeExp)) +
  geom_point()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-728-1.png" width="91%" /&gt;
]

---


# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

Dentro de `geom_point()` tenemos varios argumentos a usar:


* `na.rm = ...`: si queremos que nos quite ausentes.

* `color = ...`: color (si tiene dimensi√≥n, color del contorno)

* `fill = ...`: color el relleno.

Empezaremos por un **color fijo**, por ejemplo `"red"` (existen otros como `"blue"`, `"black"`, `"yellow"`, etc)


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
* geom_point(color = "red")
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-730-1.png" width="91%" /&gt;

]

---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos



.pull-left[

* `size = ...`: tama√±o  de la geometr√≠a (en este caso el **tama√±o de los punto**), cuanto mayor sea el n√∫mero, mayor ser√° el tama√±o de la geometr√≠a.

  

```r
# Color con palabra reservada
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(color = "red",
*            size = 7)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-732-1.png" width="91%" /&gt;

]

---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

* `alpha = ...`: grado de opacidad del color (1 totalmente opaco, 0 totalmente transparente)


```r
# Color con palabra reservada
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(color = "red", size = 7,
*            alpha = 0.4)
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-734-1.png" width="91%" /&gt;

]

---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

* `shape = ...`: forma de la geometr√≠a, en este caso del ¬´punto¬ª (ver todas las opciones en `vignette("ggplot2-specs")`)


&lt;img src="./img/shape_ggplot.jpg" width="32%" style="display: block; margin: auto;" /&gt;



```r
# Color con palabra reservada
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(color = "red", size = 7,
*            alpha = 0.4, shape = 5)
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-737-1.png" width="91%" /&gt;

]

---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

* `shape = ...`: forma de la geometr√≠a, en este caso del ¬´punto¬ª (ver todas las opciones en `vignette("ggplot2-specs")`)


&lt;img src="./img/shape_ggplot.jpg" width="32%" style="display: block; margin: auto;" /&gt;



```r
# Color con palabra reservada
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(color = "red", size = 7, alpha = 0.4,
*            shape = 22, fill = "black")
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-740-1.png" width="91%" /&gt;

]


---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

* `stroke = ...`: tama√±o del contorno


```r
# Color con palabra reservada
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(color = "red", size = 7,
*            alpha = 0.4, stroke = 0)
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-742-1.png" width="91%" /&gt;

]


---

# .orange[COLOR], .green[SIZE], .purple[SHAPE]: fijos


.pull-left[

Los colores tambi√©n podemos asign√°rselos por su **c√≥digo hexadecimal**, consultando en la p√°gina &lt;https://htmlcolorcodes.com/es/&gt;, eligiendo el color que queramos. El c√≥digo hexadecimal siempre comenzar√° con `#`



```r
# Color en hexadecimal
# https://htmlcolorcodes.com/es/
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
* geom_point(color = "#A02B85",
             alpha = 0.4, size = 7) 
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-744-1.png" width="91%" /&gt;

]

  
---

# Mapeado de atributos est√©ticos: .orange[aes()]

.pull-left[

Hasta ahora los **atributos est√©ticos** se los hemos pasado fijos y **constantes**.  Pero la verdadera potencia y versatilidad de `ggplot` es que podemos **.bg-purple_light[mapear los atributos est√©ticos en funci√≥n de los datos]** en `aes()` para que dependan de variables de los datos

Por ejemplo, vamos a asignar un **.bg-purple_light[color a cada dato en funci√≥n de su continente]** con `aes(color = continent)`


```r
# Tama√±o fijo
# Color por continentes
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
*          color = continent)) +
  geom_point(size = 7)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-746-1.png" width="91%" /&gt;

]

---

# Mapeado de atributos est√©ticos: .orange[aes()]


.pull-left[
  
Podemos combinarlo con lo que hemos hecho anteriormente:

* **.bg-purple_light[color]** en funci√≥n del **.bg-orange[continente]**.

* **.bg-purple_light[tama√±o]** en funci√≥n de la **.bg-orange[poblaci√≥n]**.

* **.bg-purple_light[transparencia]** la fijamos  **.bg-orange[constante]** del 50%.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent,
           size = pop)) +
  geom_point(alpha = 0.7)
```

A este scatter plot particular se le conoce **.bg-purple_light[bubble chart]**

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-748-1.png" width="91%" /&gt;

]

---

# Visualizaci√≥n .orange[MULTIVARIANTE]

.pull-left[
  
Reflexionemos sobre el gr√°fico anterior:

* **color** en funci√≥n del **continente**.
* **tama√±o** en funci√≥n de la **poblaci√≥n**
* **transparencia** fija del 50%

Usando los datos hemos conseguido dibujar en un **.bg-purple_light[gr√°fico bidimensional 4 variables]**: `lifeExp` y `gdpPercap` en los ejes , `continent` como color y `pop` como tama√±o de la geometr√≠a, con muy pocas l√≠neas de c√≥digo.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.7)
```
]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-750-1.png" width="91%" /&gt;

]

---

# .orange[GEOMETR√çA]: .green[geom()]

Vamos a modificar la **.bg-purple_light[capa de geometr√≠a]** (al igual que hemos usado `geom_point()`)

.pull-left[

* **.bg-purple_light[l√≠neas]**: la geometr√≠as como l√≠nea con `geom_line()`.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_line(alpha = 0.8, size = 1.5)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-752-1.png" width="85%" /&gt;

]
  
---

# .orange[GEOMETR√çA]: .green[geom()]



Vamos a modificar la **.bg-purple_light[capa de geometr√≠a]** (al igual que hemos usado `geom_point()`)

.pull-left[

Asignado los  **.bg-purple_light[colores a la variable continent]**, autom√°ticamente obtenemos autom√°ticamente una **.bg-purple_light[curva por continente]**.

* **.bg-purple_light[l√≠neas]**: la geometr√≠as como l√≠nea con `geom_line()`.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent)) +
  geom_line(alpha = 0.8, size = 1.5)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-754-1.png" width="85%" /&gt;

]

---


# .orange[GEOMETR√çA]: .green[geom()]


Vamos a modificar la **.bg-purple_light[capa de geometr√≠a]** (al igual que hemos usado `geom_point()`)

.pull-left[

* **.bg-purple_light[hex√°gonos]**: la geometr√≠as como hex√°gonos con `geom_hex()`. Dado que ahora nuestra geometr√≠a tiene **.bg-purple_light[volumen]** tendremos dos par√°metros: `color`  para el contorno y `fill` para el relleno.


```r
ggplot(gapminder_1997 %&gt;%
         filter(continent != "Oceania"),
       aes(y = gdpPercap, x = lifeExp,
           fill = continent, size = pop)) +
  geom_hex(alpha = 0.8)
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-756-1.png" width="85%" /&gt;

]


---

# .orange[GEOMETR√çA]: .green[geom()]


Vamos a modificar la **.bg-purple_light[capa de geometr√≠a]** (al igual que hemos usado `geom_point()`)

.pull-left[

* **.bg-purple_light[textos]**: la geometr√≠as como textos con `geom_text()` (aparezcan textos que tengamos en alguna variable, que mapearemos en `aes()` por el par√°metro `label = ...`



```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop,
*          label = country)) +
  geom_text(alpha = 0.8)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-758-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[coordenadas]

A veces querremos representar alguna de las variables usando **.bg-purple_light[escalas que no sean la lineal]**.


.pull-left[

Una muy habitual es la **.bg-purple_light[escala logar√≠tmica]** (importante indicarlo en el gr√°fico), lo que podemos hacer facilmente con `scale_x_log10()` y `scale_y_log10()`.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  # Eje Y con escala logar√≠tmica
* scale_y_log10()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-760-1.png" width="85%" /&gt;

]
  
---

# .orange[ESCALAS (scale)]: .green[coordenadas]

A veces querremos mantener la escala pero **.bg-purple_light[fijar l√≠mites en los ejes]**.


.pull-left[

Eso lo podemos hacer dentro de las funciones `scale_x_...()` y `scale_y_...()` con `limits = ...`


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() + 
  scale_x_continuous(
*   limits = c(0, 100))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-762-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[coordenadas]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[formatear los ejes]**


.pull-left[

Por ejemplo, con `breaks = ...` podemos determinar el **.bg-purple_light[espaciado exacto]** que queremos en la gr√°fica.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() + 
  scale_x_continuous(
*   breaks = seq(35, 85, by = 5))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-764-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[coordenadas]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[formatear los ejes]**

.pull-left[

Haciendo uso del paquete `{scales}` podemos a√±adir **.bg-purple_light[prefijo/sufijo a las etiquetas]** mostradas en los ejes, asign√°ndoselo al par√°metro `labels = ...`


```r
library(scales)
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() + 
  scale_x_continuous(
    breaks = seq(35, 85, by = 5),
    labels =
*     label_number(suffix = " a√±os"))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-766-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[coordenadas]

.pull-left[

Tenemos funciones concretas para **.bg-purple_light[formatear ejes]** como fechas (`scale_x_date()`), porcentajes (`labels = label_percent()`) o incluso **unidades monetarias** (`labels = label_dollar()`).


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10(
    labels =
      label_dollar(big.mark = ".",
                   accuracy = 3,
                   prefix = "",
                   suffix = "$")) + 
  scale_x_continuous(
    breaks = seq(35, 85, by = 5),
    labels =
*     label_number(suffix = " a√±os"))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-768-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[colores]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[proporcionar una paleta de colores]**

.pull-left[

ggplot selecciona autom√°ticamente una paleta de colores, pero podemos indicarle alguna concreta. La primera y m√°s inmediata es indicarle los **.bg-purple_light[colores manualmente]** con `scale_color_manual()`.


```r
pal &lt;- c("#A02B85", "#2DE86B", "#4FB2CA",
         "#E8DA2D", "#E84C2D")
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
* scale_color_manual(values = pal)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-770-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[colores]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[proporcionar una paleta de colores]**

.pull-left[

Otra opci√≥n es elegir alguna de las **.bg-purple_light[paletas de colores dise√±adas]** en el paquete `{ggthemes}`:

* `scale_color_economist()`: paleta de colores basada en los colores de **.bg-purple_light[The Economist]**.


```r
library(ggthemes)
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
* scale_color_economist()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-772-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[colores]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[proporcionar una paleta de colores]**

.pull-left[

Otra opci√≥n es elegir alguna de las **.bg-purple_light[paletas de colores dise√±adas]** en el paquete `{ggthemes}`:

* `scale_color_excel()`: paleta de colores basada en los colores del **.bg-purple_light[Excel]**.



```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
* scale_color_excel()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-774-1.png" width="85%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[colores]

La capa de escalas tambi√©n nos sirve para **.bg-purple_light[proporcionar una paleta de colores]**

.pull-left[

Otra opci√≥n es elegir alguna de las **.bg-purple_light[paletas de colores dise√±adas]** en el paquete `{ggthemes}`:

* `scale_color_tableau()`: paleta de colores basada en los colores de  **.bg-purple_light[Tableau]**.



```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
* scale_color_tableau()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-776-1.png" width="85%" /&gt;

]


---

# .orange[ESCALAS (scale)]: .green[colores]


Tambi√©n existen **m√∫ltiples paquetes** que nos proporcionan **paletas de colores** 


.pull-left[

* **.bg-purple_light[pel√≠culas]**: paquete `{harrypotter}` (repositorio de Github `aljrico/harrypotter`) usando `scale_color_hp_d()`.


```r
library(devtools)
repo &lt;- "aljrico/harrypotter"
*install_github(repo = repo)

library(harrypotter)
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
  scale_color_hp_d(
*   option = "ravenclaw")
```

]

.pull-right[


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://raw.githubusercontent.com/aljrico/harrypotter/master/readme_raw_files/palettes/ravenclaw.png" alt="Paleta basada en la casa Ravenclaw" width="15%" /&gt;
&lt;p class="caption"&gt;Paleta basada en la casa Ravenclaw&lt;/p&gt;
&lt;/div&gt;

&lt;img src="index_files/figure-html/unnamed-chunk-779-1.png" width="70%" /&gt;

]

---

# .orange[ESCALAS (scale)]: .green[colores]


.pull-left[

* **.bg-purple_light[cuadros]**: paquete `{MetBrewer}` (repositorio de Github `BlakeRMills/MetBrewer`) usando `scale_colour_manual(values = met.brewer(...))`.


```r
repo &lt;- "BlakeRMills/MetBrewer"
*install_github(repo = repo)

library(MetBrewer)
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
  scale_color_manual(
*   values = met.brewer("Hokusai"))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-781-1.png" width="85%" /&gt;

]



---


# .orange[ESCALAS (scale)]: .green[colores]


.pull-left[

* **.bg-purple_light[discos]**: paquete `{peRReo}` (repositorio de Github `jbgb13/peRReo`) usando `scale_colour_manual(values = latin_palette())`.



```r
library(devtools)
repo &lt;- "jbgb13/peRReo"
*install_github(repo = repo)

library(peRReo)
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
  scale_color_manual(
*   values = latin_palette("rosalia"))
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-783-1.png" width="85%" /&gt;

]


---

# .orange[COMPONER]: .green[facet()]

Tambi√©n podemos **.bg-purple_light[dividir/desagregar los gr√°ficos (facetar)]** por variables.

.pull-left[

Por ejemplo, vamos a crear un **.bg-purple_light[gr√°fico por continente]**, mostrando todos los gr√°ficos a la vez pero por separado, con `facet_wrap(~continent)`.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
* facet_wrap(~continent)
```


]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-785-1.png" width="85%" /&gt;

]

---

# .orange[COMPONER]: .green[facet()]

Tambi√©n podemos **.bg-purple_light[dividir/desagregar los gr√°ficos (facetar)]** por variables.

.pull-left[

Tambi√©n le podemos pasar argumentos opcionales para indicarle el **.bg-purple_light[n√∫mero de columnas o filas]** que queremos.



```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
* facet_wrap(~continent, nrow = 3)
```


]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-787-1.png" width="85%" /&gt;

]

---

# .orange[COMPONER]: .green[facet()]

Tambi√©n podemos **.bg-purple_light[dividir/desagregar los gr√°ficos (facetar)]** por variables.

.pull-left[

Tambi√©n le podemos pasar dos argumentos (variables) para formar un **.bg-purple_light[grid de gr√°ficas]**



```r
*ggplot(gapminder,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.9) +
  scale_y_log10() +
* facet_grid(continent ~ year)
```


]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-789-1.png" width="85%" /&gt;

]


---

# .orange[ESTAD√çSTICA]: .green[stat_...()]

Tambi√©n podemos a√±adir **.bg-purple_light[capas estad√≠sticas]**

.pull-left[

* `stat_smooth()`: visualiza un **.bg-purple_light[ajuste suavizado]** (con glm, loess, o regresi√≥n lineal por ejemplo).


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.7, size = 5) +
  scale_y_log10() +
  scale_color_tableau() +
* stat_smooth(method = "lm")
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-791-1.png" width="85%" /&gt;

]

---


# .orange[ESTAD√çSTICA]: .green[stat_...()]

Tambi√©n podemos a√±adir **.bg-purple_light[capas estad√≠sticas]**

.pull-left[

Podemos indicarle en `se = FALSE` que no pinte los intervalos de confianza.


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.7, size = 5) +
  scale_y_log10() +
  scale_color_tableau() +
  stat_smooth(method = "lm",
*             se = FALSE)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-793-1.png" width="85%" /&gt;

]

---


# .orange[ESTAD√çSTICA]: .green[stat_...()]

Tambi√©n podemos a√±adir **.bg-purple_light[capas estad√≠sticas]**

.pull-left[

Si las trazas est√°n separadas realizada el suavizado de todas ellas. 


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent)) +
  geom_point(alpha = 0.7, size = 5) +
  scale_y_log10() +
  scale_color_tableau() +
  stat_smooth(method = "lm",
              se = FALSE)
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-795-1.png" width="85%" /&gt;

]



---


# .orange[ETIQUETAR]: .green[geom_text()]

.pull-left[

Podemos combinarlo con `geom_text()` para  **.bg-purple_light[a√±adir la ecuaci√≥n del ajuste]**


```r
lm_fit &lt;-
  lm(data = gapminder_1997,
     formula = gdpPercap ~ lifeExp)
a &lt;- round(coef(lm_fit)[1], 2)
b &lt;- round(coef(lm_fit)[2], 2)

ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp)) +
  geom_point(alpha = 0.7, size = 5) +
  scale_y_log10() +
  stat_smooth(method = "lm",
              se = FALSE) +
  geom_text(x = 45, y = log10(30000),
            label =
              glue("Y = {a} + {b}X"),
            size = 5)
```

]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-797-1.png" width="85%" /&gt;


]

---

# .orange[ESTAD√çSTICA]: .green[stat_...()]

Tambi√©n podemos a√±adir **.bg-purple_light[capas estad√≠sticas]**

.pull-left[

Con `stat_summary()` podemos incluso a√±adir estad√≠sticas por grupos, como la media o mediana.


```r
ggplot(gapminder,
       aes(y = gdpPercap, x = year)) +
  geom_point(alpha = 0.7, size = 3) +
  stat_summary(fun = "mean", size = 0.3,
               color = "coral") + 
  stat_summary(fun = "median", size = 0.3,
               color = "darkcyan")
```

]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-799-1.png" width="85%" /&gt;

]

---

# .orange[ESTAD√çSTICA]: .green[stat_...()]

Tambi√©n podemos a√±adir **.bg-purple_light[capas estad√≠sticas]**

.pull-left[

F√≠jate que si no tenemos una variable cuali, la media la hace con `n = 1` (es decir, es el propio punto).


```r
ggplot(gapminder,
       aes(y = gdpPercap, x = lifeExp, color = continent)) +
  geom_point(alpha = 0.7, size = 3) +
  stat_summary(fun = "mean",
               size = 0.2,
               color = "black")
```

]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-801-1.png" width="85%" /&gt;

]


---


# .orange[TEMA]: .green[theme()]


Por √∫ltimo podemos **.bg-purple_light[personalizar el tema]** de los gr√°ficos.

.pull-left[

Por ejemplo, podemos **.bg-purple_light[a√±adir t√≠tulos,  subt√≠tulos y pie de gr√°fica]** con `labs()`,


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez")
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-803-1.png" width="85%" /&gt;

]

---

# .orange[TEMA]: .green[theme()]


Tambi√©n podemos personalizar el **.bg-purple_light[t√≠tulo de los ejes]** o el **.bg-purple_light[t√≠tulo de las leyendas]**.

.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = "Continente",
    size = "Poblaci√≥n")
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-805-1.png" width="85%" /&gt;

]

---

# .orange[TEMA]: .green[theme()]


Tambi√©n podemos **.bg-purple_light[ocultar el nombre de la leyenda]** asign√°ndole un `NULL`.

.pull-left[



```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL, size = "Poblaci√≥n")
```

]

.pull-right[


&lt;img src="index_files/figure-html/unnamed-chunk-807-1.png" width="85%" /&gt;

]

---


# .orange[TEMA]: .green[theme()]


Incluso podemos **.bg-purple_light[ocultar la leyenda]** de alguna de las variables con `guides()`


.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
* guides(size = "none") +
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL)
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-809-1.png" width="85%" /&gt;

]

---


# .orange[TEMA]: .green[theme()]

Tenemos adem√°s algunos temas ya predefinidos en el paquete `{ggthemes}`



.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL) +
* theme_excel()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-811-1.png" width="85%" /&gt;

]

---



# .orange[TEMA]: .green[theme()]

Tenemos adem√°s algunos temas ya predefinidos en el paquete `{ggthemes}`



.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL) +
* theme_fivethirtyeight()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-813-1.png" width="85%" /&gt;

]


---

# .orange[TEMA]: .green[theme()]

Tenemos adem√°s algunos temas ya predefinidos en el paquete `{ggthemes}`



.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL) +
* theme_economist()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-815-1.png" width="85%" /&gt;

]

---


# .orange[TEMA]: .green[theme()]

Tenemos adem√°s algunos temas ya predefinidos en el paquete `{ggthemes}`



.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL) +
* theme_bw()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-817-1.png" width="85%" /&gt;

]


---


# .orange[TEMA]: .green[theme()]

Una opci√≥n muy habitual es usar `theme_minimal()`, ya que es un tema muy limpio, y luego con `theme_update()` configurarlo a nuestro gusto.


.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL) +
* theme_minimal()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-819-1.png" width="83%" /&gt;

]


---

# .orange[TEMA]: .green[theme()]

* `sysfonts::font_add_google()`: le indicaremos la tipograf√≠a de &lt;https://fonts.google.com/&gt;

* `showtext_auto()` del paquete `{showtext}` nos permite su posterior uso.

* `theme_set()`: inicializamos el tema con la fuente

* `theme_update()`: configuramos cada elemento a nuestro gusto (mira `? theme`).



```r
sysfonts::font_add_google(name = "Roboto") # Fuente de google
# Usar fuentes a futuro
library(showtext)
showtext_auto()

theme_set(theme_minimal(base_family = "Roboto")) # Definir tema base

# Configurar tema
theme_update(
  plot.title = element_text(color = "#C34539", face = "bold", size = 27),
  plot.subtitle = element_text(color = "#3E6FCB", face = "bold", size = 17))
```

---


# .orange[TEMA]: .green[theme()]

Una vez definido el tema, **.bg-purple_light[todas las gr√°ficas que hagas lo tendr√°n incluido]**, y as√≠ evitas programarlo en cada una

.pull-left[


```r
ggplot(gapminder_1997,
       aes(y = gdpPercap, x = lifeExp,
           color = continent, size = pop)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  guides(size = "none") + 
  labs(
    title = "Primer scatter plot",
    subtitle = "Datos de 1997",
    caption = "Autor: J. √Ålvarez",
    x = "Esperanza de vida",
    y = "Renta per c√°pita",
    color = NULL)
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-822-1.png" width="85%" /&gt;

]

---

# .orange[UNIR] gr√°ficas

Con el paquete `{patchwork}` podremos **.bg-purple_light[combinar varias gr√°ficas]** (ver documentaci√≥n en &lt;https://patchwork.data-imaginist.com/&gt;)


Por ejemplo, vamos a combinar en una gr√°fica los datos de 1987, de 2007 y la media en todos los a√±os

--


```r
gapminder_1987 &lt;-
  gapminder %&gt;% filter(year == 1987)

gapminder_2007 &lt;-
  gapminder %&gt;% filter(year == 2007)

gapminder_mean &lt;-
  gapminder %&gt;% 
  group_by(continent, country) %&gt;% 
  summarise(gdpPercap = mean(gdpPercap),
            lifeExp = mean(lifeExp),
            pop = pop) %&gt;% 
  ungroup()
```


---

# .orange[UNIR] gr√°ficas

Tras ello vamos a definir cada gr√°fica por separado


```r
plot_1987 &lt;-
  ggplot(gapminder_1987, aes(y = gdpPercap, x = lifeExp, color = continent)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(x = "Esperanza de vida", y = "Renta per c√°pita", subtitle = "1987")

plot_2007 &lt;-
  ggplot(gapminder_2007, aes(y = gdpPercap, x = lifeExp, color = continent)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(x = "Esperanza de vida", y = "Renta per c√°pita", subtitle = "2007")

plot_mean &lt;-
  ggplot(gapminder_mean, aes(y = gdpPercap, x = lifeExp, color = continent)) +
  geom_point(alpha = 0.8) +
  scale_y_log10() +
  scale_color_tableau() +
  labs(x = "Esperanza de vida", y = "Renta per c√°pita", subtitle = "Media (1952-2007)")
```

---

# .orange[UNIR] gr√°ficas

Por √∫ltimo con `{patchwork}` podemos combinar las gr√°ficas sum√°ndolas `+` (con `|` podremos poner una al lado de la otra), y con `&amp;` podremos modificar aspectos de las mismas, de todas ellas a la vez.

.pull-left[

Con `plot_layout(guides = "collect")` le indicamos que unifique leyenda y con `plot_annotation()` anotaciones globales.


```r
library(patchwork)
plot_combined &lt;-
  (plot_mean | (plot_1987 + plot_2007)) &amp;
  theme(legend.position = "bottom") &amp;
  labs(color = "continente")

plot_combined + 
  plot_annotation(
    title = "Uni√≥n de gr√°ficas",
    caption = "Autor: J. √Ålvarez") +
  plot_layout(guides = "collect")
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-826-1.png" width="85%" /&gt;

]

---

# .orange[EXPORTAR] gr√°ficas

Con `ggsave()` podemos adem√°s **.bg-purple_light[exportar nuestros gr√°ficos]**


```r
plot_combined &lt;-
  (plot_mean | (plot_1987 + plot_2007)) &amp;
  theme(legend.position = "bottom") &amp;
  labs(color = "continente")

plot_combined &lt;-
  plot_combined + 
  plot_annotation(
    title = "Uni√≥n de gr√°ficas",
    caption = "Autor: J. √Ålvarez") +
  plot_layout(guides = "collect")

*ggsave("./gapminder.pdf")
*ggsave("./gapminder.png")
```




---


# .orange[ANIMAR] gr√°ficas

Por √∫ltimo, podemos incluso **.bg-purple_light[animar gr√°ficas]**, con el paquete `{gganimate}`


```r
library(gganimate)
p &lt;-
  ggplot(gapminder,
       aes(y = gdpPercap, x = lifeExp,
           size = pop, color = country)) +
  geom_point(alpha = 0.7) +
  scale_y_log10() +
  scale_colour_manual(values = country_colors) +
  facet_wrap(~continent) +
  theme(legend.position = 'none') +
  labs(title = 'A√±o: {frame_time}',
       x = "Esperanza de vida",
       y = "Renta per c√°pita") +
  transition_time(year) +
  ease_aes('linear')
animate(p, 100, 10)
```

---

class: inverse center middle
name: clase-15

# CLASE 15: profundizando en ggplot

&amp;nbsp;


### [Diagramas de barras](#bar-plots)

### [HTML y gr√°ficos interactivos](#html-textos)

---

name: bar-plots


# Diagrama de .orange[BARRAS]


El gr√°fico anterior (diagrama de puntos o scatter plot) est√° principalmente pasado para **.bg-purple_light[representar variables num√©ricas spanontinuas]**. ¬øY si tengo **.bg-orange[variables discretas o cualitativas]**?

Vamos a usar el ya conocido conjunto `starwars` para visualizar en un **.bg-purple_light[diagrama de barras]**: vamos a representar la **.bg-purple_light[frecuencia]**  de una **.bg-orange[variable cualitativa]** como es `sex`.


```r
starwars %&gt;% 
  count(sex)
```

```
&gt; # A tibble: 5 √ó 2
&gt;   sex                n
&gt;   &lt;chr&gt;          &lt;int&gt;
&gt; 1 female            16
&gt; 2 hermaphroditic     1
&gt; 3 male              60
&gt; 4 none               6
&gt; 5 &lt;NA&gt;               4
```


---

# Diagrama de .orange[BARRAS]

.pull-left[

Para visualizar un **diagrama de barras** todo lo que hemos aprendido nos sirve: solo tenemos que **.bg-purple_light[cambiar la geometr√≠a]** con `geom_bar()` en lugar de `geom_point()`, con `x = sex` (ggplot har√° solo el recuento por nosotros)


```r
starwars &lt;- starwars %&gt;% drop_na(sex)
ggplot(starwars,
       aes(x = sex)) +
* geom_bar() +
  theme_minimal()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-831-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Podemos aplicar lo aprendido sobre **.bg-purple_light[colores para codificar]** la informaci√≥n, en este caso vamos a usar las paletas ya cargadas en `scale_color_brewer()` (info en &lt;https://colorbrewer2.org&gt;). F√≠jate que ahora ser√° importante distinguir entre `color` y `fill`


```r
ggplot(starwars, aes(x = sex)) +
* geom_bar(aes(color = sex),
           alpha = 0.5) + 
  scale_color_brewer(palette = "Dark2") + 
  theme_minimal()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-833-1.png" width="95%" /&gt;

]

---


# Diagrama de .orange[BARRAS]

.pull-left[

F√≠jate que ahora ser√° importante distinguir entre `color` y `fill`


```r
ggplot(starwars, aes(x = sex)) +
* geom_bar(aes(fill = sex),
           alpha = 0.5) + 
  scale_fill_brewer(palette = "Dark2") + 
  theme_minimal()
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-835-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Podemos personalizar el gr√°fico haciendo uso de las opciones ya vistas.


```r
theme_set(theme_minimal())
theme_update(
  plot.title =
    element_text(size = 25, face = "bold"),
  plot.subtitle = element_text(size = 13),
  plot.caption = element_text(size = 9)
)

ggplot(starwars, aes(x = sex)) +
  geom_bar(aes(fill = sex),
           alpha = 0.5) + 
  scale_fill_brewer(palette = "Dark2") + 
  labs(x = "Sexo", y = "Frecuencia",
       fill = "Sexo",
       title = "Diagrama de barras de starwars",
       subtitle = "Frec. de variable sexo",
       caption =
         "Autor: J. √Ålvarez Li√©bana")
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-837-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Haciendo uso de los que sabemos **.bg-purple_light[sobre factores]** podemos indicarle que nos ordene las columnas de mayor a menor frecuencia, usando simplemente `fct_infreq()`


```r
ggplot(starwars,
       aes(x = fct_infreq(sex))) +
  geom_bar(aes(fill = sex),
           alpha = 0.5) + 
  scale_fill_brewer(palette = "Dark2") + 
  labs(x = "Sexo", y = "Frecuencia",
       fill = "Sexo",
       title = "Diagrama de barras de starwars",
       subtitle =
         "Frec. de la variable sexo",
       caption =
         "Autor: J. √Ålvarez Li√©bana")
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-839-1.png" width="95%" /&gt;

]


---

# Diagrama de .orange[BARRAS]

.pull-left[

Para cambiar el rol de los ejes, generando un diagrama de **.bg-purple_light[barras horizontales]**, podemos dejar el gr√°fico igual y luego simplemente hacer `coord_flip()`


```r
ggplot(starwars,
       aes(x = fct_infreq(sex))) +
  geom_bar(aes(fill = sex),
           alpha = 0.5) + 
* coord_flip() +
  scale_fill_brewer(palette = "Dark2") + 
  labs(x = "Sexo", y = "Frecuencia",
       fill = "Sexo",
       title = "Diagrama de barras de starwars",
       subtitle =
         "Frec. de la variable sexo",
       caption =
         "Autor: J. √Ålvarez Li√©bana")
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-841-1.png" width="90%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Para **.bg-purple_light[invertir el orden de los factores]** basta usar `fct_rev()`


```r
ggplot(starwars,
       aes(x = fct_rev(fct_infreq(sex)))) +
  geom_bar(aes(fill = sex),
           alpha = 0.5) + 
* coord_flip() +
  scale_fill_brewer(palette = "Dark2") + 
  labs(x = "Sexo", y = "Frecuencia",
       fill = "Sexo",
       title = "Diagrama de barras de starwars",
       subtitle =
         "Frec. de la variable sexo",
       caption =
         "Autor: J. √Ålvarez Li√©bana")
```

]


.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-843-1.png" width="90%" /&gt;

]


---


# Diagrama de .orange[BARRAS]

.pull-left[

La capa `geom_bar()` est√° solo pensada para **.bg-purple_light[conteos de variables discretas o cualitativas]**. ¬øY si queremos visualizar en gapminder el producto interior bruto por a√±o? Usaremos `geom_col()` (ahora si necesitamos dos argumentos x,y)



```r
ggplot(gapminder,
       aes(y = gdpPercap, x = year)) +
* geom_col() +
  theme_minimal()
```

F√≠jate que por defecto lo que hace es **.bg-purple_light[sumar la variable continua]** en cada a√±o

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-845-1.png" width="95%" /&gt;

]


---

# Diagrama de .orange[BARRAS]

.pull-left[

Si a√±adimos `fill = continent` nos crear√° lo que se conoce como **.bg-purple_light[diagrama de barras apilado]** (en cada barra apilar√° los continentes uno encima de otros). Usaremos una paleta `scale_fill_colorblind()` pensada para personas dalt√≥nicas.



```r
ggplot(gapminder,
       aes(y = gdpPercap, x = year)) +
* geom_col(aes(fill = continent),
           alpha = 0.7) + 
  scale_fill_colorblind() +
  theme_minimal()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-847-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Si a√±adimos `position = "dodge"` nos crear√° lo que se conoce como **.bg-purple_light[diagrama de barras desapilado]**: nos pinta las barras de cada pa√≠s y a√±o (coloreados por continente) unas al lado de otras. 



```r
ggplot(gapminder,
       aes(y = gdpPercap, x = year)) +
  geom_col(aes(fill = continent),
           alpha = 0.7,
*          position = "dodge") +
  scale_fill_colorblind() +
  theme_minimal()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-849-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

En este caso no parece una muy buena idea ya que tenemos muchos pa√≠ses. Si usamos `position = "dodge2"` nos crear√° el gr√°fico pero usando el m√°ximo de cada grupo (continente).


```r
ggplot(gapminder,
       aes(y = gdpPercap, x = year)) +
  geom_col(aes(fill = continent),
           alpha = 0.7,
*          position = "dodge2") +
  scale_fill_colorblind() +
  theme_minimal()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-851-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Podemos hacer antes un resumen para visualizar la media por continente y a√±o


```r
gapminder_continent &lt;-
  gapminder %&gt;% 
  group_by(continent, year) %&gt;%
  summarise(mean_gdp = mean(gdpPercap)) %&gt;% 
  ungroup()
ggplot(gapminder_continent,
       aes(y = mean_gdp, x = year)) +
  geom_col(aes(fill = continent),
           alpha = 0.7,
*          position = "dodge2") +
  scale_fill_colorblind() +
  theme_minimal()
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-853-1.png" width="95%" /&gt;

]

---

# Diagrama de .orange[BARRAS]

.pull-left[

Con `position = fill` lo que hacemos es que todas las barras ocupen lo mismo para **.bg-purple_light[facilitar la comparaci√≥n]** (a√±adimos de paso la leyenda debajo)


```r
ggplot(gapminder_continent,
       aes(y = mean_gdp, x = year)) +
  geom_col(aes(fill = continent),
           alpha = 0.7,
*          position = "fill") +
  scale_fill_colorblind() +
  theme_minimal() +
* theme(legend.position = "bottom") +
  labs(x = "A√±o", y = "PIB medio",
       fill = "continente",
       title = "Diagrama de barras")
```

]

.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-855-1.png" width="95%" /&gt;

]


---

name: html-textos

# .orange[HTML] en textos

Con el paquete `{ggtext}` podemos indicarle dentro del tema `theme()` si alguno de los elementos lo vamos a querer **.bg-purple_light[escribir en HTML dando colores a textos]** haciendo uso de `element_markdown()`


```r
library(ggtext)
ggplot(gapminder_continent, aes(y = mean_gdp, x = year)) +
  geom_col(aes(fill = continent), alpha = 0.7, position = "fill") +
  scale_fill_colorblind() +
  theme_minimal() +
* theme(legend.position = "none",
*       plot.subtitle = element_markdown(face = "bold")) +
  labs(x = "A√±o", y = "PIB medio",
       title = "Diagrama de barras",
       subtitle = "Media del PIB en &lt;span style = 'color:#606060;'&gt;√Åfrica&lt;/span&gt;, &lt;span style = 'color:#f3bb53;'&gt;Am√©rica&lt;/span&gt;, &lt;span style = 'color:#7bcbf3;'&gt;Asia&lt;/span&gt;, &lt;span style = 'color:#48bf9f;'&gt;Europa&lt;/span&gt; y &lt;span style = 'color:#f3eb73;'&gt;Ocean√≠a&lt;/span&gt;")
```

---

# .orange[HTML] en textos

&lt;img src="index_files/figure-html/unnamed-chunk-857-1.png" width="50%" /&gt;

---
  
# .orange[INTERACTIVOS]: plotly

Tambi√©n podemos crear **.bg-purple_light[gr√°ficos interactivos]**: vamos a a√±adirle un  nuevo **.bg-purple_light[atributo de texto]** dentro de `geom_col()`, que construimos con `str_glue()` (&lt;b&gt;...&lt;/b&gt; para meter negrita en HTML). Y guardamos el gr√°fico


```r
gg &lt;-
  ggplot(gapminder_continent, aes(y = mean_gdp, x = year)) +
  geom_col(aes(fill = continent,
* text =
  str_glue(
  "&lt;b&gt;PIB medio&lt;/b&gt;: {round(mean_gdp, 2)}$
  &lt;b&gt;Continente&lt;/b&gt;: {continent}
  &lt;b&gt;A√±o&lt;/b&gt;: {year}")),
  alpha = 0.7, position = "fill") +
  scale_fill_colorblind() +
  theme_minimal() +
  theme(legend.position = "bottom") + 
  labs(x = "A√±o", y = "PIB medio",
       title = "Diagrama de barras")
```

---

# .orange[INTERACTIVOS]: plotly


La librer√≠a `{plotly}` es una librer√≠a poco conocida pero muy completa para generar **.bg-purple_light[gr√°ficos interactivos]**. Podemos o usar la gram√°tica propia de dicho paquete o, aprovechando que tenemos ya el gr√°fico generado en ggplot, **.bg-purple_light[convertirlo a interactivo]** con `ggplotly()` (indic√°ndole en `tooltip = ...` que atributos queremos que se visualicen al pasar el rat√≥n)


```r
library(plotly)
ggplotly(gg, tooltip = c("text"))
```


---

# .orange[INTERACTIVOS]: plotly

<div id="htmlwidget-d20dabd36b68245f4577" style="width:70%;height:700px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-d20dabd36b68245f4577">{"x":{"data":[{"orientation":"v","width":[4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5],"base":[0.952708598111373,0.954358779223076,0.951996569463208,0.946505693830392,0.949044996083606,0.947543903123967,0.951902519311172,0.958756869122911,0.959913418875341,0.96294946569192,0.963239654619816,0.962065066059655],"x":[1952,1957,1962,1967,1972,1977,1982,1987,1992,1997,2002,2007],"y":[0.0472914018886267,0.0456412207769236,0.0480034305367918,0.0534943061696077,0.0509550039163942,0.0524560968760334,0.0480974806888278,0.0412431308770888,0.0400865811246586,0.0370505343080801,0.0367603453801837,0.0379349339403448],"text":["<b>PIB medio<\/b>: 1252.57$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1952","<b>PIB medio<\/b>: 1385.24$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1957","<b>PIB medio<\/b>: 1598.08$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1962","<b>PIB medio<\/b>: 2050.36$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1967","<b>PIB medio<\/b>: 2339.62$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1972","<b>PIB medio<\/b>: 2585.94$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1977","<b>PIB medio<\/b>: 2481.59$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1982","<b>PIB medio<\/b>: 2282.67$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1987","<b>PIB medio<\/b>: 2281.81$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1992","<b>PIB medio<\/b>: 2378.76$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 1997","<b>PIB medio<\/b>: 2599.39$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 2002","<b>PIB medio<\/b>: 3089.03$<br /><b>Continente<\/b>: Africa<br /><b>A√±o<\/b>: 2007"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,0,0,0.7)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Africa","legendgroup":"Africa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5],"base":[0.798701870557711,0.802267827448396,0.804763015622975,0.798620090389056,0.80766880335025,0.798407488322447,0.806409222067998,0.817946165434532,0.818580937822493,0.824493544042868,0.831893894997778,0.826942090273792],"x":[1952,1957,1962,1967,1972,1977,1982,1987,1992,1997,2002,2007],"y":[0.154006727553662,0.15209095177468,0.147233553840233,0.147885603441337,0.141376192733356,0.14913641480152,0.145493297243174,0.140810703688379,0.141332481052848,0.138455921649052,0.131345759622038,0.135122975785863],"text":["<b>PIB medio<\/b>: 4079.06$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1952","<b>PIB medio<\/b>: 4616.04$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1957","<b>PIB medio<\/b>: 4901.54$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1962","<b>PIB medio<\/b>: 5668.25$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1967","<b>PIB medio<\/b>: 6491.33$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1972","<b>PIB medio<\/b>: 7352.01$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1977","<b>PIB medio<\/b>: 7506.74$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1982","<b>PIB medio<\/b>: 7793.4$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1987","<b>PIB medio<\/b>: 8044.93$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1992","<b>PIB medio<\/b>: 8889.3$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 1997","<b>PIB medio<\/b>: 9287.68$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 2002","<b>PIB medio<\/b>: 11003.03$<br /><b>Continente<\/b>: Americas<br /><b>A√±o<\/b>: 2007"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(230,159,0,0.7)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Americas","legendgroup":"Americas","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5],"base":[0.602544180088376,0.611571668066277,0.632662996195583,0.642831260862377,0.629352123287509,0.640359676402933,0.662323073382788,0.680481170377275,0.66679985463529,0.671321942380566,0.688012533042515,0.673766805031049],"x":[1952,1957,1962,1967,1972,1977,1982,1987,1992,1997,2002,2007],"y":[0.196157690469336,0.190696159382119,0.172100019427393,0.155788829526678,0.178316680062741,0.158047811919513,0.14408614868521,0.137464995057257,0.151781083187203,0.153171601662302,0.143881361955263,0.153175285242743],"text":["<b>PIB medio<\/b>: 5195.48$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1952","<b>PIB medio<\/b>: 5787.73$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1957","<b>PIB medio<\/b>: 5729.37$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1962","<b>PIB medio<\/b>: 5971.17$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1967","<b>PIB medio<\/b>: 8187.47$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1972","<b>PIB medio<\/b>: 7791.31$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1977","<b>PIB medio<\/b>: 7434.14$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1982","<b>PIB medio<\/b>: 7608.23$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1987","<b>PIB medio<\/b>: 8639.69$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1992","<b>PIB medio<\/b>: 9834.09$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 1997","<b>PIB medio<\/b>: 10174.09$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 2002","<b>PIB medio<\/b>: 12473.03$<br /><b>Continente<\/b>: Asia<br /><b>A√±o<\/b>: 2007"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(86,180,233,0.7)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Asia","legendgroup":"Asia","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5],"base":[0.388808568323732,0.382151994507502,0.381378729766887,0.378177342598925,0.357556711514759,0.350607313964265,0.35962174808262,0.369454003067469,0.36706419161515,0.374190205332155,0.380966545678531,0.366084683349535],"x":[1952,1957,1962,1967,1972,1977,1982,1987,1992,1997,2002,2007],"y":[0.213735611764644,0.229419673558775,0.251284266428695,0.264653918263452,0.27179541177275,0.289752362438668,0.302701325300168,0.311027167309806,0.299735663020141,0.297131737048411,0.307045987363984,0.307682121681514],"text":["<b>PIB medio<\/b>: 5661.06$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1952","<b>PIB medio<\/b>: 6963.01$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1957","<b>PIB medio<\/b>: 8365.49$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1962","<b>PIB medio<\/b>: 10143.82$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1967","<b>PIB medio<\/b>: 12479.58$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1972","<b>PIB medio<\/b>: 14283.98$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1977","<b>PIB medio<\/b>: 15617.9$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1982","<b>PIB medio<\/b>: 17214.31$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1987","<b>PIB medio<\/b>: 17061.57$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1992","<b>PIB medio<\/b>: 19076.78$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 1997","<b>PIB medio<\/b>: 21711.73$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 2002","<b>PIB medio<\/b>: 25054.48$<br /><b>Continente<\/b>: Europe<br /><b>A√±o<\/b>: 2007"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,158,115,0.7)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Europe","legendgroup":"Europe","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5,4.5],"base":[0,0,0,0,0,0,0,0,0,0,0,0],"x":[1952,1957,1962,1967,1972,1977,1982,1987,1992,1997,2002,2007],"y":[0.388808568323732,0.382151994507502,0.381378729766887,0.378177342598925,0.357556711514759,0.350607313964265,0.35962174808262,0.369454003067469,0.36706419161515,0.374190205332155,0.380966545678531,0.366084683349535],"text":["<b>PIB medio<\/b>: 10298.09$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1952","<b>PIB medio<\/b>: 11598.52$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1957","<b>PIB medio<\/b>: 12696.45$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1962","<b>PIB medio<\/b>: 14495.02$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1967","<b>PIB medio<\/b>: 16417.33$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1972","<b>PIB medio<\/b>: 17283.96$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1977","<b>PIB medio<\/b>: 18554.71$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1982","<b>PIB medio<\/b>: 20448.04$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1987","<b>PIB medio<\/b>: 20894.05$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1992","<b>PIB medio<\/b>: 24024.18$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 1997","<b>PIB medio<\/b>: 26938.78$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 2002","<b>PIB medio<\/b>: 29810.19$<br /><b>Continente<\/b>: Oceania<br /><b>A√±o<\/b>: 2007"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(240,228,66,0.7)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Oceania","legendgroup":"Oceania","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":40.8401826484018,"r":7.30593607305936,"b":37.2602739726027,"l":48.9497716894977},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Diagrama de barras","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1946.775,2012.225],"tickmode":"array","ticktext":["1960","1980","2000"],"tickvals":[1960,1980,2000],"categoryorder":"array","categoryarray":["1960","1980","2000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"A√±o","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"PIB medio","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.938132733408324},"annotations":[{"text":"continent","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"23cb3f5e3a93":{"x":{},"y":{},"fill":{},"text":{},"type":"bar"}},"cur_data":"23cb3f5e3a93","visdat":{"23cb3f5e3a93":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

---

florence - hiking
heat map

boxplot y alternativas: histograma y densidades, viol√≠n, etc

dumbell
flujo (acumulativos) area chart
flujo de partidos
tablas
circulos clim√°ticos y florence (coordenadas polares)
¬ømapas?

---

name: clase-17

# CLASE 17: entrega III

---


# .orange[RECURSOS] y .green[BIBLIOGRAF√çA]

&amp;nbsp;


#### üìö **.bg-purple_light[Art√≠culos o libros]** cient√≠ficos que han sido sometidos a revisi√≥n por pares.

&amp;nbsp;

#### üîó **.bg-green_light[Recursos online]** recomendados

&amp;nbsp;

#### üíª Recursos para la **.bg-orange[programaci√≥n en R]**

---

# Bibliograf√≠a general

üìö **¬´Statistical tests, P values, confidence intervals, and power: a guide to misinterpretations¬ª**. Greenland et al. (2016) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/p-value_Greenland_etal_2016.pdf&gt;

üíª **Tidy Data Tutor**: para visualizar la mec√°nica interna de `{tidyverse}`. &lt;https://tidydatatutor.com/&gt;

üîó Web con recursos para la **introducci√≥n a la estad√≠stica y Machine Learning en R** &lt;https://artofstat.com/&gt;

üíª **Manual introductorio de R** (Javier √Ålvarez Li√©bana): &lt;https://dadosdelaplace.github.io/courses-intro-R/&gt;


---

# Bibliograf√≠a general

üìö **¬´The reproducibility of research and the misinterpretation of p-values¬ª**. Colquhoun (2017) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/p-values_Colquhoun_2017.pdf&gt;


üìö **¬´An Introduction to Multivariate Statistical Analysis¬ª**. Anderson (1958) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/introduction_mva_anderson_2003.pdf&gt;

üìö **¬´A New Measure of Rank Correlation¬ª**. Kendall (1938) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/correlation_kendall_1938.pdf&gt;

üìö **¬´The generalised product moment distribution in samples from a normal multivariate population¬ª**. Wishart (1928) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/multivariate_normal_wishart_1928.pdf&gt;

üìö **¬´On lines and planes of closest fit to systems of points in space¬ª**. Pearson (1901) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bioestad/biblio/fit_pearson_1901.pdf&gt;


---

# Recursos dataviz

### Dataviz

üìö **¬´Gram√°tica de las gr√°ficas: pistas para mejorar las representaciones de datos¬ª**. Sevilla (2005) &lt;http://academica-e.unavarra.es/bitstream/handle/2454/15785/Gram%C3%A1tica.pdf&gt;

üìö **¬´Quantitative Graphics in Statistics: A Brief History¬ª**. Beniger and Robyn (1978) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/graphics_beniger_robin_1978.pdf&gt;
 
 
üíª **¬´Analizando datos, visualizando informaci√≥n, contando historias¬ª** (curso de dataviz en R). √Ålvarez-Li√©bana y Valverde-Castilla (2022) &lt;https://dadosdelaplace.github.io/curso-dataviz-ECI-2022&gt;

üìö **¬´40 years of boxplots¬ª**. Wickham and Stryjewski (2011) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/boxplot_Wickham_Stryjewski_2011.pdf&gt;
 
 


---

# Bibliograf√≠a componentes principales

üíª **Componentes principales** en `{tidymodels}`. &lt;https://www.tmwr.org/dimensionality.html#beans&gt;


üìö **¬´Principal Component Analysis¬ª**. Jolliffe (2002) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/pca_jolliffe_2002.pdf&gt;

üìö **¬´Principal Component Analysis¬ª**. Herv√© and Lynne (2010) &lt;http://staff.ustc.edu.cn/~zwp/teach/MVA/abdi-awPCA2010.pdf&gt;

üìö **¬´Principal Component Analysis: a review and recent developments¬ª**. Jolliffe and Cadima (2016) &lt;https://royalsocietypublishing.org/doi/10.1098/rsta.2015.0202&gt;

üîó **¬´The Mathematics Behind Principal Component Analysis¬ª**. Dubey (2018).  &lt;https://towardsdatascience.com/the-mathematics-behind-principal-component-analysis-fff2d7f4b643&gt;


üîó **¬´A One-Stop Shop for Principal Component Analysis¬ª**. Brems (2017). &lt;https://towardsdatascience.com/a-one-stop-shop-for-principal-component-analysis-5582fb7e0a9c&gt;

üìö **¬´On the number of principal components: a test of dimensionality based on measurements of similarity between matrices¬ª**. Dray (2008) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/numer_pca_dray_2008.pdf&gt;


---

# Bibliograf√≠a an√°lisis cl√∫ster

üìö **¬´Multiclass classification of dry beans using computer vision and machine learning techniques¬ª**. Koklu y Ozkan (2020) &lt;https://github.com/dadosdelaplace/teaching/blob/main/bdba-pca-clustering-2022/biblio/multiclass_classif_koklu_ozlan_2020.pdf&gt;

üíª **¬´Clustering y heatmaps: aprendizaje no supervisado¬ª**. Amat (2017). &lt;https://rpubs.com/Joaquin_AR/310338&gt;

üíª **¬´K-means clustering with tidy data principles¬ª** &lt;https://www.tidymodels.org/learn/statistics/k-means/&gt;

üîó **¬´ISLR tidymodels Labs¬ª** &lt;https://emilhvitfeldt.github.io/ISLR-tidymodels-labs/unsupervised-learning.html#kmeans-clustering&gt;


üìö **¬´Algorithm AS 136: a K-Means Clustering Algorithm¬ª**. Hartigan y Wong (1979) &lt;http://www.jstor.org/stable/2346830&gt;

üîó **¬´Machine Learning for Social Scientists¬ª**. Cimentada (2020) &lt;https://cimentadaj.github.io/ml_socsci/unsupervised-methods.html&gt;

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
